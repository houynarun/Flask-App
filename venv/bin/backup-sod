#!/bin/bash
# Created by Sovankiry Rim
# Date: 01 January 2015
# All Right Reserved Morakot Technology

bankdate=`psql -A -t -q -U mktuser mktdb << THE_END
SELECT "SystemDate" FROM "MKT_DATES"
THE_END`
# echo "bankdate="$bankdate

dbfilename=mktdb_SOD_${bankdate//-/}_$(date +%Y%m%d_%H%M%S).bak

#for backup postgres
pg_dump -h localhost -p 5432 -U mktuser -d mktdb -F c > /var/dbbackup/SOD/$dbfilename

# Catch error during the backup
if [ $? -ne 0 -o ${PIPESTATUS[0]} -ne 0 ]; then
        echo "False"
        echo ""
        echo "Backup failed."
        echo "Please try again."
        echo ""
        #exit 1
else
        echo "True"
        echo ""
        echo "File Name :"$dbfilename
        echo "Backup for SOD was sucessfully done. Thanks You!"
        echo "Morakot Technology. All Right Reserved. 2014"
        echo ""
fi
