from app.mktcore.wtfimports    		import *
from app.LoanApplication.forms   	import *
from app.LoanApplication.models     import *
from app.Officer.models 			import *


def loadOfficer():
	return MKT_OFFICER.query.all()


class FRM_LOAN_APPLICATION_EX(FRM_LOAN_APPLICATION):
	LoanPurpose 	= QuerySelectField(requiredlabel("Loan Purpose","*"),
						query_factory=loadLoanPurpose,
						get_label=u'Description',
						allow_blank=True,
						blank_text=u'--%s--' %getLanguage("Choose Loan Purpose"),
						validators=[validators.Required()]
					)
	VBID 			= RemoteTextField(getLanguage("Village Bank"))
	Group 			= IntegerField(getLanguage("Group"), [validators.Optional()])

	SourceOfFund 	= QuerySelectField(getLanguage("Source of Fund"),
						query_factory=loadSourceOfFund,
						get_label=u'Description',
						allow_blank=True,
						blank_text=u'--%s--' %getLanguage("Choose Source of Fund")
					)

	PreparedBy 		= TextField(getLanguage("Prepared By"), default=loadUserID, description="5-%s" %getLanguage("Signatory"))
	PreparedDate 	= DateField(getLanguage("Prepared Date"), [validators.Optional()], default=loadCurrentDate, description="5-%s" %getLanguage("Signatory"))
	ReviewedBy 		= TextField(getLanguage("Reviewed By"), description="5-%s" %getLanguage("Signatory"))
	ReviewedDate 	= DateField(getLanguage("Reviewed Date"), [validators.Optional()], description="5-%s" %getLanguage("Signatory"))
	ApprovedBy 		= TextField(getLanguage("Approved By"), description="5-%s" %getLanguage("Signatory"))
	ApprovedDate 	= DateField(getLanguage("Approved Date"), [validators.Optional()], description="5-%s" %getLanguage("Signatory"))
	RejectedBy 		= TextField(getLanguage("Rejected By"), description="5-%s" %getLanguage("Signatory"))
	RejectedDate 	= DateField(getLanguage("Rejected Date"), [validators.Optional()], description="5-%s" %getLanguage("Signatory"))

	Guarantor 		= 	QuerySelectField(getLanguage("Guarantor"),
							query_factory=loadGuarantor,
							get_label=lambda a: a.ID + " - " + a.LastNameEn + " " +a.FirstNameEn,
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							description="3-%s" %getLanguage("Guarantor")
						)
	GTRelationIndicator 		= 	QuerySelectField("Relation Indicator",
							query_factory=loadRelationIndicators,
							get_label=u'Description',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							description="3-%s" %getLanguage("Guarantor")
						)
	Type 				= SelectField("Type",
								choices=[('G', 'Guarantor'), ('R', 'Referrer'), ('S', 'Successor')],
								coerce=str,
								default='G',
								description="3-%s" %getLanguage("Guarantor")
							)

	Collateral 		= 	QuerySelectField(getLanguage("Collateral"),
							query_factory=loadCollateral,
							get_label=u'Description',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							description="4-%s" %getLanguage("Collateral")
						)
	
	CoBorrowerID 		= 	QuerySelectField(getLanguage("Co-Borrower"),
							query_factory=loadCoBorrower,
							get_label=lambda a: a.ID + " - " + a.LastNameEn + " " +a.FirstNameEn,
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							description="2-%s" %getLanguage("Co-Borrower")
						)
	# CoBorrowerName 		= 	TextField("Co-Borrower Name", description="2-%s" %getLanguage("Co-Borrower"))

	RelationIndicator 		= 	QuerySelectField("Relation Indicator",
							query_factory=loadRelationIndicators,
							get_label=u'Description',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							description="2-%s" %getLanguage("Co-Borrower")
						)

	AppStatus 		= SelectField(getLanguage("Status"),
						choices=[('1', '1. %s' %getLanguage("Applied")), ('2', '2. %s' %getLanguage("Reviewed")), ('3', '3. %s' %getLanguage("Approved")), ('4', '4. %s' %getLanguage("Rejected"))],
						default='1',
						coerce=str
					)
	Officer 		= QuerySelectField("Officer",
						query_factory=loadOfficer,
						get_label=lambda a: a.LastName + " " + a.FirstName,
						allow_blank=True,
						blank_text="--Chooser Officer--"
						)
	CheckList = QuerySelectField("Check List Item",
					query_factory=loadCheckList,
					get_label=u'Description',
					allow_blank=True,
					blank_text=u'--%s--' %"Choose Check List",
				)

	YesNo = SelectField("%s/%s" %("Yes", "No"),
					choices=[('N', 'No'), ('Y', 'Yes')],
					coerce=str,
				)

	YesDate = DateField("Yes Date", [validators.Optional()])


	@staticmethod
	def setVisible():
		MainObj = super(FRM_LOAN_APPLICATION_EX, FRM_LOAN_APPLICATION_EX).setVisible()
		NewList = [
					("CheckList"),
					("YesNo"),
					("YesDate"),
					("VBID"),
					("Group"),
					("SourceOfFund")
					]

		MainObj.extend(NewList)
		return MainObj