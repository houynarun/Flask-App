from app.LoanContract.models import MKT_LOAN_CONTRACT
from ..tools.mktloan 			import LocalLoanEx
import app.tools.mktsetting     as mktsetting
import app.tools.mktdate 		as mktdate
try:
	VATOnOff 	=   mktsetting.getAppSetting('MEGA_VAT_NO_OFF')
	BankDate 	=	str(mktdate.getBankDate())
	LoanObj 	= MKT_LOAN_CONTRACT.query.filter(MKT_LOAN_CONTRACT.DisbursedStat=='Y',MKT_LOAN_CONTRACT.ValueDate==BankDate,MKT_LOAN_CONTRACT.BookVAT=='N')
	if LoanObj.first():
		if VATOnOff =="Y":
			for LC in LoanObj:
				LocalLoanEx.VATPosting(LCID=LC.ID)
except Exception as e:
	raise e
