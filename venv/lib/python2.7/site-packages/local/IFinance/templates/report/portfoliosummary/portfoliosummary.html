{% extends "layout.html" %}

{% block css %}
<style type="text/css">
	 h3.header-3{
            color: #888 !important;
            font-size: 16px;
            font-weight: bold;
            margin: 5px 0 10px;
            padding: 10px 18px 0;
        }

        h4.header-4{
            color: #888 !important;
            font-size: 14px;
            font-weight: normal;
            margin: 5px 0 10px;
            padding: 0px 18px 0;
        }
		
</style>
<style type="text/css" media="print">
	body{
		font-size: 9px;
	}
	.title {
		font-size: 13px;
		font-weight: bold;
	}
</style>
{% endblock %}

{% block content %}

{%if ErrorMsg %}
	<div class="col-sm-12" style="padding-top:5px;">
		<div class="alert alert-danger">
		<button type="button" class="close" data-dismiss="alert">&times;</button>
		{%for message in ErrorMsg %}
			{{ message }}
		{%endfor%}
		</div>
	</div>
{%else%}
	<div class="clearfix"></div>
	<div class="col-sm-12">
		{% for message in get_flashed_messages() %}
			{% if contain(message, "Error") %}
				<div class="clearfix">&nbsp;</div>
				<div class="alert alert-danger">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
			{% else %}
				<div class="clearfix">&nbsp;</div>
				<div class="alert alert-info">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
			{% endif %}
		{% endfor %}
	</div>
	<div class="navbar navbar-default navbar-static-top">
		<div class="col-sm-6" style="margin-top: 15px;">
			<!-- Button Export -->
			{% from "print.html" import exportButtonLink %}
			{{exportButtonLink()}}
		</div>
		<div class="col-sm-6" style="margin-top: 8px;">
			<a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
				<span class="btn-label icon fa fa-refresh"></span> Refresh
			</a>
			<button  type="button" data-toggle="modal" data-target="#myModal"  class="btn btn-flat btn-labeled btn-success pull-right" >
				<span class="btn-label icon fa fa-gear" ></span> Custom 
			</button>
		</div>
	</div>

	<div class="modal fade" id="myModal" tabindex="-1" 
		role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="form-horizontal" action="/Morakot/Report/PortfolioSummary" method="GET">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Custom</h4>
                    </div>
                    <div class="modal-body">
						<input type="hidden" name="ID" value="{{ID}}">

						<div class="form-group">
                            <label for="Branch" class="col-sm-4 control-label">Branch:</label>
                            <div class="col-sm-8">
                                <input name="Branch" value="{{ Branch }}" class="input-sm form-control" style="width: 70%;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="StartMonth" class="col-sm-4 control-label">Start Month:</label>
                            <div class="col-sm-8">
                                <input type="text" value="{{Start}}" placeholder="Start Month" name="Start" id="StartMonth" class="input-sm form-control" style="width: 70%;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="EndMonth" class="col-sm-4 control-label">End Month:</label>
                            <div class="col-sm-8">
                                <input type="text" value="{{End}}" placeholder="End Month" name="End" id="EndMonth" class="input-sm form-control" style="width: 70%;">
                            </div>
                        </div>
                        
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="Apply">Apply</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div style="margin-left:10%; margin-right:10%;">
		<h3 class="header-3 text-center">{{ Company }}</h3>
		<h4 class="header-4 text-center">Portfolio Summary Report</h4>
		<h4 class="header-4 text-center"><strong>As of:</strong> {{ BankDate }}</h4>
		<h4 class="header-4 text-center"><strong>Currency:</strong> {{ BaseCurrencyObj.ID }}</h4>
	</div>

	<!--  message  -->
	<div class="col-sm-12">
		{% for message in get_flashed_messages() %}
			{% if contain(message,"Error") %}
				<div class="alert alert-danger">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				{{ message[6:]}}
			</div>
			{% elif contain(message,"Warning") %}
				<div class="alert alert-warning">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				{{ message[8:] }}
			</div>
			{% else %}
				<div class="alert alert-info">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				{{ message }}
			</div>
			{% endif %}
		{% endfor %}
	</div>
	<div class="col-sm-12">
		<table style="border: 0px;">
			<tr>
				<td width="150"><strong>Branch</strong></td>
				<td>: &nbsp;{{Branch}}</td>
			</tr>
			<tr>
				<td width="150"><strong>Start Month</strong></td>
				<td>: &nbsp;{{Start}}</td>
			</tr>
			<tr>
				<td width="150"><strong>End Month</strong></td>
				<td>: &nbsp;{{End}}</td>
			</tr>
		</table>
	</div>
	<!--Result Table-->
	{% if ListResult %}
		<div class="clearfix">&nbsp;</div>
		<table id="mktlist" class="table table-striped table" cellspacing="0" width="100%">
			<thead>
				
				<tr>
					<th></th>
					{% for DicResult in ListResult %}
					<th>{{DicResult.Header[5:7]+'/'+DicResult.Header[2:4]}}</th>
					{% endfor %}
				</tr>
			</thead>
			<tbody>
				<tr>
					<td class="text-bold">Portfolio Exposure</td>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.PortfolioExposure,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<!-- Row Volume filter by Product -->
				<tr>
					<td class="text-bold">Volumes (units)</td>
					{% for DicResult in ListResult %}
					<td></td>
					{% endfor %}
				</tr>
				{% for item in LoanProductObj %}
				<tr>
					<td>&emsp;&emsp;{{item.Description}}</td>
					{% for DicResult in ListResult %}
						{% set DicResult = DicResult.DicNumberByPro%}
						{% if DicResult[item.ID] %}
						<td>{{DicResult[item.ID]}}</td>
						{% else %}
						<td>0</td>
						{% endif %}
					{% endfor %}
				</tr>
				{% endfor %}
				<!-- End Volume -->

				<!-- Row Exposure filter by Product -->
				<tr>
					<td class="text-bold">Exposure (USD)</td>
					{% for DicResult in ListResult %}
					<td></td>
					{% endfor %}
				</tr>
				{% for item in LoanProductObj %}
				<tr>
					<td>&emsp;&emsp;{{item.Description}}</td>
					{% for DicResult in ListResult %}
						{% set DicResult = DicResult.DicAmountByPro%}
						{% if DicResult[item.ID] %}
						<td>{{mktmoney.toMoney(DicResult[item.ID],BaseCurrencyObj)}}</td>
						{% else %}
						<td>{{mktmoney.toMoney(0,BaseCurrencyObj)}}</td>
						{% endif %}
					{% endfor %}
				</tr>
				{% endfor %}
				<!-- End Exposure -->

				<!-- Row Volume filter by Purpose -->
				<tr>
					<td class="text-bold">Volumes (units)</td>
					{% for DicResult in ListResult %}
					<td></td>
					{% endfor %}
				</tr>
				{% for item in LoanPurposeObj %}
				<tr>
					<td>&emsp;&emsp;{{item.Description}}</td>
					{% for DicResult in ListResult %}
						{% set DicResult = DicResult.DicNumberByPur%}
						{% if DicResult[item.ID] %}
						<td>{{DicResult[item.ID]}}</td>
						{% else %}
						<td>0</td>
						{% endif %}
					{% endfor %}
				</tr>
				{% endfor %}
				<!-- End Volume -->

				<!-- Row Exposure filter by Purpose -->
				<tr>
					<td class="text-bold">Exposure (USD)</td>
					{% for DicResult in ListResult %}
					<td></td>
					{% endfor %}
				</tr>
				{% for item in LoanPurposeObj %}
				<tr>
					<td>&emsp;&emsp;{{item.Description}}</td>
					{% for DicResult in ListResult %}
						{% set DicResult = DicResult.DicAmountByPur%}
						{% if DicResult[item.ID] %}
						<td>{{mktmoney.toMoney(DicResult[item.ID],BaseCurrencyObj)}}</td>
						{% else %}
						<td>{{mktmoney.toMoney(0,BaseCurrencyObj)}}</td>
						{% endif %}
					{% endfor %}
				</tr>
				{% endfor %}
				<!-- End Exposure -->
				<!-- Coloumn Condition is created by AlterForm and AlterTable, 
				so its value will be store as what it shows in the list in order 
				to get the same value to show in report as well. 
				item.Condition = 'New'-->
				<!-- Row Volume filter by Condition -->
				<tr>
					<td class="text-bold">Volumes (units)</td>
					{% for DicResult in ListResult %}
					<td></td>
					{% endfor %}
				</tr>
				{% for item in LoanConditionObj %}
				<tr>
					<td>&emsp;&emsp;{{item.Condition}}</td>
					{% for DicResult in ListResult %}
						{% set DicResult = DicResult.DicNumberByCon%}
						{% if DicResult[item.Condition] %}
						<td>{{DicResult[item.Condition]}}</td>
						{% else %}
						<td>0</td>
						{% endif %}
					{% endfor %}
				</tr>
				{% endfor %}
				<!-- End Volume -->

				<!-- Row Exposure filter by Condition -->
				<tr>
					<td class="text-bold">Exposure (USD)</td>
					{% for DicResult in ListResult %}
					<td></td>
					{% endfor %}
				</tr>
				{% for item in LoanConditionObj %}
				<tr>
					<td>&emsp;&emsp;{{item.Condition}}</td>
					{% for DicResult in ListResult %}
						{% set DicResult = DicResult.DicAmountByCon%}
						{% if DicResult[item.Condition] %}
						<td>{{mktmoney.toMoney(DicResult[item.Condition],BaseCurrencyObj)}}</td>
						{% else %}
						<td>{{mktmoney.toMoney(0,BaseCurrencyObj)}}</td>
						{% endif %}
					{% endfor %}
				</tr>
				{% endfor %}
				<!-- End Exposure -->

				<tr>
					<td class="text-bold">Weighted Interest Rate</td>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.WeightedInterestRate,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td class="text-bold">Weighted LTV (Initial Advance)</td>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.WeightedInitialAdvance,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td class="text-bold">Weighted LTV (Exposure)</td>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.WeightedExposure,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td class="text-bold">Weighted Original Term (Exposure)</td>
					{% for DicResult in ListResult %}
					<td>{{DicResult.WeightedOriginalTerm}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td class="text-bold">Weighted Remaining Term (Exposure)</td>
					{% for DicResult in ListResult %}
					<td>{{DicResult.WeightedRemainingTerm}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td class="text-bold">Total Payments Made</td>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.TotalPaymentMade,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td>&emsp;&emsp;Interest</th>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.Interest,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td>&emsp;&emsp;Principal</th>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.Principal,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td>&emsp;&emsp;Charge</th>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.Charge,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td class="text-bold">Average Yield (Payments/Exposure)</td>
					{% for DicResult in ListResult %}
					<td>{{mktmoney.toMoney(DicResult.AverageYield,BaseCurrencyObj)}}</td>
					{% endfor %}
				</tr>
			</tbody>

		</table>
	{% endif%}

<!-- End ErrorMsg -->
{%endif%}

{% endblock %}

{% block js %}


{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}

<script type="text/javascript">

	$(document).ready(function() {
		$('#mktlist').dataTable({
			"lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
			"bSort" : false
		});
		{% from "print.html" import exportDataTable %}
		{{exportDataTable("#mktlist","Portfolio Summary")}}
		//Set Default Value to criteria
		$("#Refresh").click(function() {
			fn_fadeIn();
			window.location.reload(true);
		});

		init.push(function () {
			var options = {
			orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
			startView: "months", 
			minViewMode: "months",
			format:"yyyy-mm",
			autoclose:true
			}
			$('#StartMonth').datepicker(options);
			});

		init.push(function () {
			var options = {
			orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
			startView: "months", 
			minViewMode: "months",
			format:"yyyy-mm",
			autoclose:true
			}
			$('#EndMonth').datepicker(options);
			});
	});

</script>
{% endblock %}