
from app.mktcore.wtfimports 	import *
from app.Collateral.detail 		import *

class FRM_COLLATERAL_DE_EX(FRM_COLLATERAL_DE):

	CollateralID 	= 	QuerySelectField(requiredlabel(getLanguage("Collateral"), "*"),
							query_factory=loadCollateral,
							get_label=lambda a: a.ID + " - " + a.Description,
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							validators=[validators.Required()]
						)

	CollateralType 	= 	QuerySelectField(requiredlabel(getLanguage("Collateral Type"), "*"),
							query_factory=loadCollateralType,
							get_label=u'Description',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							validators=[validators.Required()]
						)
	CollateralNumber= 	TextField("Collateral Number", [validators.length(max=25)])
	LTV 			=   TextField(requiredlabel("LTV (%)","*"), validators=[validators.Required()])
	Province 		= 	QuerySelectField(getLanguage('Province'),
							query_factory=loadProvince, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose Province--'
						)
	District 		= 	QuerySelectField(getLanguage('District'),
							query_factory=loadDistrict, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose District--'
						)

	Commune 		=	QuerySelectField(getLanguage('Commune'),
							query_factory=loadCommune, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose Commune--'
						)

	Village 		=	QuerySelectField(getLanguage('Village'),
							query_factory=loadVillage, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose Village--'
						)

	Currency 		= 	QuerySelectField(requiredlabel(getLanguage("Currency"), "*"),
							query_factory=loadCurrency,
							get_label=u'ID',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							validators=[validators.Required()]
						)

	PurchasePrice 	= 	TextField(getLanguage("Purchased Price"))
	ValuationPrice 	= 	TextField(getLanguage("Valuation Price"))
	Valuer 			= 	TextField(getLanguage("Valuer"), [validators.length(max=50)])
	LTV 			=   TextField(requiredlabel("LTV (%)","*"), validators=[validators.Required()])
	IssuedDate 		= 	DateField(getLanguage("Issued Date"),
							format='%Y-%m-%d',
							default=mktdate.getDateISO(),
							validators=[validators.Optional()]
						)

	IssuedPlace 	= 	TextField(getLanguage("Issued Place"),[validators.length(max=50)])
	IssuedBy 		= 	TextField(getLanguage("Issued By"),[validators.length(max=100)])
	
	ReceivedDate 	= 	DateField(getLanguage("Received Date"),
							format='%Y-%m-%d',
							validators=[validators.Optional()]
						)
	ReceivedBy 		= 	TextField("Received By", [validators.length(max=35)])
	
	WithdrawalDate 	= 	DateField("Release Date",
							format='%Y-%m-%d',
							validators=[validators.Optional()]
						)
	
	WithdrawalBy 	= 	TextField("Release By", [validators.length(max=35)])

	Description 		= 	TextAreaField(getLanguage("Property Description"))

	@staticmethod
	def hotField():
		base 			= 		super(FRM_COLLATERAL_DE_EX,FRM_COLLATERAL_DE_EX).hotField()
		hotfield 		=		[]

		fielddisplay 	=  "$('#LTV').val(data.LTV)"
		varname 		= "CollateralType:$('#CollateralType').val()"
		fun 			= ["CollateralType", varname, fielddisplay, "/Morakot/getLTVPercentage", "click"]

		hotfield.append(fun)
		hotfield.extend(base)

		return hotfield