# -*- coding: utf-8 -*-
from app.mktcore.wtfimports 		import *

from app.Customer.forms 			import *
from app.Customer.models 			import *

import app.tools.mktdb 				as mktdb

class FRM_CUSTOMER_EX(FRM_CUSTOMER):
	PotentialCustomer 	= 	RemoteTextField("Potential Customer")

	FirstNameEn 	=	TextField(requiredlabel("%s (%s)" %(getLanguage("First Name"), getLanguage("English")),"*"),[validators.Required()])
	LastNameEn 		=	TextField(requiredlabel("%s (%s)" %(getLanguage("Last Name"), getLanguage("English")),"*"),[validators.Required()])
	FirstNameKh 	=	TextField("%s (%s)" %(getLanguage("First Name"), getLanguage("Khmer")))
	LastNameKh 		=	TextField("%s (%s)" %(getLanguage("Last Name"), getLanguage("Khmer")))
	AdditionalName	= TextField("Additional Name")
	Salutation 		=	SelectField(getLanguage("Salutation"),
							 choices=[('Mrs', 'Mrs'),('Mr', 'Mr'),('Miss','Miss')],
							 coerce=str)
	Gender 			=	SelectField(requiredlabel(getLanguage("Gender"),"*"),
							 choices=[('Female', 'Female'),('Male', 'Male'),('Other','Other')],
							 coerce=str,
							 validators=[validators.Required()])
	DateOfBirth 	=	DateField(requiredlabel(getLanguage("Date of Birth"), "*"),
							format='%Y-%m-%d',
							validators=[custom_DateOfBirth])

	CountryOfBirth 	=	QuerySelectField(getLanguage('Country of Birth'),query_factory=loadCountry, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='',
							 default=lambda:loadCountry('KH'),
							 validators=[validators.Required()])
	Nationality		=   QuerySelectField(getLanguage('Nationality'),query_factory=loadCountry, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='',
							 default=lambda:loadCountry('KH'),
							 validators=[validators.Required()])
	ProvinceOfBirth =	QuerySelectField(getLanguage('Province of Birth'),query_factory=loadProvinceOfBirth, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Province--')
	DistrictOfBirth =	QuerySelectField(getLanguage('District of Birth'),query_factory=loadDistrictOfBirth, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose District--')
	CommuneOfBirth 	=	QuerySelectField(getLanguage('Commune of Birth'),query_factory=loadCommuneOfBirth, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Commune--')
	AsGurantor 		=	SelectField(requiredlabel(getLanguage('As Guarantor'),"*"),
							 choices=[('N', 'No'),('Y', 'Yes')],
							 coerce=str,
							 validators=[validators.Required()])
	AsReferrer			= SelectField('As Referrer',
							 choices=[('N', 'No'),('Y', 'Yes')],
							 coerce=str)
	AsSuccessor			= SelectField('As Successor',
							 choices=[('N', 'No'),('Y', 'Yes')],
							 coerce=str)
	MaritalStatus 	=	SelectField(requiredlabel(getLanguage('Marital Status'),'*'),
							 choices=[('1', 'Married'),
							 		('2', 'Single'),
							 		('3','Divorced'),
							 		('4','Widow'),
							 		('5','Widower'),
							 		('6','Separated'),
							 		('7','Defacto'),
							 		('8','Unknown')],
							 coerce=str,
							 validators=[validators.Required()])
	Resident 		=	SelectField(getLanguage('Resident'),
							 choices=[('Y', 'Yes'),('N', 'No')],
							 coerce=str,
							 validators=[validators.Required()])

	Officer 		= 	QuerySelectField(requiredlabel(getLanguage('Officer'),'*'),
							query_factory=loadOfficer,
							get_label=lambda a: a.ID + " - " + a.LastName + " " +a.FirstName,
							allow_blank=True,
							blank_text=u'--None--',
							validators=[validators.Required()])
	EducationLevel 	=	QuerySelectField('Education Level',
								query_factory=loadEducationLevel, 
								get_label='Description',
								allow_blank=True,
								blank_text=u'--None--'
							)
	# --Contact and Address--
	ProvinceType	= SelectField(requiredlabel('Province Type',"*"),
							 choices=[('', '--None--'),('Province', u'ខេត្ត'),('Capital', u'រាជធានី')],
							 coerce=str,
							 validators=[validators.Required()],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	Province 		= 	QuerySelectField(requiredlabel(getLanguage('Province'),'*'),query_factory=loadProvince, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Province--',
							 validators=[validators.Required()],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	DistrictType	= SelectField(requiredlabel('District Type',"*"),
							 choices=[('', '--None--'),('District', u'ស្រុក'),('Khan', u'ខណ្ឌ'),('City', u'ក្រុង')],
							 coerce=str,
							 validators=[validators.Required()],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	District 		= 	QuerySelectField(requiredlabel(getLanguage('District'),'*'),query_factory=loadDistrict, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose District--',
							 validators=[validators.Required()],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	CommuneType		= SelectField(requiredlabel('Commune Type',"*"),
							 choices=[('', '--None--'),('Commune', u'ឃុំ'),('Sangkat', u'សង្កាត់')],
							 coerce=str,
							 validators=[validators.Required()],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	Commune 		=	QuerySelectField(requiredlabel(getLanguage('Commune'),'*'),query_factory=loadCommune, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Commune--',
							 validators=[validators.Required()],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	Village 		=	QuerySelectField(requiredlabel(getLanguage('Village'),'*'),query_factory=loadVillage, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Village--',
							 validators=[validators.Required()],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	AdditionalVillage	= TextField("Additional Village",
							 description="1-%s" %getLanguage('Current Address and Contact'))
	City 			=	TextField("City",description="1-%s" %getLanguage('Current Address and Contact'))
	HouseNo 		=	TextField("House No",
							description="1-%s" %getLanguage('Current Address and Contact'),
							validators=[validators.Length(max=25)])
	Street 		   =	TextField('Street',
							description="1-%s" %getLanguage('Current Address and Contact'),
							validators=[validators.Length(max=40)])
	Group 			= TextField("Group",description="1-%s" %getLanguage('Current Address and Contact'))
	Mobile1 		=	TextField("Mobile Phone 1",
							 description="1-%s" %getLanguage('Current Address and Contact'))
	Mobile2 		=	TextField(getLanguage("Mobile Phone 2"), description="1-%s" %getLanguage('Current Address and Contact'))
	Email 			= 	TextField(getLanguage("Email"), [validators.Optional(),validators.Email(message=u'Invalid email address.')],
							 description="1-%s" %getLanguage('Current Address and Contact'))

	# --Spouse Info--

	SpoFirstNameEn 	=	TextField("%s (%s)" %(getLanguage("First Name"), getLanguage("English")),description="2-%s" %'Spouse Info')
	SpoLastNameEn 	=	TextField("%s (%s)" %(getLanguage("Last Name"), getLanguage("English")),description="2-%s" %'Spouse Info')
	SpoFirstNameKh 	=	TextField("%s (%s)" %(getLanguage("First Name"), getLanguage("Khmer")),description="2-%s" %'Spouse Info')
	SpoLastNameKh 	=	TextField("%s (%s)" %(getLanguage("Last Name"), getLanguage("Khmer")),description="2-%s" %'Spouse Info')
	SpoDateOfBirth 	=	DateField("Spouse Date of Birth",
							 description="2-%s" %'Spouse Info',
							 validators=[custom_SpoDateOfBirth]
							)
	SpouseNationality	= QuerySelectField('Spouse Nationality',
							 query_factory=loadCountry, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='',
							 default=lambda:loadCountry('KH'),
							 description="2-%s" %'Spouse Info')

	SpoOccupation 		=	QuerySelectField(getLanguage('Occupation'),query_factory=loadPosition, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='--None--',
							 description="2-%s" %'Spouse Info'
							)
	SpoOccupationRemark =	TextAreaField("Occupation Remark",
							 description="2-%s" %'Spouse Info')
	SpouseIDType 		=	QuerySelectField('ID Type of Spouse',
								query_factory=loadIdType, 
								get_label='Description',
								allow_blank=True,
								blank_text='--None--',
								description="2-Spouse Info"
							)
	SpoNationalID 			=	TextField("# Of ID Type",description="2-%s" %'Spouse Info')


	SpouseIDIssueDate		=	DateField("Issue Date Of ID Type", validators=[custom_SpouseIDIssueDate], description="2-Spouse Info")


	# --Family Info --
	HouseOwnership 		=	SelectField('House Ownership',
								choices=[('', '--None--'),
										('1', 'Owner'),
								 		('2', 'Family'),
								 		('3', 'Sibling'),
								 		('4', 'Others Relative'),
								 		('5', 'Friend'),
								 		('6', 'Rental'),
								 		('7', 'Other')
								 		],
								coerce=str,
								description="2.1-Family Details"
							)

	NumberOfMember 		=	TextField('# Family Member', description="2.1-Family Details",
								validators=[validators.Length(max=3)])
	ActiveMember 		=	TextField('# Active Member', description="2.1-Family Details",
								validators=[validators.Length(max=3)])


	# --Employment Detail--
	EmployerType 	=	SelectField(requiredlabel('Employment Type',"*"),
							 choices=[('C', 'Current'),('P', 'Previous')],
							 coerce=str,
							 validators=[validators.Required()],
							 description="3-%s" %getLanguage('Employment Details'))

	SelfEmployed 	=	SelectField(requiredlabel(getLanguage('Self-Employed'),"*"),
							 choices=[('N', 'No'),('Y', 'Yes')],
							 coerce=str,
							 validators=[validators.Required()],
							 description="3-%s" %getLanguage('Employment Details'))
	Government 		=	SelectField('Government',
							 choices=[('N', 'No'),('Y', 'Yes')],
							 coerce=str,
							 description="3-%s" %getLanguage('Employment Details'))
	JobType			= TextField("Job Type",
							 description="3-%s" %('Employment Details'))
	Position 		=	QuerySelectField(requiredlabel('Occupation', '*'),query_factory=loadPosition, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='--None--',
							 description="3-%s" %getLanguage('Employment Details'))
	PositionRemark	=	TextAreaField("Occupation Remark",
							 description="3-%s" %('Employment Details'))

	LengthOfService =	TextField(isRequiredCBCLabel("Length Of Service(M)"),
							 validators=[validators.Length(max=3)],
							 description="3-%s" %getLanguage('Employment Details'))

	CompanyName 	=	TextField(getLanguage("Company Name"),
							description="3-%s" %getLanguage('Employment Details'),
							validators=[validators.Length(max=35)])

	CompanyBusiness =	TextField(getLanguage("Company Business"),
							description="3-%s" %getLanguage('Employment Details'),
							validators=[validators.Length(max=50)])

	EmployerName 	=	TextField(isRequiredCBCLabel("Employer Name"),
							description="3-%s" %getLanguage('Employment Details'),
							validators=[validators.Length(max=50)])

	EmployerAddressType = SelectField(isRequiredCBCLabel('Employer AddressType'),
						  choices=[('WORK', 'Work'),
						  		   ('RESID', 'Residential'),
					  			   ('POST', 'Correspondence'),
						  		   ('U', 'Unknown')
						  		  ],
						  coerce=str,
						  validators=[validators.Required()],
						  description="3-%s" %getLanguage('Employment Details'),
						  default='WORK')

	EmployerProvince = QuerySelectField(isRequiredCBCLabel('Employer Province'),query_factory=loadEmpProvince,
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Province--',
							 description="3-%s" %getLanguage('Employment Details'))

	EmployerDistrict = QuerySelectField(isRequiredCBCLabel('Employer District'),query_factory=loadEmpDistrict,
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose District--',
							 description="3-%s" %getLanguage('Employment Details'))

	EmployerCommune = QuerySelectField(isRequiredCBCLabel('Employer Commune'),query_factory=loadEmpCommune,
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Commune--',
							 description="3-%s" %getLanguage('Employment Details'))

	EmployerVillage = QuerySelectField(isRequiredCBCLabel('Employer Village'),query_factory=loadEmpVillage,
							 get_label='Description',
							 allow_blank=True,
							 blank_text=u'--Choose Village--',
							 description="3-%s" %getLanguage('Employment Details'))

	EmployerAddress =	TextField('Employer Address',
							description="3-%s" %getLanguage('Employment Details'),
							validators=[validators.Optional(),validators.Length(max=150)])

	Currency 		= 	QuerySelectField(getLanguage('Currency'),query_factory=loadCurrency, 
							 get_label='ID',
							 allow_blank=False,
							 blank_text='--None--',
							 description="3-%s" %getLanguage('Employment Details'))

	MonthlyIncome 		=	TextField(isRequiredCBCLabel("Total Monthly Salary/Income"),
							description="3-%s" %getLanguage('Employment Details'),
							validators=[validators.Required()])
	# --Classification--
	Sector 			=	QuerySelectField(requiredlabel(getLanguage('Sector'),'*'),query_factory=loadSector, 
							 get_label=lambda a: a.ID + " - " + a.Description,
							 allow_blank=True,
							 blank_text='--None--',
							 validators=[validators.Required()],
							 description="5-%s" %getLanguage('Classification'))
	Industry 		=	QuerySelectField(getLanguage('Industry'),query_factory=loadIndustry, 
							 get_label=lambda a: a.ID + " - " + a.Description,
							 allow_blank=True,
							 blank_text='--None--',
							 description="5-%s" %getLanguage('Classification'))

	ACMember 		=	SelectField(requiredlabel(getLanguage('AC Member'),"*"),
							 choices=[('Y', 'Yes'),('N', 'No')],
							 coerce=str,
							 validators=[validators.Required()]
							 ) #description="5-%s" %getLanguage('Classification')

	# --Identification--
	IDType 			=	QuerySelectField(requiredlabel('ID Type (1)','*'),
							 query_factory=loadIdType, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='--None--',
							 validators=[validators.Required()],
							 description="8-%s" %getLanguage('Identification Document'))
	IDNumber 		=	TextField(requiredlabel("ID Number (1)","*"),
							 validators=[validators.Required()],
							 description="8-%s" %getLanguage('Identification Document'))
	
	IssuePlace 		=	TextField(requiredlabel("Issue Place (1)",'*'),
							 description="8-%s" %getLanguage('Identification Document'),
							 validators=[validators.Length(max=35),validators.Required()],)

	IssueDate 		=	DateField(requiredlabel("Issue Date (1)",'*'),
							 description="8-%s" %getLanguage('Identification Document'),
							 validators=[custom_IssueDate])

	ExpiryDate 		=	DateField("Expiry Date (1)",
							 description="8-%s" %getLanguage('Identification Document'),
							 validators=[custom_ExpiryDate])

	# --Block--
	Block 			=	SelectField(getLanguage('Block'),
							choices=[('N', 'No'),('Y', 'Yes')],
							coerce=str,
							default='N',
							description="7-%s" %getLanguage('Block')
						)

	BlockReason 	=	TextAreaField("Block Reason",
						description="7-%s" %getLanguage('Block'),
						validators=[validators.Length(max=100)])
	Mobile3				= TextField("Mobile Phone 3",
							 description="1-%s" %getLanguage('Current Address and Contact'))
	Email 				= TextField(getLanguage("Email"), [validators.Optional(),validators.Email(message=u'Invalid email address.')],
							 description="1-%s" %getLanguage('Current Address and Contact'))
	MaximaStaff			= SelectField('Maxima Staff',
							 choices=[('N', 'No'),('Y', 'Yes')],
							 coerce=str,
							 default='N',
							 validators=[validators.Required()])
	IssuePlace 			= TextField("Issue Place")
	IDType2				= QuerySelectField('ID Type (2)',
							 query_factory=loadIdType, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='--None--',
							 description="8-%s" %getLanguage('Identification Document'))
	IDNumber2			= TextField("ID Number (2)",
							 description="8-%s" %getLanguage('Identification Document'))
	IssueDate2 			= DateField("Issue Date (2)",
							 description="8-%s" %getLanguage('Identification Document'),
							 validators=[custom_IssueDate])
	ExpiryDate2 		= DateField("Expiry Date (2)",
							 description="8-%s" %getLanguage('Identification Document'),
							 validators=[custom_ExpiryDate])
	IDType3				= QuerySelectField('ID Type (3)',
							 query_factory=loadIdType, 
							 get_label='Description',
							 allow_blank=True,
							 blank_text='--None--',
							 description="8-%s" %getLanguage('Identification Document'))
	IDNumber3			= TextField("ID Number (3)",
							 description="8-%s" %getLanguage('Identification Document'))
	IssueDate3 			= DateField("Issue Date (3)",
							 description="8-%s" %getLanguage('Identification Document'),
							 validators=[custom_IssueDate])
	ExpiryDate3 			= DateField("Expiry Date (3)",
							 description="8-%s" %getLanguage('Identification Document'),
							 validators=[custom_IssueDate])

	@staticmethod
	def setVisible():
		base = super(FRM_CUSTOMER_EX,FRM_CUSTOMER_EX).setVisible()
		listControl = [("IssuePlace"),("ACMember"),("City"),("Email"),("Salutation"),("VBID"),("GroupID")]
		listControl.extend(base)
		return listControl

	def validate_IDNumber2(form,field):
		IDNumber2 	= form.IDNumber2.data
		IDType2 	= str(request.form['IDType2'])
		ID 			= request.form['ID']
		validateIDNumber(ID, IDType2, IDNumber2)

	def validate_IDNumber3(form,field):
		IDNumber3 	= form.IDNumber3.data
		IDType3 	= str(request.form['IDType3'])
		ID 			= request.form['ID']
		validateIDNumber(ID, IDType3, IDNumber3)

	def validate_Mobile1(form,field):
		pass