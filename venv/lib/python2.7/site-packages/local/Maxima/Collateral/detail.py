# -*- coding: utf-8 -*-
from app.mktcore.wtfimports 	import *
from app.Collateral.detail 		import *
from app.Collateral.models 		import *

class FRM_COLLATERAL_DE_EX(FRM_COLLATERAL_DE):
	CollateralID 	= 	QuerySelectField(requiredlabel(getLanguage("Collateral"), "*"),
							query_factory=loadCollateral,
							get_label=lambda a: a.ID + " - " + a.Description,
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							validators=[validators.Required()]
						)
	CollateralStatus	=  SelectField("Status",
								choices=[('_None','--None--'),('1','Received'),('2','Withdrawn')],
								coerce=str,
								default ='1'
							)
	CollateralType 	= 	QuerySelectField(requiredlabel(getLanguage("Collateral Type"), "*"),
							query_factory=loadCollateralType,
							get_label=u'Description',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							validators=[validators.Required()],
							description='1-Collateral Details'
						)
	PropertyType 	= TextField("Property Type",description='1-Collateral Details')
	Currency 		= 	QuerySelectField(requiredlabel(getLanguage("Currency"), "*"),
							query_factory=loadCurrency,
							get_label=u'ID',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							validators=[validators.Required()]
						)

	# PurchasePrice 	= 	TextField(getLanguage("Purchased Price"))
	# ValuationPrice 	= 	TextField(getLanguage("Valuation Price"))
	# Valuer 			= 	TextField(getLanguage("Valuer"), [validators.length(max=50)])
	
	IssuedDate 		= 	DateField(getLanguage("Issued Date"),
							format='%Y-%m-%d',
							default=mktdate.getDateISO(),
							validators=[validators.Optional()],
							description='1-Collateral Details'
						)

	IssuedPlace 	= 	TextField(getLanguage("Issued Place"),[validators.length(max=50)],description='1-Collateral Details')
	IssuedBy 		= 	TextField(getLanguage("Issued By"),[validators.length(max=100)],description='1-Collateral Details')
	CollateralNumber= 	TextField("Collateral Number", [validators.length(max=25)],description='1-Collateral Details')

	ProvinceType	= SelectField(requiredlabel('Province Type',"*"),
							 choices=[('', '--None--'),('Province', u'ខេត្ត'),('Capital', u'រាជធានី')],
							 coerce=str,
							 validators=[validators.Required()],
							 description='1-Collateral Details')

	Province 		= 	QuerySelectField(getLanguage('Province'),
							query_factory=loadProvince, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose Province--',
							description='1-Collateral Details'
						)

	DistrictType	= SelectField(requiredlabel('District Type',"*"),
							 choices=[('', '--None--'),('District', u'ស្រុក'),('Khan', u'ខណ្ឌ'),('City', u'ក្រុង')],
							 coerce=str,
							 validators=[validators.Required()],
							 description='1-Collateral Details')
	District 		= 	QuerySelectField(getLanguage('District'),
							query_factory=loadDistrict, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose District--',
							description='1-Collateral Details'
						)
	CommuneType		= SelectField(requiredlabel('Commune Type',"*"),
							 choices=[('', '--None--'),('Commune', u'ឃុំ'),('Sangkat', u'សង្កាត់')],
							 coerce=str,
							 validators=[validators.Required()],
							 description='1-Collateral Details')
	Commune 		=	QuerySelectField(getLanguage('Commune'),
							query_factory=loadCommune, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose Commune--',
							description='1-Collateral Details'
						)
	Village 		=	QuerySelectField(getLanguage('Village'),
							query_factory=loadVillage, 
							get_label='Description',
							allow_blank=True,
							blank_text=u'--Choose Village--',
							description='1-Collateral Details'
						)
	HouseNo 					= 	TextField("House No",
										description="1-Collateral Details")

	StreetNo 					= 	TextField("Street",
										description="1-Collateral Details")

	Location 		= LocationField("Collateral Location",description="1-Collateral Details")
	ReceivedDate 	= 	DateField(getLanguage("Received Date"),
							format='%Y-%m-%d',
							validators=[validators.Optional()]
						)
	ReceivedBy 		= 	TextField("Received By", [validators.length(max=35)])
	
	WithdrawalDate 	= 	DateField("Withdrawal Date",
							format='%Y-%m-%d',
							validators=[validators.Optional()]
						)
	WithdrawalBy 	= 	TextField("Withdrawal By", [validators.length(max=35)])
	Description 	= 	TextAreaField(getLanguage("Property Description"), [validators.length(max=300)])

	OwnershipType 		=	SelectField('Ownership Type', 
								choices=[('1', 'Owned by 1st Borrower'),('2', 'Owned by 2nd Borrower'),('3', 'Owned by All Borrower'),('4', 'Owned by Other')],
								coerce=str,
								description='1.1-Ownership')

	OwnerName 			= 	TextField('Owner Name',
								description='1.1-Ownership')
	OwnerSpouseName 	= 	TextField('Owner Spouse Name',
								description='1.1-Ownership')
	RelationIndicator 	= 	SelectField("Relation Indicator",
								choices=[('', '--None--'), ('1', 'Spouse'), ('2', 'Son/Daughter'), ('3', 'Relative'), ('4', 'Parent'), ('5', 'Friend')],
								coerce=str,
								default='__None',
								description='1.1-Ownership'
							)

	LandLength 		= TextField("Land Length",
								description="2-Property Details")
	LandWidth 		= TextField("Land Width",
								description="2-Property Details")
	LandSurface 	= TextField("Land Surface",
								description="2-Property Details")
	BorderNorth 	= TextField("Border North",
								description="2-Property Details")
	BorderSouth 	= TextField("Border South",
								description="2-Property Details")
	BorderWest 		= TextField("Border West",
								description="2-Property Details")
	BorderEast 		= TextField("Border East",
								description="2-Property Details")
	House 			= TextField("House",
								description="2-Property Details")
	HouseLength 	= TextField("House Length",
								description="2-Property Details")
	HouseWidth 		= TextField("House Width",
								description="2-Property Details")
	HouseQuality 	= SelectField('House Quality',
							 choices=[('None', '--None--'),('O', u'ចាស់'),('N', u'ថ្មី'),('M', u'មធ្យម')],
							 coerce=str,
							 default='None',
							 description="2-Property Details")
	HousePrice 		= TextField("House Price",
								description="2-Property Details")
	# Tab 2-Collateral Values
	Currency 		= 	QuerySelectField(requiredlabel(getLanguage("Currency"), "*"),
							query_factory=loadCurrency,
							get_label=u'ID',
							allow_blank=True,
							blank_text=u'--%s--' %getLanguage("None"),
							default=lambda:loadCurrency(Default=True),
							validators=[validators.Required(),
							],
							description='2-Collateral Values'
						)
	PurchasePrice 	= 	TextField(getLanguage("Purchased Price"),default='0',description='2-Collateral Values')
	ValuationPrice 	= 	TextField(requiredlabel(getLanguage("Valuation Price"),'*'),default='0',description='2-Collateral Values',validators=[validators.Required()])
	ForceSaleValue 	= 	TextField('Force Sale Value', description="2-Collateral Values")
	Valuer 			= 	TextField(getLanguage("Valuer"), [validators.length(max=50)],description='2-Collateral Values')
	@staticmethod
	def moneyField():
		MainObj = super(FRM_COLLATERAL_DE_EX,FRM_COLLATERAL_DE_EX).moneyField()
		NewList = [	["HousePrice","Currency"] ]
		MainObj.extend(NewList)
		return MainObj

	@staticmethod
	def hotField():
		hotfield=[]

		fielddisplay =  "$('input[name=OwnerName]').attr('readonly', data.Bool);"
		fielddisplay += "$('input[name=OwnerName]').val( data.OwnerName);"
		fielddisplay += "$('input[name=OwnerSpouseName]').attr('readonly', data.Bool);"
		fielddisplay += "$('input[name=OwnerSpouseName]').val(data.OwnerSpouseName);"
		fielddisplay += "$('input[name=RelationIndicator]').attr('readonly', data.Bool);"
		fielddisplay += "$('input[name=RelationIndicator]').val(data.RelationIndicator);"

		varname  = "OwnershipType:$('#OwnershipType').val()"
		varname += ",OwnerName:$('#OwnerName').val()"
		varname += ",OwnerSpouseName:$('#OwnerSpouseName').val()"
		varname += ",RelationIndicator:$('#RelationIndicator').val()"

		fun = ["OwnershipType", varname, fielddisplay, "/Morakot/CollateralOwnership_ex", "change"]
		hotfield.append(fun)


		return hotfield

@app.route("/Morakot/CollateralOwnership_ex", methods=['GET'])
@checkLogOutSession
@checkLogOutTime
def getCollateralOwnership_ex():
	RelationIndicator 	= 	request.args.get('RelationIndicator')
	OwnerSpouseName 	= 	request.args.get('OwnerSpouseName')
	OwnershipType 		= 	request.args.get('OwnershipType')
	OwnerName 			= 	request.args.get('OwnerName')
	Bool 				= 	False
	OwnerList = ['1','2','3']
	if OwnershipType in OwnerList:
		RelationIndicator 	= 	''
		OwnerSpouseName 	= 	''
		OwnerName 			= 	''
		Bool 				= 	True

	return jsonify(
			RelationIndicator 	= RelationIndicator,
			OwnerSpouseName 	= OwnerSpouseName,
			OwnershipType 		= OwnershipType,
			OwnerName 			= OwnerName,
			Bool 				= Bool
		)