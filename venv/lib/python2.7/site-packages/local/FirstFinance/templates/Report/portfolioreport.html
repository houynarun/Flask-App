{% extends "layout.html" %}

{% block css %}
<style type="text/css">
.table-borderless td,
.table-borderless th
{
	border: 0 !important;
	padding-top: 3px !important;
	font-size: 14px;
}
th.table-header{
	border-bottom: 2px solid #ccc !important;
}
 h3.header-3{
            color: #888 !important;
            font-size: 16px;
            font-weight: bold;
            margin: 5px 0 10px;
            padding: 10px 18px 0;
        }

        h4.header-4{
            color: #888 !important;
            font-size: 14px;
            font-weight: normal;
            margin: 5px 0 10px;
            padding: 0px 18px 0;
        }
  table./*dataTable*/ tfoot th, table./*dataTable*/ tfoot td {
            border-top: 1px solid #111111;
            padding: 10px 10px 6px;
        }
</style>
{% endblock %}

{% macro generateReportTable(ReportDict,Total) -%}
	<tbody>
	{% for key, value in ReportDict.iteritems()|sort %}
		<tr>
			<td class="text-right"><span style="display: none;">{{key}}</span>{{ loop.index|int }}</td>
			<td>{{value['BranchDesc']}}</td>
			{% if ShowBy=='Branch' %}
			<td>{{key}}</td>
			{% endif %}
			<td class="text-right">{{value['NumberOfApproval']}}</td>
			<td class="text-right">{{value['ApprovalAmount']}}</td>
			<td class="text-right">{{value['NumberOfDisbursed']}}</td>
			<td class="text-right">{{value['DisbursedAmount']}}</td>
			<td class="text-right">{{value['ActivePortfolio']}}</td>
			<td class="text-right">{{value['PortfolioAmount']}}</td>
			{% if ShowBy=='Referral' %}
			<td class="text-right">{{value['PercentageOfPortfolio']}}</td>
			{% endif %}
			<td class="text-right">{{value['Male']}}</td>
			<td class="text-right">{{value['Female']}}</td>
			<td class="text-right">{{value['TotalActiveClient']}}</td>
			<td class="text-right">{{value['AvgIntRate']|round(2)}}</td>
		</tr>
	{% endfor %}
	</tbody>
	<tfoot>
 			<tr class="text-bold">
				<td>Total:</td>
				{% if ShowBy=='Branch' %}
					<td></td>
				{% endif %}
				<td></td>
					<td class="text-right">{{Total['TotalNumberOfApproval']}}</td>
					<td class="text-right">{{Total['TotalAmountOfApproval']}}</td>
					<td class="text-right">{{Total['TotalNumberOfDisbursed']}}</td>
					<td class="text-right">{{Total['TotalAmountOfDisbursed']}}</td>
					<td class="text-right">{{Total['TotalNumberOfPortfolio']}}</td>
					<td class="text-right">{{Total['TotalAmountOfPortfolio']}}</td>
					{% if ShowBy=='Referral' %}
					<td></td>
					{% endif %}
					<td class="text-right">{{Total['TotalMale1']}}</td>
					<td class="text-right">{{Total['TotalFemale1']}}</td>
					<td class="text-right">{{Total['TotalAllMaleFemal']}}</td>
					<td class="text-right">{{Total['TotalAvgIntRate']}}</td>
			</tr> 
	</tfoot>
{%- endmacro %}

{% block content %}

{% include 'msg_error.html' %}

<!-- Print Button -->
   <div class="navbar navbar-default navbar-static-top">
		<form method="GET" id="frm" name="frm" role="form" action="/Morakot/portfolioreport">
			<div class="col-sm-6" style="margin-top: 15px;">
				<!-- Button Export -->
				{% from "print.html" import exportButtonLink %}
				{{exportButtonLink()}}
			</div>
			<div class="col-sm-6" style="margin-top: 8px;">
				<div class="pull-right">
					<a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
						<span class="btn-label icon fa fa-refresh"></span> Refresh
					</a>
					<button type="button" 
								class="btn btn-flat btn-labeled btn-success" 
								data-toggle="modal" data-target="#getCustomRange">
						<span class="btn-label icon fa fa-gear"></span> Custom
					</button>
				</div>
			</div>
		</form>
	</div>

	<div class="modal fade" id="getCustomRange" tabindex="-1" 
		role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form class="form-horizontal" action="/Morakot/portfolioreport" method="POST" id="filterBy">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="exampleModalLabel">Custom View</h4>
					</div>
					<div class="modal-body">
						<input type="hidden" name="ID" value="{{ID}}">
						<div class="form-group">
							<label for="ShowReceivedBy" class="col-sm-6 control-label">Show By:</label>
							<div class="col-sm-6">
								<select class="form-control input-sm" name="ShowBy" style="width: 100%;" id="ShowBy">
									{% if ShowBy %}
										<option value="Branch" {% if ShowBy == 'Branch' %} selected="selected"{% endif %} >Branch</option>
										<option value="Product"{% if ShowBy == 'Product' %} selected="selected"{% endif %} >Product</option>
										<option value="CC" {% if ShowBy == 'CC' %} selected="selected"{% endif %} >CC</option>
										<option value="CRO" {% if ShowBy == 'CRO' %} selected="selected"{% endif %} >CRO</option>
										<option value="SourceOfIncome" {% if ShowBy == 'SourceOfIncome' %} selected="selected"{% endif %}>Source Of Income</option>
										<option value="Referral" {% if ShowBy == 'Referral' %} selected="selected"{% endif %}>Source Of Referral</option>
									{% else %}
										<option value="Branch">Branch</option>
										<option value="Product" >Product</option>
										<option value="CC" >CC</option>
										<option value="CRO" >CRO</option>
										<option value="SourceOfIncome">Source Of Income</option>
										<option value="Referral">Source Of Referral</option>
									{% endif %}
								</select>
								<script type="text/javascript">
									init.push(function () {
										// Single select
										$("#ShowBy").select2({
											allowClear: true,
											placeholder: "Show By"
										});
									});
								</script>
							</div>
						</div>

					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-primary" id="Apply">Apply</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					</div>
				</form>
			</div>
		</div>
	</div>

<!-- /Print Button -->

<div class="row">
<div class="col-sm-12">
	<div style="margin-left:10%; margin-right:10%;">
		<h3 class="header-3 text-center">{{ Result['Company'] }}</h3>
		<h4 class="header-4 text-center">{{ Result['Title']}}</h4>
		<h4 class="header-4 text-center"><strong>As of:</strong> {{ Result['BankDate'] }}</h4>
	</div>
	<div class="clearfix">&nbsp;</div>
	<div class="row">
	<div class="col-sm-12">
	    <table>
	          <tbody>
	            <tr>
	                <td width="150"><h5><strong>Filtered By:</strong></h5></td>
	                <td><h5>:  {{ ShowBy }}</h5>  </td>
	            </tr>
	        </tbody>
	    </table>
	</div>
	<div class="clearfix">&nbsp;</div>
	<div class="row">
		<div class="col-xs-12">
			
			<table class="table table-bordered reportTable" id="mktlist">
				<thead>
					<tr>
						<th class="text-center" rowspan="2">No</th>
						{% if TableHeader %}
							<th rowspan="2">{{TableHeader['Field1']}}</th>
							{% if TableHeader['Field2'] %}
								<th rowspan="2">{{TableHeader['Field2']}}</th>
							{% endif %}
						{% endif %}
						<th class="text-center" colspan="2">Approval</th>
						<th class="text-center" colspan="2">Disbursement</th>
						<th class="text-center"  {% if ShowBy=='Referral'%} colspan="3" {% else %} colspan="2" {% endif %}>Active Portfolio</th>
						<th class="text-center" colspan="3"># of Active Client</th>
						<th class="text-center" rowspan="2">Active Portfolio</th>
					</tr>
					<tr class="text-center">
						<th class="text-center"># of loans</th>
						<th class="text-center">$ of Loans</th>
						<th class="text-center"># of loans</th>
						<th class="text-center">$ of Loans</th>
						<th class="text-center"># of loans</th>
						<th class="text-center">$ of Loans</th>
						{% if ShowBy=='Referral' %}
						<th class="text-center">% of portfolio</th>
						{% endif %}
						<th class="text-center">Male</th>
						<th class="text-center">Female</th>
						<th class="text-center">Total</th>
					</tr>
					{# <tr></tr> #}
				</thead>
					{{ generateReportTable(ReportDict,Total) }}
			</table>
		</div>
		<!-- Note -->
		<div class="col-sm-11" style="margin-left: 15px;">
		    <table>
		    <h5><strong><u>Note:</u></strong></h5>
		        <tbody>
		            {% set CurrencyDict = Result['CurrencyDict'] %}
		            <tr>
		                <td ><b>(1)</b> Based Currency:  <b></b></td>
		                <td ><b></b> {{ Result['BasedCurrency'] }} <b></b></td>
		            </tr>
		            <tr>
		                <td><b>(2)</b> Exchange Rate: <b></b></td>
		                <td><b></b> {{CurrencyDict['ForeignExchangeRate']}} <b></b></td>
		            </tr>
		            <tr>
		                <td colspan="2">&nbsp;</td>
		            </tr>
{# 		            <tr>
		                <th width="250">Total Avg Monthly Income:</th>
		                <td>.......</td>
		            </tr> #}
		            <tr>
		                <th width="250" colspan="2"><i>All Amount is Converted into Based Currency</i></th>
		            </tr>
		        </tbody>
		    </table>
		</div>
		<!-- End note -->
	</div>

	<div class="row"></div>
</div>
</div>

<div class="clearfix">&nbsp;</div>

{% endblock %}



{% block js %}
	{% from "print.html" import exportIncludeJS %}
	{{exportIncludeJS()}}
	<script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script>
<script>

	$(document).ready(function(){

		// $('#mktlist').dataTable();

		  	$("#Refresh").click(function() {
	            fn_fadeIn();
	            window.location.reload(true);
	        });
	        {% from "print.html" import exportDataTable %}
            {{exportDataTable('#mktlist','Loan Portfolio Report')}}
	})
</script>
{% endblock %}

