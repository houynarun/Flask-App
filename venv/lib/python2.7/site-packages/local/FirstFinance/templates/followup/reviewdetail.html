{% macro getLoanPurpose(ID) -%}
{%set LoanPurposeObj = LoanPurpose.query.filter(LoanPurpose.ID==ID).first() %}
{{LoanPurposeObj.Description}}
{%- endmacro %}

{% macro getCollateralType(ID) -%}
{%set CollateralType = collateralType.query.filter(collateralType.ID==ID).first() %}
{{CollateralType.Description}}
{%- endmacro %}

{% block content %}

{%set CustomerName = (CustomerObj.LastNameEn +' '+ CustomerObj.FirstNameEn) if CustomerObj else ''%}
{%set HouseHoldMember = CustomerObj.NumberOfMember if CustomerObj else ''%}
{%set EmploymentType = ("Current" if CustomerObj.EmployerType=='C' else 'Previous') if CustomerObj else ''%}

{# {{toMoney(float(LoanApplication.Amount),CurrencyObj(LoanApplication.Currency),2)}} #}

{%set Income = toMoney(float(CustomerObj.MonthlyIncome),CurrencyObj(LoanApplicationObj.Currency),2) if CustomerObj else ''%}
{%set TotalExpenses = toMoney(float(CustomerObj.TotalExpenses),CurrencyObj(LoanApplicationObj.Currency),2) if CustomerObj else '' %}
{%set LoanAmount = toMoney(float(LoanApplicationObj.Amount),CurrencyObj(LoanApplicationObj.Currency),2) if LoanApplicationObj else ''%}
{%set MonthlyRep = toMoney(float(LoanApplicationObj.MonthlyRep),CurrencyObj(LoanApplicationObj.Currency),2) if LoanApplicationObj else ''%}
{%set LoanPurpose = getLoanPurpose(LoanApplicationObj.LoanPurpose) if LoanApplicationObj else ''%}

{%set FollowupID = FollowUpObj.ID if FollowupObj else ''%}
{%set ReviewDate = FollowUpObj.NextFollowUpDate if FollowUpObj else ''%}
{%set ReviewDict = {'1':'Followup Survey','2':'Followup Review','3':'Followup PAR'} %}
{%set ReviewType = ReviewDict[FollowUpObj.NextReviewType] if FollowUpObj else ''%}
{%set Description = FollowUpObj.ActionPlan if FollowUpObj else ''%}
{# {%set NextFollowupDate = FollowUpObj.NextFollowUpDate if FollowUpObj else ''%} #}
{%set NextActionPlan = FollowUpObj.NextAction if FollowUpObj else ''%}

<style>
	table {
		width: 400px;
	}
</style>

<div class="container">
		<div class="row">
			<div class="col-xs-6">
				<h4>Customer Detail</h4>
				<table class="table table-hover table-striped">
					{# <caption></caption> #}
					<tr>
						<td><b>Customer Name</b></td>
						<td>{{CustomerName}}</td> 
					</tr>
					<tr>
						<td><b>Household Member</b></td>
						<td>{{HouseHoldMember}}</td>
					</tr>
					<tr>
						<td><b>Employment Type</b></td>
						<td>{{EmploymentType}}</td>
					</tr>
					<tr>
						<td><b>Employment/Business</b></td>
						<td>&nbsp;</td>
					</tr>
					<tr>
						<td><b>Income</b></td>
						<td>{{Income}}</td>
					</tr>
					<tr>
						<td><b>Total Expenses</b></td>
						<td>{{TotalExpenses}}</td>
					</tr>
				</table>
			</div>
			<div class="col-xs-6">
				<h4>Loan Detail</h4>
				<table class="table table-hover table-striped">
					<tr>
						<td><b>Total Loan Amount</b></td>
						<td>{{LoanAmount}}</td>
					</tr>
					<tr>
						<td><b>Total Monthly Repayment</b></td>
						<td>{{MonthlyRep}}</td>
					</tr>
					<tr>
						<td><b>Loan Purpose</b></td>
						<td>{{LoanPurpose}}</td>
					</tr>
				</table>
			</div>
		</div>
		<div class="clearfix"></div>
		<br><br>
		<div class="row">
			<div class="col-xs-6">
				<h4>Review Detail</h4>
				<table class="table table-hover table-striped">
					{# <caption><h4>Review Detail</h4></caption> #}
					<tr>
						<td><b>Date of Visit/Review</b></td>
	{# 					<td>Hello USD 300,000.00</tr> #}
						<td>{{ReviewDate}}</td>
					</tr>
					<tr>
						<td><b>Review Type</b></td>
						{# <td>	Hello USD 300,000.00</td> #}
						<td>{{ReviewType}}</td>
					</tr>
					<tr>
						<td><b>Description of Action Take</b></td>
						<td>{{Description}}</td>
					</tr>
					<tr>
						<td><b>Next Follow Up Date</b></td>
						<td>{{NextFollowupDate}}</td>
					</tr>
					<tr>
						<td><b>Action Plan for Next Follow up</b></td>
						<td>{{NextActionPlan}}</td>
					</tr>
				</table>
			</div>
			<div class="col-xs-6">
				<h4>Collateral Detail</h4>
				<table class="table table-hover table-striped">
				{%for collateral in CollateralDeObj%}
					<tr>
						<td><b>Value of Collateral</b></td>
						{%set CollateralValue = toMoney(float(collateral.ValuationPrice),CurrencyObj(LoanApplicationObj.Currency),2) if collateral.ValuationPrice else ''%}
						<td>{{CollateralValue}}</td>
					</tr>
					<tr>
						<td><b>Collateral Type</b></td>
						<td>{{getCollateralType(collateral.CollateralType)}}</td>
					</tr>
					<tr>
						<td><b>Collateral Address</td>
						{% set ColLocation = mktaddress.getAddress(collateral.Province, collateral.District, collateral.Commune, collateral.Village, Locale='kh') %}
						<td>{{ColLocation}}</td>
					</tr>
				{%endfor%}
				</table>
			</div>
		</div>
</div>

{% endblock %}