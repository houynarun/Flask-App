{% extends "layout.html" %}

{% block css %}
<style type="text/css">
	/*tr{
		height:35px;
	}*/
	.panel-group{
		margin-bottom: 5px !important;
	}
	.accordion-toggle::after {
		right: auto;
	}
	.colunm-padding {
		padding: 9px 5px 9px 10px;
	}
	.colunm-padding-first {
		padding: 9px 5px 9px 50px;
	}
	.uninstall-padding{

		display: inline-block;
		padding-left: 25px;
		padding-top: 4px;
		vertical-align: top;
	}
}
.table-borderless td,
.table-borderless th
{
	border: 0 !important;
	padding-top: 3px !important;
}

.modal-lg {
	width: 95%;
}
iframe{
	border: 0px
}

</style>
{% endblock %}

{% block content %}

{# Modal Reason #}
<div class="modal fade" id="modalReason" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Review</h4>
      </div>
      <div class="modal-body">
      	<div class="alert alert-warning" id="div-warning" style="display: none">
	       <button type="button" class="close" data-dismiss="alert">Ã—</button>
	          <div id="warning-msg"></div>
	       </div>
        <p>Please give the reason:</p>
        {# Form #}
        <div class="container" style="margin: 5px auto;">
        	<div class="row">
        		<div class="col-md-12">
        			<form class="rejected-form" action="/Morakot/CBCSubmitEx/?ID={{ID}}" method="POST" id="frm-rejected">
					  <div class="form-group">
					    <label for="reason">Reason:</label>
					    <textarea class="form-control" id="Reason" name="Reason" cols="30" rows="10" placeholder="Reason"></textarea>
					    <input type="hidden" name="Action" id="Action-Rejected" value="2">
					    <input type="hidden" name="LoanAppID" id="LoanAppID" value="{{ID}}">
					  </div>
					</form>
        		</div>
        	</div>
        </div>
        {# .From #}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="Rejected">Save changes</button>
      </div>      
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{# end Modal Reason #}

{# Horizontal Form #}
<form method="POST" id="frm-submit" name="frm-submit" role="form" action="/Morakot/CBCSubmitEx/?ID={{ID}}">
	<div class="navbar navbar-default navbar-static-top" role="navigation">
		<ul class="nav navbar-nav">
			{% set APPSTATUS_NEW = '0' %}
			{% if LoanAppObj and LoanAppObj.AppStatus == APPSTATUS_NEW %}
				<li>
					<a href="javascript:void();" id="Submit"><i class="fa fa-pencil-square-o"></i>&nbsp;Submit</a>
				</li>
				<li>
					<a href="javascript:void();" id="Reject" data-toggle="modal" data-target="#modalReason"><i class="fa fa-undo"></i>&nbsp;Reject</a>
				</li>
			{% endif %}
			<li>
				<div class="navbar-form navbar-left">
					<div class="form-group">
						<input type="text" class="form-control" name="LoanAppID" id="LoanAppID" placeholder="Record ID" value="{{ID}}" readonly="" data-original-title="" title="">
						<input type="hidden" name="Action" id="Action" value="1">	
					</div>
				</div>
			</li>
		</ul>
	</div>
	{# /Horizontal Form #}

	{# ===================  Form  ========================= #}

	{% include 'msg_error.html' %}
	<div class="col-sm-12" >
		<div class="col-sm-12">
			Below here are summary information of all customer(s) in loan application 
				<b>
					<a href="javascript:void(0);" onclick="CustomClickView('LoanApplication','{{g_getUrlExtend(Module="LoanApplication")}}/?ID={{ID}}')">{{ ID }}</a>
				</b>	
			{# Already check in 30 days #}	
			<ul>
				<li>Customer(s) aleady exist in CBC history
				<ul>
				{% for row in HistoryData.get("CBCDetailSuccessObj") %}
					{%set Fullname = ""%}
					{%if CustomerObj %}
						{%set CustObj = CustomerObj %}
						{%set CustObj = CustObj.filter_by(ID=row.Customer).first() %}
						{%set Fullname = "%s %s" % (CustObj.LastNameEn , CustObj.FirstNameEn )%}
					{%endif%}
					<li><a href="javascript:void(0);" onclick="CustomClickView('CBC','{{g_getUrlExtend(Module="CBC")}}/?ID={{row.ID}}')">{{row.ID}}</a> - 
						<a href="javascript:void(0);" onclick="CustomClickView('Customer','{{g_getUrlExtend(Module="Customer")}}/?ID={{row.Customer}}')">
						{{row.Customer}} 
						</a> ({{Fullname}})
					</li>			
				{% endfor %}
				</ul>
				</li>

				<li>Customer(s) not yet check CBC (New Request)
					<ul>
						{% for item in HistoryData.get("CustNotYetCheckList") %}
							{%set Fullname = ""%}
							{%if CustomerObj %}
								{%set CustObj = CustomerObj %}
								{%set CustObj = CustObj.filter_by(ID=item).first() %}
								{%set Fullname = "%s %s" % (CustObj.LastNameEn , CustObj.FirstNameEn )%}
							{%endif%}
							<li>
							<a href="javascript:void(0);" onclick="CustomClickView('Customer','{{g_getUrlExtend(Module="Customer")}}/?ID={{item}}')">{{item}}</a> 
							({{Fullname}})
							</li>			
						{% endfor %}
					</ul>
				</li>			
			</ul>	
		</div>
	</div>
	<div class="form-horizontal">
		
		<div class="form-group">
			
			
		</div>
		<!-- Javascript -->
		<script>
			$(document).ready(function(){
				  init.push(function () {
					$('ul.bs-tabdrop-example').tabdrop();
				});
			})
		</script>
		<!-- / Javascript -->
		{% if LoanAppObj %}
		<div id="container_tab" class="tab-content">
			<ul class="nav nav-tabs bs-tabdrop-example" role="tablist">
				<li class="dropdown pull-right tabdrop hide"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="fa fa-bars"></i> <b class="caret"></b></a>
					<ul class="dropdown-menu"></ul>
				</li>
				{% for item in ALLCBCIDList %}
					{% set NewLabel = "" %}
					{% if item in NewCBCIDList %}
						{% set NewLabel = "<span class='badge'>New</span>"  %}
					{% endif%}
					{% if loop.first %}	
						<li class="active"><a data-toggle="tab" href="#{{item}}">{{item}} {{NewLabel | safe}}</a> </li>
					{% else %}	
						<li><a data-toggle="tab" href="#{{item}}">{{item}} {{NewLabel | safe}}</a></li>
					{% endif %}
				{%endfor%}
			</ul>

			{% for item in ALLCBCIDList %}
				{% if loop.first %}	
					<div id="{{item}}" class="tab-pane fade in active">
						<iframe src="/Morakot/CBCEnquiry?ID={{item}}" width="100%" height="3000px"></iframe>
					</div>
				{% else %}	
					<div id="{{item}}" class="tab-pane fade in">
						<iframe src="/Morakot/CBCEnquiry?ID={{item}}" width="100%" height="3000px"></iframe>
					</div>
				{% endif %}		
			{%endfor%}
		</div>
		{% endif %}
	</div>
</form>

<div class="clearfix">&nbsp;</div>


{% endblock %}

{% block js %}

<script type="text/javascript">
	$(document).ready(function() {
		function fn_fadeOut(){
			var $getParentEle = window.parent.$("#animated")
			$getParentEle.fadeOut("slow");
		}
		function fn_fadeIn(){
			var $getParentEle = window.parent.$("#animated")
			$getParentEle.fadeIn("slow");
		}

		fn_fadeIn()

		$('#Submit').click(function(e){
            e.preventDefault();            
            bootbox.confirm({
                message: "<b>Are you sure you want to submit application ?</b> ",
                callback: function(result) {
                    if(result==true){
                        $('#frm-submit').submit()
                    }                    
                },
                className: "bootbox-sm"
            });
        })

        $('#Rejected').click(function(e){
        	var Reason = $("#Reason").val()
        	if (Reason){
        		$('#frm-rejected').submit()    
        	}else{
        		$("#div-warning").css("display","block")
        		$("#warning-msg").html("Reason: This Field is required.")
        		return false
        	}

        })

	});

</script>

{% endblock %}