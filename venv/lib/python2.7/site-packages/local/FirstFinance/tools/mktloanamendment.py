
from app.LoanAmendment.models  		import *
from app.LoanApplication.models 	import *
from app.LoanContract.models 		import *
import app.tools.mktdate 			as 	mktdate
def updateApprovedAmount(ID="",EOD=1,Resource="AUTH"):
	"""
	Definition:
		Update LC approved amount when create loan topup/progressive and choos top up mode.
	Param:
		ID is loan amend ID
		EOD :
			1 refer to eod process
			0 refer to ui process
		Resource use to trigger whether it is INAU or AUTH record
	"""
	SystemBankDate 	=	str(mktdate.getBankDate())
	if Resource=="INAU":
		AmendObj		=	MKT_LOAN_AMENDMENT_INAU.query.get(ID)
	else:
		AmendObj		=	MKT_LOAN_AMENDMENT.query.get(ID)
	if AmendObj:
		Op 			=	AmendObj.Operation
		LoanAppID 	=	AmendObj.LoanAppID
		LcID 		=	AmendObj.LoanID
		AmendDate 	=	AmendObj.AmendDate
		if Op.upper() == "AMT" and AmendDate==SystemBankDate:
			"""Loan Contract Approved amount will be topped up when there is loan applicaton chosen"""
			if LoanAppID:
				LoanAppObj 	= MKT_LOAN_APPLICATION.query.get(LoanAppID)
				if LoanAppObj:
					ApprovedAmount = LoanAppObj.Amount if LoanAppObj else 0
					LoanContractObj = MKT_LOAN_CONTRACT.query.get(LcID)
					if LoanContractObj:
						NewApprovedAmt = LoanContractObj.ApprovedAmount + ApprovedAmount
						LoanContractObj.ApprovedAmount = NewApprovedAmt
						db.session.add(LoanContractObj)