from app.mktcore.wtfimports 	import *
from app.Account.account_dd 	import *


class FRM_ACCOUNT_DD_EX(FRM_ACCOUNT_DD):
	def validate_Currency(form,field):
		ID 			= request.form['ID']
		CustomerID 	= request.form['CustomerList']
		Currency 	= request.form['Currency']

		AccountProduct 	= ['101'] # Drawdown Account product ID
		AccountStatus 	= 'O' # Status open
		DDAccountObj	= MKT_ACCOUNT.query.filter(	MKT_ACCOUNT.AccProduct.in_(AccountProduct),\
													MKT_ACCOUNT.AccStatus == AccountStatus,\
													MKT_ACCOUNT.ID != ID,
													MKT_ACCOUNT.CustomerList == CustomerID).all()
		if DDAccountObj:
			for item in DDAccountObj:
				if Currency == item.Currency:
					raise ValidationError(Markup("Customer already has an opened <b>%s</b> Drawdown Account \
												<a href='javascript:void(0)' onClick=CustomClickView('Drawdown&nbspAccount-%s','DrawdownAccountEx/?ID=%s')> %s</a>"%(Currency,item.ID,item.ID,item.ID)))