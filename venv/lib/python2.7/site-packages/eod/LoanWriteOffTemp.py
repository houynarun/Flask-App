from app.mktcore.mdlimports import *
from app.LoanContract.models import MKT_LOAN_MATURITY
from sqlalchemy.sql import text

"""
You run this command from inside vb
python -m EOD.LoanWriteOffTemp
"""

def copyWOFToMTR():
	
	SQL = text('''
			insert into "MKT_LOAN_MATURITY" ("Branch","Curr","Inputter","Createdon","Authorizer","Authorizeon","ID","LoanStatus","Date","Status")
			select "MKT_WRITE_OFF_DE"."Branch","MKT_WRITE_OFF_DE"."Curr","MKT_WRITE_OFF_DE"."Inputter","MKT_WRITE_OFF_DE"."Createdon","MKT_WRITE_OFF_DE"."Authorizer","MKT_WRITE_OFF_DE"."Authorizeon","MKT_WRITE_OFF_DE"."ID",'WOF' AS "LoanStatus","MKT_WRITE_OFF_DE"."WOFDate","MKT_WRITE_OFF_DE"."Status" 
			from "MKT_WRITE_OFF_DE"
			full outer JOIN "MKT_LOAN_MATURITY" ON "MKT_WRITE_OFF_DE"."ID" = "MKT_LOAN_MATURITY"."ID"
			where "MKT_LOAN_MATURITY"."ID" is null;
			''')
	Result = db.engine.execute(SQL)
	print 'There are ', Result.rowcount,'rows was inserted.'

copyWOFToMTR()