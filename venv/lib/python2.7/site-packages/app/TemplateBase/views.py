from app.mktcore.imports 			import *
from app.TemplateBase.forms 		import *
from app.TemplateBase.models 		import *
from sqlalchemy 					import *
from app.Currency.models 			import MKT_CURRENCY

import app.tools.mktmoney 			as mktmoney

registerCRUD(admin, '/TemplateBase', 'TemplateBase',FRM_TEMPLATE_BASE, [MKT_TEMPLATE_BASE])

@app.route("/Morakot/ViewTemplateBaseSchedule", methods = ['GET','POST'])
@checkLogOutSession
@checkLogOutTime
def ViewTemplateBaseSchedule():

	ScheduleObj = ''
	Currency 	= 'MMK'
	ID 				= request.args.get('ID') if 'ID' in request.args else ''

	TemplateBase 	= MKT_TEMPLATE_BASE_INAU.query.filter(MKT_TEMPLATE_BASE_INAU.ID == ID).first()
	if not TemplateBase:
		TemplateBase 	= MKT_TEMPLATE_BASE.query.filter(MKT_TEMPLATE_BASE.ID == ID).first()
	if TemplateBase:
		Currency 		= TemplateBase.Currency
		CurrencyObj 	= MKT_CURRENCY.query.get(Currency)

		ScheduleObj 	= db.session.query(MKT_TEMPLATE_BASE_DE_INAU).filter(MKT_TEMPLATE_BASE_DE_INAU.TemplateBaseID == str(ID)).\
														order_by(cast(MKT_TEMPLATE_BASE_DE_INAU.No,Integer)).all()
		if not ScheduleObj:
			ScheduleObj 	= db.session.query(MKT_TEMPLATE_BASE_DE).filter(MKT_TEMPLATE_BASE_DE.TemplateBaseID == str(ID)).\
														order_by(cast(MKT_TEMPLATE_BASE_DE.No,Integer)).all()

		HeaderTable 	=	['No','Principal','Interest','Charge','Balance']

		return render_template('templatebase/viewtemplatebaseschedule.html',
								float 			= float,
								ID 				= ID,
								mktmoney 		= mktmoney,
								CurrencyObj 	= CurrencyObj,
								HeaderTable 	= HeaderTable,
								ScheduleObj 	= ScheduleObj)

	return render_template('templatebase/viewtemplatebaseschedule.html',ScheduleObj = ScheduleObj)

@app.route("/Morakot/ViewSampleTemplateBaseSchedule", methods = ['GET','POST'])
@checkLogOutSession
@checkLogOutTime
def viewSampleTemplateBaseSchedule():
	return render_template('templatebase/viewSampletemplatebaseschedule.html')