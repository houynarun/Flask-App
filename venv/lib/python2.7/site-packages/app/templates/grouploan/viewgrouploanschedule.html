{% extends "layout.html" %}

{% block css %}
   
	<style type="text/css">
		.form-control
		{
			width: 100% !important;
		}
		@media print{
			#filter{
				display: none;
			}
		}
	</style>
{% endblock %}

{% block content %}
	{% if not message=='' %}
	<div class="se-pre-con1"></div>
	<div class="col-sm-12" id="navberCriteria" style="padding: 0px;">
		<form method="GET" role="FORM" id="generate_schedule">
			<input id='ID' name="ID" class="hidden" value="{{ID}}"/>
			<input id='Resource' name="Resource" class="hidden" value="AUTH"/>
			<table id="mktlist" class="table table-striped table" cellspacing="0" width="100%" style="height: 8px;">
				<div class="col-sm-12">
					{% if Editable=='Yes' %}
						<div class="" style="padding-left: 0px;">
							<ul class="nav navbar-nav">
								<li>
									<a href="javascript:void(0)" id="Edit" style="padding-left: 15px;"><i class='fa fa-reply'></i>&nbsp;Back</a>
								</li>
							</ul>
						</div>
						<script type="text/javascript">
							$(document).ready(function() {
								$("#Edit").on("click",function(e){
									fn_fadeIn();
									window.location.href="/Morakot/{{g_getUrlExtend(Module='GroupLoan')}}/Edit/{{ ID }}";
								});
							});
						</script>
					{% endif %}
					<div style="margin-top: 10px; padding-right: 0px;"> 
						<label style="padding-top: 5px; float: left; padding-left: 10px; text-align: right;">Borrower:</label>
						<div class="col-sm-3">
						   <select class="form-control" id="Borrower" name="Borrower" required>
								<optgroup label="Borrower">
									{%for row in GroupBorrowerObj.all() %}
										{% set Customer = CustomerObj.get(row.BorrowerID) %}
										<option value="{{row.BorrowerID}}"> {{row.BorrowerID}} - {{ Customer.LastNameEn}} {{ Customer.FirstNameEn }}</option> 
									{%endfor%}
								 </optgroup>
							</select>
						</div>
						<button class="btn btn-success" id="Submit">Show</button>
						<script type="text/javascript">
							init.push(function () {
								// Single select
								$("#Resource").val(window.parent.$('#Status').val());
								$("#Borrower").val('{{Borrower}}');
								$("#Borrower").select2({
									allowClear: true,
									placeholder: "Borrower"
								});
							});
						</script>
					</div>
				</div>
			</div>
			{% include 'msg_error.html' %}
			{% if Schedule %}
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						{% if Schedule %}
							<h3 class="text-center">Repayment Schedule</h3>
							 <table id="mktlist" class="table table-striped table" cellspacing="0" width="100%">
								<thead>
									<tr>
										{% set Header = [] %}
										{% if Schedule[0].Charge == '0' or Schedule[0].Charge == '0.00' %}
											<span style="display: none;">{{HeaderTable.remove('Charge')}}</span>
										{% endif %}
										{%for item in HeaderTable %}
											<th>{{item}}</th>
										{% endfor %}
									</tr>
								</thead>
								<tbody>
									{% for row in Schedule %}
									{% set TotalAmount = float(row.TotalAmount|replace(',','')) %}
										<tr>
											<td>{{ row.InstallmentNo }}</td> 
											<td>{{ row.CollectionDate }}</td> 
											<td>{{ toMoney(float(row.Principal), getCurrencyObj) }}</td> 
											<td>{{ toMoney(float(row.Interest), getCurrencyObj) }}</td> 
											{% if row.Charge!='0.00' and row.Charge!='0'%}
												<td>{{ toMoney(float(row.Charge), getCurrencyObj) }}</td> 
											{% endif %}
											<td>{{ toMoney(TotalAmount,getCurrencyObj)}}</td> 
											<td>{{ toMoney(float(row.Balance), getCurrencyObj) }}</td> 
											<td>{{ row.NumberOfDay }}</td> 
											
										</tr>
									{% endfor %}
								</tbody>
								
							</table>
						{% endif %}
					</div>
					<div class="col-sm-offset-1"></div>
				</div>
			{% else %}
				{% if request.method == 'POST' %}
					<div style="font-size: 17px; padding-left: 50px;">Please save records to view schedule ...</div>
				{% endif %}
			{% endif %}

		</form>
	</div>
	{% else %}
		<div style="font-size: 17px; padding-left: 50px;">Please save records to view schedule ...</div>
	{% endif %}
	<!--  message  -->

{% endblock %}

{% block js %}

{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}

<script type="text/javascript">

	$(document).ready(function() {
		$('#mktlist').dataTable({
			"lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
			"bSort" : false,
			"bScrollCollapse": true
		});
	});

</script>
{% endblock %}
