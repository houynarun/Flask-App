{% extends "layout.html" %}

{% block css %}


    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/menubuilder/menubuilder.css') }}">

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/bootstrap.min.css') }}">
    <!-- <link href="./Sortable Menu_files/font-awesome.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/font-awesome.min.css') }}">


{% endblock %}

{% block content %}

{% include 'menubuilder/modal.html' %}

{% macro getForm(ID) %}
    {% set FormObj = MKT_FORM.query.filter(MKT_FORM.ID==ID).all() %}

    {%for row in FormObj -%}
    <li data-ItemID="" data-formid="{{row.ID}}:{{row.FormID}}" data-formdesc="" data-act="Y" data-icon=""><i class=""></i>{{row.FormDesc}}
    <a href="JavaScript:void(0)" style="visibility: hidden;"><i class="fa fa-pencil modal-trigger" aria-hidden="true" data-toggle="modal" data-target="#update-item"></i></a></li>
    {%- endfor %}
{% endmacro %}

    <div class="col-sm-12 navbar navbar-default navbar-static-top" role="navigation">
        <ul class="col-sm-10 nav navbar-nav">
            {% for items in li_html %}
                <li  {{items[1]|safe}} >
                    {% if items[0]=="Save" %}
                        <a href="javascript:void(0)" {{items[1]|safe}} id="{{items[0]}}"><i class='fa fa-floppy-o'></i>&nbsp;{{ getLanguage('Save') }}</a>
                    {% elif items[0]=="Edit" %}
                        <a href="javascript:void(0)" {{items[1]|safe}} id="{{items[0]}}"><i class='fa fa-pencil-square-o'></i>&nbsp;{{ getLanguage('Edit') }}</a>
                    {% elif items[0]=="Delete" %}
                        <a href="javascript:void(0)" id="Delete" {{items[1]|safe}}><i class='fa fa-trash-o'></i>&nbsp;{{ getLanguage('Delete') }}</a>
                    {% elif items[0]=="Authorize" %}
                        <a href="javascript:void(0)" id="Authorize" {{items[1]|safe}} ><i class='fa fa-check'></i>&nbsp;{{ getLanguage('Authorize') }}</a>
                    {% elif items[0]=="Cancel" %}
                        <a href="javascript:void(0)" id="Cancel" {{items[1]|safe}} ><i class='fa fa-undo'></i>&nbsp;{{ getLanguage('Cancel') }}</a>
                    {% elif items[0]=="Verify" %}
                        <a href="javascript:void(0)" id="Verify" {{items[1]|safe}}><i class='fa fa-pencil-square-o'></i>&nbsp;{{ getLanguage('Verify') }}</a>
                    {% else %}
                    {#
                        <a href="javascript:void(0)" id="New" {{items[1]|safe}}><i class='fa fa-file-text-o'></i>&nbsp;{{ getLanguage('New') }}</a>
                    #}
                    {% endif %}
                </li>
            {% endfor %}
            <li>
                <div class="navbar-form navbar-left">
                    <div class="form-group">
                    <input type="text" class="form-control" name="ID" ID="ID" placeholder="Record ID"  value="{{g_id}}" {{ g_readonly }} >
                    </div>

                </div>
            </li>
            <li>
                <div class="btn-group group-more-action" style="padding: 9px 0px 0px 0px; margin-left: 15px;">
                    <button type="button" class="btn btn-primary dropdown-toggle more-action" data-toggle="dropdown">{{ getLanguage('More Action') }}</button>
                    <button type="button" class="btn btn-primary group" data-toggle="dropdown">
                            <i class="fa fa-caret-down"></i>
                    </button>
                    <script>
                        $(function(){
                            $('button.more-action,button.group').click(function(){
                                $('div.group-more-action').toggleClass('open');
                            })
                        })
                    </script>
                    <ul class="dropdown-menu">
                            <!-- <li><a href="javascript:void(0)" onclick="copy('frm')"><i class='fa fa-files-o'></i>&nbsp;{{ getLanguage('Copy Record') }}</a></li>
                            <li><a href="javascript:void(0)" onclick="paste('frm')"><i class='fa fa-clipboard'></i>&nbsp;{{ getLanguage('Paste Record') }}</a></li> -->
                            <li><a href="javascript:void(0)" id="Reverse"><i class='fa fa-reply'></i>&nbsp;{{ getLanguage('Reverse Record') }}</a></li>
                            <li class="divider"></li>
                            <li><a href="javascript:void(0)" id="listLive" ><i class='fa fa-list'></i>&nbsp;{{ getLanguage('List Live Record') }}</a></li>
                            <li><a href="javascript:void(0)" id="listAuth"><i class='fa fa-list'></i>&nbsp;{{ getLanguage('List Un-authorize Record') }}</a></li>
                            <li><a href="javascript:void(0)" id="listHist"><i class='fa fa-list'></i>&nbsp;{{ getLanguage('List History Record') }}</a></li>
                            
                            <li class="divider"></li>

                            <li><a href="javascript:void(0)" id="csv"> <i class='fa fa-files-o'></i> {{ getLanguage('Export CSV') }} </a></li> 
                            <li><a href="javascript:void(0)" id="excel"> <i class='fa fa-file-excel-o'></i> {{ getLanguage('Export Excel') }} </a></li>
                            <li><a href="javascript:void(0)" id="print"><i class='fa fa-print'></i>&nbsp;{{ getLanguage('Print') }}</a></li>
                    </ul>
                </div>
            </li>
        </ul>
        </ul>
        {%if Form %}
        <ul class="col-sm-2 nav navbar-nav">
            <li class="pull-right">
                <div class="navbar-form navbar-left" style="padding:0px;">
                    <button type="button" id="AddMoreLoan" data-toggle="modal" {{disabled}} data-target="#modal-sizes-2" class="btn btn-flat btn-labeled btn-success" 
                    id="Auto">
                        <span class="btn-label icon fa fa-plus"></span>Add More Loan Contract
                    </button>
                </div>
            </li>
        </ul>
        {%endif%}
    </div>

    <!-- <div class="clearfix"></div> -->
    {% include 'msg_error.html' %}

    {% if ordered_list %}
    <div class="col-sm-12">
        <div class="message"></div>
        <form class="form-horizontal">
            <session id="MenuList">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="form-group">
                                <label class="col-xs-2 control-label" for="Description" style="width: auto;padding-left: 24px;">Menu Name</label>
                                <div class="col-xs-5" style="padding-left: 0px;">
                                    <input type="text" value="{{MenuName}}" name="MenuName" id="MenuName" class="form-control" style="width: 96%;" required="required">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <h4 class="center">List Available Menu</h4>
                        <input type="text" id="myInput" class="form-control text-center" onkeyup="itemFilter(this.id,'myUL');" placeholder="Search Form" value="" style="width: 100%;">
                        <br>
                        <ol class="example forms" id="myUL" data-toggle="collapse">
                            {% for mod in Module -%}
                            <li data-ItemID="" data-module="" data-formdesc="" data-act="Y" data-icon=""><i class=""></i>{{mod.Description}}<a href="JavaScript:void(0)" style="visibility: hidden;"><i class="fa fa-pencil modal-trigger" aria-hidden="true" data-toggle="modal" data-target="#update-item"></i></a>
                                <ol style="display:none;" data-formid="{{mod.ID}}">{{getForm(mod.ID)}}</ol>
                            </li>
                            {%- endfor %}
                        </ol>
                    </div>
                    <div class="col-xs-6">
                        <h4 class="center">Menu Preview</h4>
                    <form action="" id="new-parent" style="position: relative;">
                        <div class="form-group" style="margin-left:0;margin-right: 0;">
                            <div class="col-sm-12" style="padding: 0;">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control text-center new-parent" placeholder="Input Name of parent menu and press enter" style="width: 100%;">

                                    </div>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control text-center" placeholder="Search Menu" id="searchMenu" onkeyup="itemFilter(this.id,'example2');" style="width: 100%;">
                                    </div>
                                </div>
                                
                               <!--  <input type="text" class="form-control text-center new-parent" placeholder="Input Name of parent menu and press enter" style="width: 100%;"> -->

                                <input type="submit" value="" form="new-parent" style="display: none;">
                            </div>
                        </div>
                    </form>
                    <div></div>
                    <div class="newMenu">
                        <ol class="example example2 sortable" id="example2">
                            {{ordered_list[4:ordered_list|length-5]|safe}}
                        </ol>
                    </div>
                    </div>
                </div>
            </session>
        </form>
    </div>
    
    <script>
        $(document).ready(function(){
            '{% if unsortable == "unsortable" %}'
                $('ol.example li').addClass('unsortable');
                $('#ID,input.new-parent,#MenuName').attr('readonly','readonly');
                $('ol.example:last').find('a i.fa-pencil').css('display','none');
            '{% endif %}'

            $('ol.example:last li').has('ol li').addClass('toggle-icon-down');
            $('ol.example:first li').has('ol li').addClass('toggle-icon-up');

            checkChild();

        })
    </script>
    {% endif %}

    <div role="dialog" tabindex="-1" id="deleteDialog" class="modal fade" >
        <div style="width: 40%;" class="modal-dialog">
            <div class="modal-content">
                <form method="POST" action="" id="deleteForm" class="form-horizontal">
                    <div class="modal-header">
                        <button aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span></button>
                        <h4 id="exampleModalLabel" class="modal-title">Delete Menu</h4>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure want to delete this Menu "<strong id="tTitle"></strong>"?</p>
                        <input type="hidden" name="ID" id="tID">
                    </div>
                    <div class="modal-footer">
                        <div class="form-group">
                            <button type="button" class="btn btn-flat btn-default" data-dismiss="modal"><i class="fa fa-reply"></i> Close</button>
                            <button type="submit" class="btn btn-flat btn-danger"><i class="fa fa-remove"></i> Delete</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
     
{% endblock %}

{% block js %}
     <!-- Call in Block Js -->
    <script src="{{ url_for('static', filename='js/menubuilder/jquery-sortable-min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/menubuilder/icons.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/menubuilder/trello_card.js') }}"></script>

    <script>
    trello_card();
    /* Initialize Menu: List available forms and make them sortable*/
    Menu_init()
    </script>

    <script type="text/javascript">

        $(document).ready(function() {

            $('#Cancel').click(function(e) {
                window.location = '/Morakot/MenuBuilder/';
            });

            $('#Edit').click(function(e) {
                window.location = '/Morakot/MenuBuilder/Edit/'+$('#ID').val();
            });

            $('#listLive').click(function(e) {
                window.location = '/Morakot/MenuBuilder/ListLive/';
            });

            $('#listHist').click(function(e) {
                window.location = '/Morakot/MenuBuilder/ListHist/';
            });

            $('#Save').click(function(e) {
                e.preventDefault();
                if(isValidMenuItem()==false){
                    return false;
                }

                MenuOperation('Edit');
            })

            $('#Reverse').click(function (e) {
                e.preventDefault();
                var id = $('#ID').val(), 
                    title = $('#MenuName').val();
                // alert(id);
                $('#tID').val(id);
                $('#tTitle').html(title);
                $('#deleteForm').attr('action','/Morakot/MenuBuilder/Delete/'+id);

                $('#deleteDialog').modal()
            });

        });
        
    </script>

 
{% endblock %}