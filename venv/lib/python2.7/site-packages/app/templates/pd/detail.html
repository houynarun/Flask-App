{% extends "layout.html" %}

{% block css %}
    
    <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/jquery.datatables.css') }}"> -->
    <style>
        h3.header-3{
            color: #888 !important;
            font-size: 16px;
            font-weight: bold;
            margin: 5px 0 10px;
            padding: 10px 18px 0;
        }

        .se-pre-con1 {
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: #FFF url("{{ url_for('static',filename='images/loading.gif') }}") center no-repeat;
            opacity: 0.4;
            display: none;
        }

        .form-label{
            padding-top: 7px;
        }

        #Main {
          width: 1px;
          min-width: 100%;
          *width: 100%;
        }
        .panel {
          width: 100%;
        }

    </style>

{% endblock %}

{% block content %}
<div id="Main">
    <div class="navbar navbar-default navbar-static-top">
        <form method="GET" id="frm" name="frm" role="form" action="/Morakot/PD/">
            <div class="col-sm-6">

                <div style="margin-top: 8px;">
                    <div class="col-sm-4" style="padding-left: 0;">
                       <input type="text" name="ID" class="form-control" value="{{ ID }}" style="width: 100%;" placeholder="Record ID *">
                    </div>
                    <label class="col-sm-1" style="padding:0px;">
                        <button type="submit" class="btn btn-flat btn-labeled btn-primary" style="padding: 7px 25px;">
                            Show
                        </button>
                    </label>
                </div>             
            </div>

            <div class="col-sm-6">

                <div class="pull-right" style="margin-top: 8px;">

                    {% from "print.html" import exportButton %}
                    {{exportButton()}}

                </div>             
            </div>

        </form>
    </div>

    <div class="clearfix"></div>
    {% include 'msg_error.html' %}

    {% if PD_DATE: %}
        <div class="col-sm-12">
            <h3 class="header-3 text-center">Past Due Detail</h3>
        </div>
        <div class="col-xs-6">
        <!-- <div class="table-responsive"> -->
            <table  style="width: 100%;">
                <tr>
                    <td width="150"><strong>Customer</strong></td>
                    <td>: &nbsp <a href='javascript:void(0)' onClick=CustomClickView('Customer','{{LINK.get("Customer")}}?ID={{PD.Customer}}')>{{ PD.Customer }}</a></td>
                </tr>
                <tr>
                    <td><strong>Customer Name</strong></td>
                    <td>: &nbsp  {{ VLOOKUP(['MKT_CUSTOMER', 'ID', PD.Customer, 'LastNameEn']) }} {{ VLOOKUP(['MKT_CUSTOMER', 'ID', PD.Customer, 'FirstNameEn']) }}</td>
                </tr>
                <tr>
                    <td><strong>Account</strong></td>
                    <td>: &nbsp   <a href='javascript:void(0)' onClick=CustomClickView('Account&nbspStatement','AccountStatement/?ID={{ LoanObj.Account }}')>{{ LoanObj.Account }}</a> </td>
                </tr>
                <tr>
                    <td><strong>Loan ID</strong></td>
                    <td>: &nbsp  <a href='javascript:void(0)' onClick=CustomClickView('Loan-Centre','LoanCentre?ID={{ID[2:]}}')>{{ ID[2:] }}</a> </td>
                </tr>
                <tr>
                    <td><strong>Disbursed</strong></td>
                    <td>: &nbsp  {{ toMoney(float(LoanObj.Disbursed), getCurrencyObj(LoanObj.Currency)) }}</td>
                </tr> 
                <tr>
                    <td><strong>Loan Balance</strong></td>
                    <td>: &nbsp  {{ toMoney(float(LoanObj.Amount), getCurrencyObj(LoanObj.Currency)) }}</td>
                </tr>                 
                <tr>
                    <td><strong>Loan Outstanding</strong></td>
                    <td>: &nbsp  {{ toMoney(float(LoanObj.OutstandingAmount), getCurrencyObj(LoanObj.Currency)) }}</td>
                </tr>                
                <tr>
                    <td><strong>Currency</strong></td>
                    <td>: &nbsp  {{ PD.Currency }}</td>
                </tr>
                
                
            </table>
        <!-- </div> -->
        </div>
        <div class="col-xs-6" style="padding-right: 20px;">
        <!-- <div class="table-responsive"> -->
            <table style="float: right;">
                <tr>
                    <td width="170"><strong>Total Over Due Amount</strong></td>
                    <td>: &nbsp {{ toMoney(float(PD.TotODAmount), getCurrencyObj(PD.Currency)) }}</td>
                </tr>
                <tr>
                    <td><strong>Total Principal Due</strong></td>
                    <td>: &nbsp {{ toMoney(float(PD.TotPrincipalDue), getCurrencyObj(PD.Currency)) }}</td>
                </tr>
                <tr>
                    <td><strong>Total Interest Due</strong></td>
                    <td>: &nbsp {{ toMoney(float(PD.TotInterestDue), getCurrencyObj(PD.Currency)) }}</td>
                </tr>
                <tr>
                    <td><strong>Total Penalty Due</strong></td>
                    <td>: &nbsp {{ toMoney(float(PD.TotPenaltyDue), getCurrencyObj(PD.Currency)) }}</td>
                </tr>
                <tr>
                    <td><strong>Total Charge Due</strong></td>
                    <td>: &nbsp {{ toMoney(float(PD.TotChargeDue), getCurrencyObj(PD.Currency)) }}</td>
                </tr>
                <tr>
                    <td><strong>Interest Rate</strong></td>
                    <td>: &nbsp  {{ LoanObj.InterestRate }} %</td>
                </tr>
                <tr>
                    <td><strong>Penalty Rate</strong></td>
                    <td>: &nbsp  {{ PenaltyDict.get("PenaltyRateWithFormat") }}</td>
                </tr>
            </table>
        <!-- </div> -->
        </div>

        <div class="clearfix">&nbsp;</div>
        <div class="clearfix">&nbsp;</div>
        <div class="table-responsive">
        <table id="mktlist" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th colspan="3"></th>
                    <th colspan="5" class="text-center"><b>Past Due Before Payment</b></th>
                    <th colspan="5" class="text-center"><b>Outstanding Past Due</b></th>
                  
                </tr>
                <tr>
                    <th><b>Date</b></th>
                    <th><b>Day Due</b></th>
                    <th><b>Status</b></th>
                    {%set BgColor= 'background: #d9edf7; color: #3a87ad;'%}
                    {%set BGColor2 = 'background: #8cc98c; color: #2d6e2d; '%}
                    <th class="text-right" style="padding-right: 35px; {{BgColor}}"><b>Principal</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BgColor}}"><b>Interest</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BgColor}}"><b>Penalty</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BgColor}}"><b>Charge</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BgColor}}"><b>Total</b></th>

                    <th class="text-right" style="padding-right: 35px; {{BGColor2}}"><b>Principal</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BGColor2}}"><b>Interest</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BGColor2}}"><b>Penalty</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BGColor2}}"><b>Charge</b></th>
                    <th class="text-right" style="padding-right: 35px; {{BGColor2}}"><b>Total</b></th>

                </tr>
            </thead>

            <tbody>
                {% for row in PD_DATE %}
                    <tr>
                        <td>{{ row.DueDate }}</td>
                        <td>{{ row.NumDayDue }}</td>
                        <td>{{ row.ODStatus }}</td>
                       
                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.PrincipalDue), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.InterestDue), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.PenaltyDue), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.ChargeDue), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.TotODAmount), getCurrencyObj(PD.Currency)) }}</td>



                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.OutPriAmount), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.OutIntAmount), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.OutPenAmount), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.OutChgAmount), getCurrencyObj(PD.Currency)) }}</td>

                        <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(row.OutAmount), getCurrencyObj(PD.Currency)) }}</td>



                        


                    </tr>
                {% endfor %}
            </tbody>
            {%if PD_DATE %}
     
                <tr class="text-bold">
                    <td><b>Total</b></td>
                    <td></td>
                    <td></td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='PrincipalDue') ), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='InterestDue') ), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='PenaltyDue')), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='ChargeDue')), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='TotODAmount')), getCurrencyObj(PD.Currency)) }}</td>



                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='OutPriAmount')), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='OutIntAmount')), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='OutPenAmount')), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='OutChgAmount')), getCurrencyObj(PD.Currency)) }}</td>

                    <td class="text-right" style="padding-right: 35px;">{{ toMoney(float(PD_DATE |sum(attribute='OutAmount')), getCurrencyObj(PD.Currency)) }}</td>

                </tr>

            {%endif%}
        </table>
        </div>

    {% endif %}
</div>
{% endblock %}

{% block js %}
    
    {% from "print.html" import exportIncludeJS %}
    {{ exportIncludeJS() }}

    <script type="text/javascript">
        $(document).ready(function() {

            $('#mktlist').dataTable({
                "lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
                "bSort" : false
            });

            {% from "print.html" import exportDataTable %}
            {{ exportDataTable('#mktlist','Past Due - ' + ID) }}
        });
    </script>

{% endblock %}