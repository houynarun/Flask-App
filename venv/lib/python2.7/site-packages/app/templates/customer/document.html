{% extends "layout.html" %}

{% block css %}

	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/jquery.datatables.css') }}">
	<script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script>
	<script src="{{ url_for('static',filename='js/dataTables.tableTools.js') }}"></script>
	<link rel=stylesheet type=text/css href="{{ url_for('static', filename='stylesheets/dataTables.tableTools.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/responsive.bootstrap.min.css') }}">
	 <script src="{{ url_for('static',filename='javascripts/dataTables.responsive.min.js') }}"></script>
	<style type="text/css">
		body{
			/*background: rgba(192, 192, 192, 0.18);*/
		}
		.se-pre-con1 {
			position: fixed;
			left: 0px;
			top: 0px;
			width: 100%;
			height: 100%;
			z-index: 9999;
			background: #FFF url("{{ url_for('static',filename='images/loading.gif') }}") center no-repeat;
			opacity: 0.4;
			display: none;
		}

		.modal-dialog{
			width: 50%;
		}

		.pixel-file-input
		{
			width: 330px;
		}
		#s2id_ID{
			width: 100% !important;
		}
		
		#div-view-list{
			background: #fff;
		}
		.thead {
		}
		.tbody {
			background: #fff;
		}
		.grid-container{
			padding: 10px;
		}
		.grid-container > .grid-file {
			height: 300px;
			background: #fff;
			box-shadow:1px 1px 2px #888888;
			/*margin:5px;*/
			/*padding: 10px;*/
		}
		.thumbnail{
			background: #fff;
			box-shadow:1px 1px 2px #888888;	
		}
		.thumbnail:hover{
			border:1px solid #4083a9;
			/*padding: 5px;	*/
		}
		p.description span{
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			display: inline-block;
			max-width: 100%;
		}
		h3{
			font-weight:600;
			font-size:14px;
		}
		.pixel-file-input{
			float: left;
		}
		.button-action {
			margin-left: 5px;
			font-size: 14px;
		}
		@media all and (max-width: 842px) {
			.bootbox > .modal-dialog {
				width: 94% !important;
			}
        h3{
        	font-weight:600;
        	font-size:14px;
        }
        .pixel-file-input{
        	float: left;
        }
        .button-action {
        	margin-left: 5px;
        	font-size: 14px;
        }
        @media all and (max-width: 842px) {
	        .bootbox > .modal-dialog {
	        	width: 94% !important;
	        }
			.select2 {
				width: 50% !important;
			}
		}
		@media all and (max-width: 706px) {
			.HistoryFile,.uploadDocument {
				display: none;
			}
		}
		#Main {
		  width: 1px;
		  min-width: 100%;
		  *width: 100%;
		}
		.panel {
		  width: 100%;
		}
	</style>

{% endblock %}

{% block content %}
<div id="Main">
	<div class="se-pre-con1" id="animated"></div>
	<div class="navbar navbar-default navbar-static-top">
		<form method="GET" id="frm" name="frm" role="form" action="/Morakot/Document/">
			<div class="col-xs-12">

				{% if Add == 'Y' %}

					<div class="col-xs-8" style="margin-top:16px; padding:0px">

						<a href="javascript:void(0)" id="Save"  style="color: #777;">
							<span class="btn-label icon fa fa-floppy-o"></span> Save
						</a> &nbsp;&nbsp;&nbsp;

						<a href="javascript:void(0)" id="Cancel" style="color: #777;">
							<span class="btn-label icon fa fa-undo"></span>&nbsp; Cancel
						</a>
					</div>

				{% else %}

					<div class="col-xs-3" style="margin-top:8px; padding:0px;">
						{% from "print.html" import searchCustomer %}
						{#searchCustomer(url,name,value,condition,placeholder="Record ID",AllowPutID='Y')#}
						{{searchCustomer(url='/Morakot/GetCustomerDocument', name='ID', value=globalID,condition='',placeholder='Input Customer ID or Name')}}
					</div>		 
					<div class="col-xs-3" style="margin-top:8px;">
						<label>
							<button type="submit" class="btn btn-flat btn-labeled btn-primary" id="btnShow" style="padding: 7px 25px;">
								{{ getLanguage('Show') }}
							</button>
						</label>
					</div>

					{% if CustomerObj %}

						<div class="col-xs-6" style="margin-top:8px;">
							{% if Trash == 'Y' %}
								<a href="/Morakot/Document/?ID={{ ID }}" class="btn btn-flat btn-labeled btn-warning pull-right" title="Back">
					                <span class="icon fa fa-reply"></span> &nbsp;&nbsp; Back 
					            </a>
							{% else %}
								<a href="/Morakot/Document/?ID={{ ID }}&Trash=Y" class="btn btn-flat btn-labeled btn-primary pull-right" title="Restore from Trash">
					                <span class="icon fa fa-history"></span><span class="HistoryFile">&nbsp;&nbsp; History Files</span>
					            </a>
				            {% endif %}
				            
				            {% if AccessRightDict.get("New") == True %}
				            <a href="/Morakot/Document/?ID={{ ID }}&Add=Y" class="btn btn-flat btn-labeled btn-success pull-right" style="margin-right: 5px;" title="Upload Document">
				                <span class="icon fa fa-upload"></span><span class="uploadDocument"> &nbsp;&nbsp; Upload Document</span>
				            </a>
				            {%endif%}
				            {% if AttachmentOptionDict.get("AttachmentDefaultView") == '1' %} {# 1 = list, 2 = grid #}				            
				            <a href="javascript:void(0)" id="btn-view" class="btn btn-flat pull-right" data-view="list" title="List View" style="margin-right: 5px;">
				                <span class="icon fa fa-th-list" id="icon-view"></span>
				            </a>
				            {%else%}
				            <a href="javascript:void(0)" id="btn-view" class="btn btn-flat pull-right" data-view="grid" title="Grid View" style="margin-right: 5px;">
				                <span class="icon fa fa-th" id="icon-view"></span>
				            </a>
				            {%endif%}
						</div>

					{% endif %}

				{% endif %}
				
			</div>
		</form>
	</div>


	<!--  message  -->
	<div class="clearfix"></div>
	{% include 'msg_error.html' %}

	<div class="col-xs-12" id="client-side-alert" style="display: none">
		<div class="alert alert-warning">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<div id="client-side-alert-msg"></div>
		</div>
	</div>

	<!--  data content  -->
	<div class="clearfix"></div>
	<div class="col-xs-12">
		{% if CustomerObj %}
			{% if Add == 'Y' %}

				<form class="form-horizontal" action="/Morakot/Document/Upload/" method="POST" enctype="multipart/form-data" id="PostAttachment">
                    
                        <input type="hidden" value="{{ ID }}" name="GetCustomerDocument" id="GetCustomerDocument">
                        <input type="hidden" value="{{ DocumentID }}" name="ID" id="ID">
                        <input type="hidden" value="{{ AttachmentOptionDict.get('AttachementAllowSize') }}" id="AttachementAllowSize">
                        <div class="form-group">
							<label class="col-sm-2 control-label" for="Description">
								{{ getLanguage('Description') }} <span style="color:#d38e99">*</span>
							</label>
							<div class="col-xs-10">
								<input id="Description" name="Description" class="form-control" value="{{ Description }}">
							</div>
						</div>

						<div class="form-group">
							<label class="col-xs-2 control-label" for="Type">
								{{ getLanguage('Type') }} <span style="color:#d38e99">*</span>
							</label>
							<div class="col-xs-10">
								<select class="form-control select2" name="Type" id="Type">
									<option value="">--None--</option>
									{% for item in TypeList %}
										<option value="{{item[0]}}">{{item[1]}}</option>
									{% endfor %}
								</select>
							</div>
						</div>

						<div class="form-group">
							<label class="col-xs-2 control-label" for="Reference">
								{{ getLanguage('Reference') }} <span style="color:#d38e99">*</span>
							</label>
							<div class="col-xs-10">
								<select class="form-control select2" name="Reference" id="Reference">
									<option value="">--None--</option>
								</select>
							</div>
						</div>

						{% if DocumentID and Link %}
							{% set url_no_image =  url_for('static', filename='images/noPreview.png')%}

							<div class="form-group">
								<label for="file" class="col-xs-2 control-label"></label>
								<div class="col-xs-10">
									{% if DocumentType == 'Image' %}
										<img width="330" style="padding: 5px; border: 1px solid #CCC;" class="img-responsive" src="{{ url_for('custom_attachment', filename=Link) }}" width="100%" onerror="this.src='{{url_no_image}}'">
									{% else %}
										<object style="padding: 5px; border: 1px solid #CCC;" data="{{ url_for('custom_attachment', filename=Link) }}" type="application/pdf" width="330" height="250">
											<p>Can't view this file - link <a href="{{ url_for('custom_attachment', filename=Link) }}">to download PDF!</a></p>
										</object>
									{% endif %}
								</div>
							</div>

						{% endif %}

						<div class="form-group">
							{% set AllowExtension = AttachmentOptionDict.get("AttachmentAllowExtension").replace(' ', ' , ')%}
							{% set AllowSize = AttachmentOptionDict.get("AttachementAllowSize") / 1024 /1024 %}
							<label for="file" class="col-xs-2 control-label">Browse File ({{AllowExtension}} ) <span style="color:#d38e99">*</span></label>
							<div class="col-xs-10">
								<input id="BrowseFile" type="file" name="file" class="form-control">
								<div style="float: left;margin: 5px;margin-left: 10px">Maximum Size: ({{AllowSize}} MB)</div>
								<script type="text/javascript">
									// check if on mobile or not
									isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
									if(isMobile==false)
									{
										init.push(function () {
											$('#BrowseFile').pixelFileInput({ placeholder: 'No file selected...' });
										})
									}
								</script>
							</div>
						</div>

				</form>

			{% else %}
				{% if DocumentObj %}
					{%if Trash=='Y' %}
						<h2 style="font-size: 18px;"><i class="fa fa-history"></i> &nbsp;&nbsp;History Files</h2><hr>
					{%else%}
						<h2 style="font-size: 18px;"><i class="fa fa-file"></i> &nbsp;&nbsp;Uploaded Files</h2><hr>
					{%endif%}
					<div style="display: none;" id="div-view-list">
						<div class="table-responsive">					
						<table id="mktlist" class="display mktlist" cellspacing="0" width="100%">
							
				            <thead>
				                <tr>                            
				                    <th>ID</th>
				                    <!-- <th>Customer</th> -->
				                    <th>Description</th>
				                    <th>Type</th>
				                    <th>Reference</th>
				                    <th>Inputter</th>
				                    <th>Created Date</th>
				                    <!-- <th>Link</th> -->
				                    <th class="text-center">Action</th>
				                </tr>
				            </thead>				            

				            	<tbody>

				            		{% for item in DocumentObj %}
				            			{% set first_index = loop.index - 1 %}

					            		<tr>
					            			<td>
					            				<i class="fa {{'fa-file-pdf-o' if item.DocumentType=='PDF' else 'fa-file-image-o' }} text-lg"></i>&nbsp;&nbsp;&nbsp;
					            				{{ item.ID }}
				            				</td>
					            			{#<td>{{ item.LastNameEn }} {{ item.FirstNameEn }}</td>#}
					            			<td>{{ item.Description }}</td>
					            			{% for itemType in TypeList %}
					            				{% if itemType[0] == item.Type %}
					            					<td>{{ itemType[1] }}</td>
					            				{% endif %}
					            			
					            			{% endfor %}
					            			{% for itemType in TypeList %}
					            				{% if itemType[0] == item.Type %}
					            			<td><a href="javascript:void(0);" class="link" onClick="ClickView('{{itemType[1]}}','{{itemType[2]}}','{{item.Reference}}')">{{ item.Reference }}</a></td>
					            				{% endif %}
					            			{% endfor %}
					            			<td>{{ item.Inputter }}</td>
					            			<td>{{ item.Createdon }}</td>
					            			{#<td>{{ item.Link }}</td>#}
					            			<td class="text-center">
					            				{% if Trash == 'Y' %}
					            					{%if AccessRightDict.get("Delete") == True %}
					            					<a id="RemoveAttachment" href="javascript:void(0);" onclick="getRemoveDocument('{{ item.ID }}', '{{ ID }}', '{{ item.Link }}', '{{ item.Description }}')" title="Delete" style="" class="button-action">
						            					<i class="fa fa-trash-o text-danger"></i>
						            				</a>
						            				{%endif%}

						            				{% if AccessRightDict.get("Edit") == True %}
						            				<a id="RestoreDocument" href="javascript:void(0);" onclick="getRestoreDocument('{{ item.ID }}', '{{ ID }}')" title="Restore" style="" class="button-action">
						            					<i class="fa fa-undo text-info"></i>
						            				</a>
						            				{%endif%}

					            				{% else %}
					            					{%if AccessRightDict.get("View") == True %}
					            					<a href="/Morakot/View/Document/?ID={{ ID }}&FirstIndex={{ first_index }}" data-toggle="modal" data-target="#PreviewAttachment" title="Preview" style="" class="button-action">
						            					<i class="fa fa-eye"></i>
						            				</a>
						            				&nbsp;&nbsp;
						            				{%endif%}
						            				<a target="_blank" href="{{ url_for('custom_attachment', filename=item.Link) }}" title="Download" style="" class="button-action">
						            					<i class="fa fa-cloud-download"></i>
						            				</a>
						            				{%if AccessRightDict.get("Edit") == True %}
						            				&nbsp;&nbsp;
						            				<a href="/Morakot/Document/?ID={{ ID }}&Add=Y&AT={{ item.ID }}" title="Edit" style="" class="button-action">
						            					<i class="fa fa-pencil text-warning"></i>
						            				</a>
						            				{%endif%}
						            				{%if AccessRightDict.get("Delete") == True %}
						            				&nbsp;&nbsp;
						            				<a id="DeleteAttachment" href="javascript:void(0);" onclick="getDeleteDocument('{{ item.ID }}', '{{ ID }}','{{ item.Description }}')" title="Delete" style="" class="button-action">
						            					<i class="fa fa-trash-o text-danger"></i>
						            				</a>
						            				{%endif%}

					            				{% endif %}
					            				
					            			</td>
					            		</tr>

					            	{% endfor %}

				            	</tbody>
			        	</table>

						</div>
					</div>

					<div style="display: none;" id="div-view-grid">	
							{% for itemType in TypeList%}
								<h3 style="text-decoration: underline;">{{itemType[1]}} Files</h3>
								<div class="clearfix"></div>
								<div class="row">
								{% for item in DocumentObj %}
									{% set url_image =  url_for('custom_attachment', filename=item.Link)%}
									{% if item.Type == itemType[0] %}
									{% set url_no_image =  url_for('static', filename='images/noPreview.png')%}
									{% set first_index = loop.index - 1 %}
									<div class="col-lg-2 col-md-4 col-sm-4 col-xs-6">
										<div class="thumbnail" style="overflow: hidden;">
											{% if item.DocumentType == "Image" %}
										  		
										  		<a href="/Morakot/View/Document/?ID={{ ID }}&FirstIndex={{ first_index }}" data-toggle="modal" data-target="#PreviewAttachment" title="Preview"><img src="{{url_image}}" alt="{{item.Link}}" style="height: 200px;" onerror="this.src='{{url_no_image}}'"></a>
										  		
											{% else %}
												<object class="embed-responsive-item" src="{{url_image}}?zoom=15&scrollbar=0&toolbar=0&navpanes=0" style="height: 196px;width: 100%;overflow: hidden;border: 0px">
										  		</object>
											{% endif %}	
															  	
										  	<div class="caption">
										    	<h3>
										    		<i class="fa {{ 'fa-file-pdf-o' if item.DocumentType == 'PDF' else 'fa-file-image-o' }} text-lg"></i>&nbsp;&nbsp;&nbsp; 
										    		{{item.ID}}
									    		</h3>
										    	<p class="description"><span title="{{ item.Reference }} - {{ item.Description }}"> <a href="javascript:void(0);" class="link" onClick="ClickView('{{itemType[1]}}','{{itemType[2]}}','{{item.Reference}}')">{{ item.Reference }}</a>
										    	 - <b>{{ item.Description }}</b> </span></p>
										    	<p class="pull-right">
										    		{% if Trash == 'Y' %}
					            					{%if AccessRightDict.get("Delete") == True %}
					            					<a id="RemoveAttachment" href="javascript:void(0);" onclick="getRemoveDocument('{{ item.ID }}', '{{ ID }}', '{{ item.Link }}', '{{ item.Description }}')" title="Delete" style="" class="button-action">
						            					<i class="fa fa-trash-o text-danger"></i>
						            				</a>
						            				{%endif%}
						            				{% if AccessRightDict.get("Edit") == True %}
						            				<a id="RestoreDocument" href="javascript:void(0);" onclick="getRestoreDocument('{{ item.ID }}', '{{ ID }}')" title="Restore" style="" class="button-action">
						            					<i class="fa fa-undo text-info"></i>
						            				</a>
						            				{% endif %}
					            				{% else %}
					            					{%if AccessRightDict.get("View") == True %}
					            					<a href="/Morakot/View/Document/?ID={{ ID }}&FirstIndex={{ first_index }}" data-toggle="modal" data-target="#PreviewAttachment" title="Preview" style="" class="button-action">
						            					<i class="fa fa-eye"></i>
						            				</a>
						            				&nbsp;&nbsp;
						            				{%endif%}
						            				<a target="_blank" href="{{ url_for('custom_attachment', filename=item.Link) }}" title="Download" style="" class="button-action">
						            					<i class="fa fa-cloud-download"></i>
						            				</a>
						            				{%if AccessRightDict.get("Edit") == True %}
						            				&nbsp;&nbsp;
						            				<a href="/Morakot/Document/?ID={{ ID }}&Add=Y&AT={{ item.ID }}" title="Edit" style="" class="button-action">
						            					<i class="fa fa-pencil text-warning"></i>
						            				</a>
						            				{%endif%}
						            				{%if AccessRightDict.get("Delete") == True %}
						            				&nbsp;&nbsp;
						            				<a id="DeleteAttachment" href="javascript:void(0);" onclick="getDeleteDocument('{{ item.ID }}', '{{ ID }}','{{ item.Description }}')" title="Delete" style="" class="button-action">
						            					<i class="fa fa-trash-o text-danger"></i>
						            				</a>
						            				{%endif%}

					            				{% endif %}		
										    	</p>
										  	</div>
										</div>
									</div>
									{% endif %}							
								{% endfor %}
								</div>
							{% endfor%}
						
					</div>	
				{% else %}
					{% if Trash == "Y" %}
					<div class="clearfix">&nbsp;</div>	
					<div class="col-xs-12" style="padding: 5%"></div>	
					<div class="col-xs-12 text-center">
						<i class="fa fa-history text-default" style="font-size: 70px"></i>
					</div>
					<div class="col-xs-12">
						<h1 class="header-3 text-center text-default"><span style="font-weight: bold;">History List is Empty</span></h1>
					</div>	
					<div class="col-xs-12 text-center" style="padding:5px 10px">
						<span class="text-center" style="font-size: 15px">
							There are no update or delete files.
						</span> 
					</div>

					{% else %}
					<div class="clearfix">&nbsp;</div>	
					<div class="col-xs-12" style="padding: 5%"></div>	
					<div class="col-xs-12 text-center">
						<i class="fa fa-file text-success" style="font-size: 70px"></i>
					</div>
					<div class="col-xs-12">
						<h1 class="header-3 text-center text-default"><span style="font-weight: bold;">Document Upload</span></h1>
					</div>	
					<div class="col-xs-12 text-center" style="padding:5px 10px">
						<span class="text-center" style="font-size: 15px">
							There are no upload files.
						</span> 
					</div>
					<div class="col-xs-12 text-center" style="padding:5px 10px">
						<span class="text-center" style="font-size: 15px">
							{% if AccessRightDict.get("New") == True %}
				            <a href="/Morakot/Document/?ID={{ ID }}&Add=Y" class="btn btn-flat btn-labeled btn-success" style="margin-right: 5px;" title="Upload Document">
				                <span class="icon fa fa-upload"></span> &nbsp;&nbsp; Upload Document
				            </a>
				            {%endif%}
						</span> 
					</div>
					{% endif %}

				{% endif %}
			{% endif %}

		{% endif %}

	</div>
</div>
{% endblock %}

{% block js %}

	<!-- <script src="http://malsup.github.com/jquery.form.js"></script> -->
	<script type="text/javascript">
		function getModal(e){
			// e.preventDefault();
			var url = e;
			if (url.indexOf('#') == 0) {
				return false;
			} else {
				$.get(url, function(data) {
					// $('<div class="modal">' + data + '</div>').modal();
					var iFrameDetection = (window === window.parent) ? false : true;
					window.parent.$( ".is-iframe" ).remove();
					window.parent.$('<div class="modal is-iframe" data-is-iframe='+iFrameDetection+'>' + data + '</div>').modal();
					// fn_fadeIn()
				}).success(function() {
					$('input:text:visible:first').focus();
					// fn_fadeOut()
				});
			}
			return;
		}



		$(document).ready(function() {

			// $('[data-toggle="modal"]').on("click", function(e) );


			$('#mktlist').dataTable({
				responsive:true,
				// "scrollX":true,
			});

			$('#btnShow').on("click",function(e) 
			{
				$("#animated").fadeIn("slow");

			});

			$('#scroll').slimScroll({
					height: '100px'   
			});

			function readURL(input) {

				if (input.files && input.files[0]) {
					var reader = new FileReader();

					reader.onload = function (e) {
						$('#ProfilePicture').attr('src', e.target.result);
					}

					reader.readAsDataURL(input.files[0]);
				}
			}

			$("#BrowseFile").change(function(){
				readURL(this);
			});

		});

		function getDeleteDocument(ID, CustomerID, Description){
			bootbox.confirm({
				message: "Are you sure you want to delete document#" + ID + " <br><b>"+Description+"</b> ?",
				callback: function(result) {
					if(result==true){
						$.ajax({
					        beforeSend: function() {
					            // $('#statusbox').html("Running deployment...");
					            fn_fadeIn()
					        },
					        type: "GET",
					        url: "/Morakot/Document/Delete/?DeleteID=" + ID + "&ID=" + CustomerID,
					        data: {},
					        success: function() {
					            console.log('Qa-run OK');
					            window.location.href="/Morakot/Document/?ID=" + CustomerID;
					            fn_fadeOut()
					        },
					        error: function() {
					            console.log('Qa-run failed.');
					        }
					    });
					}
					
				},
				className: "bootbox-sm"
			});
		}

		function getRemoveDocument(ID, CustomerID, File, Description){
			bootbox.confirm({
				message: "Note: The record will be delete from trash and it can't be restored. Are you sure you want to delete document#" + ID + "<br> <b>"+ Description +"</b> ?",
				callback: function(result) {
					if(result==true){
						$.ajax({
					        beforeSend: function() {
					            // $('#statusbox').html("Running deployment...");
					            fn_fadeIn()
					        },
					        type: "GET",
					        url: "/Morakot/Document/Remove/?RemoveID=" + ID + "&ID=" + CustomerID + "&Link=" + File,
					        data: {},
					        success: function() {
					            console.log('Qa-run OK');
					            window.location.href="/Morakot/Document/?ID=" + CustomerID + "&Trash=Y";
					        },
					        error: function() {
					            console.log('Qa-run failed.');
					            fn_fadeOut()
					        }
					    });
					}
					
				},
				className: "bootbox-sm"
			});
		}

		function getRestoreDocument(ID, CustomerID){
			bootbox.confirm({
				message: "Note: The record will be override to existing. Are you sure you want to restore?",
				callback: function(result) {
					if(result==true){
						$.ajax({
					        beforeSend: function() {
					            // $('#statusbox').html("Running deployment...");
					            fn_fadeIn()
					        },
					        type: "GET",
					        url: "/Morakot/Document/Restore/?RestoreID=" + ID + "&ID=" + CustomerID,
					        data: {},
					        success: function() {
					            console.log('Qa-run OK');
					            window.location.href="/Morakot/Document/?ID=" + CustomerID + "&Trash=Y";
					        },
					        error: function() {
					            console.log('Qa-run failed.');
					            fn_fadeOut()
					        }
					    });
					}
					
				},
				className: "bootbox-sm"
			});
		}

		function fn_fadeIn(){
			var $getParentEle = window.parent.$("#animated")
			$getParentEle.fadeIn("slow");
		}

		function fn_fadeOut(){
			var $getParentEle = window.parent.$("#animated")
			$getParentEle.fadeOut("slow");
		}

	</script>

	<script type="text/javascript">

		$("#Save").on("click",function(e){
			//check file size before submit
			fn_fadeIn();
			if (window.File && window.FileReader && window.FileList && window.Blob){
				//get the file size from input file
				var AllowSize = $('#AttachementAllowSize').val();
				var ATID      = $('#ID').val()
				var File      = $('#BrowseFile').val()

				if (File !== ""){
					var FileSize = $('#BrowseFile')[0].files[0].size;
					if(FileSize > AllowSize) //alert validate if file exceed limit size (FileSize is in bytes)
					{
						
						$("#client-side-alert-msg").html("File Size is exceed maximum size ("+ AllowSize / 1024 /1024 +" MB).")
						$("#client-side-alert").show()	
						fn_fadeOut();	           

					}else{
						$("#client-side-alert").hide()
						PostAttachment.submit();  
						fn_fadeOut();
					}	
				}else{
					PostAttachment.submit();  
					fn_fadeOut();
				} 

			}else{
				$("#client-side-alert-msg").html("Please used upgrade Browser.")
				$("#client-side-alert").show()	
				fn_fadeOut();	        
			}					
						
		});

		$("#Cancel").on("click",function(e){
			window.location.href="/Morakot/Document/?ID={{ ID }}";
		});

		$(document).ready(function(){
			$("#Type").select2();
			$("#Reference").select2();
		})

		$(document).ready(function() {			
			$("#Type").on("change", function(){
				ID 	= "{{ID}}";
				Type = $(this).val();
				$.ajax({
					url: "/Morakot/ReferenceID/?ID="+ID+"&Type="+Type,	
					dataType: "json", 
				}).done(function(data) {
					if (data.FreeText == "Y"){
						$("#Reference").select2("container").hide();
						$('#Reference').replaceWith('<input type="text" class="form-control" name="Reference" id="Reference" value="{{Reference}}">');
					}else{
						$("#Reference").html("")					
						option = "<option value=''>--None--</option>"
						for (i=0;i<data.items.length;i++){
							option+="<option value='"+data.items[i].id+"'>"+data.items[i].text+"</option>"	
						}
						$("#Reference").html(option)	
						var Reference = "{{Reference}}";
						if (Reference==""){
							Reference=ID
						}	
						$("#Reference").select2("val",Reference).trigger('Change')	
					}
						
				});
				
			})
			var Type = "{{Type}}"
			if (Type==""){
				Type = "CU"
			}
			$("#Type").select2("val",Type).trigger('Change')			
			$("#Type").change()

			$("body").on("click","#btn-view", function(){

				view = $(this).data("view")
				if (view == 'list'){					
					$('#icon-view').removeClass("fa-th-list")
					$('#icon-view').addClass("fa-th")
					$(this).data("view", "grid")
					$(this).prop('title', 'View Grid')
					$('#div-view-list').css('display', 'block')
					$('#div-view-grid').css('display', 'none')

				}else{
					$('#icon-view').removeClass("fa-th")
					$('#icon-view').addClass("fa-th-list")
					$(this).data("view", "list")
					$(this).prop('title', 'View List')
					$('#div-view-list').css('display', 'none')
					$('#div-view-grid').css('display', 'block')
				}
			})
			//default click to show list of document based on app setting
			$('#btn-view').click()

		});

	</script>

{% endblock %}
