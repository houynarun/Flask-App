{% extends "layout.html" %}

{% block css %}

<style type="text/css">
	.form-control
	{
		width: 100% !important;
	}
	.highlight {
		background: yellow
	}
</style>
	
{% endblock %}

{% block content %}
    <div class="navbar navbar-default navbar-static-top">

    	<form method="GET" id="frm" name="frm" role="form" action="">
    		<div class="col-sm-12">
	    		<div class="col-sm-3" style="margin-top:8px; padding:0px">
	               
	                {% from "print.html" import searchCustomer %}
					{{searchCustomer('/Morakot/CustomerRecordID','ID',ID,'','Input Customer ID or Name')}}
				</div>
				<div class="col-sm-6" style="margin-top:8px;">
	    			<button id="btnShow" type="submit" class="btn btn-flat btn-labeled btn-primary" style="padding: 7px 25px;">
                        {{ getLanguage('400001') }}
                    </button>
	    		</div>
				
				<div class="col-sm-3" style="margin-top: 8px;">
					<div class="pull-right">
						{% from "print.html" import exportButton %}
		                {{ exportButton() }}
	                </div>
				</div>
    		</div>
				
		</form>
	</div>

	<div class="clearfix"></div>
	{% include 'msg_error.html' %}	
	{%if ResultObj%}
		<div class="col-sm-12">
		<div style="margin-left:10%; margin-right:10%;background: none">
			<h3 class="header-3 text-center">Black-list check </h3>
			{%if ResultObj%}<h4 class="header-5 text-center">{{ResultObj | length}} results found ({{formatNumber(EndTime)}} seconds)  </h4>{%endif%}
		</div>
		<div class="clearfix">&nbsp;</div>	
		<!-- DataTable -->
			<div class="panel panel-default" style="border: 0px;">
			<table>
				<tr>
					<td width="150"><strong>Customer</strong></td>
					<td>: &nbsp; {{FullName}}</td>
				</tr>
				<tr>
					<td width="150"><strong>Gender</strong></td>
					<td>: &nbsp; {{Gender}}</td>
				</tr>
				<tr>
					<td width="150"><strong>Date of Birth</strong></td>
					<td>: &nbsp; {{DateOfBirth}}</td>
				</tr>
				<tr>
					<td width="150"><strong>Mobile1</strong></td>
					<td>: &nbsp; {{Mobile1}}</td>
				</tr>
				<tr>
					<td width="150"><strong>Mobile2</strong></td>
					<td>: &nbsp; {{Mobile2}}</td>
				</tr>
				</table>
			</div>
			<div class="clearfix" style="height: 5px;">&nbsp;</div>
			<table id="mktlist" class="table table-striped table-borderless" cellspacing="0" width="100%">
				<thead>
					<tr>
						<th>Branch</th>
						<th>Customer ID</th>
						<th>English Name</th>
						<th>Khmer Name</th>
						<th>Gender</th>
						<th>Date Of Birth</th>
						<th>Address</th>
						<th>Mobile1</th>
						<th>Mobile2</th>
						<th>Block Date</th>
						<th>Block Reason</th>
						<th>Block By</th>
						
					</tr>
				</thead>
				<tbody>
					{%for row in ResultObj%}
						
						{% set module = "" %}
						{% set link = "" %}
						{% if row.ID[0:2] == "CU" %}
							{% set module 	= "Customer" %}
							{% set link 	= g_getUrlExtend(Module="Customer") %}
						{% else %}
							{% set module 	= "POCustomer" %}
							{% set link 	= g_getUrlExtend(Module="POCustomer") %}
						{% endif %}
						<tr>
							<td> {{row.Branch}}</td>
							<td> 
								{% if QueryObj.ID == row.ID %}
									<a href="javascript:void(0)" class="highlight" onClick="ClickView('{{module}}','{{link}}','{{row.ID}}')">{{row.ID}}</a>
								{% else %}
									<a href="javascript:void(0)" onClick="ClickView('{{module}}','{{link}}','{{row.ID}}')">{{row.ID}}</a>
								{% endif%}	
								
							</td>
							<td> 
								{% set fullname1 = row.LastNameEn | upper + " " +row.FirstNameEn | upper %}
								{% set fullname2 = row.FirstNameEn | upper + " " +row.LastNameEn | upper%}

								{% if FullName | upper == fullname1 or FullName | upper == fullname2 %}
									<span class="highlight">{{row.LastNameEn}} {{row.FirstNameEn}}</span>
								{%else%}
									<span>{{row.LastNameEn}} {{row.FirstNameEn}}</span>
								{%endif%}

							</td>
							<td> {{row.LastNameKh}} {{row.FirstNameKh}}</td>
							<td> 
								{% if QueryObj.Gender == row.Gender %}
									<span class="highlight">{{row.Gender}}</span>
								{% else %}
									{{row.Gender}}
								{% endif%}	

							</td>
							<td> 
								{% if QueryObj.DateOfBirth == row.DateOfBirth %}
									<span class="highlight">{{row.DateOfBirth}}</span>
								{% else %}
									{{row.DateOfBirth}}
								{% endif%}	

							</td>
							
							<td> {{mktaddress.getAddress(row.Province,row.District,row.Commune,row.Village,row.HouseNo,row.Street)}}
							<td> 
								{% if row.Mobile1 == QueryObj.Mobile1 or row.Mobile1 == QueryObj.Mobile2 %}
									<span class="highlight">{{row.Mobile1}}</span>
								{% else %}
									{{row.Mobile1}}
								{% endif%}	
							</td>
							<td> 
								{% if row.Mobile2 == QueryObj.Mobile1 or row.Mobile2 == QueryObj.Mobile2 %}
									<span class="highlight">{{row.Mobile2}}</span>
								{% else %}
									{{row.Mobile2}}
								{% endif%}	
							</td>
							<td> {{row.Createdon}} </td>
							<td> {{row.BlockReason}} </td>
							<td> {{row.Inputter}} </td>

						</tr>
					{%endfor%}
				</tbody>
				
			</table>

		</div>
	{%else%}
		{% if ID !="" %}
		<div class="clearfix">&nbsp;</div>	
		<div class="col-sm-12" style="padding: 5%"></div>	
			
			{% set module = "" %}
			{% set link = "" %}
			{% if ID[0:2] == "CU" %}
				{% set module 	= "Customer" %}
				{% set link 	= g_getUrlExtend(Module="Customer") %}
			{% else %}
				{% set module 	= "POCustomer" %}
				{% set link 	= g_getUrlExtend(Module="POCustomer") %}
			{% endif %}

		<div class="col-sm-12 text-center">
			<i class="fa fa-check-circle text-success" style="font-size: 70px"></i>
		</div>
		<div class="col-sm-12">
			<h1 class="header-3 text-center text-success"><span style="font-weight: bold;">Black-list Check</span></h1>
		</div>	
		<div class="col-sm-12 text-center" style="padding:5px 10px">
			<span class="text-center" style="font-size: 15px">
				Your checking record ID: <a href="javascript:void();" class="link" onClick="ClickView('{{module}}','{{link}}','{{ID}}')">
				 {{ID}} </a> - <b>{{FullName}}</b> not found in black-list customer.
			</span> 
		</div>
			
		{%endif%}
		
	{%endif%}
{% endblock %}

{% block js %}
    <script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script>

    {% from "print.html" import exportIncludeJS %}
    {{exportIncludeJS()}}

    <script type="text/javascript">
        $(document).ready(function() {

            $('#mktlist').dataTable({
               "lengthMenu": [[100,200, 300, -1], [100,200, 300, "All"]],
               "bSort" : false,
            });

            {% from "print.html" import exportDataTable %}
            {{exportDataTable('#mktlist','Repayment Schedule')}}

        });

    </script>

{% endblock %}
