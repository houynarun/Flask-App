{% extends "layout.html" %}

{% block css%}
    <style>
        .dataTables_wrapper .table-footer {
            margin-top: 0 !important;
        }
    </style>
{% endblock%}

{% block content%}
<div class="row">
  <div class="container">
     <h3>
        <center>
          {{formTitle}} to Review/Approve
        </center>
    </h3>
  </div>
  <hr>   
</div>

    <div class="col-sm-12">
        {% if  get_flashed_messages(category_filter=["error"]) %}
            {% for message in get_flashed_messages(category_filter=["error"]) %}
            
                <div class="clearfix">&nbsp;</div>
                <div class="alert alert-danger">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    {{ message }}
                </div>
                
            {% endfor %}

        {% else %}
            {% for message in get_flashed_messages() %}
                <div class="clearfix">&nbsp;</div>
                <div class="alert alert-info">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    {{ message }}
                </div>
                
            {% endfor %}
        {% endif %}
        

    </div>
<div class="col-sm-12" style="padding-top:5px;">
    <div class="panel panel-info">
        <div class="panel-heading" style="height:50px;">
            <span class="panel-title"><i class="panel-title-icon fa fa-bullhorn"></i> 
                Total records: <span class="badge badge-info">{{recordReview + recordApprove}}</span>
            </span>
            <div class="panel-heading-controls">
                <div class="panel-heading-icon" style="padding-top:0px;">
                    <a title="Refresh" class="link"><i id="Refresh" class="fa fa-refresh"></i></a>
                </div>
            </div>
        </div>
        <div class="panel-body">
            <div role="grid" id="mktlist_wrapper" class="dataTables_wrapper form-inline no-footer">
                
                <table id="listRecord" class="table table-hover table-striped  dataTable no-footer">
                    <thead>
                        <tr role="row">
                            <th>Branch</th>
                            <th>ID</th>
                            <th>Inputter</th>
                            <th>CreatedOn</th>
                            <th>Reviewer</th>
                            <th>Approver</th>
                            <th>Rejected</th>
                            <th>Next Level</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if recordReview !=0 %}
                            <tr>
                                <th>
                                    <STRONG>Review </STRONG> 
                                    <span class="badge badge-info">{{recordReview}}</span>
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                            {% for lo in listRecordReviewObj %}
                                <tr class="link" onclick="CustomClickView('{{formTitle}}',
                                             'ReviewApproveCustom/?ID={{lo.RecordID}}&formID={{formID}}&InBranch={{lo.Branch}}')">
                                    <td>{{lo.Branch}}</td>
                                    <td>{{lo.RecordID}}</td>
                                    <td>{{lo.Inputter}}</td>
                                    <td>{{lo.Createdon}}</td>
                                    {% if lo.Reviewers == '[]'%}
                                        <td>No reviewer</td>
                                    {% else %}
                                        <td>{{lo.Reviewers.strip('[]')}}</td>
                                    {% endif%}
                                    {% if lo.Approvers == '[]'%}
                                        <td>No approver</td>
                                    {% else %}
                                        <td>{{lo.Approvers.strip('[]')}}</td>
                                    {% endif%}
                                    {% if lo.Rejecters == '[]'%}
                                        <td>No rejecter</td>
                                    {% else %}
                                        <td>{{lo.Rejecters.strip('[]')}}</td>
                                    {% endif%}
                                    <td>{{lo.NextLevel}}</td>
                                    <td>
                                        <span class="label label-warning">View</span> 
                                    </td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                        {% if recordApprove !=0 %}
                            <tr>
                                <th>
                                    <STRONG>Approve</STRONG> 
                                    <span class="badge badge-info">{{recordApprove}}</span>
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                            {% for lo in listRecordApproveObj%}
                                <tr onclick="CustomClickView('{{formTitle}}',
                                             'ReviewApproveCustom/?ID={{lo.RecordID}}&formID={{formID}}&InBranch={{lo.Branch}}')" class="link">
                                    <td>{{lo.Branch}}</td>
                                    <td>{{lo.RecordID}} </td>
                                    <td>{{lo.Inputter}}</td>
                                    <td>{{lo.Createdon}}</td>
                                    
                                    {% if lo.Reviewers == '[]'%}
                                        <td>No reviewer</td>
                                    {% else %}
                                        <td>{{lo.Reviewers.strip('[]')}}</td>
                                    {% endif%}
                                    {% if lo.Approvers == '[]'%}
                                        <td>No approver</td>
                                    {% else %}
                                        <td>{{lo.Approvers.strip('[]')}}</td>
                                    {% endif%}
                                    {% if lo.Rejecters == '[]'%}
                                        <td>No rejecter</td>
                                    {% else %}
                                        <td>{{lo.Rejecters.strip('[]')}}</td>
                                    {% endif%}
                                    <td>{{lo.NextLevel}}</td>
                                    <td>
                                        <span class="label label-warning">View</span> 
                                    </td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                       
                    </tbody>
                </table>
                
            </div>
        </div>
        <!-- panel-body -->
    </div>
    <!-- panel panel-info -->
</div>


{% endblock%}
{% block js %}
    <script type="text/javascript">
        
         $(document).ready(function(){
            $('#Refresh').click(function(){ 
               window.location.reload();
               console.log("reload frame")
            });

            $('#listRecord').DataTable({
                "bSort" : false,
               "sScrollX": "100%",
               "bScrollCollapse": true
            });
           
        });
    </script>
{% endblock %}