<script type="text/javascript">
	$(document).ready(function(){
		$('.re-assign').popover({
			html:true,
			// trigger: 'focus'
		})
	})
</script>

{% set TabObj = [('new-assign','New Assign', POObj[0]),
									 ('upcoming','Upcoming Followup', POObj[5]),
									 ('today','Today Followup', POObj[6]) ,
									 ('past-due','Past Due Followup', POObj[7])] %}


					{% for row_status in POObj[3] %}
						{% set POCount = POObj[1].filter_by(POStatus=row_status.ID) %}
						{% if TabObj.append((row_status.ID,row_status.Description, POCount)) %} {% endif%}
					{% endfor %}
					{% set TabSelected = POObj[4].get("TabSelected") if POObj[4].get("TabSelected") else "" %}

			<div class="tab-content table-container">

			{% set Dict = {'i': 1} %}
			{%for item in TabObj%}		

				{% if TabSelected == "" %}
					<div class="tab-pane {{ 'active' if Dict.get('i') == 1 else '' }}" id="tab-{{item[0]}}">
				{%else%}
					<div class="tab-pane {{ 'active' if TabSelected == item[0] else '' }}" id="tab-{{item[0]}}">
				{%endif%}				
					<table  class="table">
						<thead>
							{%if item[0] == "5" %}
								<tr>	
									<th>Branch</th>							
									<th>ID</th>
									<th>English Name</th>
						            <th>Gender</th>
						            <th>Mobile</th>
						            <th>Date of Contact</th>	
					            	<th>Rejected/Block Date</th>
					            	<th>Rejected/Block By</th>
					            	<th>Rejected Stage</th>
					            	<th>Assign To</th>
					            	<th>Status</th>	
					            	<th class="text-center" style="min-width: 80px">Action</th>
								</tr>
							{%else%}
								<tr>	
									<th>Branch</th>							
									<th>ID</th>
									<th>English Name</th>
						            <th>Gender</th>
						            <th>Mobile</th>
						            <th>Date of Contact</th>
					            	<th>Followup Date</th>	
					            	<th>Assign To</th>
					            	<th>Status</th>	
					            	<th class="text-center" style="min-width: 80px">Action</th>
								</tr>

							{%endif%}
								
						</thead>
						<tbody>	
							{%for row in item[2] %}	

								{% set CurrentDate = POObj[4].get("CurrentDate") | string %}
			            		{% set NextDate    = POObj[4].get("NextDate") | string %}

			            		{% set RejectedStatus = '5' %}
			            		{% set AppliedStatus = '4' %}
			            		{% set MeetingStatus = '3' %}
			            		{% set AssignStatus = '2' %}
			            		{% set NewStatus = '1' %}

								{% set color = 'label-default' %}
								{% if row.POStatus == NewStatus %}
									{% set color = 'label-warning' %}
								{% endif %}

								{% if row.POStatus == AssignStatus %}
									{% set color = 'label-info' %}
								{% endif %}

								{% if row.POStatus == MeetingStatus %}
									{% set color = 'label-primary' %}
								{% endif %}

								{% if row.POStatus == AppliedStatus %}
									{% set color = 'label-success' %}
								{% endif %}

								{% if row.POStatus == RejectedStatus %}
									{% set color = 'label-danger' %}
								{% endif %}

			            	{% if row.Block == "Y" %}
			            		<tr style="text-decoration:line-through;">
			            	{% else %}
			            		<tr style="">
			            	{% endif %}
								<td>{{row.AssignBranch}}</td>
								<td class="{{row.ID}} link"> <a href="javascript:void()" class="link" onClick="ClickView('POCustomer','{{g_getUrlExtend(Module="POCustomer")}}','{{row.ID}}')">{{ row.ID }}</a></td>
								<td class="">{{ row.LastNameEn }} {{ row.FirstNameEn }}</td>
								<td class="">{{ row.Gender }}</td>
								<td class="">{{ row.Mobile1 }}</td>
								<td class="">{{ row.DateOfContact }}</td>	

								{% set RejectedObj = POObj[8] %}
								{% set ReasonTypeObj = POObj[9] %}
								{% set RejectedObj1 = RejectedObj.filter_by(CustomerID=row.ID).first() %}	

								{% set decoration = "none"%}
			            		{% set title = "" %}
			            		{% set RejectedBlockDate = "" %}
			            		{% set RejectedBlockBy = "" %}
			            		{% set IsBlock = "" %}
			   
			            		{%if RejectedStageObj %}
			            			{% set StageID	= RejectedObj1.RejectedStage %}
			            			{% if not StageID %}
			            				{% set StageID = ''%}
			            			{%endif%}

			            			{% set Description = ""%}
			            			{% set StageObj 	= RejectedStageObj.filter_by(ID=StageID).first() %}
			            			
			            			{% if StageObj %}
			            				{% set Description = StageObj.Description%}
			            			{%endif %}
			            		{%endif%}
			            		

								{% if row.POStatus == RejectedStatus and RejectedObj1.Rejected == "Y" %}
			            			{% set ReasonTypeObj1 = ReasonTypeObj.filter_by(ID=RejectedObj1.ReasonType).first() %}
			            			{% set title = "%s - %s" % (ReasonTypeObj1.Description, RejectedObj1.RejectedReason) %}
			            			{% set RejectedBlockDate = RejectedObj1.RejectedDate %}
			            			{% set RejectedBlockBy= "Client" if RejectedObj1.RejectedBy == '1' else "Company" %}
			            			{% set IsBlock = "N" %}
			            		{% endif %}
			            		{% if row.POStatus == RejectedStatus and row.Block == "Y" %}
			            			{% set title = row.BlockReason %}
			            			{% set RejectedBlockDate = row.Createdon %}
			            			{% set RejectedBlockBy= row.Inputter %}
			            			{% set IsBlock = "Y" %}
			            		{% endif %}						

								{% if item[0] == RejectedStatus %}


								<td class="">{{ RejectedBlockDate }}</td>
								<td class="">{{ RejectedBlockBy }}</td>
								<td class="">{{ Description }}</td>
								{%else%}
								<td class="">
									{{ row.NextFollowDate}}
									{% if row.NextFollowDate <= NextDate and row.NextFollowDate > CurrentDate  and row.POStatus !=RejectedStatus%}
										<span class="label label-tag label-warning" title="Customer who you need to follow up in few days">Upcoming</span>	
									{% endif %}

									{% if row.NextFollowDate == CurrentDate and row.POStatus !=RejectedStatus %}
										<span class="label label-tag label-success" title="Customer who you need to follow up Today">Today</span>
									{% endif %}

									{% if row.NextFollowDate < CurrentDate and row.POStatus ==MeetingStatus %}
										<span class="label label-tag label-danger" title="Please followup with this customer">Past Due</span>
									{% endif %}

								</td>

								{%endif%}
								{%set UserObj1 = POObj[2].filter_by(ID=row.AssignTo).first() %}					
								<td class="">{{ UserObj1.DisplayName }}</td>

								{%set POStatusObj1 = POObj[3].filter_by(ID=row.POStatus).first() %}
				            	<td class="">			            		
				            		
				            		{% if row.POStatus == AssignStatus and row.AssignDate == CurrentDate %}
				            			{% set decoration = "underline"%}
				            			{% set title= "New Assigned" %}
				            		{%endif%}
				            		
				            		<span class="label {{ color }}" style="text-decoration: {{decoration}}" title="{{title}}">{{ POStatusObj1.Description }}</span>

				            	</td>	
				            	<td class="text-center" style="text-decoration: none !important">	
				            		{% if item[0] != RejectedStatus %}				            		
				            		<a href="javascript:void(0);" onClick="CustomClickView('POCustomer - Activity','{{g_getUrlExtend(Module="POCustomerAct")}}/New?POID={{row.ID}}')">
				            			<i class="fa fa-plus-circle" title="Add Activity"></i>
				            		</a>
				            		{% endif%}
				            		{% if item[0] == RejectedStatus and IsBlock=="N" %}
				            			| <a href="javascript:void(0);" onClick="CustomClickView('Rejected-Potential','{{g_getUrlExtend(Module="Rejected")}}/?ID={{RejectedObj1.ID}}')">
					            			<i class="fa fa-eye text-danger" title="View Rejected"></i>
					            		</a>	
				            		{% endif%}
				            		{% if item[0] == RejectedStatus and IsBlock=="Y" %}
				            			| <a href="javascript:void(0);" onClick="CustomClickView('Potential-Customer','{{g_getUrlExtend(Module="POCustomer")}}/?ID={{row.ID}}')">
					            			<i class="fa fa-eye text-danger" title="View Block"></i>
					            		</a>	
				            		{% endif%}
				            			{% if IsAssigner[0] == True%}

						            		| <a href="javascript:void(0);" class="re-assign popover-info popover-dark" disabled data-toggle="popover" data-content='<select 	class="form-control input-sm select2 select-re-assign" style="width: 200px;"> 
						            			<option value=""><option> 
						            			{% for row_user in ReAssigneeObj %} 
						            				{% if row_user.Role !=IsAssigner[1].Role %}
						            				<option value="{{row_user.ID}}" data-po-id="{{row.ID}}">{{row_user.DisplayName}}
						            				</option> 
						            				{%endif%}
						            				{% endfor %}
						            			</select>' data-title="Re-Assign - {{row.ID}}" data-placement="left">
						            			<i class="fa fa-user-plus text-warning" title="Re-Assign"></i>
					            				</a>
					            		{%endif%}
			            		</td>				            						
							</tr>
							{% endfor %}				
						</tbody>
					</table>
				</div>
				{% if Dict.update({"i": (Dict.get('i') + 1) }) %} {%endif%}							
			{%endfor%}
				
			</div>