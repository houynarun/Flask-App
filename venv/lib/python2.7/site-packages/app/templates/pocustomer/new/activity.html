{# Obj = [ActObj, POCustomerObj, UserObj, POStatusObj,ActTypeObj,Param]#}


<div>
{% set UserObj1 = Obj[2] %}
{% set UserID = Obj[5].get("UserID") %}
{% if UserID != "ALL" %}
{% set UserObj1 = UserObj1.filter_by(ID=UserID) %}
{% endif %}

{% set CurrentDate = Obj[5].get("CurrentDate") | string %}
{% set NextDate    = Obj[5].get("NextDate") | string %}

{% for row in UserObj1 %}
	{% set POCustomerObj1 = Obj[1].filter_by(AssignTo=row.ID) %}
	{% set TotalNew = POCustomerObj1.filter_by(POStatus='1').count() %}
	{% set TotalMeeting = POCustomerObj1.filter_by(POStatus='3').count() %}
	{% set TotalAssign = POCustomerObj1.filter_by(POStatus='2').count() %}

{% if POCustomerObj1.count() > 0 %}
<div class="comment">

	<img src="/static/avatars/{{ row.ProfilePicture if row.ProfilePicture else 'default.jpg' }}" alt="" class="comment-avatar">
	<div class="comment-body">
		<div class="comment-text">
			<div class="comment-heading">
				<a href="javascript:void(0)" title="">{{ row.DisplayName }}</a><span>Currently have <b> {{TotalNew}} </b> new, <b>{{ TotalAssign }}</b> assigned, <b> {{ TotalMeeting }} </b> meeting (Inquiry)</span>
				
			</div>									
		</div>
	</div> <!-- / .comment-body -->

	{% for row_cust in POCustomerObj1 %}

		{% set POStatusObj1 = Obj[3].filter_by(ID=row_cust.POStatus).first() %}

		{% set RejectedStatus = '5' %}
		{% set AppliedStatus = '4' %}
		{% set MeetingStatus = '3' %}
		{% set AssignStatus = '2' %}
		{% set NewStatus = '1' %}

		{% set color = 'label-default' %}
		{% if row_cust.POStatus == NewStatus %}
			{% set color = 'label-warning' %}
		{% endif %}

		{% if row_cust.POStatus == AssignStatus %}
			{% set color = 'label-info' %}
		{% endif %}

		{% if row_cust.POStatus == MeetingStatus %}
			{% set color = 'label-primary' %}
		{% endif %}

		{% if row_cust.POStatus == AppliedStatus %}
			{% set color = 'label-success' %}
		{% endif %}

		{% if row_cust.POStatus == RejectedStatus %}
			{% set color = 'label-danger' %}
		{% endif %}

	<div class="comment">	
		{% set isNewAssign = "N" %}
		{% if row_cust.POStatus == AssignStatus and row_cust.AssignDate == CurrentDate  %}
			<span class="label {{ color }}" style="text-decoration: underline;float:left;margin-left: 10px" title="New Assigned" onClick="ClickView('POCustomer','POCustomer','{{row_cust.ID}}')">{{ POStatusObj1.Description }}</span>
			{% set isNewAssign = "Y" %}
		{%endif%}
		{% if isNewAssign == "N" %}
			<span class="label {{ color }}" style="float: left;margin-left: 10px" onClick="ClickView('POCustomer','POCustomer','{{row_cust.ID}}')">{{ POStatusObj1.Description }}</span>
		{%endif%}            		
		
		<span class="name link" onClick="ClickView('POCustomer','POCustomer','{{row_cust.ID}}')">{{ row_cust.LastNameEn }} {{ row_cust.FirstNameEn }} </span>
		<span class="phone">|&nbsp;&nbsp;<i class="fa fa-phone" ></i> &nbsp;&nbsp;{{row_cust.Mobile1}} </span>
		<span class="followup-date">|&nbsp;&nbsp;<i class="fa fa-calendar" title="Next Follow Up Date"></i>&nbsp;&nbsp; {{row_cust.NextFollowDate if row_cust.NextFollowDate !="" else "____/__/__"  }} </span>  

		{% if row_cust.NextFollowDate <= NextDate and row_cust.NextFollowDate > CurrentDate  and row_cust.POStatus !=RejectedStatus %}
			<span class="label label-tag label-warning" title="Customer who you need to follow up in few days">Upcoming</span>	
		{% endif %}

		{% if row_cust.NextFollowDate == CurrentDate  and row_cust.POStatus !=RejectedStatus %}
			<span class="label label-tag label-success" title="Customer who you need to follow up Today">Today</span>
		{% endif %}

		{% if row_cust.NextFollowDate < CurrentDate  and row_cust.POStatus ==MeetingStatus %}
			<span class="label label-tag label-danger" title="Please followup this customer it is past followup date already">Past Due</span>
		{% endif %}

		<div class="comment-body test" style="margin-left: 65px">				
			{% set ActObj1 = Obj[0].filter_by(PotentialCustomer=row_cust.ID) %}
			{% for row_act in ActObj1 %}
				{% set ActTypeObj1 = Obj[4].filter_by(ID=row_act.ActivityType).first() %}
			<div class="comment-text">
				<div class="comment-heading">
					<i class="fa fa-long-arrow-right"></i> &nbsp;&nbsp; <a href="javascript:void(0)" title="" style="font-size:14px">{{ActTypeObj1.Description}}</a> 
				</div>
				<span style="margin-left: 25px">{{row_act.ActivityDesc}}</span>
			</div>
			<div class="comment-footer">
				<a href="javascript:void(0)
							" onClick="ClickView('POCustomerAct','POCustomerAct','{{row_act.ID}}')" style="margin-left: 25px">Read More
				</a> | 

				<a href="javascript:void(0);" onClick="CustomClickView('POCustomer - Activity','POCustomerAct/New?POID={{row_cust.ID}}')">
	            	Add Activity
        		</a>
			</div>
			{% endfor %}

		</div> <!-- / .comment-body -->

	</div> <!-- / .comment -->	
	
	<hr style="border-style: dashed;">		

	{% endfor %} 
	
</div> <!-- / .comment -->

{%endif%}
{% endfor %}
</div>

