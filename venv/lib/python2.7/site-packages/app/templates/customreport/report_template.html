<!-- 

Create by       : Mony
Create Date     : 2018-01-15
Update By       : .............
Last Update     : .............

Thanks for team for update code more.
Enjoy your work ! :)
 -->

{% macro getHeaderReport(DictHeader={},mktdate="")%}
	<div class="clearfix"></div>
	{% include 'msg_error.html' %}

	<!-- Header Report -->
	<div class="col-sm-12">
		<!-- Report Title -->
		<h4 class="header-4 text-center"><b>{{ DictHeader.get("CompanyName") }}</b></h4>
		<h3 class="header-3 text-center">{{ DictHeader.get("ReportTitle") }}</h3>

		{% if DictHeader.get("Parameters") %}
			{% for key, value in DictHeader.get("Parameters").iteritems() %}
				{% if value %}
					{% set TextValue = value %}
					{% set ValueSplit = value.split() %}
					{% if mktdate.isDate(ValueSplit[0]) %}
						{% set DateLen = ValueSplit | length %}
						{% if DateLen == 2 %}
							{% set TextValue = "%s To %s" % (ValueSplit[0],ValueSplit[1]) %}
						{% else %}
							{% set TextValue = value.replace(" "," , ") %}
						{% endif%}
					{% endif %}
					<span><strong>{{key}}: </strong> {{TextValue}} </span> <br>

				{% endif %}
			{% endfor %}
		{% endif %}
		
	</div>
	<!-- Header Report -->
	<div class="clearfix">&nbsp;</div>
{%endmacro%}

<!-- Function for markup html with newline only -->
{%macro mktMarkup(Text)%}  
	{% for line in Text.splitlines() %}
		{{line | safe}}<br>
	{% endfor %}
{%endmacro%}

<!-- Default css in report NBC -->
{%macro setStyleNBCReport()%}
	<style>
		h3.header-3{
			font-size: 16px;
			font-weight: bold;
			margin: 5px 0 10px;
			padding: 10px 18px 0;
		}

		.form-label{
			padding-top: 7px;
		}

		.input-sm {

			width: 214px !important;
		}

		.modal-dialog{

			width: 428px !important;

		}

		.form-label{
			padding-top: 7px;
		}

		.modal-body {
			z-index: 99999 !important;
		}
		.nbc-bg-header{
			font-weight: bold !important;
			background-color: {{getNBCColor()}}
			
		}   
		.nbc-bg-body{
			background-color: {{getNBCColor('body')}};
		}
	</style>
{%endmacro%}

<!-- for table style css with NBC style -->
{%macro setTableStyle()%}
	class="table table-striped table-bordered" style="border: 3px solid black;"
{%endmacro%}

<!-- for border style css with NBC style -->
{%macro setStyleBorder()%}
	style="border: 3px solid black;"
{%endmacro%}

<!-- Using for indent of text by default if line detail with 45px of pendding -->
{%macro setTextIndent(LineType,Indent)%}
	{%set NewIndent = 45 %}

	{%if ( Indent == 0 or Indent == '' or Indent == 1 ) and  LineType == 'LD'%}
		
		{{NewIndent}}px;

	{%elif (Indent == 0 or Indent == '') and  LineType == 'GH'%}
		8px;
	{%else %}

		{%set NewIndent = NewIndent * Indent %}

		{{NewIndent}}px;
	{%endif%}

{%endmacro%}

<!-- Using for get color code of NBC report -->
{%macro getNBCColor(Type='Header')%}
{%if Type == 'Header'%}#93CDDD;{%else%}#DBEEF4;{%endif%}
{%endmacro%}

{% macro setRowStyle(row,FirstCol=False)%}
	{%if row.get('LineType') %}
		{%set ValueCss=''%}
		{%if row.get('RowBGColor') %}
			{%set ValueCss = 'background:'+row.get('RowBGColor')+';' %}
		{%endif%}

		{%if row.get('LineFormat') %}
			{%set ValueCss = ValueCss +'font-weight:'+row.get('LineFormat')+';' %}
		{%endif%}

		{%if FirstCol==True %}
			{%set ValueCss = ValueCss + 'padding-left:'+ setTextIndent(row.get('LineType'),row.get('Indent',0))+';' %}
		{%endif%}

		{%if ValueCss%}
			style="{{ValueCss}}"
		{%endif%}

	{%endif%}
   
{% endmacro %}

{# for render custom report search field #}
{#{% macro render_field(field) %}    
	<div class="form-group">
		<label for="{{field.name}}" class="col-sm-4 control-label">{{ field.label }} :</label>
		<div class="col-sm-8">
			{{ field(class_="form-control")| safe }}
		</div>
	</div>

{% endmacro %}#}

{% macro render_field(field,disabled='' ,label_visible=true) %}
	
	<div class="form-group  {% if field.errors %}has-error{% endif %} {{ kwargs.pop('class_', '') }}">
		{% if (field.type != 'HiddenField' or field.type !='CSRFTokenField') and label_visible %}

			{% if field.type != "MKTIframe" %}
			<label for="{{ field.id }}" class="col-sm-3 control-label">{{ field.label }}</label>
			{% endif %}

		{% endif %}       
	<div class="col-sm-8">
		 {% if field.type =="DateField" %}
		   {% if disabled %}
			{{ field(class_='form-control',id=field.id,readonly=true, **kwargs) }}
		   {% else %}
			{{ field(class_='form-control',id=field.id, **kwargs) }}
		   {% endif %}

		  <script type="text/javascript"> 

			$(document).ready(function() {
				 init.push(function () {
					var options = {
					orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
					format:"yyyy-mm-dd",
					autoclose:true,
					multidate: false,
					multidateSeparator:' '
					}
					$('#{{field.id}}').datepicker(options);
					});
			});

		  </script>
		  {% elif field.type =="DateTextField" %}
		   {% if disabled %}
			{{ field(class_='form-control',id=field.id,readonly=true, **kwargs) }}
		   {% else %}
			{{ field(class_='form-control',id=field.id, **kwargs) }}
		   {% endif %}

		  <script type="text/javascript"> 

			$(document).ready(function() {
				 init.push(function () {
					var options = {
					orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
					format:"yyyy-mm-dd",
					autoclose:true,
					multidate: true,
					multidateSeparator:' '
					}
					$('#{{field.id}}').datepicker(options);
					});
			});

		  </script>
		 {% elif field.type=="DateTimeField" %}
		 <!-- Javascript -->
		  <script>
			init.push(function () {
			  var options = {
				minuteStep: 1,
				defaultTime:false,
				showSeconds: false,
				showMeridian: false,
				showInputs: false,
				orientation: $('body').hasClass('right-to-left') ? { x: 'right', y: 'auto'} : { x: 'auto', y: 'auto'}
			  }
			  $('#{{field.id}}').timepicker(options);
			});
		  </script>
		  <!-- / Javascript -->
			 {% if disabled %}
			  {{ field(class_='form-control',id=field.id,readonly=true, **kwargs) }}
			 {% else %}
			  {{ field(class_='form-control',id=field.id, **kwargs) }}
			 {% endif %}
	  

		 {% elif field.type=="HiddenField" %}
		  
				{% if disabled %}
				{{ field(class_='form-control',id=field.id,readonly=true, **kwargs) }}
			   {% else %}
				{{ field(class_='form-control',id=field.id, **kwargs) }}
			   {% endif %}
			 {#
				call remote data through jquery ajax. url's name should be field of database 
			 #}
			 <script type="text/javascript">
			 $('#{{field.id}}').select2({
				  placeholder:'Select {{field.id}}',
				  minimumInputLength: 3,
				  triggerChange: true,
				  allowClear: true,
				  ajax: {
					  url: '{{ url_for(field.id) }}',
					  dataType: 'json',
					  data: function (term, page) {
						  return {
							  q: term,
							  action:'search'
						  };
					  },
					  results: function (data, page) {
						  return {
							  results: data.items
						  };
					  }
				  },
				  initSelection: function (element, callback) {
					  var id = $(element).val();
					  if (id !== "") {
						  $.ajax("{{ url_for(field.id) }}?action=view&q="+id, {
							  dataType: "json"
						  }).done(function(data) { callback({id: id, text: data.items[0].text}); });
					  }
					  
				  }
			  });
			 </script>

		 {% elif field.type == "MKTIframe" %}
 
			<iframe width="{{field.dicIframe.width}}", height="{{field.dicIframe.height}}" id ="{{field.id}}", frameborder ="{{field.dicIframe.frameborder}}"  ></iframe>
		   
		 {% else %}

			 {% if disabled %}
				{{ field(class_='form-control',disabled='disabled', **kwargs) }}
			 {% else %}
				{{ field(class_='form-control', **kwargs) }}
			 {% endif %}
		 {% endif %}

		 

	</div>
	</div>

{%- endmacro %}