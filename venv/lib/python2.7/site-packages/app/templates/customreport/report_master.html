{% extends "layout.html" %}

{% import 'customreport/report_template.html' as report %}


{% block css %}
   
{#{{report.setStyleNBCReport()}}#}

<style>
    #Main {
        width: 1px;
        min-width: 100%;
        *width: 100%;
    }

    .panel {
        width: 100%;
</style>

{% endblock %}
{% block content %}
<div id="Main">
    <div class="navbar navbar-default navbar-static-top">
        <div class="col-sm-6" style="margin-top: 15px;">
            <!-- Button Export -->            
            {% set FullUrl = request.url %}
            {% set Url = FullUrl.split("?")[0] %}
            {% set UrlParam = FullUrl.split("?")[1] if "?" in FullUrl else "" %}
            {{exportButtonLink(Url=Url,UrlParam=UrlParam)}}
        </div>

        <div class="col-sm-6" style="margin-top: 8px;">
            <a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
                <span class="btn-label icon fa fa-refresh"></span> Refresh
            </a>
            <button type="button" class="btn btn-flat btn-labeled btn-success pull-right" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">
                <span class="btn-label icon fa fa-gear"></span>   {{ getLanguage('Custom') }} 
            </button>
        </div>

    </div>
    {% if Result and not FilterOption['Criteria'] %}
       <!-- Call Header NBC Report -->
        {% set DictHeader = Result['ReportHeader'] %}
        {{ report.getHeaderReport(DictHeader,mktdate) }}
        <!-- Call Header NBC Report -->

        <div class="col-sm-12"> 
            <div class="table-responsive">
            <table id="mktlist" {{report.setTableStyle()}} style="width:100%;">
                <thead>
                    {%for row in Result.TableHeader %}
                        <tr class="nbc-bg-header">
                            {%for col in Result.TableHeader[row] %}
                                <th colspan="{{col.Colspan}}" rowspan="{{col.Rowspan}}" class="{{col.Class}}" style="{{col.Style}}">{{report.mktMarkup(col.Text)}}</th>
                            {%endfor%}
                        </tr>
                    {%endfor%}
                </thead>
                <tbody>
                    {%for row in Result.Data %}
                        {% set row_data = row[0] %}
                        {% set row_style = row[1] %}

                        <tr class="{{row_style.get('Class',{})}}" style="{{row_style.get('Style',{})}}">
                            {%for col in row_data | sort %}                     
                                <td class="{{row_data.get(col,{}).get('Class',{})}}" style="{{row_data.get(col,{}).get('Style',{})}}">
                                {{row_data.get(col,{}).get('Value',{})}}
                                </td>
                            {%endfor%} 
                        </tr>
                    {%endfor%}
                </tbody>
            </table>
            </div>
        </div>
    {% else %}
        <div class="col-sm-12 text-center" style="padding:5px 10px">
            <span class="text-center header-3" style="font-size: 15px">
               Please use filter option to view this report.
            </span> 
        </div>
    {% endif %}

</div>
{% endblock %}

{% block js %}
    {% from "print.html" import exportIncludeJS %}
    {{exportIncludeJS()}}

    <script type="text/javascript">

        $(document).ready(function() {
            
            {% from "print.html" import exportTable %}
            {{exportTable("#mktlist","")}}
            $("#Refresh").click(function() {
                fn_fadeIn();
                window.location.reload(true);
            });
            '{% if FilterOption["Criteria"] == True %}'
                $('#exampleModal').modal({ keyboard: false,backdrop: 'static' });
                $('#exampleModal').modal('show');
            '{% endif %}'
            // $('#mktlist').dataTable({
            //     "lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
            //     "bSort" : false
            // });
        });
    </script>
    <script type="text/javascript">

        $(function(){
            $('[data-toggle="modal"]').on("click", function(e) {
                e.preventDefault();
                var url = $(this).attr('href');
                if (url.indexOf('#') == 0) {
                    // $(url).modal('open');
                    return false;
                } else {
                    $.get(url, function(data) {
                         $('<div class="modal">' + data + '</div>').modal();
                    }).success(function() {
                        $('input:text:visible:first').focus();
                    });
                }
            });
            '{% if FilterOption["DataTable"] == True %}'
                $('#mktlist').dataTable({
                    "lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
                    "bSort" : false,
                });
            '{% endif %}'

        });

    </script>
    <!-- Call in Block Js -->

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="form-horizontal" action="{{Url}}" method="GET">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">{{ getLanguage('Custom') }}</h4>
                    </div>

                    <div class="modal-body">
                        {% for field in SearchForm %}
                            {% if field.widget.input_type != 'hidden' %}
                                {%if field.name not in list_exclude %}
                                    {{ report.render_field(field) }} 
                                {% endif %}
                            {% endif %}  
                        {% endfor %}
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" value="btn_apply" name="ButtonApply">{{ getLanguage('Apply') }}</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">{{ getLanguage('Cancel') }}</button>
                    </div>

                </form>
            </div>
        </div>
    </div>

{% endblock %}
{% macro exportButtonLink(Url="",UrlParam="") %}
    <div id="exportButton">
        <b>Also available in :</b>
        <a title="Download to Excel" href="{{Url}}/Excel?{{UrlParam}}" style="cursor:pointer;"> 
            <i class='fa fa-file-excel-o'></i> Excel
        </a> | 
        <a href="javascript:void(0)" id="print"><i class='fa fa-print'></i>&nbsp;Print</a>
    </div>
{% endmacro %}
