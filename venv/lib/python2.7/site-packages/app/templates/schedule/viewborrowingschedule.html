{% extends "layout.html" %}


{% block css %}
	<style type="text/css">
		body{
				font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
			}

		.brr-title{
			font-family: inherit;
			font-size:14pt;
			font-weight: 700;
			color:#777;
		}
		
	</style>
	
{% endblock %}
{% block content %}

<div class="navbar navbar-default navbar-static-top">
	<form method="GET" id="frm" name="frm" role="form">
		<div class="col-sm-10">
			<div style="margin-top: 8px;">
				<div class="col-sm-4" style="padding-left: 0;">
				   <input type="hidden" value="{{ID}}" />
				   <input type="hidden" value="{{Resource}}" />
					{% from "print.html" import searchCustomer %}
					{{searchCustomer(url="BorrowingSchedule/Search/"+Resource,name='ID',value=ID,placeholder='Input Borrowing Contract ID or Lender Name',AllowPutID='Y')}}
				</div>
				<div class="col-sm-2" style="padding-left: 0;">
					<select name="Resource" class="form-control" style="width: 100%;" id="select">
						{% if Resource == 'AUTH' %}
							<option selected value="AUTH">AUTH</option>
							<option value="INAU">INAU</option>
						{% else %}
							
							<option value="AUTH">AUTH</option>
							<option selected value="INAU">INAU</option>
						{% endif %}
					</select>
					<script type="text/javascript">
						init.push(function(){
							$('#select').change(function(){
								$('#frm').submit();
							});
						});
					</script>
				</div>
				<label class="col-sm-1" style="padding:0px;">
					<button type="submit" class="btn btn-flat btn-labeled btn-primary" style="padding: 7px 25px;">
						Show
					</button>
				</label>
			</div>
		</div>
		<div class="col-sm-2" style="margin-top: 8px;">
			<div class="pull-right">               
				<a id="print" onclick="" class="btn btn-flat btn-labeled btn-success">
					<span class="btn-label icon fa fa-print"></span> Print
				</a>
				<script type="text/javascript">
					$('#print').click(function(){
						window.print();
					})
				</script>
			</div>
		</div>
	</form>
</div>

{% if ScheduleObj %}
		<div class="row"></div>
		<div class="col-sm-12">
			<div class="container-fluid">
				{% if ScheduleObj %}
					<h3 class="text-center brr-title">Borrowing Schedule for {{ID}}</h3>
					<table id="mktlist" class="table table-striped table-info table-dark" cellspacing="0" width="100%">
						<thead>
							<tr>
								{% set Header = [] %}
								
								{%for item in HeaderTable %}
									<th>{{item}}</th>
								{% endfor %}
								
							</tr>
						</thead>
						<tbody>
							{% for row in ScheduleObj %}
								<tr>
									<td>{{ loop.index }}</td>
									<td>{{ row.CollectionDate }}</td> 
									<td>{{ toMoney(float(row.Principal), getCurrencyObj(BorrowingObj.Currency), 0) }}</td>
									<td>{{ toMoney(float(row.Interest), getCurrencyObj(BorrowingObj.Currency), 0) }}</td> 
									
									<td>{{ toMoney(float(row.Charge), getCurrencyObj(BorrowingObj.Currency), 0) }}</td>
									<td>{{ toMoney(float(row.TotalPayment), getCurrencyObj(BorrowingObj.Currency), 0) }}</td> 
									<td>{{ toMoney(float(row.Balance), getCurrencyObj(BorrowingObj.Currency), 0) }}</td> 									
								</tr>
							{% endfor %}
										
						</tbody>
						<tfoot>
							<tr>
								{% set TotalInterest = float(ScheduleObj|sum(attribute='Interest')) %}
								{% set TotalCharge = float(ScheduleObj|sum(attribute='Charge')) %}
								{% set TotalPaid = float(ScheduleObj|sum(attribute='TotalPayment')) %}
								
								<td colspan="2" style="text-align: right"><strong>សរុប</strong></td>
								<td style="text-align: left;"><strong>{{ toMoney(float(BorrowingObj.DisbursedAmount), getCurrencyObj(BorrowingObj.Currency)) }}</strong></td>
								<td style="text-align: left;"><strong>{{ toMoney(float(TotalInterest), getCurrencyObj(BorrowingObj.Currency)) }}</strong></td>								
								<td style="text-align: left;"><strong>{{ toMoney(float(TotalCharge), getCurrencyObj(BorrowingObj.Currency)) }}</strong></td>								
								<td><strong>{{ toMoney(float(TotalPaid), getCurrencyObj(BorrowingObj.Currency)) }}</strong></td>
								<td></td>
							</tr>			
						</tfoot>
						
					</table>
				{% endif %}
			</div>
			<div class="col-sm-offset-1"></div>
		</div>
	{% else %}
		{% if request.method == 'POST' %}
			<div class="alert alert-warning">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				Schedule not found.
			</div>
		{% endif %}
{% endif %}


{% endblock %}