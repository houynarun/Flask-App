{% extends "layout.html" %}

{% block css %}
{# 	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/jquery.datatables.css') }}"> #}
	<style>
		h3.header-3{
			color: #888 !important;
			font-size: 16px;
			font-weight: bold;
			margin: 20px 0;
			padding: 10px 18px 0;
		}

		.se-pre-con1 {
			position: fixed;
			left: 0px;
			top: 0px;
			width: 100%;
			height: 100%;
			z-index: 9999;
			background: #FFF url("{{ url_for('static',filename='images/loading.gif') }}") center no-repeat;
			opacity: 0.4;
			display: none;
		}

		.form-label{
			padding-top: 7px;
		}
		.form-control{
			width: 100%;
		}
		.generete-schedule{
			padding-right: 30px;
		}
		.advance-option{
			padding-top: 20px;
		
		#Main {
		  width: 1px;
		  min-width: 100%;
		  *width: 100%;
		}
		.panel {
		  width: 100%;
		}
	</style>

{% endblock %}

{% block content %}

	<script type="text/javascript">

		function saveSchedule(){
			fn_fadeIn();
			url = "/Morakot/ScheduleDefine/?Operation=Save&ContractID={{ ContractID }}&Resource={{ Resource }}&Amendment={{ Amendment }}&AmtID={{ AmtID }}"
			document.forms["frm"].action=url;
			document.forms["frm"].submit();
		}

		$(document).ready(function() {
			function fn_fadeIn(){
				var $getParentEle = window.parent.$("#animated")
				$getParentEle.fadeIn("slow");
			}
			$("#Save").on("click",function(e){
				// fn_fadeIn();/
				//url = "/Morakot/ScheduleDefine/Save/{{ ContractID }}?Resource={{ Resource }}&Amendment={{ Amendment }}&AmtID={{ AmtID }}"
				//document.forms["frm"].action=url;
				//document.forms["frm"].submit();
				var Installment = "{{ Contract.Installment if Contract else 0 }}"
				var ScheduleInstallment = "{{ Schedule | length if Schedule else 1 }}"
				var PrevInstallment = "{{ PrevInstallment if PrevInstallment else 0 }}"
				console.log("Installment"+Installment+"Schedule"+ScheduleInstallment+"PrevInstallment"+PrevInstallment)
				if (parseInt(ScheduleInstallment) + parseInt(PrevInstallment) != parseInt(Installment)){
					console.log("check");
					$("#accept-override").show();
				}else{
					saveSchedule();
				}
			});
			$("#override-yes").on("click",function(e){
				saveSchedule();
			});
			$("#override-no").on("click",function(e){
				$("#accept-override").hide();
			});

			$("#Edit").on("click",function(e){
				fn_fadeIn();
				{%if Amendment == "No"%}
					window.location.href="/Morakot/{{g_getUrlExtend(Module='LoanContract')}}/Edit/{{ ContractID }}/";
				{%elif Amendment == "Topup"%}
					window.location.href="/Morakot/{{g_getUrlExtend(Module='LoanTopup')}}/Edit/{{ AmtID }}/";
				{%else%}
					window.location.href="/Morakot/{{g_getUrlExtend(Module='LoanAmendment')}}/Edit/{{ AmtID }}/";
				{%endif%}
			});

			$("#New").on("click",function(e){
				fn_fadeIn();
				{%if Amendment == "No"%}
					window.location.href="/Morakot/{{g_getUrlExtend(Module='LoanContract')}}/New";
				{%elif Amendment == "Topup"%}
					window.location.href="/Morakot/{{g_getUrlExtend(Module='LoanTopup')}}/New";
				{%else%}
					window.location.href="/Morakot/{{g_getUrlExtend(Module='LoanAmendment')}}/New";
				{%endif%}
			});

			$("#Manual").on("click",function(e){
				fn_fadeIn();
				window.location.href="/Morakot/ScheduleManual/{{ ContractID }}?Amendment={{ Amendment }}&Resource={{ Resource }}&AmtID={{AmtID}}";

			});
			$("#Generate").on("click",function(e){
				fn_fadeIn();
				
			});

		});

	</script>

	<script type="text/javascript">
	init.push(function () {
			$(function() {
				$('#AnnuityAmount').bind('blur', function() {
					var Amount = $('#AnnuityAmount').val();
					// var Currency = $('#Currency').val();
					var Currency = '{{Currency}}';
					$.ajax({
						url: "/Morakot/toMktmoney",
						data:{Currency:Currency,Money:Amount},
						type: "GET",
						success: function(data){
							$('#AnnuityAmount').val(data['value']);
						} 
					});
				});
			});
	});
</script>
	<div class="se-pre-con1"></div>

	{% if not Contract %}
		<div class="col-sm-12">
			{% for message in get_flashed_messages() %}
				<div class="clearfix">&nbsp;</div>
				<div class="alert alert-danger">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
			{% endfor %}
		</div>
	{% else %}

	<script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script>
	<script src="{{ url_for('static',filename='js/dataTables.tableTools.js') }}"></script>

	<!-- <link rel=stylesheet type=text/css href="{{ url_for('static', filename='stylesheets/jquery.datatables.css') }}">
	 -->
	 <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.1/css/responsive.bootstrap.min.css">
	 <link rel=stylesheet type=text/css href="{{ url_for('static', filename='stylesheets/dataTables.tableTools.css') }}">
	 <script src="{{ url_for('static',filename='javascripts/dataTables.responsive.min.js') }}"></script>
<div id="Main">
		<div class="col-sm-12 navbar navbar-default navbar-static-top" style="padding: 10px !important; margin: 0px !important;">
			<div class="form-group" style="margin: 0px !important;">
				<input type="hidden" name="ContractID" id="ContractID" value="{{ ContractID }}">
				<input type="hidden" name="Resource" value="{{ Resource }}">
				<input type="hidden" name="AmtID" id="AmtID" value="{{ AmtID }}">
				<button type="button" class="btn btn-flat btn-labeled btn-success pull-right" id="Manual">
					<span class="btn-label icon fa fa-gear"></span> Manual Schedule
				</button>

				<div style="padding-top: 5px;">

					<a href="javascript:void(0)" id="New" style="color: #777;">
						<span class="btn-label icon fa fa-file-text-o"></span>&nbsp; New
					</a> &nbsp;&nbsp;&nbsp;

					<a href="javascript:void(0)" id="Save"  style="color: #777;">
					<span class="btn-label icon fa fa-floppy-o"></span> Save
					</a> &nbsp;&nbsp;&nbsp;

					<a href="javascript:void(0)" id="Edit" style="color: #777;">
						<span class="btn-label icon fa fa-pencil-square-o"></span>&nbsp; Edit
					</a> &nbsp;&nbsp;&nbsp;

				</div>
				
			</div>
		</div>

		<div class="clearfix">&nbsp;</div>
		{% include 'msg_error.html' %}
			{% if ListError %}
			<div class="clearfix"></div>
			<div class="col-sm-12" style="padding-top:5px;">

				<div class="alert alert-danger" id="alert-danger">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					<ol>
						{% for message in ListError %}
						<li id="lblTableName">
							<a class="error_pointer" >
								<label for="TableName">
									{{message[0]}} <span style="color:#d38e99;">*	</span>
								</label>
							</a> 

							: {{message[1]}}
						</li>		
						{% endfor %}
					</ol>
					
				</div>
			</div>
			{% endif %}
			<div class="clearfix"></div>

		<div class="col-sm-12" style="padding-top:5px;display: none" id="accept-override">
			<div class="alert alert-info">
				<!-- <button type="button" class="close" data-dismiss="alert">Ă</button> -->
				<span>The number of installment 
					{% if Contract.Installment | int < Schedule | length + PrevInstallment %}
						increases
					{% else %}
						decreases
					{% endif %}
					from <b>{{ Contract.Installment }}</b> to <b>{{ Schedule | length + PrevInstallment }}</b>, Do you want to proceed?&nbsp;&nbsp;&nbsp;
				</span>
				<a class="btn btn-flat btn-success btn-xs" href="javascript:void(0)" id="override-yes">Yes </a>
				<a class="btn btn-flat btn-danger btn-xs" href="javascript:void(0)" id="override-no"> No</a>
			</div>
		</div>

		<div class="col-sm-12">
			<h3 class="header-3 text-center">Schedule Define for {{ ContractID }}</h3>
		</div>
		<div class="col-sm-2"></div>
		<div class="col-sm-8 form-horizontal">
			<form method="POST" id="frm" name="frm"  enctype="multipart/form-data" role="form" action="/Morakot/ScheduleDefine/?Operation=New&ContractID={{ ContractID }}&Resource={{ Resource }}&Amendment={{ Amendment }}&AmtID={{ AmtID }}">
				<div class="row">
				<input type="hidden" name="ID" value="{{ContractID}}">
				<input type="hidden" name="Resource" value="{{Resource}}"></input>
					<div class="col-sm-6">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								Repayment Mode <span style="color:#d38e99">*</span>
							</label>
							<div class="col-sm-7">
								<select class="form-control" id="RepMode" name="RepMode">
									<!-- <option value=""> --None-- </option> -->
									<optgroup label="Repayment Mode">
										{# {% set PaymentDict = {} %} #}
										{% if PaymentDict %}
											{% for key,value in PaymentDict.iteritems() %}
												<option value="{{key}}">{{value}}</option>
											{% endfor %}
										{% else %}
											<option value="1">Declining</option>
											<option value="2">Annuity</option>
											<option value="3">Flat</option>
											{% if FrequencyType != 3 %}
											<option value="4">IRR</option>
											{% endif %}
										{% endif %}
										{%if ShowUpload %}
											<option value="5">Upload</option>
										{%endif%}
									 </optgroup>
								</select>
								<script type="text/javascript">
									init.push(function () {
										// Single select
										{# Set default value to select from loan application. #}
										{% if LoanAppPaymentMode %}
											$("#RepMode").select2().select2("val",{{LoanAppPaymentMode}});
										{% endif %}
										{%if RepaymentMode%}
											$("#RepMode").val('{{ RepaymentMode }}');
										{%endif%}
										$("#RepMode").select2({
											allowClear: true,
											placeholder: "Repayment Mode"
										});
									});
								</script>
								
							</div>
						</div>
					</div>

					<div class="col-sm-6 group-crl" id="Group-Principal">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								Principal Frequency <span style="color:#d38e99">*</span>
							</label>
							<div class="col-sm-7">
								<input type="text" class="form-control" id="PrincipalFreq" name="PrincipalFreq" value="{{ FrequencyP }}">								
							</div>
						</div>
					</div>

					<div class="col-sm-6 group-upload" id="FileUpload" style="padding: 0px;">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								File Upload <span style="color:#d38e99">*</span>
							</label>
							<div class="col-sm-7">
								<input type="file" name="fileUpload" id="fileUpload" >
								<!-- Javascript -->
								<script>
									init.push(function () {
										$('#fileUpload').pixelFileInput({ placeholder: 'No file selected...' });
									})
								</script>
								<!-- / Javascript -->
							</div>
						</div>
					</div>

				</div>

				<div class="row">

					<div class="col-sm-6 group-crl" id="Group-FwdBwdKey">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								Fwd/Bwd Key <span style="color:#d38e99">*</span>
							</label>
							<div class="col-sm-7">
								<select class="form-control" id="FwdBwdKeyID" name="FwdBwdKey">
									<!-- <option value=""> --None-- </option> -->
									<optgroup label="Fwd/Bwd Key">
										<option value="0">0. No holiday</option>
										{% if FrequencyType != 3 %}
										<option value="1">1. Backward within month</option>
										<option value="2">2. Forward within month</option>
										<option value="3">3. Backward</option>
										{% endif%}
										<option value="4">4. Forward</option>
									 </optgroup>
								</select>
								
							</div>
						</div>
					</div>
					
					<div class="col-sm-6 group-crl">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								Interest Frequency <span style="color:#d38e99">*</span>
							</label>
							<div class="col-sm-7">
								<input type="text"class="form-control" id="InterestFreq" name="InterestFreq" value="{{ FrequencyI }}">
							</div>
						</div>
					</div>

				</div>
				<div class="row">

					<div class="col-sm-6 group-crl">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								First Installment Date
							</label>
							<div class="col-sm-7">
								<input type="text" class="form-control" data-provide="datepicker" data-date-format="yyyy-mm-dd" value="{{ FirstInstallmentDate }}" data-date-autoclose="true" id="FirstInstallmentDate" name="FirstInstallmentDate">
								{% if FristDateRequired %} <p class="text-danger"> {{ FristDateRequired }} </p> {% endif %}
							</div>
						</div>
					</div>

					<!-- <div class="col-sm-6">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								
							</label>
							<div class="col-sm-7">
								<input type ="submit" class="btn btn-flat btn-labeled btn-primary" value="Upload" id="btnUpload">
							</div>
						</div>
					</div> -->

					<div class="col-sm-6 group-crl">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								Base Date Key <span style="color:#d38e99">*</span>
							</label>
							<div class="col-sm-7">
								<select class="form-control" id="BaseDateKeyID" name="BaseDateKey">
									<optgroup label="Base Date Key">
										<option value="1">1. Value Date</option>
										<option value="2">2. Previous Date</option>
										<option value="3">3. First Date</option>
									</optgroup>
								</select>
								<script type="text/javascript">
									init.push(function () {
										// Single select
										{% if DefaultBasedDateKey %}
											$("#BaseDateKeyID").select2().select2("val",{{DefaultBasedDateKey}});
										{% endif %}

										$("#BaseDateKeyID").select2({
											allowClear: true,
											placeholder: "Base Date Key"
										});
									});
								</script>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6 group-crl">
						<div class="form-group">
						<div id= "Annuity">							
								<label class="col-sm-5 text-right form-label">
									Annuity Amount 
								</label>
								{# 2018-07-13 payment-holiday #}
								{% if Schedule and RepaymentMode == 2 %}
									{% set s_index = 1 %}
									{% if PaymentHoliday and NumOfHolidayInstallment %}
										{% set s_index = NumOfHolidayInstallment %}
									{% endif %}

									{# {% set Interest = float(Schedule[0].Interest.replace(',','')) + float(AccrCurrentInt) %} #}
									{% set Interest = float(Schedule[0].Interest.replace(',','')) %}
									{% set Length = Schedule|length %}
									{% set AnnuityAmount = float(Schedule[s_index].AnnuityAmount) if 'AnnuityAmount' in Schedule[s_index] else 0   %}
									{% set DefaultAnnuityAmount = float(Schedule[s_index].DefaultAnnuityAmount) if 'DefaultAnnuityAmount' in Schedule[s_index] else 0   %}

								{% else %}
									{% set AnnuityAmount = 0 %}
									{% set DefaultAnnuityAmount = 0 %}
								{% endif %}
								{# end #}
								<div class="col-sm-7">
									<input type="text" class="form-control" id="AnnuityAmount" name="AnnuityAmount" value="{{ toMoney(AnnuityAmount,getCurrencyObj(Currency)) }}">

								</div>
							
							</div>
						</div>
						
					</div>
					{# 2018-07-13 payment-holiday #}
					<div class="col-sm-6 group-crl">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								
							</label>
							<div class="col-sm-7">
								<a class="link" id="AdvanceOption"> Advance Option </a>
							</div>
						</div>
					</div>
					{# end #}
				</div>
				{# 2018-07-13 payment-holiday #}
				<div id="AdvanceContent" class="border-t panel-padding advance-option">
				{# end #}
				{# 2018-07-13 payment-holiday #}
				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label">
								Payment Holiday
							</label>
							<div class="col-sm-7">
								<select class="form-control" id="PaymentHoliday" name="PaymentHoliday">
									<optgroup label="Payment Holiday">
										<option value="0"> --None-- </option>
										<option value="1">Principal Only</option>
										<option value="2">Interest Only</option>
										<option value="3">Both Principal+Interest</option>
										<option value="4">Principal Only - Fix Annuity Amount</option>
									 </optgroup>
								</select>
								<script type="text/javascript">
									init.push(function () {
										{% if PaymentHoliday %}
											$("#PaymentHoliday").select2().select2("val",{{str(PaymentHoliday)}});
										{% endif %}
										// Single select
										$("#PaymentHoliday").select2({
											allowClear: true,
											placeholder: "Payment Holiday"
										});
									});
								</script>
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label ">
								Waive Interest {{OptWaiveInterest}}
							</label>
							<div class="col-sm-7">
								<select class="form-control" id="WaiveInterest" name="WaiveInterest">
									<optgroup label="Waive Interest">
										<option value="Y">Yes</option>
										<option value="N">No</option>										
									 </optgroup>
								</select>
								<script type="text/javascript">
									init.push(function () {
										{% if WaiveInterest %}
											$("#WaiveInterest").select2().select2("val",{{OptWaiveInterest}});
										{% endif %}
										// Single select
										$("#WaiveInterest").select2({
											allowClear: true,
											placeholder: "WaiveInterest"
										});
									});
								</script>
							</div>
						</div>
						
					</div>
				</div>

				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
							<label class="col-sm-5 text-right form-label ">
								#Of Holiday Installment
							</label>
							<div class="col-sm-7">
								<input type="number" class="form-control" id="NumOfHolidayInstallment" name="NumOfHolidayInstallment" value="{{ NumOfHolidayInstallment }}">
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<input type="hidden" id="DefaultAnnuityAmount" name="DefaultAnnuityAmount" value="{{DefaultAnnuityAmount}}">		
					</div>
				</div>
				</div>
				{# end #}
				<div class="row">
					<div class="col-sm-6"></div>
					<div class="col-sm-6 text-right group-crl">
						<div class="form-group generete-schedule">
							<input type="hidden" id="OptSave" name="OptSave" value="">
							<input type="hidden" id="Resource" name="Resource" value="{{ Resource }}">
							<input type="hidden" id="Amendment" name="Amendment" value="{{ Amendment }}">
							<input type="hidden" name="AmtID" id="AmtID" value="{{ AmtID }}">
							<button type="submit" id="Generate" class="btn btn-flat btn-labeled btn-primary ">
							<span class="btn-label icon fa fa-th"></span> Generate Schedule
							</button>
						</div>
					</div>
					<div class="col-sm-6 text-right group-upload">
						<div class="form-group">
							<input type="hidden" id="OptSave" name="OptSave" value="">
							<input type="hidden" id="Resource" name="Resource" value="{{ Resource }}">
							<input type="hidden" id="Amendment" name="Amendment" value="{{ Amendment }}">
							<input type="hidden" name="AmtID" id="AmtID" value="{{ AmtID }}">
							<button type="submit" id="Generate" class="btn btn-flat btn-labeled btn-primary">
							<span class="btn-label icon fa fa-th"></span> Upload Schedule 
							</button>
						</div>
					</div>
				</div>
				
			</form>

		</div>
		<div class="col-sm-2"></div>

		{% if not FristDateRequired %}

			{% if Schedule %}

				<div class="clearfix"></div>
				<table id="mktlist" class="display table table-striped table-hover" cellspacing="0" width="100%">
			   
					<thead>
						<tr>
							<th>No</th>
							<th style="width: 190px;">Collection Date</th>
							<th class="text-right">Principal</th>
							<th class="text-right">Interest</th>
							{%if EnableChargeSchedule%}
								<th class="text-right">Charge</th>
							{%endif%}
							<th class="text-right">Total Amount</th>
							<th class="text-right">Balance</th>
							<th class="text-center">NumberOfDay</th>
						</tr>
					</thead>
					<tbody>
					{%set DicTotalAmount = {'TotPrincipal':0,'TotInterest':0,'Total':0,'TotNumDay':0, 'TotCharge': 0}%}
						{%for row in Schedule%}
							{%set Interest 	= 0 %}
							{%set Charge  	= 0 %}

							{% if loop.first %}
								{%set Interest = toMoney(float(row.Interest.replace(',','')) + float(AccrCurrentInt),getCurrencyObj(Currency)) %}
								{%set Charge = toMoney(float(row.Charge.replace(',','')) + float(AccrCurrentCharge),getCurrencyObj(Currency)) %}

							{%else%}
								{%set Interest 	= row.Interest %}
								{%set Charge 	= row.Charge %}
							
							{%endif%}
						
							<tr>
								<td>{{ row.InstallmentNo }}</td>
								<td>{{ row.FormatCollectionDate }}</td>
								<td class="text-right">{{ row.Principal }}</td>
								<td class="text-right">{{ Interest }}</td>
								{%if EnableChargeSchedule%}
									<td class="text-right">{{ Charge }}</td>
								{%endif%}
								<td class="text-right">
								{%set TotalAmount = float(Interest.replace(',',''))+ float(row.Principal.replace(',','')) +  float(Charge.replace(',','')) %}

								{{toMoney(TotalAmount,getCurrencyObj(Currency))}}
								</td>
								<td class="text-right">{{ row.Balance }}</td>
								<td class="text-center">{{ row.NumberOfDay }}</td>
							</tr>
							{{AddDataToList(DicTotalAmount,float(row.Principal.replace(',','')), float(Interest.replace(',','')), TotalAmount, row.NumberOfDay, float(Charge.replace(',','')))}}
						{% endfor %}
					</tbody>
					<tfooter>
						<tr>
							<th colspan="2" class="text-right" style="border-top: 1px solid #000;">Sub Total</th>
							<th class="text-right" style="border-top: 1px solid #000;">{{ toMoney(float(LoanBalance), getCurrencyObj(Currency), 1) }}</th>
							<th class="text-right" style="border-top: 1px solid #000;">{{ toMoney(float(DicTotalAmount['TotInterest']), getCurrencyObj(Currency), 1) }}</th>
							{%if EnableChargeSchedule%}
								<th class="text-right" style=" border-top: 1px solid #000;">{{ toMoney(float(DicTotalAmount['TotCharge']), getCurrencyObj(Currency), 1) }}</th>
							{%endif%}
							<th class="text-right" style=" border-top: 1px solid #000;">{{ toMoney(float(DicTotalAmount['TotInterest'])+float(DicTotalAmount['TotCharge'])+ LoanBalance, getCurrencyObj(Currency), 1) }}</th>
							<th class="text-right" style=" border-top: 1px solid #000;"></th>
							<th class="text-center" style=" border-top: 1px solid #000;">{{ formatNumber(float(DicTotalAmount['TotNumDay']), 1, 0) }}</th>
						</tr>
					</tfooter>
				</table>
			{% endif %}

		{% endif %}

	{% endif %}
</div>
{% endblock %}

{% block js %}
	<!-- <script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script> -->

	<script type="text/javascript">
		$(document).ready(function() {

			$("#RepMode").val('{{ RepaymentMode }}');
			$("#FwdBwdKeyID").val('{{FwdBwdKey}}');
			$("#BaseDateKeyID").val('{{BaseDateKey}}');
			$("#PaymentHoliday").val('{{PaymentHoliday}}');
			$("#NumOfHolidayInstallment").val('{{NumOfHolidayInstallment}}');
			$("#WaiveInterest").val('{{WaiveInterest}}');
			
			{# 2018-07-13 payment-holiday #}
			{#Disable AdvanceOption Because not yet working #}
			$("#AdvanceOption").show();
			{#End Disable#}
			{# end #}

			{%if not PaymentHoliday%}
				$("#AdvanceContent").hide();
			{%endif%}
			
			$( "#AdvanceOption" ).click(function() {
				
				$('#AdvanceContent').toggle(); 
				if($(this).text() == 'Hide Advance Option'){
					$(this).text('Advance Option');
				} else {
					$(this).text('Hide Advance Option');
				}
			});

			$('#mktlist').dataTable({
				responsive : true,
			   "lengthMenu": [[12,24, 36, 60,120, -1], [12,24, 36, 60,120, "All"]]
			});
			$("#FwdBwdKeyID").select2({
				allowClear: true,
				placeholder: "Fwd/Bwd Key"
			});
			checkRepMode();

			$("select#RepMode").change(function(){
				checkRepMode();
			});
			function disableControl() {
				// body...
				$("input#PrincipalFreq").attr("readonly", true);
				$("input#InterestFreq").attr("readonly", true);
			}
			function enableControl(){
				$("input#PrincipalFreq").attr("readonly", false);
				$("input#InterestFreq").attr("readonly", false);
			   
			}

			function checkRepMode()
			{
				var RepMode = $("select#RepMode").val();
				var ActualNumDay = '{{AnnuityWithActualNumDay}}';
				var textarea = document.getElementById("Annuity");

				if(RepMode == 5){
					$(".group-crl").hide();
					$(".group-upload").show();
					$("#Save").hide();
					
				}else{
					$(".group-crl").show();
					$(".group-upload").hide();
					$("#Save").show();
				}

				if (ActualNumDay == "N"){ // If Actual number of Day of Annuity is No

						textarea.style.display = "none";
						if(RepMode == 1 || RepMode == 3 ) // Annuity
							{
								enableControl();
								$("#FwdBwdKeyID").select2("readonly",false);
							}
						if(RepMode == 4){

								disableControl();
								$("#FwdBwdKeyID").select2("readonly",false);
							}
						if(RepMode == 2){
							
								textarea.style.display = "none";
								disableControl();
								$("#FwdBwdKeyID").select2("readonly",true);
						}

				}else{ // If Actual number of Day of Annuity is Yes

						// textarea.style.display = "block";

						if(RepMode == 1 || RepMode == 3 ) // Annuity
								{
									enableControl();
									$("#FwdBwdKeyID").select2("readonly",false);
									$("input#AnnuityAmount").attr("readonly",true);
									$("input#AnnuityAmount").val("0");
								}
							if(RepMode == 4){

									disableControl();
									$("#FwdBwdKeyID").select2("readonly",false);
									$("input#AnnuityAmount").attr("readonly",true);
									$("input#AnnuityAmount").val("0");
								}
						if(RepMode == 2){
							
								// textarea.style.display = "block";
								disableControl();
								$("#FwdBwdKeyID").select2("readonly",false);
								$("input#AnnuityAmount").attr("readonly",false);
							}

				} // end if
			} // end function checkRepMode

			// $('#PaymentHoliday').change(function() {
			//  	$("#AnnuityAmount").val(0)
			//  	// alert('test');
			// });

				
			{#
			$("#SaveSchedule").click(function(){
				var ContractID = $("#ContractID").val();
				var Resource = $("#Resource").val()
				var Amendment = $("#Amendment").val()
				var AmtID = $("#AmtID").val()
				$.ajax({
					url: "/Morakot/ScheduleDefine/SaveSchedule",
					type: "POST",
					data: { ContractID:ContractID, Resource:Resource, Amendment:Amendment, AmtID:AmtID },
					beforeSend: function()
					{
						$(".se-pre-con1").show();
					},
					success: function(data)
					{
						$(".se-pre-con1").hide();
						if(data == "OK")
						{
							window.location = "/Morakot/ScheduleDefine/?Operation=New&ContractID={{ ContractID }}&Resource={{ Resource }}&Amendment={{ Amendment }}&AmtID={{ AmtID }}"
						}
						else
						{
							alert(data);
						}
					}
				});
			});
			#}
		});
	</script>
{% endblock %}

{% macro AddDataToList(TotalAmount, Principal, Interest, Total, NumDay, Charge=0) %}
		
	{% if TotalAmount.update({ 

	"TotPrincipal":float(TotalAmount["TotPrincipal"]) + float(Principal),
	"TotInterest":float(TotalAmount["TotInterest"]) + float(Interest),
	"Total":float(TotalAmount["Total"]) + float(Total),
	"TotNumDay":float(TotalAmount["TotNumDay"]) + float(NumDay),
	"TotCharge":float(TotalAmount["TotCharge"]) + float(Charge)

	}) %}{% endif %}

{% endmacro %}
