{% extends "layout.html" %}

{% block css %}
   
    <style type="text/css">
        .form-control
        {
            width: 100% !important;
        }

    </style>
{% endblock %}

{% block content %}
    <div class="se-pre-con1"></div>
    <div class="navbar navbar-default navbar-static-top ActionFotter" id="CriteriaSetting" >
        <div class="col-sm-12">
                <div style="margin-top: 8px;">
                </div> 
                <div class="col-sm-6" style="padding-top:10px; padding-left:0px;">

                    {% from "print.html" import exportButtonLink %}
                    {{exportButtonLink()}}

                </div>  
        </div> 
    </div>
    
 
    <div class="col-sm-12" id="navberCriteria">
        {% include 'msg_error.html' %}
        <form action="" method="GET" role="FORM" id="generate_schedule">
            <div class="col-sm-6 col-sm-offset-1">
                <div class="panel colourable panel-info panel-dark" style=" min-height: 550px;">
                        <div class="panel-heading">
                            <span class="panel-title"><i class="fa fa-calculator" aria-hidden="true"></i> Calculator</span>
                        </div>
                        <div class="panel-body">
                           

                            <div class="form-group">
                            <label class="col-sm-3">Currency :</label>
                            <div class="col-sm-4">
                               <select class="form-control" id="Currency" name="Currency">
                                    <optgroup label="Currency">
                                        {%for row in CurrencyObj %}
                                        <option value="{{row.ID}}"> {{row.ID}} </option> 
                                        {%endfor%}
                                     </optgroup>
                                </select>
                                <script type="text/javascript">
                                    init.push(function () {
                                        // Single select
                                        $("#Currency").val('{{Currency}}');
                                        $("#Currency").select2({
                                            allowClear: true,
                                            placeholder: "Currency"
                                        });

                                    });
                                </script>
                            </div>
                            <span class="col-sm-5"> Example: USD, KHR, THB </span>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">Disburse Amount :</label>
                            <div class="col-sm-4">
                                <input type="text" id="DisburseAmount" name="DisburseAmount" value="{{DisburseAmount}}" class="form-control" required="required">
                            </div>
                            <span class="col-sm-5"> Enter any number here </span>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3">Value Date :</label>
                            <div class="col-sm-4">
                                <input class="input-sm form-control" type="text" value="{{ ValueDate }}" placeholder="" name="ValueDate" id="ValueDate"  style="width:214px;">
                                <script type="text/javascript">

                                    init.push(function () {
                                        var options = {
                                        orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
                                        format:"yyyy-mm-dd",
                                        autoclose:true
                                        }
                                        $('#ValueDate').datepicker(options);
                                    });

                                </script>
                            </div>
                            <span class="col-sm-5"> Example: 2015-03-20 </span>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3">Interest Rate :</label>
                            <div class="col-sm-4">
                                <input type="text" name="Rate" value="{{ Rate }}" class="form-control" required="required">
                            </div>
                            <span class="col-sm-5"> Enter Rate per year Ex : 1% per month = 12% per year</span>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3">Charge Type :</label>
                            <div class="col-sm-4">
                                 <select class="form-control" id="ChargeType" name="ChargeType">
                                    <optgroup label="ChargeType">
                                        {% for item in RegularFeeType %}
                                            <option value="{{item[0]}}"> {{item[0]}}-{{item[1]}} </option>
                                        {% endfor %}
                                     </optgroup>
                                </select>
                                <script type="text/javascript">
                                    init.push(function () {
                                        // Single select
                                        $("#ChargeType").val('{{ChargeType}}');
                                        $("#ChargeType").select2({
                                            allowClear: true,
                                            placeholder: "Charge Type"
                                        });

                                    });
                                </script>
                            </div>
                            <span class="col-sm-5"> Charge type </span>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3">Charge Value:</label>
                            <div class="col-sm-4">
                                <input type="text" name="Charge" value="{{ Charge }}" class="form-control" required="required">
                            </div>
                            <span id="ChargeText" class="col-sm-5">Charge value can be fix amount or rate based on charge type.</span>
                            <script type="text/javascript">
                                $('#ChargeType').change(function (){
                                    if($('#ChargeType').val() == "1"){
                                        $('#ChargeText').html('Example: 50 per each installment');
                                    } else if ($('#ChargeType').val() == "2"){
                                        $('#ChargeText').html('Example: 1% of Disburse amount per each installment');
                                    } else if ($('#ChargeType').val() == "3"){
                                        $('#ChargeText').html('Example: 1% of Loan Balance per each installment');
                                    } else {
                                        $('#ChargeText').html('Charge value can be fix amount or rate based on charge type');
                                    }
                                });
                            </script>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3">Frequency Type :</label>
                            <div class="col-sm-4">
                                 <select class="form-control" id="FrequencyType" name="FrequencyType">
                                    <optgroup label="FrequencyType">
                                        <option value="1"> 1-Monthly </option> 
                                        <option value="2"> 2-Weekly </option> 
                                     </optgroup>
                                </select>
                                <script type="text/javascript">
                                    init.push(function () {
                                        // Single select
                                        $("#FrequencyType").val('{{FrequencyType}}');
                                        $("#FrequencyType").select2({
                                            allowClear: true,
                                            placeholder: "Frequency Type"
                                        });

                                    });
                                </script>
                            </div>
                            <span class="col-sm-5"> 1= Monthly ; 2= Weekly </span>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3">Term :</label>
                            <div class="col-sm-4">
                                <input type="number" name="Term" value="{{Term}}" class="form-control" required="required">
                            </div>
                            <span class="col-sm-5"> Example: 1, 2,...12,..24 </span>
                        </div>
               
                        <div class="form-group">
                            <label class="col-sm-3">Repayment Mode :</label>
                            <div class="col-sm-4">
                            
                                 <select class="form-control" id="RepaymentMode" name="RepaymentMode">
                                    <optgroup label="RepaymentMode">
                                       
                                        <option value="1"> 1-Declining </option> 
                                        <option value="2"> 2-Annuity </option>
                                        <option value="3"> 3-Flat </option> 
                                       
                                     </optgroup>
                                </select>
                                <script type="text/javascript">
                                    init.push(function () {
                                        // Single select
                                        $("#RepaymentMode").val('{{RepaymentMode}}');
                                        $("#RepaymentMode").select2({
                                            allowClear: true,
                                            placeholder: "Repayment Mode"
                                        });

                                    });
                                </script>
                            </div>
                            <span class="col-sm-5"> 1=Declining ; 2= Annuity ; 3=Flat</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 form-group text-center">
                            <input type="submit" id="Generate" value="Calculate Schedule" class="btn btn-info">
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="col-sm-4 ">

            <div class="panel colourable panel-info panel-dark" style=" min-height:550px;">
                <div class="panel-heading">
                    <span class="panel-title"><i class="fa fa-pie-chart" aria-hidden="true"></i> Summary</span>
                </div>
                <div class="panel-body">
                    {% if Schedule %}
                    <div class="form-group">
                        <label class="col-sm-6">Total Interest :</label>
                        <span class="col-sm-6 text-lg"><strong>
                        {% set Interest = 0 %}
                        {% set ListData = {} %}
                        {% for row in Schedule %}
                            {% set Interest = float(Interest) + float(row.Interest|replace(',','')) %}
                            {%if ListData.update({'Interest':Interest}) %} {%endif%}
                        {% endfor %}
                        {{toMoney(ListData.Interest,getCurrencyObj)}}
                        </strong></span>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-6">First Principle : </label>
                        <span class="col-sm-6 text-lg"><strong>{{ Schedule[0].Principal }}</strong></span>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-6">First Interest : </label>
                        <span class="col-sm-6 text-lg"><strong>{{ Schedule[0].Interest }}</strong></span>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-6">First Charge : </label>
                        <span class="col-sm-6 text-lg"><strong>{{ Schedule[0].Charge }}</strong></span>
                    </div>

                    <div class="form-group">
                        {% set TotalAmount = float(Schedule[0].TotalAmount|replace(',',''))  %}
                        <label class="col-sm-6"> First Total Payment : </label>
                        <span class="col-sm-6 text-lg"><strong>{{ toMoney(TotalAmount,getCurrencyObj) }}</b></strong></span>
                    </div>
                     
                    {% endif %}
                    </div>
                    <div class="text-right" style="position: absolute; right:10px; bottom: 10px;">
                        <a href='javascript:void(0)' onClick=CustomClickView('Loan&nbspEstimator','LoanEstimator')>Loan Estimator</a>
                    </div>
                    </div>
                </div><!--End Summary Data-->
            </div>
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    {% if Schedule %}
                        <h3 class="text-center">Repayment Schedule</h3>

                        <table id="mktlist" class="table table-striped table-info table-dark" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    {%for item in HeaderTable %}
                                    <th>{{item}}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                               {% for row in Schedule %}
                               {% set TotalAmount = float(row.TotalAmount|replace(',','')) %}
                                    <tr>
                                        
                                        <td>{{ row.InstallmentNo }}</td> 
                                        <td>{{ row.CollectionDate }}</td> 
                                        <td>{{ row.Principal }}</td> 
                                        <td>{{ row.Interest }}</td> 
                                        <td>{{ row.Charge }}</td> 
                                        <td>{{ toMoney(TotalAmount,getCurrencyObj)}}</td> 
                                        <td>{{ row.Balance }}</td> 
                                        <td>{{ row.NumberOfDay }}</td> 
                                        
                                    </tr>
                                {% endfor %}
                            </tbody>
                            
                        </table>
                    {% endif %}
                </div>
                <div class="col-sm-offset-1"></div>
            </div>
        </form>
    </div>
    <!--  message  -->

{% endblock %}

{% block js %}

{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}

<script type="text/javascript">

    $(document).ready(function() {
        $('#mktlist').dataTable({
            "lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
            "bSort" : false,
            "bScrollCollapse": true
        });
        {% from "print.html" import exportDataTable %}
        {{exportDataTable("#mktlist","Daily Cash Collection Reports ")}}
        if($('#ChargeType').val() == "1"){
            $('#ChargeText').html('Example: 50 per each installment');
        } else if ($('#ChargeType').val() == "2"){
            $('#ChargeText').html('Example: 1% of Disburse amount per each installment');
        } else if ($('#ChargeType').val() == "3"){
            $('#ChargeText').html('Example: 1% of Loan Balance per each installment');
        } else {
            $('#ChargeText').html('Charge value can be fix amount or rate based on charge type');
        }
    });

</script>
{% endblock %}