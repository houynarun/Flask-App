{% extends "layout.html" %}

{% block css %}

	<style type="text/css" rel="stylesheet">
		.sn-transaction{
						width:200px;
						padding-left: 130px;
	
						margin-right: 18px;
						}

		.sn-timeline:before{
							margin-left: 80px;
							}
		.sn-timeline:after{
							margin-left: 76px;
							}
		.fam-tl-time-entry{
							padding-left: 120px;
							/*width: 60%;*/
							}
		.fam-tl-time-entry:before{
									margin-left: 80px;
		}
		/*.fam-tl-time-entry:before{
									color: black;
								}*/
		.fam-sn-header{					
				    text-align: center;	
				    color: white;			    
					}
		.fam-tl-icon{
					 margin-left:80px;
					}
		td{
			/*border: 1px solid black;*/
			valign: middle;
		}
		table{
			margin:0 auto;
			width:100%;
		}
		/* td{
			width : 50%;
		} */
		#summary td { float: left; width: 50%; overflow: hidden; white-space: nowrap; }
		#summary td:first-child:after{
			text-align: left;
			content : ".............................................................................................................................................................................................";
		}
		td:last-child{
			text-align: left;
		}
		.tb-title td{
			text-align: center;
		}
		#notFound{
			display: none;
			margin: 0 auto;
			margin-top: 40px;
			float: center;
			width:100%;
			color:red;
		}
		.search{
				margin-top:-25px;
				margin-bottom: 5px;
		}
		.dep-schedule{
			margin-top:5px;
			margin-bottom: 0px;	
			padding: 0px;
		}
		.chevron-toggle{
			background: transparent;
			display: inline-block;
			float: right;
			position: relative;
			padding: 0px;
			margin-top: -6px;
		}
		.fa-chevron-down{
			-webkit-transition: all 300ms 0s ease-in-out;
    		transition: all 300ms 0s ease-in-out;
		}
		.fa-chvron-click{
			transform: rotate(-180deg);
		}

		.amend-break{
			width: 100%;
			padding: 0;
			margin: 0;
			border: 1px dotted rgb(255,127,80);
			text-align: center;
			color: rgb(255,127,80);
			border-radius: 20px;
		}

		.amend-break:parent{
			background: #fff;
		}

		#amended-schedule > tbody:last-child > tr:last-child {
			display: none;
		}

	</style> 

{% endblock %}

{% block content %}

		<div class="navbar navbar-default navbar-static-top">
	    <form method="GET" id="frm" name="frm" role="form" action="">
	        <div class="col-sm-12">

	            <div class="col-sm-3" style="margin-top:8px; margin-right: 80px">
	                {% from "print.html" import searchCustomer %}
	                {{searchCustomer('/Morakot/Report/Asset/GetSuggestion','Q',Query,'','Input Serial Number or Description',AllowPutID=AllowPutID)}}
	            </div>
	            <div class="col-sm-6" style="margin-top:8px;">
	                <label>
	                    <button type="submit" class="btn btn-flat btn-labeled btn-primary" id="btnShow" style="padding: 7px 25px;">
	                        {{ getLanguage('Show') }}
	                    </button>
	                </label>
	            </div>
	        </div>
	    </form>
		</div>			
	<div class="container-fluid">
		{% for item in Assets %}
		
		<div class="timeline sn-timeline" id="assetItem">
				<div class="tl-entry fam-tl-time-entry">
					<div class="tl-time sn-transaction">
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Asset Summary
					</div>
					<div class="tl-icon fam-tl-icon bg-info"><i class="fa fa-reorder"></i></div>
					<div id="summary" class="panel tl-body">			
						<table>
							<tr>
								<td>Asset ID </td>
								<td>&nbsp;: {{AssetID}}</td>
							</tr>
							<tr>
								<td>Purchase Amount </td>
								<td>&nbsp;: {{Currency}} {{item['Info'][2]}}</td>
							</tr>
							<tr>
								<td>Purchase Date </td>
								<td>&nbsp;: {{item['Info'][3]}}</td>
							</tr>
							<tr>
								<td>Serial Number </td>
								<td>&nbsp;: {{(item['Info'][7] if item['Info'][7] != '' else 'None') if item['Info']|length>=8 else 'None'}}</td>
							</tr>
							<!-- <tr>
								<td></td>
							</tr> -->
							<tr>
								<td>Age Of Asset </td>
								{% if item['Info'][6].days >0 or (item['Info'][6].months >0 or item['Info'][6].years >0) %}
								<td>
									&nbsp;:
									{% if item['Info'][6].years>1 %}
										{{item['Info'][6].years}} years
									{% elif item['Info'][6].years==1 %}
										{{item['Info'][6].years}} year
									{% endif %}
									{% if item['Info'][6].months>1 %}
										{{item['Info'][6].months}} months
									{% elif item['Info'][6].months==1 %}
										{{item['Info'][6].months}} month
									{% endif %}
									{% if item['Info'][6].days>1 %}
										{{item['Info'][6].days}} days
									{% elif item['Info'][6].days==1 %}
										{{item['Info'][6].days}} day
									{% endif %}
								</td>
								{% else %}
								<td>&nbsp;: 0</td>
								{% endif %}
							</tr>
							<tr>
								<td>Accumulated Depreciation </td>
								<td>&nbsp;: {{item['Info'][1]}} {{item['Info'][4]}}</td>
							</tr>	
							<tr>
								<td>Maturity Date </td>
								<td>&nbsp;: {{item['Info'][8]}}</td>
							</tr>		
						</table>
						
					</div> <!-- / .tl-body -->
				<div class="dep-schedule">
					<div class="panel panel-default">
						<div class="panel-heading" role="tab" id="depSchedule">
							<h5 class="panel-title">
								<a id="btnDepSchedule" data-toggle="collapse" data-parent="#faq" href="#scheduleData" aria-expanded="false" aria-controls="scheduleData">
									Depreciatin Schedule
								</a>
								<div class="chevron-toggle">
									<button id="btnChevron" class="btn rounded" type="button" data-toggle="collapse" data-target="#scheduleData" aria-expanded="false" aria-controls="scheduleData">
										<i class="fa fa-chevron-down"></i>
									</button>
								</div>
							</h5>
						</div>
							<div id="scheduleData" class="panel-collapse collapse" role="tabpanel" aria-labelledby="depSchedule">
								<div class="panel-body">
								{% if ScheduleObj[:-1] %}
								<div  class="table-responsive">
									<table id="amended-schedule" class="table table-striped table-info table-dark" cellspacing="0" width="100%">
										<thead>
											<tr>
												{% set Header = [] %}
												
												{%for item in HeaderTable %}
													<th>{{item}}</th>
												{% endfor %}
												
											</tr>
										</thead>
									{% for installments in ScheduleObj[:-1] %}
										<tbody>
										{% for row in installments %}
											
											<tr>
												<td>{{ row.Branch }}</td>
												<td>{{ row.InstallmentNo }}</td>
												<td>{{ row.StartDate }}</td>
												<td>{{ row.EndDate }}</td>
												<td>{{ toMoney(float(row.BeginBookValue), getCurrencyObj(item['Info'][1]), 0) }}</td>
												<td>{{ toMoney(float(row.Depreciation), getCurrencyObj(item['Info'][1]), 0) }}</td>
												<td>{{ toMoney(float(row.AccumulatedDepreciation), getCurrencyObj(item['Info'][1]), 0) }}</td>
												<td>{{ toMoney(float(row.EndBookValue), getCurrencyObj(item['Info'][1]), 0) }}</td>
											</tr>
											
										{% endfor %}
											<tr>
												<td colspan="8"  style="background: #fff">
													<div  class="amend-break" >
														Fixed Asset Record
													</div>
												</td>
											</tr>
										</tbody>
									{% endfor %}

									</table>
								</div>
								{% endif %}
								<div  class="table-responsive">
									<table id="mktlist" class="table table-striped table-info table-dark" cellspacing="0" width="100%">
										<thead>
											<tr>
												{% set Header = [] %}
												
												{%for item in HeaderTable %}
													<th>{{item}}</th>
												{% endfor %}
												
											</tr>
										</thead>
									</table>
								</div>
								</div>
							</div>
						</div>
					</div>

				</div> <!-- / .tl-entry -->				
				<div class="tl-entry left fam-tl-time-entry">
					<div class="tl-time sn-transaction">
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Using History
					</div>
					<div class="tl-icon fam-tl-icon bg-success"><i class="fa fa-certificate"></i></div>
					<div id="summary" class="panel tl-body">
						{% if item['Using'][0]|length>0 %}
						{% set usr = item['Using'][0][0].split('#') %}
						{% else %}
						{% set usr = '' %}
						{% endif %}
						{% if item['Dispose']|length==0 %}
						<h6>Current Owner</h6>
						<div class="well well-sm" style="margin: 10px 0 0 0;">
							<table>
							{% if usr[0] == 'BR' %}
								<tr>
									<td>Branch Name </td>
									<td>&nbsp;: {{usr[1]}}</td>
								</tr>
								<tr>
									<td>Transferring Date </td>
									<td>&nbsp;: {{ item['Using'][0][1] }}</td>
								</tr>
							{% else %}
								<tr>
									<td>User's Name </td>
									<td>&nbsp;: {{usr[0] if usr!='' else 'None'}}</td>
								</tr>
							
								<tr>
									<td>Start Using Date </td>
									<td>&nbsp;: {{item['Using'][0][1] if usr!='' else 'None'}}</td>
								</tr>
							{% endif %}
							</table>
						</div>
						{% endif %}
						{% if item['Using'][1]|length>0 %}
						<h6>Owner History</h6>
						{% for using in item['Using'][1] %}
						
						{% set usr = using[0].split('#') %}
						
						<div class="well well-sm" style="margin: 10px 0 0 0;">
							<table>
								{% if usr[0] == 'BR' %}
									<tr>
										<td>Transfer From </td>
										<td>&nbsp;: {{usr[1]}}</td>
									</tr>
									<tr>
										<td>To </td>
										<td>&nbsp;: {{ using[1] }}</td>
									</tr>
									<tr>
										<td>Transfer in Date </td>
										<td>&nbsp;: {{ using[2] }}</td>
									</tr>
									<tr>
										<td>Transfer out Date </td>
										<td>&nbsp;: {{ using[3] }}</td>
									</tr>
								{% else %}
									<tr>
										<td>User's Name </td>
										<td>&nbsp;: {{using[0]}}</td>
									</tr>
									<tr>
										<td>Start Using Date </td>
										<td>&nbsp;: {{using[1]}}</td>
									</tr>
									<tr>
										<td>Stop Using Date </td>
										<td>&nbsp;: {{using[2]}}</td>
									</tr>
								{% endif %}
															
							</table>
						</div>
						{% endfor %}
						{% endif %}
					</div> <!-- / .tl-body -->
				</div> <!-- / .tl-entry -->

				<div id="summary" class="tl-entry fam-tl-time-entry">
					<div class="tl-time sn-transaction">
						Repair Or Maintenance
					</div>
					<!-- <div class="tl-icon bg-success"><img src="assets/demo/avatars/2.jpg" alt=""></div> -->
					<div class="tl-icon fam-tl-icon bg-warning"><i class="fa fa-wrench"></i></div>
					<div class="panel tl-body">
						{% if item['Repair']|length==0 %}
						<div class="well well-sm" style="margin: 10px 0 0 0;">
							<table>
								<tr>
									<td>Vendor Name </td>
									<td>&nbsp;: None</td>
								</tr>
								<tr>
									<td>Repair Or Maintenance Amount </td>
									<td>&nbsp;: None</td>
								</tr>
								<tr>
									<td>Repair Or Maintenance Date </td>
									<td>&nbsp;: None</td>
								</tr>
							</table>
						</div>
						{% endif %}
						{% for i in item['Repair'] %}
						<div class="well well-sm" style="margin: 10px 0 0 0;">
							<table>
								<tr>
									<td>Vendor Name </td>
									<td>&nbsp;: {{i[0] if i[0]!='' else 'Other'}}</td>
								</tr>
								<tr>
									<td>Repair Or Maintenance Amount </td>
									<td>&nbsp;: {{i[1]}} {{i[2]}}</td>
								</tr>
								<tr>
									<td>Repair Or Maintenance Date </td>
									<td>&nbsp;: {{i[3]}}</td>
								</tr>
							</table>
						</div>
						{% endfor %}
					</div> <!-- / .tl-body -->
				</div> <!-- / .tl-entry -->							
				<div id="summary" class="tl-entry left fam-tl-time-entry">
					<div class="tl-time sn-transaction">
						 &nbsp;&nbsp;&nbsp;&nbsp;Write Off Or Dispose
					</div>
					<div class="tl-icon fam-tl-icon bg-danger"><i class="fa fa-eraser"></i></div>
					<div class="panel tl-body">
						<table>
							<tr>
								<td>Disposal Type </td>
								<td>&nbsp;: {{item['Dispose'][0] if item['Dispose']|length>0 else 'None'}}</td>
							</tr>
							{% if item['Dispose']|length>0 %}
							{% if item['Dispose'][2]|float>0 %}
							<tr>
								<td>Sale Amount</td>
								<td>&nbsp;: {{item['Dispose'][1]}} {{item['Dispose'][2]}}</td>
							</tr>
							{% endif %}
							{% endif %}
							<tr>
								<td>
									{% if item['Dispose']|length>0 %}
										{{ 'Gain Amount' if item['Dispose'][3]|float>0 else 'Loss Amount' }}
									{% else %}
										Loss Or Gain Amount 
									{% endif %}
								</td>
								<td>&nbsp;:
									{% if item['Dispose']|length>0 %}{{item['Dispose'][1]}} {{item['Dispose'][3]}}
									{% else%}
									None
									{% endif %}
								</td>
							</tr>
							
							<tr>
								<td>Dispose Or Write Off Date </td>
								<td>&nbsp;: {{item['Dispose'][4] if item['Dispose']|length>0 else 'None'}}</td>
							</tr>
						</table>	
					</div>
				</div> <!-- / .tl-entry -->				
		</div> <!-- / .timeline -->		
		{% endfor %}
	</div>
{% endblock %}

{% block js %}

{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}

<script type="text/javascript">

	
	$(document).ready(function(e){
		window.localStorage.removeItem('already-click', false);
		
	    if ($('.Wrapper').find('div.timeline').length==0){
	    	$('#notFound').css('display', 'block')
	    }
	    else {
	    	$('#notFound').css('display', 'none')
	    }

	    $('#btnChevron, #btnDepSchedule').click(function(e){
	    	$('.fa-chevron-down').toggleClass('fa-chvron-click');
	    });

	    $('#btnDepSchedule').on("click", function(){
	    	$('#btnChevron').trigger("click");
	    })

	    $('#btnChevron').on("click", function(){
	    	isNotFirstClick = window.localStorage.getItem('already-click');
	    	if (!isNotFirstClick) {
	    		$('#mktlist').dataTable({
		   		"ajax": "/Morakot/DepSchedule/{{AssetID}}?Currency=" + "{{Currency}}",
		   		"columns":[
		   			{"data": "Branch"},
		   			{"data": "InstallmentNo"},
		   			{"data": "StartDate"},
		   			{"data": "EndDate"},
		   			{"data": "BeginBookValue"},
		   			{"data": "Depreciation"},
		   			{"data": "AccumulatedDepreciation"},
		   			{"data": "EndBookValue"}
		   		],
				"lengthMenu": [[15,25,50,100,200, -1], [15,25,50,100,200, "All"]],
				"bSort" : false,
				"bScrollCollapse": true
			});
	    		window.localStorage.setItem('already-click', true);
	    	}
	    });
		  
	});
</script>

{% endblock %}