{% extends "layout.html" %}
from jinja2 import nodes
{% block css %}
    
       <style type="text/css">
        .form-control
        {

            width: 100% !important;
        }

        .se-pre-con1 {
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: #FFF url("{{ url_for('static',filename='images/loading.gif') }}") center no-repeat;
            opacity: 0.4;
            display: none;
        }
        .subtotal{
            font-size:14px;  
            font-weight: bold;
        }
        .grandtotal{
            font-size:14px;  
            font-weight: bold;
        }
        .text-right{
            padding-right: 35px !important;
            } 
        .blank_row{
            height: 30px;
        }
        .mktlink{
            
            color:#1d89cf;
        }
        .mktlink:hover{
            cursor:pointer;
        }
        .close{
            text-align: center !important;

        }
        .dataTables_wrapper .table-footer {
            margin-top: 0px;
            padding-right: 10px;
        }
      /*  .close:hover
        {
            
            background: none repeat scroll 0 0 #ccc !important;
            border-radius: 2px !important;
        }*/

    </style>
{% endblock %}

{% block content %}

{%set DicRow={} %}
{%set HeaderAlign=[]%}
{%for col in RowFormat %}
    {% if col[1] != 'H' %}
        {%if HeaderAlign.append(col[1])%}{%endif%}
    {%endif%}
    {%if DicRow.update({col[0]:col[1]})%}{%endif%}
    {%if col[1]== 'C' %}
        {%if DicRow.update({col[0]:col[1]})%}{%endif%}
    {%endif%}

{%endfor%}
<!--Block gernate filter -->

{% if Criteria %}
<div class="navbar navbar-default navbar-static-top" id="navberCriteria">
    <button type="button" id="Hide" class="close" style="padding-right:10px;">&times;</button>
    <form method="GET" id="frmReport" name="frm" role="form" action="/Morakot/Report/Procedure/{{getID}}">
        <div class="col-sm-6" id="SectionCriteria">
            <table style="margin-top: 8px;">
                {% for item in ReportRow%}
                    {% if item != ''%}
                        <tr style="height:35px;">
                            <td class="col-sm-3">{{item[0]}} : </td>
                                <script type="text/javascript">
                                    init.push(function () {
                                        // Single select
                                        $("#Opr{{item[0]}}").select2({
                                            allowClear: true,
                                            placeholder: "Opr{{item[0]}}"
                                        });
                                    });
                              </script>
                            <td class="col-sm-4">
                                {%if item[1]=='D' %}
                                <input class="input-sm form-control" type="text" placeholder="{{item[0]}}" name="{{item[0]}}" id="{{item[0]}}" value="{{ kwargs[item[0]] }}" >
                                  <script type="text/javascript">
                                    $(document).ready(function() {
                                       
                                         init.push(function () {
                                            var options = {
                                            orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
                                            format:"yyyy-mm-dd",
                                            autoclose:true,
                                            multidate: true,
                                            multidateSeparator:' '
                                            }
                                            $('#{{item[0]}}').datepicker(options);
                                            });
                                    });
                                </script>

                                {%else%}
                                    <input class="input-sm form-control" type="text" placeholder="{{item[0]}}" name="{{item[0]}}" id="{{item[0]}}" value="{{ kwargs[item[0]] }}" >
                                {%endif%}
                            </td>

                        </tr>
                        {% if loop.last%}
                        <tr style="height:50px;">
                            <td class="col-sm-3"></td>
                            <td class="col-sm-3"></td>
                            <td class="col-sm-4" style="text-align: right;">
                                <button type="submit" id="form_submit" class="btn btn-flat btn-labeled btn-primary" style="padding: 7px 25px;" >
                                    Show
                                </button>

                            </td>
                        </tr>
                        {% endif %} <!-- end last loop-->
                    {% endif %}
                {% endfor %}
            </table>
        </div>
    </form>             
</div>
{% endif %}

<!--End Criteria -->


<div class="navbar navbar-default navbar-static-top ActionFotter" id="CriteriaSetting" >
    <div class="col-sm-12">

                <div style="margin-top: 8px;">

                </div> 
                <div class="col-sm-6" style="padding-top:10px; padding-left:0px;">

                    {% from "print.html" import exportButtonLink %}
                    {{exportButtonLink()}}
                    <!-- <div class="btn-group" >
                        <button type="button" class="btn btn-flat btn-primary dropdown-toggle" data-toggle="dropdown" style="width:125px;">
                            &nbsp;Export Table
                        </button>
                        <button type="button" class="btn btn-flat btn-primary" data-toggle="dropdown">
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a id="csv"> <i class='fa fa-files-o'></i> CSV </a></li> 
                            <li><a id="excel"> <i class='fa fa-file-excel-o'></i> Excel </a></li> 
                            <li><a href="javascript:void(0)" id="print"><i class='fa fa-print'></i>&nbsp;Print</a></li>
                        </ul>
                    </div> -->

                </div>
                <a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
                        <span class="btn-label icon fa fa-refresh"></span> Refresh
                    </a>
                  <button  type="button"  class="btn btn-flat btn-labeled btn-success pull-right ActionFotter" id="Show" >
                  <span class="btn-label icon fa fa-gear"></span> Custom </button>
            

    </div> 
           
</div>


<!--  message  -->
<div class="clearfix"></div>
<div class="col-sm-12">
    {% for message in get_flashed_messages() %}
        {% if contain(message, "Error") %}
            <div class="clearfix">&nbsp;</div>
            <div class="alert alert-danger">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                {{ message }}
            </div>
        {% else %}
            <div class="clearfix">&nbsp;</div>
            <div class="alert alert-info">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                {{ message }}
            </div>
        {% endif %}
    {% endfor %}
</div>

{% if ListError %}
    <div class="clearfix"></div>
    <div class="col-sm-12" style="padding-top:5px;">

        <div class="alert alert-danger" id="alert-danger">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <ol>
                {% for message in ListError %}
                <li>
                    <a class="error_pointer">
                        <label for="TableName">
                            {{message[0]}} <span style="color:#d38e99">*:</span>
                        </label>
                    </a> {{message[1]}}
                </li>
                {% endfor %}
            </ol>
            
        </div>
    </div>

{%else%}
    {% if Report %}
        <div class="col-sm-12">
            <h3 class="header-3 text-center">{{ Report.ReportTitile}}</h3>
        </div>
        <!-- show value filter -->
        {% if Criteria %}
            {%if urlRequest%}
            <div class="col-sm-12">
                <table>
                    
                     {% for item in kwargs%}
                        <tr>
                            <td width="150"><strong>{{ item }}</strong></td>
                            <td>: &nbsp;{{ kwargs[item] }}  </td>
                        </tr>
                     {% endfor %}
                </table>          
            </div>
            {% endif %}<!-- end urlRequest-->
        {% endif %} <!-- end Criteria-->
         <!-- end show value filter -->

        <div class="clearfix">&nbsp;</div>
        <div class="panel panel-default">

        <table id="mktlist" class="table table-striped table" cellspacing="0" width="100%">
            <thead>
                <tr>
                    {% for FieldName in HeaderTable %}
                        {% set ColFomat = DicRow.get(FieldName) %}
                        {%if ColFomat =='N'%}
                            <th class="text-right"><b>{{FieldName}}</b></th>

                        {%elif ColFomat=='C'%}
                            <th class="text-right"><b>{{FieldName}}</b></th>
                        {%elif ColFomat =='H'%}
                            {#skip hide row#}
                        {%else%}
                            <th><b>{{FieldName}}</b></th>
                        {%endif%}
                        
                    {% endfor %}
                     
                </tr>
            </thead>
              
            <tbody>
                <!--  Result is the row of tuple-->
                {% for Row in Result %}
                    
                    <tr>
                        {% for ColumnValue in Row%} 
                            {%set FormatType= DicRow.get(HeaderTable[loop.index0])%}
                                {%if FormatType=='C'%}
                                    <td class="text-right">{{ColumnValue}}</td>
                                {%elif FormatType=='N'%}
                                    <td class="text-right">{{ColumnValue}}</td>
                                {%elif FormatType=='H'%}
                                   
                                {%else%}    
                                <td>{{ColumnValue}}</td>
                                {%endif%}

                        
                        {% endfor%}<!--endfor Row-->
                    </tr>

                {% endfor%}<!--endfor Result-->

            </tbody>
        </table>

        {%if pagination%}
            <br>
            <div class="table-footer clearfix">
              <div class="DT-label">
                <div class="dataTables_info" role="alert" aria-live="polite" aria-relevant="all"> Showing {{StartNumRecord}} to {{EndNumRecord}} of {{TotalRecord}} entries
                </div>
              </div>

              <div class="DT-pagination">
              <div class="dataTables_paginate paging_simple_numbers">
                 {{ render_pagination(pagination,urlRequest) }}
              </div>
               
            </div>

            </div> <!--End pagination-->
        {%endif%}

    {% endif %} <!-- Result -->

{% endif %} <!-- ListError -->

{% endblock %}

{% block js %}

{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}

    <script type="text/javascript">
        $(document).ready(function() {

            $("form#frmReports").submit(function(){
                $(".se-pre-con1").show();  
            });

            function fn_fadeIn(){
                var $getParentEle = window.parent.$("#animated")
                $getParentEle.fadeIn("slow");
            }
            $('#mktlist').dataTable({
               "lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
                "bSort" : false,
                "sScrollX": "100%",
                "bScrollCollapse": true

                // "bLengthChange" :false,
            });
             $( "#form_submit").click(function() {
                fn_fadeIn();
            });
            
            // $('#mktlist_filter').hide()
            // $('.table-header').hide()
            $('#users-url').addClass('active');

            $("#Refresh").click(function() {
                fn_fadeIn();
                window.location.reload(true);
            });
            $( "#Hide").click(function() {
                $('#navberCriteria').hide( );
                $('#SectionCriteria').hide( );
                $('#CriteriaSetting').show();
            });
            $( "#Show").click(function() {
                $('#navberCriteria').show();
                $('#SectionCriteria').show();
                $('#CriteriaSetting').hide();
            });

             {% if Criteria %}
                $('#Show').show();
                {%if CriteriaRequired%}
                    $('#navberCriteria').show();
                    $('#SectionCriteria').show();
                    $('#CriteriaSetting').hide();
                    {%if urlRequest%}
                        $('#navberCriteria').hide();
                        $('#CriteriaSetting').show();
                    {%endif%}
                {%else%}
                    $('#navberCriteria').hide();
                    $('#SectionCriteria').hide();
                {%endif%}
            {%else%}
                $('#Show').hide();
            {%endif%}

            {% from "print.html" import exportDataTable %}
                {% if Report%}
                    {{exportDataTable('#mktlist',Report.ReportTitile)}}
                {% endif%}
          

        });
        </script>
    
{% endblock %}


{% macro render_pagination(pagination,urlRequest) %}
<ul class="pagination">
    {% if pagination.has_prev %}
        <li><a href="{{ url_for_other_page(pagination.page - 1)}}?{{urlRequest}}">&laquo; Previous</a></li>
    {% endif %}

    {%- for page in pagination.iter_pages() %}
        {% if page %}
            {% if page != pagination.page %}
                
                <li> <a href="{{ url_for_other_page(page) }}?{{urlRequest}}"> {{ page }} </a> </li>
               
            {% else %}
                <li class="paginate_button active"> <a href=""> {{ page }} </a> </li>
            {% endif %}
            {% else %}
            <li> <span class=ellipsis>…</span></li>
        {% endif %}
    {%- endfor %}

    {% if pagination.has_next %}
      
        <li><a href="{{ url_for_other_page(pagination.page + 1)}}?{{urlRequest}}">Next &raquo;</a></li>
        
    {% endif %}
</ul>
{% endmacro %}