{% extends "layout.html" %}

{% block css %}
<style type="text/css">
.table-borderless td,
.table-borderless th
{
	border: 0 !important;
	padding-top: 3px !important;
	font-size: 14px;
}
th.table-header{
	border-bottom: 2px solid #ccc !important;
}
 h3.header-3{
            color: #888 !important;
            font-size: 16px;
            font-weight: bold;
            margin: 5px 0 10px;
            padding: 10px 18px 0;
        }

        h4.header-4{
            color: #888 !important;
            font-size: 14px;
            font-weight: normal;
            margin: 5px 0 10px;
            padding: 0px 18px 0;
        }
</style>
{% endblock %}

{% block content %}
<form method="GET" id="frm" name="frm" role="form" >
<!-- Modal -->
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" style="display: none;">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
				<h4 class="modal-title" id="myModalLabel">Custom</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label for="LoanClass" class="col-sm-3 control-label"> Loan class from: </label>
					<div class="col-sm-5">
						<select class="form-control" id="LoanClass" name="LoanClass" style="width:100%;">
							<optgroup label="LoanClass">
								{%for row in AssetClass %}
								<option value="{{row.ID}}"> {{row.ID}} - {{row.Description}} </option> 
								{%endfor%}
							 </optgroup>
						</select>
						<script type="text/javascript">
							init.push(function () {
								// Single select
								$("#LoanClass").val('{{ LoanClass }}');
								$("#LoanClass").select2({
									allowClear: true,
									placeholder: "Loan Class"
								});

							});
						</script>
					</div>
				</div>	
				

			</div> <!-- / .modal-body -->
			<div class="modal-footer">
				
				<button type="submit" class="btn btn-primary">{{ getLanguage('Apply') }}</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">{{ getLanguage('Cancel') }}</button>
			</div>
		</div> <!-- / .modal-content -->
	</div> <!-- / .modal-dialog -->
</div> <!-- /.modal -->
<!-- / Modal -->
</form>
	
	<div class="navbar navbar-default navbar-static-top">
		<div class="col-sm-6" style="margin-top: 15px;">
			<!-- Button Export -->
			{% from "print.html" import exportButtonLink %}
			{{exportButtonLink()}}
		</div>
		<div class="col-sm-6" style="margin-top: 8px;">
			<a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
				<span class="btn-label icon fa fa-refresh"></span> Refresh
			</a>
			<button  type="button" data-toggle="modal" data-target="#myModal"  class="btn btn-flat btn-labeled btn-success pull-right" >
				<span class="btn-label icon fa fa-gear" ></span> Custom 
			</button>
		</div>
	</div>
	<!--  message  -->
	<div class="clearfix"></div>
	<div class="col-sm-12">
		{% for message in get_flashed_messages() %}
			{% if contain(message, "Error") %}
				<div class="clearfix">&nbsp;</div>
				<div class="alert alert-danger">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
			{% else %}
				<div class="clearfix">&nbsp;</div>
				<div class="alert alert-info">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
			{% endif %}
		{% endfor %}
	</div>

	<div style="margin-left:10%; margin-right:10%;">
		<h3 class="header-3 text-center">{{ Result['Company'] }}</h3>
		<h4 class="header-4 text-center">Branch Productivity Reports</h4>
		<h4 class="header-4 text-center"><strong>As of:</strong> {{ Result['BankDate'] }}</h4>
		<h4 class="header-4 text-center"><strong>Currency:</strong> {{ Result['BaseCurrency'] }}</h4>
	</div>
	<div class="clearfix">&nbsp;</div>
	<!-- DataTable -->
	<div class="col-sm-12">
		<div class="panel panel-default" style="border: 0px;">
			<tr>
				<td width="150"><strong>Loan class from</strong></td>
				<td>: &nbsp;{{LoanClass}} - {{ AssetClass.filter_by(ID=LoanClass).first().Description }}  </td>
			</tr>
		</div>
		<div class="clearfix" style="height: 5px;">&nbsp;</div>
		<table id="mktlist" class="table table-striped table-borderless" cellspacing="0" width="100%">
			<thead>
				<tr>
					<th class="table-header text-left">Branch Code</th>
					<th class="table-header text-left">Branch Name</th>
					<th class="table-header text-center"># of Borrower</th>
					<th class="table-header text-center"># of Loan</th>
					<th class="table-header text-center">Loan Portfolio</th>
					<th class="table-header text-center">PAR Amount</th>
					<th class="table-header text-center">PAR %</th>
					<th class="table-header text-center"># of Loan in Arrear</th>
					<th class="table-header text-center">Loan Amount in Arrear</th>
					<th class="table-header text-center">% of Arrear</th>
				</tr>
			</thead>
			<tbody>
			{% for branch in Branch.all() %}
			{% set result = Result['Result'][branch.ID] %}
				<tr>
					<td class="text-left">{{result['BranchID']}}</td>
					<td class="text-left">{{result['BranchName']}}</td>
					<td class="text-right">{{result['#OfBorrower']}}</td>
					<td class="text-right">{{result['#OfLoan']}}</td>
					<td class="text-right">{{result['LoanPortfolio']}}</td>
					<td class="text-right">{{result['PARAmount']}}</td>
					<td class="text-right">{{result['PAR%']}} %</td>
					<td class="text-right">{{result['#OfLoanInArrear']}}</td>
					<td class="text-right">{{result['LoanAmountInArrear']}}</td>
					<td class="text-right">{{result['%OfArrear']}} %</td>
				</tr>
			{% endfor %}
			</tbody>
			<tfoot>
			{% set result = Result['Total']%}
				<tr>
					<td><b>Total</b></td>
					<td></td>
					<td class="text-right"><b>{{result['#OfBorrower']}}</b></td>
					<td class="text-right"><b>{{result['#OfLoan']}}</b></td>
					<td class="text-right"><b>{{result['LoanPortfolio']}}</b></td>
					<td class="text-right"><b>{{result['PARAmount']}}</b></td>
					<td class="text-right"><b>{{result['PAR%']}} %</b></td>
					<td class="text-right"><b>{{result['#OfLoanInArrear']}}</b></td>
					<td class="text-right"><b>{{result['LoanAmountInArrear']}}</b></td>
					<td class="text-right"><b>{{result['%OfArrear']}} %</b></td>
				</tr>
			</tfoot>
		</table>
	<br>
	</div>
	<!-- Note -->
	<div class="col-sm-12">
		<table>
		<h5><strong><u>Note:</u></strong></h5>
			<tbody>
				<tr>
					<p><b>Loan Portfolio</b>, <b>PAR Amount</b>, and <b>Loan Amount in Arrear</b> are converted to base currency <b>{{ Result['BaseCurrency'] }}</b>.</p>
				</tr>
				<tr>
					<th width="250"># of Borrower:</th>
					<td>Total number borrowers of Credit Officer.</td>
				</tr>
				<tr>
					<th># of Loan:</th>
					<td>Total disbursed loans in branch.</td>
				</tr>
				<tr>
					<th>Loan Portfolio:</th>
					<td>Total outstanding amount of disbursed loans in branch.</td>
				</tr>
				<tr>
					<th>PAR Amount:</th>
					<td>(<b>PAR</b>: <b>P</b>ortfolio <b>A</b>t <b>R</b>isk) Total outstanding amount of all loans in arrear in branch.</td>
				</tr>
				<tr>
					<th>PAR %:</th>
					<td>PAR Amount as percentage comparing to Loan Portfolio.</td>
				</tr>
				<tr>
					<th>Loan Amount in arrear:</th>
					<td>Sum of Total Principal Due and Interest Due.</td>
				</tr>
				<tr>
					<th># of Loan in Arrear:</th>
					<td>Number of Loan Arrear in branch.</td>
				</tr>
				<tr>
					<th>% of Arrear</th>
					<td>Loan Amount in Arrear as percentage comparing to Loan Portfolio.</td>
				</tr>
			</tbody>
		</table>
	</div>

{% endblock %}

{% block js %}
	{% from "print.html" import exportIncludeJS %}
	{{exportIncludeJS()}}

    <script type="text/javascript">
        //Search dataTable
        $(document).ready(function() {
	        $('#mktlist').dataTable({
	            "lengthMenu"    : [[25,50,100,200, -1], [25,50,100,200, "All"]],
	            "bSort"         : true,
	            "pageLength"    : 25
	        });
	        $("#Refresh").click(function() {
	            fn_fadeIn();
	            window.location.reload(true);
	        });
	        {% from "print.html" import exportDataTable %}
            {{exportDataTable('#mktlist','Branch Productivity')}}
	    });
    </script>
{% endblock %}
