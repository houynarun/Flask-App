{% extends "layout.html" %}

{% block css %}
<style type="text/css">


	h4.header-4{
		color: #888 !important;
		font-size: 14px;
		font-weight: normal;
		margin: 5px 0 10px;
		padding: 0px 18px 0;
	}
</style>
{% endblock %}

{% block content %}

<form method="GET" id="frm" name="frm" role="form" >
<!-- Modal -->
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" style="display: none;">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
				<h4 class="modal-title" id="myModalLabel">Custom</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label for="Branch" class="col-sm-3 control-label">
						{{ getLanguage('Branch') }}
					</label>
					<div class="col-sm-5">
						<input class="input-sm form-control" type="text" value="{{ Branch }}" placeholder="{{ getLanguage('Branch') }}" name="Branch" id="Branch"  style="width:100%;">
					</div>
				</div>
				<div class="form-group">
					<label for="StartDate" class="col-sm-3 control-label">
						{{ getLanguage('Start Date') }}
						<span style="color:#d38e99">*</span>
					</label>
					<div class="col-sm-5">
						<input class="input-sm form-control" type="text" value="{{ StartDate }}" placeholder="{{ getLanguage('Start Date') }}" name="StartDate" id="StartDate"  style="width:100%;">
					</div>
				</div>

				<div class="form-group">
					<label for="EndDate" class="col-sm-3 control-label">
						{{ getLanguage('End Date') }}
						<span style="color:#d38e99">*</span>
					</label>
					<div class="col-sm-5">
						<input class="input-sm form-control" type="text" value="{{ EndDate }}" placeholder="{{ getLanguage('End Date') }}" name="EndDate" id="EndDate" style="width:100%;" >
					</div>
				</div>
				<script type="text/javascript">

					init.push(function () {
						var options = {
						orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
						format:"yyyy-mm-dd",
						autoclose:true
						}
						$('#StartDate').datepicker(options);
					});

					init.push(function () {
						var options = {
						orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
						format:"yyyy-mm-dd",
						autoclose:true
						}
						$('#EndDate').datepicker(options);
					});
				</script>

			</div> <!-- / .modal-body -->
			<div class="modal-footer">
				
				<button type="submit" class="btn btn-primary">{{ getLanguage('Apply') }}</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">{{ getLanguage('Cancel') }}</button>
			</div>
		</div> <!-- / .modal-content -->
	</div> <!-- / .modal-dialog -->
</div> <!-- /.modal -->
<!-- / Modal -->
</form>
<div class="navbar navbar-default navbar-static-top" id="CriteriaSetting" >
	<div class="col-sm-12">

		<div style="margin-top: 8px;">

		</div> 
		<div class="col-sm-6" style="padding-top:10px; padding-left:0px;">

			{% from "print.html" import exportButtonLink %}
			{{exportButtonLink()}}

		</div>

		<button  type="button" data-toggle="modal" data-target="#myModal"  class="btn btn-flat btn-labeled btn-success pull-right" >
		<span class="btn-label icon fa fa-gear" ></span> Custom </button>
	</div> 
</div>
{% if ListError %}
<div class="clearfix"></div>
<div class="col-sm-12" style="padding-top:5px;">

	<div class="alert alert-danger" id="alert-danger">
		<button type="button" class="close" data-dismiss="alert">&times;</button>
		<ol>
			{% for message in ListError %}
			<li id="lblTableName">
				<a class="error_pointer" >
					<label for="TableName" style="width:15%;">
						{{message[0]}} <span style="color:#d38e99;">*	</span>
					</label>
				</a> 

				: {{message[1]}}
			</li>		
			{% endfor %}
		</ol>
		
	</div>
</div>
{% endif %}

<!--  message  -->
<div class="clearfix">&nbsp;</div>
{% include 'msg_error.html' %}

<div class="col-sm-12">
	<h3 class="header-3 text-center">Loan Collection Report</h3>
</div>

<div class="col-sm-12">
    <table>
	    <tr>
	        <td width="150"><strong>Branch</strong></td>
	        <td>: &nbsp;{{ Branch }}  </td>
	    </tr>
	    <tr>
	        <td width="150"><strong>Start Date</strong></td>
	        <td>: &nbsp;{{ StartDate }}  </td>
	    </tr>
	    <tr>
	        <td width="150"><strong>End Date</strong></td>
	        <td>: &nbsp;{{ EndDate }}  </td>
	    </tr>
    </table>
</div>


<div class="clearfix">&nbsp;</div>
<div class="col-sm-12">
<table id="mktlist" class="table table-striped table" cellspacing="0" width="100%">
	<thead>
		<tr>
			<th>Customer ID</th>
			<th>Customer Name</th>
			<th>Draw Down Account</th>
			<th>Loan Contract ID</th>
			<th>Transaction Date</th>
			<th class="text-right">Deposit Amount</th>
			<th class="text-right">Principal</th>
			<th class="text-right">Interest</th>
			<th class="text-right">Penalty</th>
			<th class="text-right">Charge</th>
			<th class="text-right">Total</th>
			<th>Collected By</th>
			<th>Note</th>
			<th>CO Code</th>
			<th>CO Name</th>
			<th>User</th>
		</tr>
	</thead>
	<tbody>
		{%set DicTotal={} %}
		{% for col in CurrencyObj%}
			{% for row in AccEntryObj %}
				{% if row.Account + row.LoanID + col.ID in Result %}

					{%set dict = Result[row.Account + row.LoanID + col.ID]%}

					{%set DepositAmt= dict.DepositAmt%}
					{%set Principal = dict.Principal %}
					{%set Interest 	= dict.Interest %}
					{%set Penalty 	= dict.Penalty %}
					{%set Charge 	= dict.Charge %}
					{%set Total 	= Principal+Interest+Penalty+Charge %}

					<!-- Code is sum to create total record in last row -->
					{%if DicTotal.update({'DepositAmt'+col.ID : DicTotal.get('DepositAmt'+col.ID,0)+DepositAmt})%}{%endif%}
					{%if DicTotal.update({'Principal'+col.ID : DicTotal.get('Principal'+col.ID,0)+Principal})%}{%endif%}
					{%if DicTotal.update({'Interest'+col.ID:DicTotal.get('Interest'+col.ID,0)+Interest})%}{%endif%}
					{%if DicTotal.update({'Penalty'+col.ID:DicTotal.get('Penalty'+col.ID,0)+Penalty})%}{%endif%}
					{%if DicTotal.update({'Charge'+col.ID:DicTotal.get('Charge'+col.ID,0)+Charge})%}{%endif%}
					{%if DicTotal.update({'Total'+col.ID:DicTotal.get('Total'+col.ID,0)+Total})%}{%endif%}

					<tr>
						<td>{{dict.CustomerID}}</td>
						<td>{{dict.CustomerName}}</td>
						<td>{{dict.DrawDownAccount}}</td>
						<td>{{dict.LoanContractID}}</td>
						<td>{{dict.TranDate}}</td>
						<td class="text-right">{{toMoney(dict.DepositAmt, getCurrencyObj(col.ID))}}</td>
						<td class="text-right">{{toMoney(dict.Principal, getCurrencyObj(col.ID))}}</td>
						<td class="text-right">{{toMoney(dict.Interest, getCurrencyObj(col.ID))}}</td>
						<td class="text-right">{{toMoney(dict.Penalty, getCurrencyObj(col.ID))}}</td>
						<td class="text-right">{{toMoney(dict.Charge, getCurrencyObj(col.ID))}}</td>
						<td class="text-right">{{toMoney(dict.Total, getCurrencyObj(col.ID))}}</td>
						<td>{{dict.CollectedBy}}</td>
						<td>{{dict.Note}}</td>
						<td>{{dict.COCode}}</td>
						<td>{{dict.COName}}</td>
						<td>{{dict.User}}</td>
					</tr>
				{%endif%}
			{%endfor%}
			<tr style="font-weight: bold;">
				<td>Total {{col.ID}}</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td class="text-right">{{toMoney(DicTotal.get('DepositAmt'+col.ID,0), getCurrencyObj(col.ID))}}</td>
				<td class="text-right">{{toMoney(DicTotal.get('Principal'+col.ID,0), getCurrencyObj(col.ID))}}</td>
				<td class="text-right">{{toMoney(DicTotal.get('Interest'+col.ID,0), getCurrencyObj(col.ID))}}</td>
				<td class="text-right">{{toMoney(DicTotal.get('Penalty'+col.ID,0), getCurrencyObj(col.ID))}}</td>
				<td class="text-right">{{toMoney(DicTotal.get('Charge'+col.ID,0), getCurrencyObj(col.ID))}}</td>
				<td class="text-right">{{toMoney(DicTotal.get('Total'+col.ID,0), getCurrencyObj(col.ID))}}</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
		{%endfor%}
	</tbody>
	<tfoot>
		
	</tfoot>
	
</table>
</div>


{% endblock %}

{% block js %}


{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}

<script type="text/javascript">

	$(document).ready(function() {
		$('#mktlist').dataTable({
			"lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
			"bSort" : false,
			"bScrollCollapse": true
		});
		{% from "print.html" import exportDataTable %}
		{{exportDataTable("#mktlist","Daily Cash Collection Reports ")}}
		
	});

</script>
{% endblock %}