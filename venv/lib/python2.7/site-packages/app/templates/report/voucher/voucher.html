{% extends "layout.html" %}

{% macro fillin(value,lang='kh') -%}
	{% if value %}
		{% if lang=='kh'%}
			<span class="fillin">{{value}}</span>
		{% else %}
			<span class="fillinen">{{value}}</span>
		{% endif %}
	{% endif %}
	{% if not value or value == " " %}
		{{createDotted(20)}}
	{% endif %}
{%- endmacro %}

{% macro createDotted(n=24) %}
{#	<span class="fillin" style="font-weight:normal;">{{'&nbsp;'*n}}</span> #}
<span style="font-weight:normal;">{{'.'*n}}</span>
{%- endmacro %}

{% macro dotted(n=100) -%}
{{'.'*n}}
{%- endmacro %}

{% macro fillFooterData(data) %}
	{% if ShowFooterData == "Yes" and data != "" %}
		{{fillin(data)}}
	{% else %}
		{{createDotted(20)}}
	{% endif %}
{% endmacro%}

{% block css %}
<style type="text/css">
	 h3.header-3{
			color: #888 !important;
			font-size: 16px;
			font-weight: bold;
			margin: 5px 0 10px;
			padding: 10px 18px 0;
		}

	h4.header-4{
			color: #888 !important;
			font-size: 14px;
			font-weight: normal;
			margin: 5px 0 10px;
			padding: 0px 18px 0;
		}
	.footer-opt {
		margin-top:3px;
	}
</style>
<style type="text/css" media="print">
	body{
		font-size: 9px;
	}
	.title {
		font-size: 13px;
		font-weight: bold;
	}

	.fillin {
	  position: relative;
	}

/*    .fillin:before{
	  content: '{{dotted(500)}}';
	  display: block;
	  position: absolute;
	  top: -3px;
	  left: 0; right: 0;
	  overflow: hidden;
	  width:100%;
	}*/
	.fillinen {
		border-bottom: 2px dotted #888;
		display: inline-block;
		font-weight: bold;
		font-family: "Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
		line-height: 12px;
	}
</style>
{% endblock %}


{% block content %}

	{%if ErrorMsg %}
		<div class="col-xs-12" style="padding-top:5px;">
			<div class="alert alert-danger">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			{%for message in ErrorMsg %}
				{{ message }}
			{%endfor%}
			</div>
		</div>
	{%else%}
		<div class="navbar navbar-default navbar-static-top">
			<form method="GET" id="frm" name="frm" role="form" action="">
				<div class="col-xs-8">
					<div style="margin-top: 8px;">
						<div class="col-xs-4" style="padding-left: 0;">
							<input type="text" name="ID" class="form-control" value="{{ ID }}" style="width: 100%;" placeholder="Record ID *">
						</div>
						<label class="col-xs-1" style="padding:0px;">
							<button type="submit" class="btn btn-flat btn-labeled btn-primary" style="padding: 7px 25px;">
								{{ getLanguage('Show') }}
							</button>
						</label>
					</div>
				</div>
				<div class="col-xs-4" style="margin-top: 8px;">
					<div class="pull-right">
						<button type="button" 
									class="btn btn-flat btn-labeled btn-success" 
									data-toggle="modal" data-target="#getCustomRange">
							<span class="btn-label icon fa fa-gear"></span> Custom
						</button>
						{% from "print.html" import exportButton %}
						{{ exportButton() }}
					</div>
				</div>
			</form>
		</div>

		<div class="modal fade" id="getCustomRange" tabindex="-1" 
			role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="Yes">
			<div class="modal-dialog">
				<div class="modal-content">
					<form class="form-horizontal" action="/Morakot/Voucher" method="GET">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="Yes">&times;</span></button>
							<h4 class="modal-title" id="exampleModalLabel">Custom View</h4>
						</div>
						<div class="modal-body">
							<input type="hidden" name="ID" value="{{ID}}">
							<!-- Show Voucher Type -->
							<div class="form-group">
								<label for="VoucherType" class="col-xs-4 control-label">Voucher Type:</label>
								<div class="col-xs-6">
									<select class="form-control input-xs" name="VoucherType" style="width: 100%;" id="VoucherType">
										{% for row in VoucherTypeObj %}
											<option value="{{row.ID}}"> {{row.Description}}</option>
										{% endfor %}
									</select>
									<script type="text/javascript">
										init.push(function () {
											// Single select
											$("#VoucherType").select2({
												allowClear: Yes,
												placeholder: "Voucher Type"
											});
											$('#VoucherType').val('{{VoucherType}}');
										});
									</script>
								</div>
							</div>
							<!--End Show Voucher Type -->
							<!-- Show GL ID -->
							<div class="form-group">
								<label for="ShowGLID" class="col-xs-4 control-label">Show GL ID:</label>
								<div class="col-xs-6">
									<select class="form-control input-xs" name="ShowGLID" style="width: 100%;" id="ShowGLID">
										{% if ShowGLID == 'Yes' %}
											<option value="Yes" selected>Yes</option>
											<option value="No" >No</option>
										{% else %}
											<option value="Yes">Yes</option>
											<option value="No" selected>No</option>
										{% endif %}
									</select>
									<script type="text/javascript">
										init.push(function () {
											// Single select
											$("#ShowGLID").select2({
												allowClear: Yes,
												placeholder: "Show GL ID"
											});
										});
									</script>
								</div>
							</div>
							<!-- End Show GL ID -->

							<!-- Show Header Options -->
							<div class="form-group">
								<label for="ShowPrintedBy" class="col-xs-4 control-label">Header Options:</label>
								<div class="col-xs-6">
									<div class="checkbox" style="margin: 0;">
										<!-- Show Logo -->
										<label>
											{% if ShowLogo =='Yes' %}
												<input type="checkbox" value="Yes" class="px" name="ShowLogo" checked>
											{% else %}
												<input type="checkbox" value="Yes" class="px" name="ShowLogo">
											{% endif %}
											<span class="lbl">Show Logo</span>
										</label>
									</div>
								</div>
							</div>

							<!-- Show Footer Options -->
							<div class="form-group">
								<label for="ShowPrintedBy" class="col-xs-4 control-label">Footer Options:</label>
								<div class="col-xs-6">
									<div class="checkbox" style="margin: 0;">
										<!-- Show Printed by -->
										<label class="footer-opt">
											{% if ShowPrintedBy =='Yes' %}
												<input type="checkbox" value="Yes" class="px" name="ShowPrintedBy" checked>
											{% else %}
												<input type="checkbox" value="Yes" class="px" name="ShowPrintedBy">
											{% endif %}
											<span class="lbl">Show Printed by</span>
										</label>
										<!-- Show Reviewed by -->
										<label class="footer-opt">
											{% if ShowReviewedBy =='Yes' %}
												<input type="checkbox" value="Yes" class="px" name="ShowReviewedBy" checked>
											{% else %}
												<input type="checkbox" value="Yes" class="px" name="ShowReviewedBy">
											{% endif %}
											<span class="lbl">Show Reviewed by</span>
										</label>
										<!-- Show Received by -->
										<label class="footer-opt">
											{% if ShowReceivedBy =='Yes' %}
												<input type="checkbox" value="Yes" class="px" name="ShowReceivedBy" checked>
											{% else %}
												<input type="checkbox" value="Yes" class="px" name="ShowReceivedBy">
											{% endif %}
											<span class="lbl">Show Received by</span>
										</label>
										<!-- Show Footer Data -->
										<label class="footer-opt">
											{% if ShowFooterData =='Yes' %}
												<input type="checkbox" value="Yes" class="px" name="ShowFooterData" checked>
											{% else %}
												<input type="checkbox" value="Yes" class="px" name="ShowFooterData">
											{% endif %}
											<span class="lbl">Show Footer Data</span>
										</label>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-primary" id="Apply">Apply</button>
							<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!--  message  -->
		<div class="col-xs-12">
			{% for message in get_flashed_messages() %}
				{% if contain(message,"Error") %}
					<div class="alert alert-danger">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message[6:]}}
				</div>
				{% elif contain(message,"Warning") %}
					<div class="alert alert-warning">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message[8:] }}
				</div>
				{% else %}
					<div class="alert alert-info">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
				{% endif %}
			{% endfor %}
		</div>
		<!-- end message -->

		<!--Result Table-->
		{% if DicResult.Result %}
			<div class="col-xs-12">
				<h3 class="header-3 text-center">Voucher Report</h3>
				{% if ShowLogo=='Yes' %}
					<img src="/static/company/logo.png" style="position: absolute; top: 5px;width:136px;height: 40px;">
				{% endif %}
			</div>

			<div class="col-xs-12">&nbsp;</div>
			<div class="col-xs-12">&nbsp;</div>
			<div class="col-xs-12" style="padding:20px 10px">
				<div class="col-xs-6">
					<table>
						<tr>
							<td width="150"><strong>Branch: </strong></td>
							<td>: &nbsp {{DicResult.Branch}}</td>
						</tr>
						<tr>
							<td width="150"><strong>Date: </strong></td>
							<td>: &nbsp {{DicResult.Date}}</td>
						</tr>
						<tr>
						{% if VoucherType %}
							<td width="150"><strong>Voucher Type: </strong></td>
							<td>: &nbsp {{VoucherTypeObj.get(VoucherType).Description}}</td>
						</tr>
						{%endif%}
					</table>
				</div>
				<div class="col-xs-6" style="padding-right: 20px;">
					<table style="float: right;">
						{%if not('SF' in ID or 'BF' in ID)%}
						<tr>
							<td width="150"><strong>{{ getLanguage('Currency') }}</strong></td>
							<td>: &nbsp {{DicResult.Currency}}</td>
						</tr>
						{%endif%}
						<tr>
							<td width="150"><strong>{{ getLanguage('Reference') }}</strong></td>
							<td>: &nbsp {{DicResult.Reference}} </td>
						</tr>	
					</table>
				</div>
			</div>

			<div class="clearfix">&nbsp;</div>
			<div class="col-xs-12">
				<table id="mktlist" class="table table-striped table" cellspacing="0" width="100%">
					<thead>
						<tr>
							{% if ShowGLID == 'Yes' %}
								<th>GL ID</th>
							{% endif %}
							<th>Category ID</th>
							<th>Category</th>
							{% if ID[:2] in ['FD','FW','FA','FT','FS','DP','WD','TT','IP','EP','CB','CC','WB','WC'] %}
								<th>Account</th>
							{% endif %}
							{% if 'SF' in ID or 'BF' in ID%}
								<th>Currency</th>
							{%endif%}
							<th class="text-right">Debit</th>
							<th class="text-right">Credit</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody>
							{%set TotalAmount 	={'Debit':0,'Credit':0}%}
							{%for row in DicResult.Result%}
								{%set DrAmount = row.DrAmount %}
								{%set CrAmount = row.CrAmount %}
								{%set Currency = row.Currency%}

								<tr>
									{% if ShowGLID == 'Yes' %}
										<td>{{row.GLID}}</td>
									{% endif %}
									<td>{{row.CategoryID}}</td>
									<td>{{row.CategoryName}}</td>
									{% if ID[:2] in ['FD','FW','FA','FT','FS','DP','WD','TT','IP','EP','CB','CC','WB','WC'] %}
										<td>{{row.get('Account', '')}}</td>
									{% endif %}
									{% if 'SF' in ID or 'BF' in ID%}
									<td>{{Currency}}</td>
									{%endif%}
									<td class="text-right">
										{%if DrAmount != 0 %}
											{{toMoney(float(DrAmount),CurrencyObj.get(Currency))}}
										{%endif%}
									</td>
									<td class="text-right">
										{%if CrAmount != 0 %}
										{{toMoney(float(CrAmount),CurrencyObj.get(Currency))}}
										{%endif%}
									</td>
									<td>{{row.Description}}</td>
								</tr>
							{%endfor%}
							<tr>
								{% if ShowGLID =='Yes' %}
									<td></td>
								{% endif %}
								<td></td>
								{% if 'SF' in ID or 'BF' in ID%}
									<td></td>
								{%endif%}
								<td><b>Total Amount</b></td>
								{% if ID[:2] in ['FD','FW','FA','FT','FS','DP','WD','TT','IP','EP','CB','CC','WB','WC'] %}
									<td></td>
								{% endif %}
								<td class="text-right"><b>{{DicResult.TotalDebit}}</b></td>
								<td class="text-right"><b>{{DicResult.TotalCredit}}</b></td>
								<td></td>
							</tr>
						
					</tbody>
				</table>
			</div>

			<!-- Footer -->
			<div class="clearfix">&nbsp;</div>
			<div class="col-xs-12">
				<table width="100%">
					<tr>
						{% if ShowPrintedBy == 'Yes' %}
							<td>
								<table>
									<tr>
										<td class="" ><strong>Printed By</strong></td>
									</tr>
									<tr>
										<td style="padding-top: 100px"><strong>Name: {{ fillFooterData(PrintBy) }} </strong></td>
									</tr>
									<tr>
										<td style="padding-top: 10px"><strong>Date: {{ fillFooterData(PrintDate) }}</strong></td>
									</tr>
								</table>
							</td>
						{% endif %}
						<td>
							<table>
								<tr>
									<td class="" ><strong>Prepared by</strong></td>
								</tr>
								<tr>
									<td style="padding-top: 100px"><strong>Name: {{ fillFooterData(DicResult.Inputter) }} </strong></td>
								</tr>
								<tr>
									<td style="padding-top: 10px"><strong>Date: {{ fillFooterData(DicResult.Createdon) }}</strong></td>
								</tr>
							</table>
						</td>
						{% if ShowReviewedBy == 'Yes' %}
							<td>
								<table>
									<tr>
										<td class="" ><strong>Reviewed By</strong></td>
									</tr>
									<tr>
										<td style="padding-top: 100px"><strong>Name: {{ fillFooterData("") }} </strong></td>
									</tr>
									<tr>
										<td style="padding-top: 10px"><strong>Date: {{ fillFooterData("") }}</strong></td>
									</tr>
								</table>
							</td>
						{% endif %}
						<td>
							<table>
								<tr>
									<td class="" ><strong>Approved By</strong></td>
								</tr>
								<tr>
									<td style="padding-top: 100px"><strong>Name: {{ fillFooterData(DicResult.Authorizer) }} </strong></td>
								</tr>
								<tr>
									<td style="padding-top: 10px"><strong>Date: {{ fillFooterData(DicResult.Authorizeon) }}</strong></td>
								</tr>
							</table>
						</td>
						{% if ShowReceivedBy == 'Yes' %}
							<td>
								<table>
									<tr>
										<td class="" ><strong>Received By</strong></td>
									</tr>
									<tr>
										<td style="padding-top: 100px"><strong>Name: {{ fillFooterData("") }} </strong></td>
									</tr>
									<tr>
										<td style="padding-top: 10px"><strong>Date: {{ fillFooterData("") }}</strong></td>
									</tr>
								</table>
							</td>
						{% endif %}
					</tr>
				</table>
			</div>

		{% endif %}
	{%endif%}

{% endblock %}


{% block js %}

{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}

<script type="text/javascript">

	$(document).ready(function() {
		$('#mktlist').dataTable({
			"lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
			"bSort" : false
		});
		{% from "print.html" import exportDataTable %}
		{{exportDataTable("#mktlist","Voucher Report")}}
		//Set Default Value to criteria 
		$('#VoucherType').val('{{VoucherType}}');
	});

</script>
{% endblock %}
