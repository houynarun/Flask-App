{% extends "layout.html" %}

{% block css %}
<style type="text/css">

	.se-pre-con1 {

		position: fixed;
		left: 0px;
		top: 0px;
		width: 100%;
		height: 100%;
		z-index: 9999;
		background: #FFF url("{{ url_for('static',filename='images/loading.gif') }}") center no-repeat;
		opacity: 0.4;
		display: none;
	}
	.modal-dialog{

		width: 300px !important;

	}
	a{
		cursor: pointer;
	}
	</style>
{% endblock %}

{% block content %}

<!--  message  -->
<div class="clearfix"></div>
<div class="col-sm-12">
	{% for message in get_flashed_messages() %}
		{% if contain(message, "Error") %}
			<div class="clearfix">&nbsp;</div>
			<div class="alert alert-danger">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				{{ message }}
			</div>
		{% else %}
			<div class="clearfix">&nbsp;</div>
			<div class="alert alert-info">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				{{ message }}
			</div>
		{% endif %}
	{% endfor %}
</div>

<div class="col-sm-12" style="padding-top:5px;">
	<div class="panel {{'panel-danger' if 'Critical' in Obj.Level else 'panel-warning'}}">
		<div class="panel-heading" style="height:50px;">
			<span class="panel-title"><i class="panel-title-icon fa fa-bullhorn"></i> 
				{{Obj.Level}} : {{Obj.Title}} - {{Branch}}  <span class="badge {{'badge-danger' if 'Critical' in Obj.Level else 'badge-warning'}}"> {{Total if Obj else 0}}</span>
			</span>
			<div class="panel-heading-controls" >
				<!-- <div class="panel-heading-icon"style="padding-top:0px;" >
					<a title='Refresh' class="link" ><i id='RefreshSystemHealthCheckDetail' class='fa fa-refresh'></i></a>
				</div> -->
				{% if Obj.Suggestion == "Y" %}
					<div class="panel-heading-icon" style="padding-top:2px;" >
						<span><a onclick='getDetailMessage("{{CategoryObject}}","{{Branch}}" , "{{Obj.ItemName}}");'>Suggestion</a></span>
					</div>
				{% endif %}
				<input type="hidden" name="" id="Code" value="{{Obj.Code}}">
			</div>
		</div>
		<div class="panel-body" >
			
			<h4>We founded <span style="color: {{ 'red' if 'Critical' in Obj.Level else 'yellow'}}">{{Total}}
			</span> errors '{{Obj.Title}}' in branch {{Branch}}.</h4>

			<div>
				{% set CategoryObject = [] %}
				{% for key in ErrorDetail%}
					{% if key != 'Total'%}
						{% set Currency = key%}
							<i class="fa fa-square" style="font-size: 8px"></i>&nbsp;&nbsp; <span> {{Currency}} {{ErrorDetail.get(Currency,'').get('DiffAmount','')}} </span>: <span style="color: {{ 'red' if 'Critical' in Obj.Level else 'yellow'}}">{{ErrorDetail[Currency]['Total']}}
							</span>
							{% if CategoryObject.append(Currency) %}{% endif %}
							 
						<ul>
						{% set details = ErrorDetail[Currency]['Message'] %} 
							{%for detail in details%} 
								<li>{{detail}}</li>
							{%endfor%}
						</ul>						
					{%endif%}					
				{% endfor %}
				
			</div>
		</div> <!-- panel-body -->
	</div> <!-- panel panel-info -->
</div> <!-- col-sm-12 -->

<div class="col-sm-12" style="padding-top:5px;">
	<div class=" {{'panel-danger' if 'Critical' in Obj.Level else 'panel-warning'}}" id="Panha">
		<div class="panel-body" >
			<ul id="list">
				
			</ul>
		</div> <!-- panel-body -->
	</div> <!-- panel panel-info -->
</div> <!-- col-sm-12 -->
{% endblock %}

{% block js %}

<script type="text/javascript">

	$(document).ready(function() {
		$("#RefreshSystemHealthCheckDetail").click(function(){
			$("#RefreshSystemHealthCheckDetail").addClass("fa-spin");
			fn_fadeIn();
			window.location.reload(true);
			
		});
	});

</script>

<!-- <script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script> -->

<script type="text/javascript">
	$(document).ready(function() {
		$('#mktlist').dataTable({
		"lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
		"bSort" : false
		});
		$('#mktlist_filter').hide()
		$('.table-header').hide()
		$("#SpinOnClick").click(function(){
			$("#iConSpin").addClass("fa-spin");
			window.location.reload(true);
			
		});
	});
</script>
<script type="text/javascript">
	function getDetailMessage(Category,Branch,ItemName){
		fn_fadeIn();
		$.ajax({
				url : '/Morakot/SystemHealthSuggestion/?Category='+Category+"&Branch="+Branch+"&ItemName="+ItemName,
				method : 'GET',
				success : function(response) {
					
					
					if (response.Status == "True"){
	  					var ul = ``;
						$("#Panha").addClass("panel");
						response.Message.forEach(function(Data){
							ul += `<li> ${Data}</li>`
						});
						$('ul#list').empty();
						$('ul#list').html(ul);
						fn_fadeOut();
					}else{
	  					var ul = ``;
						$("#Panha").addClass("panel");
						ul += `<li style="color:red;">Nothing Suggestion!</li>`;
						$('ul#list').empty();
						$('ul#list').html(ul);
						fn_fadeOut();
					}
					
				},
				error : function(error) {
					console.log(error);
				}
			});
		}
</script>

{% endblock %}