
{## Widget Unauthorize ##}
{% macro Unauthorize(ListModule) %}
	<script>
	init.push(function () {
		$('#Refresh').on("click",function(e){
			$.ajax({
				url: "/Morakot/UnauthorizeRefresh",
				type: "GET",
				beforeSend: function() {
				
				$('#Refresh').addClass('fa-spin');
				
				},
				success: function(data){
					$('#Unauthorize .panel-body > div').html(data);
					$('#Refresh').removeClass('fa-spin');
					$('#Unauthorize .panel-body > div').slimScroll({ height: 250, alwaysVisible: true, color: '#888',allowPageScroll: true });
				}
			});
		});
		$('#Unauthorize .panel-body > div').slimScroll({ height: 250, alwaysVisible: true, color: '#888',allowPageScroll: true });
	})
	</script>
	<div class="panel panel-info" id="Unauthorize">
		<div class="panel-heading">
			<span class="panel-title"> 
				Unauthorized Records
			</span>
			<div class="panel-heading-controls" >
				<div class="panel-heading-icon"style="padding-top:0px;" >
					<a title='Refresh' class="link" ><i id='Refresh' class='fa fa-refresh'></i></a>
				</div>
			</div>

		</div>
		<div class="panel-body" style="min-height: 250px; ">
			<div>
				{%set CheckRecord = []%}
				{%for row in ListModule%}
					
					{%if row[3] > 0%}
						{%if CheckRecord.append(row[3]) %} {% endif %}

						<a id="{{row[1]}}"class="list-group-item no-border-hr no-border-b padding-xs-hr" href="#">
						<!-- <i class="fa fa-envelope-o list-group-icon"></i> -->
						{{row[0]}}
						<span class="badge badge-warning">{{row[3]}}</span>
						</a>
						<script type="text/javascript">
							init.push(function () {
								$("#{{row[1]}}").click(function(){

									window.parent.addTab("{{row[0]}}", "/Morakot/Unauthorize/{{row[0]}}");
									window.location.reload();

								});
							});
						</script>
					{%endif%}
				
				{%endfor%}
				{%if not CheckRecord %}
					No record found.
				{%endif%}
			
			</div>
		</div> <!-- panel-body -->
	</div> <!-- panel panel-info -->

{% endmacro %}

{## Widget ChartLoan ##}
{% macro ChartLoan(QueryObj)%}

	<script>

		init.push(function () {
			var count= "{{QueryObj|length}}"
			if( count == "0"){
				$('#hero-donut').text("No record found.")
			}
			Morris.Donut({
				element: 'hero-donut',
				data:[		
				{%for row in QueryObj%}
					{ label: '{{row[0]}}', value: {{row[1]}} },
				{%endfor%}		
				],
				colors: PixelAdmin.settings.consts.COLORS,
				resize: true,
				labelColor: '#888',
				formatter: function (y) { return y + "%" }
			});
		});
	</script>
	
		<div class="panel panel-info">
			<div class="panel-heading">
				<span class="panel-title"><i class="panel-title-icon fa fa-cubes"></i>Loan Type</span>
			</div>
			<div class="panel-body" >
				<div class="graph-container">
					<div id="hero-donut" class="graph" style="max-height: 250px; min-height: 250px;">
						
					</div>
				</div>
			</div>
		</div>

{%for row in LoanObj%}
	{{row}}
{%endfor%}
{%endmacro%}

{## Widget CashPosition ##}
{% macro CashPosition(Obj) %}
<script>
	init.push(function () {
		$('#RefreshCashPosition').on("click",function(e){
			$.ajax({
				url: "/Morakot/CashPositionRefresh",
				type: "GET",
				beforeSend: function() {
				
				$('#RefreshCashPosition').addClass('fa-spin');
				
				},
				success: function(data){
					$('#CashPosition .panel-body > div').html(data);
					$('#RefreshCashPosition').removeClass('fa-spin');
					$('#CashPosition .panel-body > div').slimScroll({ height: 250, alwaysVisible: true, color: '#888',allowPageScroll: true });
				}
			});
		});
		$('#CashPosition .panel-body > div').slimScroll({ height: 250, alwaysVisible: true, color: '#888',allowPageScroll: true });
		
	})
</script>
	<div class="panel panel-info" id="CashPosition">
		<div class="panel-heading">
			<span class="panel-title"> 
				Cash Position
			</span>
			<div class="panel-heading-controls" >
				<div class="panel-heading-icon" style="padding-top:0px;" >
					<a title='Refresh' class="link" ><i id='RefreshCashPosition' class='fa fa-refresh'></i></a>
				</div>
			</div>

		</div>
		<div class="panel-body" style="min-height: 290px; ">
			<div>
				<table class="table">
					<thead>
					<tr>
						<th> 
							<span class="text-xs"># ACCOUNT</span><br> 
						</th>
						<th>
							<span class="text-xs">CURRENCY</span><br> 
						</th>
						<th class="text-right">
							<span class="text-xs">BALANCE</span><br>
						</th>
					</tr>
					</thead>
					<tbody>
						{%set toMoney=Obj['toMoney']%}
						{%set CurrencyObj=Obj['CurrencyObj']%}
						{%set float=Obj['float']%}
						{%if Obj['AccObj']%}
							{%if Obj['AccObj'].count()%}
								{%for row in Obj['AccObj']%}
									<tr>
										<td> 
											<a class="link" onClick="CustomClickView('AccountStatement-{{row.ID}}','AccountStatement/?ID={{row.ID}}')">
											{{row.ID}}
											</a>
										</td>
										<td>
											{{row.Currency}}
										</td>
										<td class="text-right">
											{{toMoney(float(row.Balance),CurrencyObj(row.Currency))}} 
										</td>
									</tr>
								{%endfor%}
							{%else%}
							<tr>
								<td>
								No record found.
								</td>
							</tr>
							{%endif%}
						{%else%}
							<tr>
								<td>
								No record found.
								</td>
							</tr>
						{%endif%}
					</tbody>
				</table>
			</div>
		</div>
	</div> <!-- /.stat-panel -->
{% endmacro %}

{## Widget Branch Productivity ##}
{% macro BranchProductivity(Obj) %}
<style type="text/css">

</style>
<script>
	init.push(function () {
		$('#RefreshBranchProductivity').on("click",function(e){
			$.ajax({
				url: "/Morakot/BranchProductivityRefresh",
				type: "GET",
				beforeSend: function() {
				
				$('#RefreshBranchProductivity').addClass('fa-spin');
				
				},
				success: function(data){
					$('#BranchProductivity .panel-body > div').html(data);
					$('#RefreshBranchProductivity').removeClass('fa-spin');
				}
			});
		});
	})
</script>
<div class="panel panel-info" id="BranchProductivity">
		<div class="panel-heading">
			<span class="panel-title"> 
				Branch Productivity
			</span>
			<div class="panel-heading-controls" >
				<div class="panel-heading-icon"style="padding-top:0px;" >
					<a title='Refresh' class="link" ><i id='RefreshBranchProductivity' class='fa fa-refresh'></i></a>
				</div>
			</div>

		</div>
		<div class="panel-body" style="min-height: 290px;max-height: 290px;">
			<div>
			{%set toMoney=Obj['toMoney']%}
			{%set CurrencyObj=Obj['CurrencyObj']%}
			{%set float=Obj['float']%}
			<!-- 10. Earnings graph example-->
				<div class="stat-panel">
					<!-- Bordered, without right border, right aligned text -->
					<div class="stat-cell col-xs-5 bordered no-border text-right">
						<!-- Stat panel bg icon -->
						<i class="fa fa-user bg-icon bg-icon-left"></i>
						<!-- Extra small text -->
						<span class="text-xs"># OF CUSTOMER</span><br>
						<!-- Extra large text -->
						<span class="text-xlg"><small><small></small></small>
							<strong>{{ Obj['NumberOfCustomer'] }}</strong>
						</span>
					</div> <!-- /.stat-cell -->
					<div class="stat-cell col-xs-5 bordered no-border  text-right">
						<!-- Stat panel bg icon -->
						<i class="fa fa-file-text bg-icon bg-icon-left"></i>
						<!-- Extra small text -->
						<span class="text-xs"># LOAN CONTRACT</span><br>
						<!-- Extra large text -->
						<span class="text-xlg"><small><small></small></small>
							<strong>{{ Obj['NumberOfLoan'] }}</strong>
						</span>
					</div> <!-- /.stat-cell -->
				</div> <!-- /.stat-panel -->
			<!-- /10. $EXAMPLE_EARNINGS_GRAPH -->

			<!--Retweets graph example-->
				<div class="stat-panel">
					<div class="stat-row">
						<!-- Info background, small padding -->
						<div class="stat-cell  padding-sm">
							<!-- Extra small text -->
							<div class="text-xs text-center">TOTAL PORTFOLIO</div>
						</div>
					</div> <!-- /.stat-row -->
					<div class="stat-row">
						<!-- Bordered, without top border, horizontally centered text -->
						<div class="stat-counters bordered no-border text-center">
							<!-- Small padding, without horizontal padding -->
							{%if Obj['TotalPortfolio']%}
								{%if Obj['TotalPortfolio']|length==1%}
								{%for row in Obj['TotalPortfolio']%}
									<div class="stat-cell col-xs-4 padding-sm no-padding-hr">
										<span class="text-xs"><b>{{row['Currency']}}</b></span><br>
										<span class="text-xlg"><small><small></small></small>
											<strong>
												{{toMoney(float(row['Amount']),CurrencyObj(row['Currency']))}}
											</strong>
										</span>
									</div>
								{%endfor%}
								{%else%}
									{%for row in Obj['TotalPortfolio']%}
										<div class="stat-cell col-xs-4 padding-sm no-padding-hr">
											<span class="text-xs"><b>{{row['Currency']}}</b></span><br>
											<span class="text-bg">
												<strong>
												{{toMoney(float(row['Amount']),CurrencyObj(row['Currency']))}}
												</strong>
											</span>
										</div>
									{%endfor%}
								{%endif%}
							{%else%}
								<div class="stat-cell col-xs-4 padding-sm no-padding-hr">
									<span class="text-xs"><b></b></span><br>
									<span class="text-xlg"><small><small></small></small>
										<strong>
											0
										</strong>
									</span>
								</div>
							{%endif%}
							
						</div> <!-- /.stat-counters -->
					</div> <!-- /.stat-row -->
				</div> <!-- /.stat-panel -->
			<!-- /9. $EXAMPLE_RETWEETS_GRAPH -->
			</div>
		</div>
</div>

{% endmacro %}



{## Widget System Health Check ##}
{% macro SystemHealthCheck(Obj) %}
<script type="text/javascript">
	init.push(function () {
		$('#RefreshSystemHealthCheck').on("click",function(e){

			$.ajax({
				url: "/Morakot/SystemHealthCheckRefresh",
				type: "GET",
				beforeSend: function() {
				$('#RefreshSystemHealthCheck').addClass('fa-spin');
				},
				success: function(data){
					$('#SysHealthCheck .panel-body > div').html(data);
					$('#RefreshSystemHealthCheck').removeClass('fa-spin');
					$('#SysHealthCheck .panel-body > div').slimScroll({ height: 250, alwaysVisible: true, color: '#888',allowPageScroll: true });
				}
			});
		});		
	$('#SysHealthCheck .panel-body > div').slimScroll({ height: 250, alwaysVisible: true, color: '#888',allowPageScroll: true });
	})
</script>
<div class="panel panel-info" id="SysHealthCheck">
		<div class="panel-heading">
			<span class="panel-title"> 
				<i class="panel-title-icon fa fa-heartbeat"></i>System Health Check &nbsp;
				<!-- <span class="badge bg-info">{{Obj|length -1}}</span> -->
			</span>
			<div class="panel-heading-controls" >
				<div class="panel-heading-icon"style="padding-top:0px;" >
					<a title='Refresh' class="link" ><i id='RefreshSystemHealthCheck' class='fa fa-refresh'></i></a>
				</div>
			</div>
		</div>
		<div class="panel-body" style="min-height: 290px; ">
			<div>
				<table class="table">
				{% if Obj %}
					<thead>
						<tr>
							<!-- <th></th> -->
							<th> 
								<span class="text-xs">CODE</span><br> 
							</th>
							<th>
								<span class="text-xs">DESCRIPTION</span><br> 
							</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						{% for row in Obj%}
							<tr>
								<td>{{row.Code}}</td>
								<td><a id="{{row.Code}}" href="#">{{row.Title}}</a></td>
								<td>
									<span class="badge {{'badge-danger' if 'Critical' in row.Level else 'badge-warning'}}">{{row.Length - 1}}</span>
								</td>
							</tr>
							<script type="text/javascript">
								init.push(function () {
									$("#{{row.Code}}").click(function(){

										window.parent.addTab("System Health Check - {{row.Code}}", "/Morakot/SysHealthCheck/{{row.Code}}");

									});
								});
							</script>
						{% endfor %}
					</tbody>

				{% else %}
				<table cellspacing="0" cellpadding="0">
					<tr height="50px"></tr>
					<tr>
						<td width="10%"></td>
						<td><i class="fa fa-smile-o text-success" style="font-size: 100px;"></i></td>
						<td width="10%"></td>
						<td style="font-size: 20px;"><b>YOUR SYSTEM IS HEALTHY</b></td>
					</tr>
				</table>

				{% endif %}
				</table>
			</div>
		</div>
</div>

{% endmacro %}

{## Widget Overview Inquiry ##}
{% macro OverviewInquiry(Obj) %}
	{%set NumNewAssign  = Obj[1].count() %} 
	{%set NumFollowup   = Obj[2].count() %}
	{%set NumToday 		= Obj[3].count() %}

<style type="text/css">
	#OverviewInquiryRefresh {
		cursor: pointer;
	}
	a.linked {
		color: #555;
	}
	a.red {
		color: #d38e99;
	}
</style>

<script>
	init.push(function () {
		$('#OverviewInquiryRefresh').on("click",function(e){
			$.ajax({
				url: "/Morakot/OverviewInquiryRefresh",
				type: "GET",
				beforeSend: function() {
				
				$('#OverviewInquiryRefresh').addClass('fa-spin');
				
				},
				success: function(data){
					$('#OverviewInquiry').html(data);
					$('#OverviewInquiryRefresh').removeClass('fa-spin');
				}
			});
		});
	});
</script>
{# Bootstrap Penal #}
 <div class="panel panel-info inq">
 <div class="panel-heading" style="min-height: 42px;max-height: 42px;margin:0;">
			 <span class="panel-title"> 
				Potential Customer Statistics By Branch
			 </span>
			 <div class="panel-heading-controls">
				 <div class="panel-heading-icon" style="padding-top:0px;">
					 <a title="Refresh" class="link"><i id="OverviewInquiryRefresh" class="fa fa-refresh"></i></a>
				 </div>
			 </div>

		 </div>
<div id="OverviewInquiry">
   <div class="panel-body" style="min-height: 290px;max-height: 290px;padding:0;margin:0;overflow:hidden;">
	 <div class="row">
	 	{%set LimitGrid = 5%}
	 	{%for Row in Obj[4] %}
	 		{%if loop.index<=LimitGrid %}
	 			{%set Num 		= Obj[0].filter_by(POStatus=Row.ID).count() %}
				 <div class="col-xs-4 text-center bordered" style="padding: 27px;">
					<a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManage?TabSelected={{Row.ID}}')">
						 <span class="{% if NumNew != '0' %} badge badge-warning {% else %}linked {% endif %}" style="line-height:18px; padding: 0 6px;">{{Num}}</span><br>
						 <span class="text-xs" style="color:#555;">{{Row.Description}}</span>
					 </a>
				 </div>
			{%endif%}
		{%endfor%}
	 		<div class="col-xs-4 text-center">
				 <br><br>
				 <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManage')" style="margin-top: 100px;" class="linked">
				 {# <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManage')" class="stat-cell col-xs-4 padding-sm no-padding-hr valign-middle" style="margin-top: 100px;" class="linked"> #}
					 <span class="text-xs">MORE&nbsp;&nbsp;<i class="fa fa-caret-right"></i></span>
				 </a>
		 	</div>
	 </div>
	 <div class="row">
		 <div class="col-xs-4 text-center bordered" style="padding: 27px;">
			 {# <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual?TabSelected=new-assign')"> #}
			 <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManage?TabSelected=new-assign')">
				 <span class="text-lg"><strong class="text-lg">{{NumNewAssign}}</strong></span><br>
				 <span class="text-xs">NEW ASSIGNED</span>
			 </a>
		 </div>
		 <div class="col-xs-4 text-center bordered" style="padding: 27px;">
			 {# <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual?TabSelected=upcoming')"> #}
			 <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManage?TabSelected=upcoming')">
				 <span class="text-lg"><strong class="text-lg">{{NumFollowup}}</strong></span><br>
				 <span class="text-xs">UPCOMING FOLLOWUP</span>
			 </a>
		 </div>
		 <div class="col-xs-4 text-center bordered" style="padding: 27px;">
			 {# <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual?TabSelected=today')"> #}
			 <a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManage?TabSelected=today')">
				 <span class="text-lg"><strong class="text-lg">{{  NumToday }}</strong></span><br>
				 <span class="text-xs">TODAY FOLLOWUP</span>
			 </a>
		 </div>
	 </div>
   </div>
</div>
<!-- ./first show on dashboard -->

</div>

{#  </div> <!-- /.stat-panel -->
 </div> #}
 {# end Bootstrap Penal #}

{% endmacro %}

{## Widget Overview Inquiry Individual##}
{% macro OverviewInquiryInd(Obj) %}

<style type="text/css">
	#OverviewInquiryIndRefresh {
		cursor: pointer;
	}
	a.linked {
		color: #555;
	}	

</style>

<script>
	init.push(function () {
		$('#OverviewInquiryIndRefresh').on("click",function(e){
			$.ajax({
				url: "/Morakot/OverviewInquiryIndRefresh",
				type: "GET",
				beforeSend: function() {
				
				$('#OverviewInquiryIndRefresh').addClass('fa-spin');
				
				},
				success: function(data){
					$('#OverviewInquiryInd').html(data);
					$('#OverviewInquiryIndRefresh').removeClass('fa-spin');
				}
			});
		});
	});
</script>

	{%set NumNewAssign  = Obj[1].count() %} 
	{%set NumFollowup   = Obj[3].count() %}
	{%set NumToday 		= Obj[4].count() %}

			<div class="panel panel-info">
					<div class="panel-heading" style="min-height: 42px;max-height: 42px;margin:0;">
						<span class="panel-title"> 
							Overview - Potential Customer Statistics By Branch
						</span>
						<div class="panel-heading-controls">
							<div class="panel-heading-icon" style="padding-top:0px;">
								<i class="fa fa-refresh bg-icon" id="OverviewInquiryIndRefresh"></i>
							</div>
						</div>

					</div>

					  <div class="panel-body" style="min-height: 290px;max-height: 290px;padding:0;margin:0;overflow:hidden;">
							<div class="row">
								{%set LimitGrid = 5%}
 								{%for Row in Obj[5]%}
 									{% if loop.index <= LimitGrid%}
	 									{% set Num =  Obj[0].filter_by(POStatus=Row.ID).count() %}
											<div class="col-xs-4 text-center bordered" style="padding: 27px;" class="linked">
												<a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual?TabSelected={{Row.ID}}')" class="linked">
													<span class="text-bg"><strong>{{Num}}</strong></span><br>
													<span class="text-xs">{{Row.Description}}</span>
												</a>
											</div>
									{%else%}
									{%endif %}
								{% endfor %}
								<div class="col-xs-4 text-center">
									<br><br>
									<a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual')" style="margin-top: 100px;" class="linked">
										<span class="text-xs">MORE&nbsp;&nbsp;<i class="fa fa-caret-right"></i></span>
									</a>
								</div>
							</div>
							<div class="row footer">
								<div class="col-xs-4 text-center bordered" style="padding: 27px;">
									<a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual?TabSelected=new-assign')">
										<span class="text-lg"><strong class="text-lg">{{NumNewAssign}}</strong></span><br>
										<span class="text-xs">NEW ASSIGNED</span>
									</a>
								</div>
								<div class="col-xs-4 text-center bordered" style="padding: 27px;">
									<a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual?TabSelected=upcoming')">
										<span class="text-lg"><strong class="text-lg">{{NumFollowup}}</strong></span><br>
										<span class="text-xs">UPCOMING FOLLOWUP</span>
									</a>
								</div>
								<div class="col-xs-4 text-center bordered" style="padding: 27px;">
									<a href="javascript:void(0)" onClick="CustomClickView('Potential Customer - Manage','POManageIndividual?TabSelected=today')">
										<span class="text-lg"><strong class="text-lg">{{  NumToday }}</strong></span><br>
										<span class="text-xs">TODAY FOLLOWUP</span>
									</a>
								</div>
							</div>
					  </div>
			</div>
				<!-- ./first show on dashboard -->
		{# </div> #} <!-- /.stat-panel -->
{% endmacro %}


{% macro WorkflowWidget(Obj) %}

	{% set listForm 	= Obj[0] %}
	{% set formIDList 	= Obj[1] %}
	{% set userRecently = Obj[2] %}

	<style type="text/css">
		
		.bg-success.darken[href]:hover, .bg-success.darker {
			background: #5bc0f5!important;
		}

	</style>
	<script>
	init.push(function () {
		$('#WorkflowRefresh').on("click",function(e){
			$.ajax({
				url: "/Morakot/WorkflowRefresh",
				type: "GET",
				beforeSend: function() {
					$('#WorkflowRefresh').addClass('fa-spin');
				},
				success: function(data){
					$('#workflow').html(data);
					$('#WorkflowRefresh').removeClass('fa-spin');					
				}
			});
			$.ajax({
				url: "/Morakot/UserRecentlyRefresh",
				type: "GET",
				beforeSend: function() {
					$('#WorkflowRefresh').addClass('fa-spin');
				},
				success: function(data){
					$('#userRecently').html(data);
					$('#WorkflowRefresh').removeClass('fa-spin');
					// console.log(data)
				}
			});
		});
		
	})
	</script>
	<div class="stat-panel">
		<div class="panel panel-info">
			<div class="panel-heading">
				<span class="panel-title"> 
					<i class="panel-title-icon fa fa-line-chart"></i>
					Workflow
				</span>
				<div class="panel-heading-controls">
					<div class="panel-heading-icon" style="padding-top:0px;">
						<a title="Refresh" class="link"><i id="WorkflowRefresh" class="fa fa-refresh"></i></a>
					</div>
				</div>
			</div>
			<div class="panel-body"  style="max-height: 290px;min-height: 290px;">
				<div class="col-sm-6 col-md-6 col-xs-6" id="workflow" style="max-height: 220px; overflow: auto;">
						<strong>Review|Approve</strong>
						<h1></h1>
						<div>      
							{% set message = [] %}
							{% for key, value in listForm.items() %}

								{% if value != 0 %}
									{% if message.append('1') %}{% endif %}
									<a id="" class="list-group-item no-border-hr no-border-b padding-xs-hr" onclick="CustomClickView('List {{key}}','listRecord/?formID={{formIDList[key]}}')" 
										href="javascript:void(0)">
										<!-- <i class="fa fa-envelope-o list-group-icon"></i> -->
										{{key}}
										<span class="badge badge-warning">{{value}}</span>
									</a>
								{% endif%}

							{% endfor %}

							{% if message == []  %}
							<p>There is no record</p>
							{% endif %}       
						</div>
				</div>
				<div class="col-sm-6 col-md-6 col-xs-6" id="userRecently" style="max-height: 220px; overflow: auto;">
					<strong>Recently Activities</strong>
					<h1></h1>
					<div>
						{% if userRecently.first() %}      
							{% for recent in userRecently %}
							<a class="list-group-item no-border-hr no-border-b padding-xs-hr" 
							   href="javascript:void(0)" style="cursor: default">
							   
							   <strong>{{recent.UserID.upper()}}</strong> is recently 
							   {% if recent.Action =='1' %}
									<span class="label label-primary">created</span>
							   {% elif recent.Action == '2' %}
									<span class="label label-warning">reviewed</span>
							   {% elif recent.Action == '3' %}
									<span class="label label-success">approved</span>
							   {% elif recent.Action == '4' or recent.Action == '7' %}
									<span class="label label-danger">rejected</span>
							   {% elif recent.Action == '5' %}
									<span class="label label-info">feedback</span> 
							   {% elif recent.Action == '8' %}
									<span class="label label-default">Edited</span> 
							   {% endif %}
							   record {{recent.RecordID}}
							   <label>on {{recent.Createdon}}</label>
							</a>
							{% endfor %} 
						{% else %}
							<p>
								No user activity
							</p>
						{% endif %}  
					</div>
				</div>
			<!-- panel-body -->
		</div>

	</div>
	<!-- /.stat-panel -->

{% endmacro %}


{% macro LoanOutstandingByPro(Result) %}	
	<script>
		init.push(function () {
			var count= "{{Result['body']|length}}";
			var COLORS = new Array();
			for(var clr of PixelAdmin.settings.consts.COLORS){
				COLORS.unshift(clr);
			}

			String.prototype.decodeHTML = function() {
				var map = {"gt":">","lt":"<"};
				return this.replace(/&(#(?:x[0-9a-f]+|\d+)|[a-z]+);?/gi, function($0, $1) {
					if ($1[0] === "#") {
						return String.fromCharCode($1[1].toLowerCase() === "x" ? parseInt($1.substr(2), 16)  : parseInt($1.substr(1), 10));
					} else {
						return map.hasOwnProperty($1) ? map[$1] : $0;
					}
				});
			};

			function isOverflown(element) {
			    return element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth;
			}

			$('#s-popovers button').popover();

			function createIndicator(dataList){
				$('.box-row').remove();
				var counter = 0;

				for(var obj of dataList){
					var boxContainer = document.getElementsByClassName("box-container")[0];
					var boxRow = document.createElement('div');
					var currIndicator = document.createElement('div');
					var boxIndicator = document.createElement('div');
					var loanProduct = document.createElement('div');
					var amount = document.createElement('div');

					boxContainer.setAttribute('class', 'box-container');
					boxContainer.setAttribute('style', 'background-image:linear-gradient(to top right,#fafafa,whitesmoke)');
					boxRow.setAttribute('class', 'box-row');
					currIndicator.setAttribute('class', 'currency-indicator');
					boxIndicator.setAttribute('style', 'background:' + COLORS.sort()[counter]);
					boxIndicator.setAttribute('class', 'box-indicator');
					loanProduct.setAttribute('class', 'loan-product');
					amount.setAttribute('class', 'amount');

					var key = document.createTextNode(obj.key);
					var label = document.createTextNode(obj.label);

					loanProduct.appendChild(key);
					amount.appendChild(label);
					currIndicator.appendChild(boxIndicator);
					currIndicator.appendChild(loanProduct);
					boxRow.appendChild(currIndicator);
					boxRow.appendChild(amount);
					boxContainer.appendChild(boxRow);
					counter++;
				}
			}

			if( count == "0"){
				$('#product-donut').text("Please, click on refresh button to get data.");				
			}
			else{
				Morris.Donut({
				element: 'product-donut',
				data:[
						{%for row in Result['body']%}
							{ label: String("{{row['key']|e}}").decodeHTML(), value: "{{row['value']}}" },
						{%endfor%}
						],
				colors: COLORS.sort(),
				resize: true,
				labelColor: '#888',
				formatter: function (y) { return y + "%" }
			});
			}

			$('#RefreshLoanOstByProduct').on("click",function(e){
			var Branch = $('#ddbr-ostpro', window.parent.document).val();
			$.ajax({
				url: "/Morakot/LoanOstByProductRefresh",
				data: { Branch : Branch },
				type: "GET",
				beforeSend: function() {
					$('#RefreshLoanOstByProduct').addClass('fa-spin');				
				},
				success: function(res){
					try{
						var dataList = [];
						var indicatorList = [];
						if (res.body.length==0){
							$('.box-container').attr("style", "background: transparent");
							$('.box-container').empty();
							$('#product-donut').text("No record found.");
							$('#RefreshLoanOstByProduct').removeClass('fa-spin');
							return;
						}
						for(var row of res.body){
							dataList.push({label: row['key'], value: row['value']});
							indicatorList.push({key: row['key'], label: row['label']});
						}
						$('#product-donut').text("");

						Morris.Donut({
							element: 'product-donut',
							data: dataList,
							colors: COLORS.sort(),
							resize: true,
							labelColor: '#888',
							formatter: function (y) { return y + "%" }
						});
						createIndicator(indicatorList);
						$('#loanostbypropanel').attr('title', "Last update on " + res.last_update[0] + " at " + res.last_update[1])
						$('#RefreshLoanOstByProduct').removeClass('fa-spin');
					}catch(err){
						if(err.name == "TypeError"){
							html = "<div class='col-sm-12'>\
										<div class='clearfix'> </div>\
										<div class='alert alert-danger'>\
											<button type='button' class='close' data-dismiss='alert'>×</button>\
											Warning,  Your session is timeout. Please kindly re-login.\
										</div>\
									</div>";

							$('#loanostbypro').html(html);
							$('#RefreshLoanOstByProduct').removeClass('fa-spin');
						}
					}
				}
			});
		});

		window.setTimeout(function(e){			
			$('#ddbr-ostpro', window.parent.document).on('change', function(){
					$('#RefreshLoanOstByProduct').trigger("click");
					var modal = $(window.frameElement).parents('#tabcontent').find('#modalostpro-setting');
					modal.modal('hide');
				});
		}, 100);

	});
	</script>
	
	<style type="text/css">
		.box-indicator{
			width:15px; 
			height: 15px; 
			border-radius: 3px;
			border: 1px solid whitesmoke;
		}

		.box-container{
			flex:3; 
			align-items: center;
			align-self: flex-start;
			margin-top: 5px;
			overflow-y: scroll;
			height: 240px;
			max-height: 250px;
			background-image:linear-gradient(to top right,#fafafa,whitesmoke);
			border-radius: 10px;
		}

		::-webkit-scrollbar { 
			display: none; 
		}

		.box-row{
			display: flex;
			flex: 1;
			flex-direction: row;
			/*border: 1px solid black;*/
			margin: auto;
			justify-content: space-between;
			margin: 10px;
			overflow: visible;			
			flex-wrap: nowrap;
		}

		.box-row:first-child{
			margin-top: 15px;
		}

		.currency-indicator{
			display: flex;
			justify-content: space-between;			
		}

		.spacing{
			flex: 0.3;
		}

		.amount{
			font-weight: bolder;
			color: #888;			
			white-space: nowrap;			
			overflow: hidden;
			float: right;
			flex:1;
			text-align: right;
			margin-right: 10px;
		}

		.currency-indicator{
			justify-content: flex-start;			
			white-space: nowrap;
			flex:5;
			overflow: hidden;
			margin-left: 10px;
		}

		#loanostbypro{
			max-height: 250px; 
			min-height: 250px; 
			padding: 0; 
			margin: 0;
		}


	</style>

	{% set COLORS = ['#71c73e', '#77b7c5', '#d54848', '#6c42e5', '#e8e64e', '#dd56e6', '#ecad3f', '#618b9d', '#b68b68', '#36a766', '#3156be', '#00b3ff', '#646464', '#a946e8', '#9d9d9d'] %}
	{% set COLORS = COLORS|sort %}
	<div class="panel panel-info">
		<div class="panel-heading">
			<span class="panel-title"><i class="panel-title-icon fa fa-cubes"></i>Loan Outstanding By Product</span>				
			<div class="panel-heading-controls">
				<div class="panel-heading-icon" style="padding-top:0px;" >
					<div style="display: flex; justify-content: space-between; width: 40px;">
						<div style="width: 100px;">								
							{% set properties = {'id':'ostpro-setting', 
												'title':"Filter by",
												}
							%}
							{% 
								set item = {'label': "Branch", 
											'field': "SelectField",
											'id':'br-ostpro',
											'name': "Branch",
											'default':session["FilterBranch"],
											'data': AccessBranch,
											}
							%}
							
							{% call WidgetSetting([item], properties) %}
							{% endcall %}
						</div>
						
						<div>
							<a title='Refresh' class="link" ><i id='RefreshLoanOstByProduct' class='fa fa-refresh'></i></a>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		{% if Result['body']|length >0 %}
		{% set LastUpdate = Result['last_update'] %}
		{% else %}
		{% set LastUpdate = ["", ""] %}
		{% endif %}
		<div title="Last update on {{LastUpdate[0]}} at {{LastUpdate[1]}}" id="loanostbypropanel" class="panel-body" >
			<div id="loanostbypro" style="display: flex; justify-content: space-between;">
				<div class="graph-container" style="flex:2.5;">
					<div id="product-donut" class="graph" style="max-height: 250px; min-height: 250px; padding: 0; margin: 0;">
						
					</div>
				</div>
				{% if Result['body']|length>0 %}
					<div class="box-container">
						{% for obj in Result['body'] %}
							<div class="box-row">
								<div class="currency-indicator">
									<div class="box-indicator" style="background: {{COLORS[loop.index-1]}};">
									</div>
									<div class="loan-product">
										{{obj['key']}}&nbsp;
									</div>
								</div>
								
								<div class="amount">
									{{obj['label']}}
								</div>
							</div>
						{% endfor %}
					</div>
				{% else %}
					<div class="box-container" style="background: transparent;">
					</div>
				{% endif %}
				<div class="spacing"></div>
			</div>
		</div>
	</div>

{% endmacro %}


{% macro LoanOutstandingByCurr(Result) %}	
	<script>
		init.push(function () {
			var count= "{{Result['body']|length}}";
			
			function createTotalDiv(total){
				var textNode = document.createTextNode("TOTAL");
				var totalAmount = document.createTextNode(total);
				var txtCurr = document.createTextNode("(In Based Currency)");
				var node = document.createElement('div');
				var p1 = document.createElement('p');
				var p2 = document.createElement('p');
				var p3 = document.createElement('p');
				p1.appendChild(textNode);
				p2.appendChild(totalAmount);
				p3.appendChild(txtCurr);
				node.setAttribute("class", "total");
				node.appendChild(p1);
				node.appendChild(p2);
				node.appendChild(p3);
				$('#currency-donut').append(node);
			}

			function createDonut(doughnutChartData){
				$('#currency-donut').plot(doughnutChartData, {
					series: {
						pie: {
							show: true,
							radius: 0.90,
							innerRadius: 0.6,
							label: {
								show: true,
								radius: 3 / 4,
								formatter: function (label, series) {
									var amount = label.split(" ");
									return '<div style="font-size:16px;text-align:center;padding:2px;">' + "" + '</div>';
								},
								background: { opacity: 0 }
							}
						}
					}
				});
			}

			if( count == "0"){
				$('#currency-donut').css('font-weight','normal')
									.text("Please, click on refresh button to get data.");
			}
			else{
				var doughnutChartData = [
										{%for row in Result['body']%}
											{ label: "{{row['key']}} {{row['label']}}", data: "{{row['value']}}" },
										{%endfor%}
										];
				
				createDonut(doughnutChartData);
				createTotalDiv("{{Result['total_amount_shortcuts']}}");
				var pieLabelX = document.getElementById("pieLabel0").getBoundingClientRect().x;
				var panelX = document.getElementById("loanostbycurr").getBoundingClientRect().x;
				var totalLeft = pieLabelX-97;
				
				$(".total").css("padding-left", totalLeft + "px");
			}

			$('#RefreshLoanOstByCurrency').on("click",function(e){
				var Branch = $('#ddbr-ostcurr', window.parent.document).val();
				$.ajax({
					url: "/Morakot/LoanOstByCurrRefresh",
					data: { Branch : Branch },
					type: "GET",
					beforeSend: function() {
						$('#RefreshLoanOstByCurrency').addClass('fa-spin');
					},
					success: function(res){
						console.log(res);
						try{
							var dataList = [];
							if(res.body.length==0){
								$('#currency-donut').css('font-weight','normal').text("No record found.");
								$('#RefreshLoanOstByCurrency').removeClass('fa-spin');
								return;
							}
							for(var row of res.body){
								dataList.push({label:row.key + " " + row.label, data:row.value})
							}
							
							var currencyDonut = document.getElementById('currency-donut');
							var children = currencyDonut.childNodes;
							for(var child of children){
								child.parentNode.removeChild(child);
							}
							
							$('#currency-donut').empty();
							$('#currency-donut').css('font-weight','bold');
							createDonut(dataList);
							createTotalDiv(res.total_amount_shortcuts);
							var pieLabelX = document.getElementById("pieLabel0").getBoundingClientRect().x;
							var panelX = document.getElementById("loanostbycurr").getBoundingClientRect().x;
							var totalLeft = pieLabelX-97;
							
							$(".total").css("padding-left", totalLeft + "px");
							$('#loanostbycurrpanel').attr('title', "Last update on " + res.last_update[0] + " at " + res.last_update[1])
							$('#RefreshLoanOstByCurrency').removeClass('fa-spin');
						}catch(err){
							if(err.name=="TypeError"){
								html = "<div class='col-sm-12'>\
											<div class='clearfix'> </div>\
											<div class='alert alert-danger'>\
												<button type='button' class='close' data-dismiss='alert'>×</button>\
												Warning,  Your session is timeout. Please kindly re-login.\
											</div>\
										</div>";
								$('#loanostbycurr').empty();
								$('#loanostbycurr').html(html);
								$('#RefreshLoanOstByCurrency').removeClass('fa-spin');
							}
						}
					}
				});
			});

			window.setTimeout(function(){
				$('#ddbr-ostcurr', window.parent.document).on('change', function(){
					$('#RefreshLoanOstByCurrency').trigger("click");
					var modal = $(window.frameElement).parents('#tabcontent').find('#modalostcurr-setting');
					modal.modal('hide');
				});
			}, 100);
			
		});
	</script>	
	<style type="text/css">
		.total{
			display: flex;			
			align-self: center;
			z-index: 999;
			padding-left: 0px;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			color: #888;
		}
		#currency-donut{			
			font-weight: bold;
			font-family: "Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
		    font-size: 13px;
		    line-height: 1.42857143;
		    color: #555;
		}
		#loanostbycurr{
			max-height: 250px; 
			min-height: 250px; 
			padding: 0; 
			margin: 0;
		}
	</style>		
		<div class="panel panel-info">
			<div class="panel-heading">
				<span class="panel-title">
					<i class="panel-title-icon fa fa-cubes"></i>
					Loan Outstanding By Currency
				</span>
				<div class="panel-heading-controls" >
					<div class="panel-heading-icon" style="padding-top:0px;" >
						<div style="display: flex; justify-content: space-between; width: 40px;">
							<div style="width: 100px;">								
								{% set properties = {'id':'ostcurr-setting', 
													'title':"Filter by",												
													}
								%}
								{% 
									set item = {'label': "Branch", 
												'field': "SelectField",
												'id':'br-ostcurr',
												'name': "Branch",
												'default':session["FilterBranch"],
												'data': AccessBranch,
												}
								%}
								
								{% call WidgetSetting([item], properties) %}
								{% endcall %}
							</div>

							<div>
								<a title='Refresh' class="link" ><i id='RefreshLoanOstByCurrency' class='fa fa-refresh'></i></a>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			{% if Result['body']|length >0  %}
				{% set LastUpdate = Result['last_update']  %}
			{% else %}
				{% set LastUpdate = ["", ""]  %}
			{% endif %}

			<div title="Last update on {{LastUpdate[0]}} at {{LastUpdate[1]}}" id="loanostbycurrpanel" class="panel-body" >
				<div id="loanostbycurr" style="display: flex; justify-content: space-between;">
					<div class="graph-container" style="flex: 1">
						<div id="currency-donut" class="graph" style="display: flex;max-height: 250px; min-height: 250px; padding: 0; margin: 0;">
						</div>
					</div>
				</div>
			</div>
		</div>
{% endmacro %}


{% macro FinancialReport(Result) %}
	<!-- 10. Earnings graph example-->        
	<style type="text/css">
		.ksn-text{
				overflow: hidden;
			   text-overflow: ellipsis;
			   display: -webkit-box;
			   -webkit-box-orient: vertical;
			   -webkit-line-clamp: 3; /* number of lines to show */
		}

		.wrapper-div{
			max-height: 110px;
			display: flex;
		}

		.finrep-container{
			margin:0;
			padding:0;
			display: flex;
			height: 250px;
			max-height: 250px;
			flex: 1;
			align-items: space-between;
			flex-wrap: wrap;
		}

		#finrep{
			height: 290px;
		}
		.fin-val{
			font-size:  22px;
			margin-top: 20px;
		}
	</style>
	<script type="text/javascript">
		init.push(function(){
			function createComponent(data, x_axis, shortcuts){
				var finrep = document.getElementById("finrep");
				var container = document.createElement('div');
				container.setAttribute("class", "stat-panel finrep-container");
				// console.log(data[0].value);
				var index = 0;
				for (var row of data[0].value){
					var wrapperdiv = document.createElement("div");
					wrapperdiv.setAttribute("class", "stat-cell col-xs-4 text-right wrapper-div");
					var i = document.createElement("i");
					i.setAttribute("class", data[0].web_icon[index] + " bg-icon bg-icon-left");
					var spanlabel = document.createElement("span");
					spanlabel.setAttribute("class", "text-xs ksn-text");
					var spanvalue = document.createElement("span");
					spanvalue.setAttribute("class", "text-xlg fin-val");
					var label = document.createTextNode(x_axis[index]);
					var value = document.createTextNode(shortcuts[index]);
					var small = document.createElement("small");
					var strong = document.createElement('strong');
					spanlabel.appendChild(small);
					spanlabel.appendChild(small);
					spanlabel.appendChild(label);
					strong.appendChild(value);
					spanvalue.appendChild(strong);
					wrapperdiv.appendChild(i);
					wrapperdiv.appendChild(spanlabel);
					wrapperdiv.appendChild(spanvalue);
					container.appendChild(wrapperdiv);
					index++;
				}
				finrep.appendChild(container);
			}

			$('#RefreshFinancialReport').on("click",function(e){
				var Branch = $('#ddbr-fin', window.parent.document).val();
				$.ajax({
					url: "/Morakot/FinancialReportRefresh",
					data: { Branch : Branch,},
					type: "GET",
					beforeSend: function() {
						$('#RefreshFinancialReport').addClass('fa-spin');				
					},
					success: function(res){
						console.log(res.body.length);
						try{
							if (res.body.length==0){
								$('#finrep').text("No record found.");
								$('#RefreshFinancialReport').removeClass('fa-spin');
								return
							}
							$('#finrep').empty();
							createComponent(res.body, res.x_axis, res.y_axis_shortcuts);
							console.log(res.body);
							$('#finrep').attr('title', "Last update on " + res.last_update[0] + " at " + res.last_update[1]);
							$('#RefreshFinancialReport').removeClass('fa-spin');
						}catch(err){
							console.log(err)
							if(err.name=="TypeError"){
							html = "<div class='col-sm-12'>\
										<div class='clearfix'> </div>\
										<div class='alert alert-danger'>\
											<button type='button' class='close' data-dismiss='alert'>×</button>\
											Warning,  Your session is timeout. Please kindly re-login.\
										</div>\
									</div>";
							$('#finrep').empty();
							$('#finrep').html(html);
							$('#RefreshFinancialReport').removeClass('fa-spin');
							}
						}
					}
				});
			});
			window.setTimeout(function(e){
				$('#ddbr-fin', window.parent.document).on('change', function(){
					$('#RefreshFinancialReport').trigger("click");
					var modal = $(window.frameElement).parents('#tabcontent').find('#modalfin-setting');
					modal.modal('hide');
				});
			},100);
			
		});
	</script>

	{% if Result['body']|length >0 %}
		{% set LastUpdate = Result['last_update'] %}
	{% else %}
		{% set LastUpdate = ["", ""] %}
	{% endif %}
	<div class="panel panel-info">
		<div class="panel-heading">
			<span class="panel-title"><i class="panel-title-icon fa fa-cubes"></i>Financial Report</strong></span>
			<div class="panel-heading-controls" >
				<div class="panel-heading-icon" style="padding-top:0px;" >
					
					<div style="display: flex; justify-content: space-between; width: 40px;">
						<div style="width: 100px;">								
							{% set properties = {'id':'fin-setting', 
												'title':"Filter by",												
											}
							%}
							{% 
								set item = {'label': "Branch", 
											'field': "SelectField",
											'id':'br-fin',
											'name': "Branch",
											'default':session["FilterBranch"],
											'data': AccessBranch,
											}
							%}
							
							{% call WidgetSetting([item], properties) %}
							{% endcall %}
						</div>

						<div>
							<a title='Refresh' class="link" ><i id='RefreshFinancialReport' class='fa fa-refresh'></i></a>
						</div>
					</div>
				</div>
				
			</div>
		</div>

		<div title="Last update on {{LastUpdate[0]}} at {{LastUpdate[1]}}" id="finrep" class="panel-body" >				
			<div class="stat-panel finrep-container" id="fincontainer">
				{% if Result['body']|length>0 %}
					{% for val in range(0, Result['body'][0]['value']|length) %}
					<div class="stat-cell col-xs-4 text-right wrapper-div">
						<!-- Stat panel bg icon -->
						<i class="{{Result['body'][0]['web_icon'][val]}} bg-icon bg-icon-left"></i>
						<!-- Extra small text -->
						<span class="text-xs ksn-text">{{ Result['x_axis'][val] }}</span>
						<!-- Extra large text -->
						<span class="text-xlg fin-val"><small><small></small></small>
							<strong>{{ Result['y_axis_shortcuts'][val] }}</strong>
						</span>
					</div>
					{% endfor %}
				{% else %}
					<span>Please, click on refresh button to get data.</span>
				{% endif %}
			</div> <!-- /.stat-panel -->
		</div>
	</div>
{% endmacro%}


{% macro LoanCollectionAndDisbursement(Result) %}	
	<script>
		init.push(function () {
			String.prototype.decodeHTML = function() {
				var map = {"gt":">","lt":"<"};
				return this.replace(/&(#(?:x[0-9a-f]+|\d+)|[a-z]+);?/gi, function($0, $1) {
					if ($1[0] === "#") {
						return String.fromCharCode($1[1].toLowerCase() === "x" ? parseInt($1.substr(2), 16)  : parseInt($1.substr(1), 10));
					} else {
						return map.hasOwnProperty($1) ? map[$1] : $0;
					}
				});
			};
			var count= "{{Result['body']|length}}";
			
			function createLineGraph(key1, key2, value1, value2, xaxis, currency){				
				
				if (typeof(xaxis)=='string'){
					var x_axis_raw = xaxis;
					var str = x_axis_raw.replace(/[^a-zA-Z ]/g, "");
					var x_axis_text = str.split(' ');
				}else{ var x_axis_text = xaxis; }
				
				var x_axis = [1, 2, 3, 4, 5, 6, 7, 8, 9 ,10, 11, 12];
				var x_axis_ticks = [];
				
				for (var i=0; i<x_axis_text.length; i++){
					x_axis_ticks.push([x_axis[i], x_axis_text[i]]);
				}

				var val1 = eval(value1);
				var val2 = eval(value2);
				var visitsChartData = [{
					label: key1,
					data: [
						[x_axis[0], val1[0]], [x_axis[1], val1[1]], 
						[x_axis[2], val1[2]], [x_axis[3], val1[3]],
						[x_axis[4], val1[4]], [x_axis[5], val1[5]], 
						[x_axis[6], val1[6]], [x_axis[7], val1[7]],
						[x_axis[8], val1[8]], [x_axis[9], val1[9]], 
						[x_axis[10], val1[10]], [x_axis[11], val1[11]]
					]
				}, {
					label: key2,
					data: [
						[x_axis[0], val2[0]], [x_axis[1], val2[1]], 
						[x_axis[2], val2[2]], [x_axis[3], val2[3]],
						[x_axis[4], val2[4]], [x_axis[5], val2[5]], 
						[x_axis[6], val2[6]], [x_axis[7], val2[7]],
						[x_axis[8], val2[8]], [x_axis[9], val2[9]], 
						[x_axis[10], val2[10]], [x_axis[11], val2[11]]
					],
					filledPoints: true // Fill points
				}];
							
				var options = {
					series: {
						points: {
							show: true
						},
						lines: {
							show: true
						}
					},
					xaxis: {										
						ticks: x_axis_ticks
					},
					yaxis: {
						// tickSize: 1000
					}
				}
				
				$('#line-graph').pixelPlot(visitsChartData, options, {
					height: 205,
					tooltipText: "'" + currency + " '" + "+y"
				});
			}
						
			if( count == 0){
				$('#line-graph').text("Please, click on refresh button to get data.");
			}else{
				var body = String("{{Result['body']|e}}").decodeHTML();
				var Result = String("{{Result}}").decodeHTML();
				body = eval(body);
				Result = JSON.parse(Result.replace(/'/g, '"'));
				if (body.length > 0){
					createLineGraph(body[0].key, body[1].key, body[0].value, body[1].value, Result.x_axis, Result.base_currency);
				}
			}
			
			function callAJAXRequest(){
				Branch = $('#ddbr-colanddis', window.parent.document).val()
				$.ajax({
					url: "/Morakot/LoanColDisRefresh",
					data: { Branch : Branch },
					type: "GET",
					beforeSend: function() {
						$('#RefreshLoanColAndDis').addClass('fa-spin');
					},
					success: function(res){
						console.log(res);
						try{
							if (res.body.length==0){
								$('#line-container').empty();
								$('#line-container').html('<div id="line-graph" class="graph" \
									style="max-height: 250px; height: 250px; padding: 0; margin: 0;width:100%;">\
									No record found.</div>');								
								$('#RefreshLoanColAndDis').removeClass('fa-spin');
								
							}else{
							$('#line-container').empty();
							$('#line-container').html('<div id="line-graph" class="graph" \
								style="max-height: 250px; height: 250px; padding: 0; margin: 0;width:100%;"></div>');
						
							createLineGraph(res.body[0].key, res.body[1].key, res.body[0].value, res.body[1].value, res.x_axis, res.base_currency);							
							$('#loancoldis').attr('title', "Last update on " + res.last_update[0] + " at " + res.last_update[1])
							$('#RefreshLoanColAndDis').removeClass('fa-spin');
						}
						}catch(err){
							console.log(err);
							if(err.name=="TypeError"){
							html = "<div class='col-sm-12'>\
										<div class='clearfix'> </div>\
										<div class='alert alert-danger'>\
											<button type='button' class='close' data-dismiss='alert'>×</button>\
											Warning,  Your session is timeout. Please kindly re-login.\
										</div>\
									</div>";
							$('#loancoldis').empty();
							$('#loancoldis').html(html);
							$('#RefreshLoanColAndDis').removeClass('fa-spin');
							}
						}
					}
				});
			}

			$('#RefreshLoanColAndDis').on("click",function(e){				
				callAJAXRequest();
			});

			window.setTimeout(function(e){
				$('#ddbr-colanddis', window.parent.document).on("change", function(){
					callAJAXRequest();
					modal = $(window.frameElement).parents('#tabcontent').find('#modalcolanddis-setting');
					modal.modal('hide');
				})
			}, 100);						
		});
	</script>
		{% if Result['body']|length >0 %}
			{% set LastUpdate = Result['last_update'] %}
		{% else %}
			{% set LastUpdate = ["", ""] %}
		{% endif %}

		<div class="panel panel-info">
			<div class="panel-heading">
				<span class="panel-title"><i class="panel-title-icon fa fa-cubes"></i>Loan Collection and Disbursement</span>
				<div class="panel-heading-controls" >
					<div class="panel-heading-icon" style="padding-top: 0px;" >
						<div style="display: flex; justify-content: space-between; width: 40px;">						
						<div style="width: 100px;">
							{% set properties = {'id':'colanddis-setting'} %}
							{% 
								set item = {'label': "Branch", 
											'field': "SelectField",
											'id':'br-colanddis',
											'name': "Branch",
											'default':session["FilterBranch"],
											'data': AccessBranch,
											'properties':{'id':'colanddis-setting'}
											}
							%}
							
							{% call WidgetSetting([item], properties) %}
							{% endcall %}
						</div>
						<div>
							<a title='Refresh' class="link" ><i id='RefreshLoanColAndDis' class='fa fa-refresh'></i></a>			
						</div>
						</div>
					</div>
				</div>
			</div>
			<div title="Last update on {{LastUpdate[0]}} at {{LastUpdate[1]}}" id="loancoldis" class="panel-body" style="max-height: 290px; height: 290px;">
				<div id="line-container" class="graph-container">
					<div id="line-graph" class="graph" style="max-height: 250px; height: 250px; padding: 0; margin: 0;">
						
					</div>
				</div>
			</div>
		</div>
{%endmacro%}


{% macro WidgetSetting(components, properties) %}
{{ caller() }}
	
	<script type="text/javascript">		
		init.push(function(){
			var id = "{{properties['id']}}";		
			idSelect = new Set();

			var DivContainer = function(){
				var divContainer = document.createElement('div');
				divContainer.setAttribute("style","display:flex; justify-content:space-between;width:100%; height:40px;");
				return divContainer;
			}
			
			function SelectField(data){
				var select = document.createElement('select');
				var defaultVal = data.default;
				select.setAttribute("name", data.name);
				select.setAttribute("id", "dd"+data.id);
				select.setAttribute("class", "form-control");
				select.setAttribute("style", "display: flex; align-self:center;");
				var div = document.createElement("div");
				div.setAttribute("style","display:flex; align-items:center");
				
				var label = document.createTextNode(data.label);
				div.appendChild(label);
				if(data.data.length > 1){
					data.data.unshift({id:"ALL", text:"ALL"});
				}
				
				for (var val of data.data){
					var option = document.createElement('option');
					
					option.setAttribute("value", val.id);				
					if (val.id === defaultVal){
						option.setAttribute("selected", "selected");
					}
					var text = val.id === val.text ? document.createTextNode(val.id): document.createTextNode(val.id + " - " + val.text);
					option.appendChild(text);
					select.appendChild(option);
				}
				var divContainer = new DivContainer();
				divContainer.appendChild(div);
				divContainer.appendChild(select);
				return divContainer;
			}

			function TextField(data){
				var input = document.createElement('input');
				var defaultVal = data.default;
				input.setAttribute("name", data.name);
				input.setAttribute("id", "dd"+data.id);
				input.setAttribute("class", "form-control");
				input.setAttribute("style", "display: flex; align-self:center;");
				var div = document.createElement("div");
				div.setAttribute("style","display:flex; align-items:center");
				
				var label = document.createTextNode(data.label);
				div.appendChild(label);
				var divContainer = document.createElement('div');
				var divContainer = new DivContainer();
				divContainer.appendChild(div);
				divContainer.appendChild(input);
				return divContainer;
			}
			var md = '<div class="modal fade" style="top:90px; z-index: 10040;" id="modal{{properties['id']}}" tabindex="-1" role="dialog" aria-labelledby="modalFilter" aria-hidden="true">\
						  <div class="modal-dialog" role="document">\
							  <div class="modal-content">\
							      <div class="modal-header">\
							        <button type="button" class="close" data-dismiss="modal">&times;</button>\
							        <h4 class="modal-title">Advance Option</h4>\
							      </div>\
							      <div class="modal-body">\
								      	<div style="display:flex; justify-content:center">\
								      	<div id="content{{properties['id']}}" style="display: flex; flex-direction:column;justify-content:space-between;width:70%;" >\
										</div>\
										</div>\
							      </div>\
							      <div id="mdfooter-{{properties['id']}}" class="modal-footer">\
							      	<button type="button" id="dbFilterBtn{{properties['id']}}" class="btn btn-primary" data-dismiss="modal">Apply</button>\
							        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\
							      </div>\
							    </div>\
						    </div>\
						</div>';
			// $('#modal'+id)

			data = $("#data"+id).val();
			$('#tabcontent', window.parent.document).append(md);
			
			data = data.replace(/'/g, '"');
			data = data.replace(/u"/g, '"');
			componentData = JSON.parse(data);
			var divContent = $('#content'+id, window.parent.document);
			divContent.empty();
			for(var component of componentData){
				// var control = new window[component.field](component);
				var control = new SelectField(component);
				divContent.append(control);
				idSelect.add("dd"+component.id);
			}
			console.log("component data", componentData);
			if (componentData.length==1){				
				$('#mdfooter-'+id, window.parent.document).remove();
			}
			var width = window.innerWidth
						|| document.documentElement.clientWidth 
						|| document.body.clientWidth;

			var baseWidth = 1256;
			var baseLeftDistance = 18;
			var windowWidthRatio = baseWidth/width;
			var distance = (baseWidth - width)/baseWidth * baseLeftDistance + baseLeftDistance;
			
			$(window.frameElement)
				.parents('#tabcontent')
				.find('#modal'+id)
				.css("left", distance + "%");
			
			$('#btnOpen'+id).on("click", function(){				
				modal = $(window.frameElement).parents('#tabcontent').find('#modal'+id);
				modal.modal('show');
			});
			
		});
	</script>
		<div id="btnOpen{{properties['id']}}">
			<input id="data{{properties['id']}}" type="hidden" value="{{components}}">
			<a title="{{properties['tip-text'] if properties['tip-text'] else 'Settings'}}" id="btnFilter{{properties['id']}}" data-toggle="modal" data-target="#modal{{properties['id']}}" class="dropbtn link" >
			  	<i class="{{properties['icon'] if properties['icon'] else 'fa fa-gear'}}"></i>
			</a>
		</div>
{% endmacro %}
