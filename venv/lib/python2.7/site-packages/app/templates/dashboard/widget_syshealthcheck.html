{% extends "layout.html" %}

{% block css %}
<style type="text/css">

	.se-pre-con1 {

		position: fixed;
		left: 0px;
		top: 0px;
		width: 100%;
		height: 100%;
		z-index: 9999;
		background: #FFF url("{{ url_for('static',filename='images/loading.gif') }}") center no-repeat;
		opacity: 0.4;
		display: none;
	}
	.modal-dialog{

		width: 300px !important;

	}
	</style>
{% endblock %}

{% block content %}

<!--  message  -->
<div class="clearfix"></div>
<div class="col-sm-12">
	{% for message in get_flashed_messages() %}
		{% if contain(message, "Error") %}
			<div class="clearfix">&nbsp;</div>
			<div class="alert alert-danger">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				{{ message }}
			</div>
		{% else %}
			<div class="clearfix">&nbsp;</div>
			<div class="alert alert-info">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				{{ message }}
			</div>
		{% endif %}
	{% endfor %}
</div>
<div class="col-sm-12" style="padding-top:5px;">
	<div class="panel {{'panel-danger' if 'Critical' in Obj.Level else 'panel-warning'}}">
		<div class="panel-heading" style="height:50px;">
			<span class="panel-title"><i class="panel-title-icon fa fa-bullhorn"></i> 
				{{Obj.Level}} : {{Obj.Title}} <span class="badge {{'badge-danger' if 'Critical' in Obj.Level else 'badge-warning'}}"> {{ErrorDetail['Total'] if Obj else 0}}</span>
			</span>
			<div class="panel-heading-controls" >
				<!-- <div class="panel-heading-icon"style="padding-top:0px;" >
					<a title='Refresh' class="link" ><i id='RefreshSystemHealthCheckDetail' class='fa fa-refresh'></i></a>
				</div> -->
				<input type="hidden" name="" id="Code" value="{{Obj.Code}}">
			</div>
		</div>
		<div class="panel-body" >
			<table  class="table table-hover table-striped panel" id="mktlist">
				<thead>
					<tr>
						<th> Code </th>
						<th> Date </th>
						<th> Branch </th>
						<th> Message</th>
						<th></th>
					</tr>
				</thead>

				<tbody>
					{% for key in ErrorDetail %}
						{%if key != 'Total'%}
							{% set Code = Obj.Code%}
							{% set Date = Obj.SystemDate%}
							{% set Branch = key%}
							{% set Message = Obj.Title%}
							<tr id="{{Branch}}" class="link">
								<td>{{Code}}</td>
								<td>{{Date}}</td>
								<td>{{BranchObj.get(Branch).Description}}</td>
								<td>{{Message}}</td>
								<td>
									<span class="badge {{'badge-danger' if 'Critical' in Obj.Level else 'badge-warning'}}">{{ErrorDetail[Branch]['Total']}}</span>
								</td>
							</tr>
							<script type="text/javascript">
									init.push(function () {
										$("#{{Branch}}").click(function(){
											window.parent.addTab("System Health Check - {{Branch}}", "/Morakot/SysHealthCheckDetail/?Branch={{Branch}}&Code={{Code}}");

										});
									});
							</script>
						{%endif%}
					{% endfor %}
				</tbody>
			</table>
		</div> <!-- panel-body -->
	</div> <!-- panel panel-info -->
</div> <!-- col-sm-12 -->
	
{% endblock %}

{% block js %}

<script type="text/javascript">

	$(document).ready(function() {
		$("#RefreshSystemHealthCheckDetail").click(function(){
			$("#RefreshSystemHealthCheckDetail").addClass("fa-spin");
			fn_fadeIn();
			window.location.reload(true);
			
		});
	});

</script>

<!-- <script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script> -->

<script type="text/javascript">
	$(document).ready(function() {

		$('#mktlist').dataTable({
		"lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
		"bSort" : false
		});
		$('#mktlist_filter').hide()
		$('.table-header').hide()
		$("#SpinOnClick").click(function(){
			$("#iConSpin").addClass("fa-spin");
			window.location.reload(true);
			
		});
	});
</script>

{% endblock %}