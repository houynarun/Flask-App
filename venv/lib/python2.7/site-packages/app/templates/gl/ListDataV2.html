{% macro getFormat(OpenTag, Value) %}
    {% if OpenTag.upper() == "B" %}
        <b>{{Value}}</b>
    {% elif OpenTag.upper() == "I" %}
        <i>{{Value}}</i>
    {% elif OpenTag.upper() == "BI" %}
        <b><i>{{Value}}</i></b>
    {% else %}
        {{Value}}
    {% endif %}
{% endmacro %}

{% macro getValue(Value) %}
    {% set a = Value.replace(',','') %}
        {% if a[0]=='(' and a[-1]==')' %}
            {% set a = a.replace('(','') %}
            {% set a = a.replace(')','') %}
            {{0.0 - a|float}}
        {% else %}
            {{a|float}}
        {% endif %}
{% endmacro %}

{% macro formatResult(format, CurrencySymbol, Currency, Value) %}
{# 1 - Check negative value #}
{% if Value < 0 %}
    {{ getFormat(format, CurrencySymbol + ' (' + mktmoney.toMoney(Value|abs, mktmoney.getCurrencyObj(Currency))+')')}}
{% else %}
    {{ getFormat(format, CurrencySymbol + ' ' + mktmoney.toMoney(Value|abs, mktmoney.getCurrencyObj(Currency)))}}
{% endif %}



{% endmacro %}


<table id="mktFR" class="table table-striped table-borderless table-hover" cellspacing="0" width="100%">
    <tbody>
        {% if ReportDataDict %}
        <tr>
            <td class="text-bold">Description</td>
            <td class="text-center text-bold" colspan="{% if showTotal=='No' %}{{MonthList|length}}{% else %}{{MonthList|length + 1}}{% endif %}">{{Year}}</td>
        </tr>
            <tr>
                <td></td>
                {% set Month = {
                                    '01':'January',
                                    '02':'February',
                                    '03':'March',
                                    '04':'April',
                                    '05':'May',
                                    '06':'June',
                                    '07':'July',
                                    '08':'August',
                                    '09':'September',
                                    '10':'October',
                                    '11':'November',
                                    '12':'December'
                                    } %}
                {% for m in ReportDataDict %}
                    {% set monthIndex = '0'+m['Info']['Month'] if m['Info']['Month']|length ==1 else m['Info']['Month'] %}
                    <td class="text-right text-bold">{{Month[monthIndex]}}</td>
                {% endfor %}
                {% if showTotal=='Yes' %}
                    <td class="text-right text-bold">Total</td>
                {% endif %}
            </tr>
        {% endif %}
        {% for key,row in ReportData['Data']|dictsort %}
            {% if HideZeroBal == 'No' %}
                {% if row.Type.upper() == "GH" %}
                    <tr>
                        <td>{{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}</td>
                        {% if ReportDataDict %}
                                {% set total = {'total':0.0} %}
                                {% for item in ReportDataDict %}
                                {% set a = getValue(item['Data'][key]['Value']) %}
                                {% if total.update({'total':total['total']+a|float}) %}{% endif %}
                                    <td class="text-right">
                                        {% if item['Data'][key]['Value'].replace(',','')|float != 0 %}
                                            {% set total = total + item['Data'][key]['Value'] %}
                                            {{getFormat(item['Data'][key]['Format'],item['Data'][key]['CurrencySymbol']+ ' ' +item['Data'][key]['Value'])|safe}}
                                        {% endif %}
                                    </td>
                                {% endfor %}
                                
                        {% else %}
                            <td class="text-right">
                                {{ getFormat(row.Format, row.CurrencySymbol+' '+row.Value)|safe }}
                            </td>
                        {% endif %}
                        {% if showTotal=='Yes' %}
                            <td></td>
                        {% endif %}
                    </tr>
                {% elif row.Type.upper() == "LD" %}
                    <tr>
                    {%if DebugMode %}
                        <td><a href="javascript:void(0)" style="color: #555;" 
                            onclick="CustomClickView('{{row.Description}}','LineValue/{{row.ID}}')" title="Preview"
                        >{{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}</a></td>
                    {%else%}
                        <td>{{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}</td>
                    {%endif%}
                    {% if ReportDataDict %}
                        {% set total = {'total':0.0} %}
                        {% set formatDict = {} %}
                        {% for item in ReportDataDict %}
                            {% if loop.first %}
                                {% if formatDict.update({'Currency':item['Data'][key]['Currency']}) %}{% endif %}
                                {% if formatDict.update({'CurrencySymbol':item['Data'][key]['CurrencySymbol']}) %}{% endif %}
                            {% endif %}
                        {% set a = getValue(item['Data'][key]['Value']) %}
                        {% if total.update({'total':total['total']+a|float}) %}{% endif %}
                            <td class="text-right">
                                {{getFormat(item['Data'][key]['Format'],item['Data'][key]['CurrencySymbol']+ ' ' +item['Data'][key]['Value'])}}
                            </td>
                        {% endfor %}
                        {% if showTotal=='Yes' %}
                            <td class="text-right">
                                {{formatResult('B', formatDict['CurrencySymbol'], formatDict['Currency'],total['total'])}}
                            </td>
                        {% endif %}
                    {% else %}
                        <td class="text-right">
                            {{ getFormat(row.Format, row.CurrencySymbol+' '+row.Value)|safe }}
                        </td>
                    {% endif %}
                    </tr>
                {% elif row.Type.upper() == "ST" %}
                    <tr>
                        <td>
                            <p style="padding-top: 7px;">
                            {{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}
                            </p>
                        </td>
                    {% if ReportDataDict %}
                        {% set total = {'total':0.0} %}
                        {% set formatDict = {} %}
                        {% for item in ReportDataDict %}
                            {% if loop.first %}
                                {% if formatDict.update({'Currency':item['Data'][key]['Currency']}) %}{% endif %}
                                {% if formatDict.update({'CurrencySymbol':item['Data'][key]['CurrencySymbol']}) %}{% endif %}
                            {% endif %}
                            {% set a = getValue(item['Data'][key]['Value']) %}
                            {% if total.update({'total':total['total']+a|float}) %}{% endif %}
                            <td class="text-right">
                                <p style="border-top: 1px solid #CCC; padding-top: 5px;">
                                    {{getFormat(item['Data'][key]['Format'],item['Data'][key]['CurrencySymbol']+ ' ' +item['Data'][key]['Value'])}}
                                </p>
                            </td>
                        {% endfor %}
                        {% if showTotal=='Yes' %}
                            <td class="text-right">
                                <p style="border-top: 1px solid #CCC; padding-top: 5px;">
                                        {{formatResult('B', formatDict['CurrencySymbol'], formatDict['Currency'],total['total'])}}
                                </p>
                                {% set total = {'total':0.0} %}
                            </td>
                        {% endif %}
                    {% else %}
                        <td class="text-right">
                            {{ getFormat(row.Format, row.CurrencySymbol+' '+row.Value)|safe }}
                        </td>
                    {% endif %}
                    </tr>
                {% else %}
                    <tr>
                        {% set extraTD = 2 if showTotal=='Yes' else 1%}
                        {% for td in range(ReportDataDict|length+extraTD) %}
                            <td>&nbsp;</td>
                        {% endfor %}
                    </tr>
                {% endif %}
            
            {% else %}
                {% if row.Type.upper() == "GH" %}
                    <tr>
                        <td>{{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}</td>
                        <td></td>
                    </tr>
                {% elif row.Type.upper() == "LD" %}
                    {% if row.Value != '0.00' %}
                        <tr>
                        {%if DebugMode %}
                            <td><a href="javascript:void(0)" style="color: #555;" 
                                onclick="CustomClickView('{{row.Description}}','LineValue/{{row.ID}}')" title="Preview"
                            >{{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}</a></td>
                        {%else%}
                            <td>{{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}</td>
                        {%endif%}
                            <td class="text-right">
                                {{ getFormat(row.Format, row.CurrencySymbol+' '+row.Value)|safe }}
                            </td>
                        </tr>
                    {% endif %}
                    
                {% elif row.Type.upper() == "ST" %}
                    {% if row.Value != '0.00' %}
                        <tr>
                            <td>
                                <p style="padding-top: 7px;">
                                {{ row.Indent|safe }}{{ getFormat(row.Format,row.Description)|safe }}
                                </p>
                            </td>
                            <td class="text-right">
                                <p style="border-top: 1px solid #CCC; padding-top: 5px;">
                                {{ getFormat(row.Format, row.CurrencySymbol+' '+row.Value)|safe }}
                                </p>
                            </td>
                        </tr>
                    {% endif %}
                {% endif %}
            {% endif %}

        {% endfor %}
    </tbody>
</table>
