{% extends "layout.html" %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/jquery.datatables.css') }}">
	<style type="text/css">
		#title {
			margin-top: 30px;
			margin-bottom: 30px;
		}
		#Amend {
			width: 50%;
		}
		#Download {
		    background:none!important;
		    border:none; 
		    padding:0!important;
		    /*border is optional*/
		    /*border-bottom:1px solid #444; */
		    cursor:pointer;
		    color:#1d89cf;
			margin-bottom: 4px;
			margin-left: 4px;
		}
		#form-group {
			margin-bottom: 15px;
		}
	</style>
{% endblock %}

{% block content %}

    <div class="modal fade" id="getCustomRange" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="form-horizontal" action="/Morakot/Report/NBC/CTR" method="POST" id="form-submit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Custom</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                        	{% for field in form %}
                        		<div class="col-sm-12" style="margin-bottom: 15px;">
	                        		{{ field.label(class_='col-sm-4 control-label')}}
		                            <div class="col-sm-8">
					        			{% if field.type == 'DateField' %}
											{{ field(class_='input-sm form-control', placeholder='YYYY-MM-DD', style='width: 50%') }}
											<script type="text/javascript">
												init.push(function () {
													var options = {
														orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
														format:"yyyy-mm-dd",
														autoclose:true
													}
													$('#{{field.id}}').datepicker(options);
												});
											</script>
										{% elif field.type == 'SelectField' %}
											{{ field(class_='form-control', style='width: 50%') }}
			                                <script type="text/javascript">
			                                    init.push(function () {
			                                        // Single select
			                                        $("#{{field.id}}").select2({
			                                            allowClear: true,
			                                            placeholder: "{{field.id}}"
			                                        });
			                                    });
			                                </script>
										{% else %}
											{{ field(style='width: 50%') }}
										{% endif %}
		                            </div>
                        		</div>
                        	{% endfor %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="Apply" onclick="ApplyClick()"> Apply </button>
                        <button type="button" class="btn btn-default" data-dismiss="modal"> Cancel </button>
                    </div>
                </form>
            </div>
        </div>
    </div>



    <div class="navbar navbar-default navbar-static-top">
        <div class="col-sm-6" style="margin-top: 15px;">
			<div id="exportButton">
				<b>Also available in :</b>
				<a id="xml" style="cursor:pointer; color:#1d89cf;" onclick="DownloadClick()"> <i class='fa fa-files-o'></i> XML &nbsp;</a>
			</div>
        </div>
        <div class="col-sm-6" style="margin-top: 8px;">
            <button type="button" class="btn btn-flat btn-labeled btn-success pull-right" data-toggle="modal" data-target="#getCustomRange">
                <span class="btn-label icon fa fa-gear"></span> Custom
            </button>
        </div>
    </div>

    <div class="clearfix"></div>


	<div class="col-sm-12" style="margin-bottom: 30px;">
		<h3 class="header-3 text-center">Cash Transaction Report</h3>
	</div>

	{% for field in form %}
		<div class="col-sm-12">
			{% if field.errors %}
				{% for error in field.errors %}
					<div class="alert alert-danger">
						<a href="#">{{field.label}}</a> {{ error }}
					</div>
				{% endfor %}
			{% endif %}
		</div>
	{% endfor %}

	{% for error in ErrorMsg %}
		<div class="col-sm-12">
			<div class="alert alert-danger">
				{{error | safe}}
			</div>
		</div>
	{% endfor %}

	{% if ResultDict %}
		{% for row in getCurrencyObj() %}
			<div class="col-sm-12">
		        <table>
	            <tbody>
	            	<tr>
		                <td width="150"><strong>{{row.ID}} Other Rate 1</strong></td>
		                <td>: &nbsp;{{row.OtherRate1}}  </td>
		            </tr>
		        </tbody>
		        </table>
    		</div>
		{% endfor %}
	{% endif %}

	<div class="col-sm-12" style="padding-top: 20px">
		<table id="mktlist" class="display" cellspacing="0" width="100%">
			<thead>
				<tr>
					<th>Branch</th>
					<th>Transaction Date</th>
					<th>Account</th>
					<th>Customer</th>
					<th>Full Name</th>
					<th>Currency</th>
					<th>Total</th>
					<th>Total (Riel)</th>
				</tr>
			</thead>
			<tbody>
				{% if ResultDict %}
					{% for row in ResultDict %}
						<tr>
							<td>{{row.Branch}}</td>
							<td>{{row.TransactionDate}}</td>
							<td><a href="javascript:void(0)" onclick="DrawDownClick('{{row.Account}}')">{{row.Account}}</a></td>
							<td><a href="javascript:void(0)" onclick="CustomClickView('Customer Centre','CustomerCentre?Search={{row.Customer}}')">{{row.Customer}}</a></td>
							<td>{{row.Fullname}}</td>
							<td>{{row.Currency}}</td>
							<td>{{row.Total}}</td>
							<td>{{row.TotalRiel}}</td>
						</tr>
					{% endfor %}
				{% else %}
					<tr>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
				{% endif %}
			</tbody>
		</table>
	</div>


{% endblock %}

{% block js %}
<script type="text/javascript">

	function DrawDownClick(ID) {
		var Start = $('#StartDate').val();
		var End = $('#EndDate').val();
		CustomClickView('Account Statement','AccountStatement?ID='+ID+"&Start="+Start+"&End="+End);
	}

	function DownloadClick() {

		if (!$('#Download').length) {
			$('<input>').attr({
	    			type: 'hidden',
	    			id: 'Download',
	    			name: 'Download'
			}).appendTo('#form-submit');
		}

		$("#form-submit").submit();
	}

	function ApplyClick() {

		if ($('#Download').length) {
			$('#Download').remove();
		}

		$("#form-submit").submit();

	}

	$(document).ready(function() {

        function fn_fadeIn(){
                var $getParentEle = window.parent.$("#animated")
                $getParentEle.fadeIn("slow");
        }
        $('#mktlist').dataTable({
           "lengthMenu": [[25,50,100,200, -1], [25,50,100,200, "All"]],
           "bSort": false,
            "sScrollX": "100%",
            "bScrollCollapse": true
        });
 		$("#form_submit").click(function() {
                fn_fadeIn();
        });

	});
</script>
{% endblock %}