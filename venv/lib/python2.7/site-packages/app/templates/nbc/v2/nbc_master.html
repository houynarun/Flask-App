{% extends "layout.html" %}

{% import 'nbc/v2/nbc_template.html' as nbc %}


{% block css %}
   
{{nbc.setStyleNBCReport()}}

{% endblock %}
{% block content %}
    <div class="navbar navbar-default navbar-static-top">
        <div class="col-sm-6" style="margin-top: 15px;">
            <!-- Button Export -->
            {{exportButtonLink(ID,Branch,Period,ReportedDate,Year,Month)}}
        </div>

        <div class="col-sm-6" style="margin-top: 8px;">
            <a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
                <span class="btn-label icon fa fa-refresh"></span> Refresh
            </a>
            <button type="button" class="btn btn-flat btn-labeled btn-success pull-right" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">
                <span class="btn-label icon fa fa-gear"></span>   {{ getLanguage('Custom') }} 
            </button>
        </div>

    </div>
    {% if Result %}
       <!-- Call Header NBC Report -->
        {{  nbc.getHeaderReport(
                Title           =   Result['ReportHeader']['Title'],
                ReportName      =   Result['ReportHeader']['ReportName'],
                AsOf            =   Result['ReportHeader']['AsOf'],
                CompanyName     =   Result['ReportHeader']['CompanyName'],
                SubTitleReport  =   Result['ReportHeader']['SubTitleReport'],
                ReportingRate   =   Result['ReportHeader']['ReportingRate'],
                NetWorth        =   Result['ReportHeader']['NetWorth']
        )}}
        <!-- Call Header NBC Report -->

        <div class="col-sm-12">
          
            <table id="mktlist" {{nbc.setTableStyle()}}>
                <thead>
                    {%for row in Result.TableHeader %}
                        <tr class="nbc-bg-header">
                            {%for col in Result.TableHeader[row] %}
                                <th colspan="{{col.Colspan}}" rowspan="{{col.Rowspan}}" class="{{col.Class}}" style="{{col.Style}}">{{nbc.mktMarkup(col.Text)}}</th>
                            {%endfor%}
                        </tr>
                    {%endfor%}

                </thead>
                <tbody>

                    {%for row in Result['Data']%}
                        {% set rowloop = loop %}
                        <tr>
                            {%for col in row  | sort %}
                                {%if not col in Result.ReportHeader.EXCLUDE_KEY_FORMAT %}
                                    <td {{nbc.setRowStyle(row,loop.first)}}>{{nbc.mktMarkup(row.get(col))}}</td>
                                {%endif%}
                            {%endfor%}
                          
                        </tr>
                    {%endfor%}

                </tbody>
                
            </table>
        </div>
    {% endif %}
{% endblock %}

{% block js %}
    {% from "print.html" import exportIncludeJS %}
    {{exportIncludeJS()}}

    <script type="text/javascript">

        $(document).ready(function() {
            
            {% from "print.html" import exportTable %}
            {{exportTable("#mktlist","NBC_REPORT")}}
            $("#Refresh").click(function() {
                fn_fadeIn();
                window.location.reload(true);
            });
        });
    </script>
    <script type="text/javascript">

        $(function(){

            init.push(function () {
                var options = {
                orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
                format:"yyyy-mm-dd",
                autoclose:true
                }
                $('#ReportedDate').datepicker(options);
            });

            $('[data-toggle="modal"]').on("click", function(e) {
                e.preventDefault();
                var url = $(this).attr('href');
                if (url.indexOf('#') == 0) {
                    // $(url).modal('open');
                    return false;
                } else {
                    $.get(url, function(data) {
                         $('<div class="modal">' + data + '</div>').modal();
                    }).success(function() {
                        $('input:text:visible:first').focus();
                    });
                }
            });

        });

    </script>
    <!-- Call in Block Js -->

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                {% set ReportType = ''%}
                {% if Type == 'MFI' %}
                    {% set ReportType = 'getNBCMFIReportDetail'%}
                {% elif Type == 'NGO' %}
                    {% set ReportType = 'getNBCNGOReportDetail'%}
                {% elif Type == 'BANK' %}
                    {% set ReportType = 'getNBCBANKReportDetail'%}
                {% elif Type == 'BANK1' %}
                    {% set ReportType = 'getNBCBANK1ReportDetail'%}
                {% endif %}

                <form class="form-horizontal" action="{{ url_for(ReportType, ID = ID) }}" method="GET">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">{{ getLanguage('Custom') }}</h4>
                    </div>

                    <div class="modal-body">
                        
                        <div class="form-group">
                            <label for="InDollar" class="col-sm-4 control-label">{{ getLanguage('Branch') }}:</label>
                            <div class="col-sm-8">
                                <input class="form-control input-sm" name="Branch" style="width: 100%;" id="Branch" value="{{ Branch }}">
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">{{ getLanguage('Apply') }}</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">{{ getLanguage('Cancel') }}</button>
                    </div>

                </form>
            </div>
        </div>
    </div>

{% endblock %}
{% macro exportButtonLink(ID='', Branch='', Period='', ReportedDate='',Year='',Month='') %}
    <div id="exportButton">
        <b>Also available in :</b>
        <a title="Download to Excel" href="/Morakot/Report/NBC/{{Type}}/Excel/{{ID}}?Branch={{ Branch }}&Period={{ Period }}&ReportedDate={{ ReportedDate }}&Year={{Year}}&Month={{Month}}" style="cursor:pointer;"> 
            <i class='fa fa-file-excel-o'></i> Current Report to Excel
        </a> | 
        <a href="javascript:void(0)" id="print"><i class='fa fa-print'></i>&nbsp;Print</a>
    </div>
{% endmacro %}