{% extends "layout.html" %}
{% block css %}
	<script src="{{ url_for('static',filename='javascripts/credit-score-gauge-chart.js') }}"></script>
	<style type="text/css">
		.form-control
	{
		width: 100% !important;
	}
		.container{
			width: 80%;
			margin-top: 30px;
			color: gray;
			border: 2px solid #ececec;
		}
		.credittitle{
			font-weight: bold;
			font-size: 24px;
			margin-top: 20px;
			position: relative;

		}
		.companyname{
			font-weight: bold;
			margin-top: 15px;
		}
		.grouptitle{
			padding-left :10px;
			font-size: 14px;
		}
		.score{
			font-size: 20px;
			margin-top: 20px;
		}
		html,body{height: 100%;width: 100%;}
		#myChart{height: 100%;width: 100%;}
	</style>
{% endblock%}

{% block content %}
	{# block header#}
	{% if OptToolbar =='Y' %}
		<div class="navbar navbar-default navbar-static-top">
			<form method="GET" id="frm" name="frm" role="form" action="/Morakot/CreditScoreTemplate">
				<div class="col-sm-12">

					<div class="col-sm-3" style="margin-top:8px; padding:0px">
						{% from "print.html" import searchCustomer %}
						{{searchCustomer('/Morakot/SearchCreditID','ID',ResultDict.get('Data').get('ID'),'','Input Name or Credit ID')}}
					</div>			 
					<div class="col-sm-6" style="margin-top:8px;">
						<label>
							<button type="submit" class="btn btn-flat btn-labeled btn-primary" id="btnShow" style="padding: 7px 25px;">
								{{ getLanguage('Show') }}
							</button>
						</label>

					</div>
					
				</div>
			</form>
		</div>
	{%endif%}

	{% set Data = ResultDict.get("Data")%}
	{% if Status==True %}
		<div class="container">
			
			<div class="row" >
				<div class="col-xs-3" style="">
					<!-- <img src="{{url_for('static',filename='company/logo.jpg')}}" width="130px" alt="" style="margin-top: 20px;"> -->
					<p class="companyname">{{Data.get("CompanyName","")}}</p>
				</div>
				<div class="col-xs-6 text-center credittitle">Client Credit Scoring</div>
				<div class="clearfix">
				</div>
				<div class="col-xs-12 text-left text-bold" style="font-size: 18px;">
					{{Data.get("Recommendation","")}}
				</div>	
			</div>
			<div class="row">
				<!-- Javascript -->
				<script>
					var Group = {{Data.get("Group")|tojson|safe}};
					var ListLabel = [];
					var ListColor = [];
					for (var i in Group) {
						Label = { label:Group[i].Description , value: Group[i].Percentage }
						ListLabel.push(Label);
						ListColor.push(Group[i].TextColor);
					}
					init.push(function () {
						// console.log(PixelAdmin.settings.consts.COLORS)
						Morris.Donut({
							element: 'hero-donut',
							data: ListLabel,
							colors: ListColor,
							resize: true,
							labelColor: '#888',
							formatter: function (y) { return y + "%" }
						});
					});
				</script>
				<!-- / Javascript -->

				<div class="">
					<div class="panel-body" style="margin-bottom: 0px;padding-bottom: 0px;">
						<hr>
						<h4>Credit score composition</h4>
						<div class="col-xs-12">
							<div class="col-xs-6 col-sm-4 col-lg-4" style="margin-top: 20px;">
								{% set Group = Data.get("Group",{})%}
								{% for Key,Value in Group.items() %}
								<div class="col-xs-2" style="background-color:{{Value.get('TextColor')}};width:22px;height:22px;margin-bottom: 10px;">
											
								</div>
								<div class="col-xs-10 grouptitle">{{Value.get("Description")}} ({{Value.get("Percentage","0.00")}}%)</div>
								<div class="clearfix">
								</div>
								{% endfor%}
							</div>
							<!-- Donut-->
							<!-- <div class="col-xs-4">
								<div class="graph-container" style="padding-top: 0px;">
									<div id="hero-donut" class="graph" style="height: 200px;"></div>
								</div>
							</div> -->
							<div class="col-xs-6 col-sm-4 col-lg-4">
								<div id='ZingChart'></div>
							</div>	
							<div class="col-xs-12 col-sm-4 col-lg-4 text-center text-bold score">
								<p>Score (%)</p>
								<p style="font-size: 52px;">{{Data.get("TotalScorePercentage","0.00")}}</p>
								<p style="color: {{Data.get('TextColor')}}">{{Data.get("DefineDesc")}}</p>
							</div>
						</div>
					</div>
					<div class="panel-body" style="padding-top: 0px;">
						<hr>
						<h4>Informations Summary</h4>
						<div class="col-xs-3"><p>Credit Type</p></div>
						<div class="col-xs-9"><p>: {{Data.get("QuestionnaireDesc","")}}</p></div>

						<div class="col-xs-3" ><p>Reported Date</p></div>
						<div class="col-xs-9"><p>: {{Data.get("ReportedDate","")}}</p></div>

						<div class="col-xs-3"><p>Report ID</p></div>
						<div class="col-xs-9"><p>: {{Data.get("ID","")}}</p></div>

						<div class="col-xs-3"><p>Customer Name</p></div>
						<div class="col-xs-9"><p>: {{Data.get("FirstNameEn","")}} {{Data.get("LastNameEn","")}}</p></div>
						
						<div class="col-xs-3"><p>Gender</p></div>
						<div class="col-xs-9"><p>: {{Data.get("Gender","")}}</p></div>

						<div class="col-xs-3"><p>Total Score</p></div>
						<div class="col-xs-9"><p>:<strong> {{Data.get("TotScore","")}}</strong></p></div>

						<div class="col-xs-3"><p>Max Score</p></div>
						<div class="col-xs-9"><p>:<strong> {{Data.get("TotalMaxScore","")}}</strong></p></div>

						<div class="col-xs-3"><p>Recommendation</p></div>
						<div class="col-xs-9"><p>:<strong> {{Data.get("Recommendation","")}}</strong></p></div>
					</div>

				</div>

				<div class="col-sm-12 col-xs-12">
				  <button type="button" class="btn btn-primary pull-right" style="margin-bottom: 20px;" data-toggle="collapse" data-target="#demo">More Detail >> </button>
				  <div id="demo" class="collapse out">
				  	<div class="col-sm-12 col-xs-12" style="overflow-x:auto;">
					    <table class="table table-hover">
						  <thead>
						    <tr>
						      <th scope="col">#</th>
						      <th scope="col">Attribute</th>
						      <th scope="col">Attribute type</th>
						      <th scope="col">Group</th>
						      <th scope="col">Answer 1</th>
						      <th scope="col">Answer 2</th>
						      <th scope="col" class="text-center">Weight</th>
						      <th scope="col" class="text-center">Score</th>
						      <th scope="col" class="text-center">Total Score</th>
						    </tr>
						  </thead>
						  <tbody>
						  	{% if Report %}
							  	{% set i = 1 %}
							  	{% for credit in Report.get('report') %}
							    <tr>
							      <th scope="row">{{i}}</th>
							      <td>
							      	{{credit.question_description}}
							      </td>
							       <td>
							      	{% if credit.type =="Survey" %}
							      	<p style="color:{{credit.survey_color}}">
							      	{% else %}
							      	<p style="color:{{credit.credit_color}}">
							      	{% endif %}
							      		{{credit.type}}
							      	</p>
							      </td>
							      <td>{{credit.group_description}}</td>
							      <td>
							      	{% if credit.type=="Survey" %}
							      	<span style="color:#1d55a9;cursor: pointer;" onclick="CustomClickViewIFrame('Survey','Survey/?ID={{credit.source_survey}}')">{{credit.answer_1}}</span>
							      	
							      	{% elif credit.type=="Credit Score" %}
							      	<span style="color:#1d55a9;cursor: pointer;" onclick="CustomClickViewIFrame('CreditAttribute','CreditAttribute/?ID={{credit.source_survey}}')">{{credit.answer_1}}
							      	</span>
							      	{% endif %}
							      </td>
							      <td>
							      	{% if credit.type=="Survey" %}
							      	<span style="color:#1d55a9;cursor: pointer;" onclick="CustomClickViewIFrame('Survey','Survey/?ID={{credit.target_survey}}')">{{credit.answer_2}}</span>
							      	{% elif credit.type=="Credit Score" %}
							      	<span  style="color:#1d55a9;cursor: pointer;" onclick="CustomClickViewIFrame('CreditAttribute','CreditAttribute/?ID={{credit.target_survey}}')">{{credit.answer_2}}
							      	</span>
							      	{% endif %}
							      </td>
							     
							      <td class="text-center">{{credit.weight}}</td>
							      <td class="text-center">{{credit.score}}</td>
							      <td class="text-center">{{credit.total_score}}</td>
							    </tr>
							    {% set i = i + 1 %}
							    {% endfor %}
							{% else %}
								<p>No record found.</p>
							{% endif %}

						  </tbody>
						</table>
					</div>
					<div class="col-sm-12" style="margin-bottom: 15px">
						<div class="col-sm-12 col-xs-12">
							<h5><strong><u>Note:</u></strong></h5><p><b>Here is score classification (%).</b></p>
						</div>
						<div class="col-sm-12 col-xs-12">
							<table>
								<tbody>
									<tr>
									</tr>
									{% if CreditDefine %}
										{% for credit in CreditDefine.get('credit_define') %}
										<tr>
											<th width="120"># {{credit.range}}</th>
											<td>{{credit.description}}</td>
										</tr>
										{% endfor %}
									{% endif %}
								</tbody>
							</table>
						</div>
					</div>
				  </div>
				</div>
		</div>
	{% else %}
	{% set Msg = ResultDict.get("Message") %}
	{%if Msg%}		
		<div>
			<div class="alert alert-warning">
	       <button type="button" class="close" data-dismiss="alert">&times;</button>
	          {{Msg}}
	       </div>		
		</div>
	{%endif%}
		{%if Data.get("ID") and CreditStatus!=""%}
			{# ID not found or don't have ID will not show option retry checking #}
			<div class="alert alert-info">
				<div  style="display: inline;">
							<p style="float: left;margin-right: 5px;">Do you want to re-check those fail credit score ?</p>
							<form style="float: left;">
								<a class='btn btn-flat btn-success btn-xs' href="?ID={{ Data.get("ID")}}&Accept=Y" onclick="fn_fadeIn();">Yes</a>
								<!-- <a href="?Accept="N"  class='btn btn-flat btn-danger btn-xs space' >No</a> -->
							</form>
				</div>&nbsp;
				<button type="button" id ="btnNo" class="btn btn-flat btn-danger btn-xs" data-dismiss="alert">No</button>
			</div>
		{%endif%}
	{% endif %}

{% endblock%}

{% block js %}

<script type="text/javascript">
	var myConfig6 = {
		  "type":"gauge",
		  "scale-r":{
		    "aperture":200,
		    "values":"0:100:20",
		    "center":{
		      "size":5,
		 	    "background-color":"#66CCFF #FFCCFF",
		 	    "border-color":"none"
		    },
		    "ring":{  //Ring with Rules
		      "size":10,
		      "rules":[
		        {
		          "rule":"%v >= 0 && %v <= 20",
		 	        "background-color":"red"
		        },
		        {
		          "rule":"%v >= 20 && %v <= 40",
		 	        "background-color":"orange"
		        },
		        {
		          "rule":"%v >= 40 && %v <= 60",
		 	        "background-color":"yellow"
		        },
		        {
		          "rule":"%v >= 60 && %v <= 80",
		 	        "background-color":"green"
		        },
		        {
		          "rule":"%v >= 80 && %v <=100",
		          "background-color":"blue"
		        }
		      ]
		    }
		  },
		  "plot":{
		    "csize":"5%",
		    "size":"100%",
		    "background-color":"#000000"
		  },
		  "series":[
		    {"values":[{{ResultDict.get("Data").get("TotalScorePercentage","0.00")}}]}
		  ]
		};
		 
		zingchart.render({ 
			id : 'ZingChart', 
			data : myConfig6, 
			height : "230px", 
			width: "230px"
		});

</script>

<script type="text/javascript">

	function CustomClickViewIFrame(Title,Url) {
    	// you're in an iframe
		if ( self !== top ) {
			window.parent.window.parent.addTab(Title, Url);	        
	    }else{
	        window.parent.window.parent.open("/Morakot/"+Url);
	    }
	}
    
</script>

{% from "print.html" import exportIncludeJS %}
{{exportIncludeJS()}}
<script type="text/javascript">

	$(document).ready(function() {

		$('#btnShow').on('click', function(event){
			fn_fadeIn();
		});
		$('#btnYes').on('click', function(event){
			fn_fadeIn();
		});
		$('#btnNo').on('click', function(event){
			window.location.href = window.location.pathname;
		});
	});

</script>
{%endblock%}
