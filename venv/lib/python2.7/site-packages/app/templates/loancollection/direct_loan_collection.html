{% extends "loancollection/loan_collection.html" %}

{% block js %}
{{super()}}

<script type="text/javascript">
	$(document).ready(function(e){
		var IsDisabled = "{{disabled}}";
		var VolSavingDict = JSON.parse('{{VolSavingDict|safe}}');
		console.log("QUERY OBJ", VolSavingDict);

		$(function(){
			
			$('#Officer').unbind("change");
			$('#Currency').unbind('change');

			// To make sure that this block run lastly.
			if (IsDisabled === ""){
				setTimeout(function(){
					$("#OfficerAccount").val("{{Account}}");
					$("#OfficerCategory").val("{{AccCategory}}");
				}, 200);
			}
		});

		$(function(){
			officerAccParent = $("#OfficerAccount").parent();
			officerCatParent = $("#OfficerCategory").parent();

			officerAccParent.siblings("label").text("Account");
			officerCatParent.siblings("label").text("Category");

			$("#frmGenerate").attr("action", "/Morakot/DirectGLoanCollection");
			$("#frmGenerate").on("submit", function(){
				$("#OfficerAccount").val("{{Account}}");
				$("#OfficerCategory").val("{{AccCategory}}");
				$("#OfficerBalance").val("{{AvailableBal}}");
			});
			
			if (IsDisabled === ""){
				$("#Currency").on("change", function(){
					$.getJSON('/Morakot/GenerateDisbursementAccountEx', {
						Currency:$('#Currency').val(),Officer:$('#Officer').val()
						}, function(data) {
							$('#OfficerAccount').val(data.OfficerAccount);
							$('#OfficerCategory').val(data.OfficerCategory);
						});
						
						return false;
				});
			}
		});

		$(function(){
			VolSavingKeys = Object.keys(VolSavingDict);
			for(var hasVolSaving of VolSavingKeys){

				var SavingAmount = $('#SavingAmount_' + hasVolSaving);
				if (VolSavingDict[hasVolSaving] === "N"){
					SavingAmount.prop("disabled", true);
				} else if(VolSavingDict[hasVolSaving] === "Y"){
					SavingAmount.prop("disabled", false);
				}
			}
		});

		// To make enable input field, so that the front end will send data from our disabled Saving Amount field. If we don't do this, we will get Bad Request error.
		$('#Save').on('click', function(){
			for(var hasVolSaving of VolSavingKeys){
				$('#SavingAmount_' + hasVolSaving).prop("disabled", false);
			}
		});
		
	});
</script>

{% endblock %}