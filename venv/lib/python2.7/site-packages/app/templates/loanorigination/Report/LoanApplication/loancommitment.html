{% extends "layout.html" %}

{% block css %}
<style type="text/css">
.table-borderless td,
.table-borderless th
{
	border: 0 !important;
	padding-top: 3px !important;
	font-size: 14px;
}
th.table-header{
	border-bottom: 2px solid #ccc !important;
}
 h3.header-3{
            color: #888 !important;
            font-size: 16px;
            font-weight: bold;
            margin: 5px 0 10px;
            padding: 10px 18px 0;
        }

        h4.header-4{
            color: #888 !important;
            font-size: 14px;
            font-weight: normal;
            margin: 5px 0 10px;
            padding: 0px 18px 0;
        }
  table.dataTable tfoot th, table.dataTable tfoot td {
            border-top: 1px solid #111111;
            padding: 10px 10px 6px;
        }
</style>
{% endblock %}


{% block content %}
<form method="GET" id="frm" name="frm" role="form" >
<!-- Modal -->
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" style="display: none;">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
				<h4 class="modal-title" id="myModalLabel">Custom</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
				         <label for="Branch" class="col-sm-3 control-label"><label for="Branch"> Branch: </label></label>
				    <div class="col-sm-5">
				        <input class="form-control" id="Branch" name="Branch" type="text" value="{{Result['Branch']}}" style="width: 210px;">
				    </div>
				    </div>

				<div class="form-group">
					<label for="CRO" class="col-sm-3 control-label"> CRO: </label>
					<div class="col-sm-5">
						<select class="form-control" id="CRO" name="CRO" style="width:100%;">
							<optgroup label="CRO">
								<option value="All"> All </option> 
								{%for row in CROObj %}
								<option value="{{row.ID}}"> {{row.ID}} - {{row.LastName}} {{row.FirstName}} </option> 
								{%endfor%}
							 </optgroup>
						</select>
						<script type="text/javascript">
							init.push(function () {
								// Single select
								$("#CRO").val('{{ Result["CRO"] }}');
								$("#CRO").select2({
									allowClear: true,
									placeholder: "Choose CRO"
								});
							});
						</script>
					</div>
				</div>
				<div class="form-group">
					<label for="CC" class="col-sm-3 control-label"> CC: </label>
					<div class="col-sm-5">
						<select class="form-control" id="CC" name="CC" style="width:100%;">
							<optgroup label="CC">
								<option value="All"> All </option> 
								{%for row in CROObj %}
								<option value="{{row.ID}}"> {{row.ID}} - {{row.LastName}} {{row.FirstName}} </option> 
								{%endfor%}
							 </optgroup>
						</select>
						<script type="text/javascript">
							init.push(function () {
								// Single select
								$("#CC").val('{{ Result["CC"] }}');
								$("#CC").select2({
									allowClear: true,
									placeholder: "Choose CC"
								});
							});
						</script>
					</div>
				</div>
			</div> <!-- / .modal-body -->
			<div class="modal-footer">
				
				<button type="submit" class="btn btn-primary">{{ getLanguage('Apply') }}</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">{{ getLanguage('Cancel') }}</button>
			</div>
		</div> <!-- / .modal-content -->
	</div> <!-- / .modal-dialog -->
</div> <!-- /.modal -->
<!-- / Modal -->
</form>
	<div class="navbar navbar-default navbar-static-top">
		<div class="col-sm-6" style="margin-top: 15px;">
			<!-- Button Export -->
			{% from "print.html" import exportButtonLink %}
			{{exportButtonLink()}}
		</div>
		<div class="col-sm-6" style="margin-top: 8px;">
			<a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
				<span class="btn-label icon fa fa-refresh"></span> Refresh
			</a>
			<button  type="button" data-toggle="modal" data-target="#myModal"  class="btn btn-flat btn-labeled btn-success pull-right" >
				<span class="btn-label icon fa fa-gear" ></span> Custom 
			</button>
		</div>
	</div>
	<!--  message  -->
	<div class="clearfix"></div>
	<div class="col-sm-12">
		{% for message in get_flashed_messages() %}
			{% if contain(message, "Error") %}
				<div class="clearfix">&nbsp;</div>
				<div class="alert alert-danger">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
			{% else %}
				<div class="clearfix">&nbsp;</div>
				<div class="alert alert-info">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					{{ message }}
				</div>
			{% endif %}
		{% endfor %}
	</div>

	<div style="margin-left:10%; margin-right:10%;">
		<h3 class="header-3 text-center">{{ Result['Company'] }}</h3>
		<h4 class="header-4 text-center">{{ Result['Title'] }}</h4>
		<h4 class="header-4 text-center"><strong>As of:</strong> {{ Result['BankDate'] }}</h4>
	</div>
	<div class="clearfix">&nbsp;</div>

<div class="row">
<div class="col-sm-12">
    <table>
          <tbody>
            <tr>
                <td width="150"><h5><strong>Branch</strong></h5></td>
                <td><h5>: {{ Result['Branch'] }}</h5>  </td>
            </tr>
        </tbody>
    </table>
</div>

{% if Result["CRO"] %}
<div class="col-sm-12">
    <table>
          <tbody>
            <tr>
                <td width="150"><h5><strong>CRO</strong></h5></td>
                <td><h5>: {{ Result['CRO'] }}</h5>  </td>
            </tr>
        </tbody>
    </table>
</div>
{% endif %}
{% if Result["CC"] %}
<div class="col-sm-12">
    <table>
          <tbody>
            <tr>
                <td width="150"><h5><strong>CC</strong></h5></td>
                <td><h5>: {{ Result['CC'] }}</h5>  </td>
            </tr>
        </tbody>
    </table>
</div>
{% endif %}

	<div class="col-xs-12">
	{% set loopDict = {} %}
		<table id="mktlist" class="table table-striped table-hover table-borderless display" cellspacing="0" width="100%">
			<thead>
				<tr>
					<th style="display: none;">No.</th>
					<th>Loan Application ID</th>
					<th>Customer ID</th>
					<th>Name</th>
					<th>Gender</th>
					<th>Account #</th>
					<th>Currency</th>
					<th>Disbursed</th>
					<th>Disbursed-Eqv</th>
					<th>Commitment</th>
					<th>Commitment-Eqv</th>
					<th>Loan Product</th>
					<th>Term</th>
					<th>Interest Rate</th>
					<th>Officer CC</th>
					<th>Officer CRO</th>
				</tr>
			</thead>
			<tbody>
			{% set result = Result['Total']%}
					{% for currency in CurrencyObj %}
						{% set LoanObj = ReportDict[currency.ID]%}
						{% if LoanObj %}
							{% set CurrencyCount = {} %}
							{% for key,value in LoanObj.iteritems() %}
								{% if value['Currency'] %}
								{% if CurrencyCount.update({'count':loop.index})%}{%endif%}
								<tr>
									<td style="display: none;">{{value.Currency}}</td>
									<td>{{value.LoanAppID}}</td>
									<td>{{value.CustomerID}}</td>
									<td>{{value.CustomerName}}</td>
									<td>{{value.Gender}}</td>
									<td>{{value.Account}}</td>
									<td>{{value.Currency}}</td>
									<td class="text-right">{{value.Disbursed}}</td>
									<td class="text-right">{{value.DisburseEqv}}</td>
									<td class="text-right">{{value.Commiment}}</td>
									<td class="text-right">{{value.CommimentEqv}}</td>
									<td>{{value.LoanProduct}}</td>
									<td class="text-right">{{value.Term}}</td>
									<td class="text-right">{{value.InterestRate}}</td>
									<td>{{value.OfficerCC}}</td>
									<td>{{value.CROName}}</td>
								</tr>
								{% endif %}
								<!-- Sub Total -->
								{% if loop.last %}
									<tr>
										<td style="display: none;">{{currency.ID}}{{loop.index|string}}</td>
										<td class="text-bold text-right">Sub Total:</td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td class="text-bold text-right">{{CurrencyCount.get('count')}}</td>
										<td class="text-bold text-right">{{ReportDict[currency.ID]['subTotalDisbursed'+currency.ID] if LoanObj else 0}} </td>
										<td class="text-bold text-right">{{ReportDict[currency.ID]['subTotalDisbursedEqv'+currency.ID] if LoanObj else 0}}</td>
										<td class="text-bold text-right">{{ReportDict[currency.ID]['subTotalCommiment'+currency.ID] if LoanObj else 0}}</td>
										<td class="text-bold text-right">{{ReportDict[currency.ID]['subTotalCommimentEqv'+currency.ID] if LoanObj else 0}}</td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
									</tr>
								{% endif %}
							{% endfor %}
						{% endif %}
					{% endfor %}
			</tbody>
			<tfoot>
				<tr>
					<td><strong>Total:</strong></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td class="text-right"><b>{{result['NumberOfLoan']}}</b></td>
					<td></td>
					<td class="text-right"><b>{{result['TotalDisbursedAllCurrency']}}</b></td>
					<td></td>
					<td class="text-right"><b>{{result['TotalCommimentEqvAllCurrency']}}</b></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</tfoot>
		</table>
	</div>
	<!-- Note -->
	<div class="col-sm-12">
		<table>
		<h5><strong><u>Note:</u></strong></h5>
			<tbody>
				{% set CurrencyDict = Result['CurrencyDict'] %}
				<tr>
					<td ><b>(1)</b> Based Currency:  <b></b></td>
					<td ><b></b> {{CurrencyDict['BasedCurrency']}} <b></b></td>
				</tr>
				<tr>
					<td><b>(2)</b> Exchange Rate: <b></b></td>
					<td><b></b> {{CurrencyDict['ForeignExchangeRate']}} <b></b></td>
				</tr>
				<tr>
					<td colspan="2">&nbsp;</td>
				</tr>
				<tr>
					<th width="250">Disbursed:</th>
					<td>Disbursement Amount:  Based On Column Currency</td>
				</tr>
				<tr>
					<th width="250">Disbursed-Eqv:</th>
					<td>Disbursement Amount Equivalent: Disbursement Amount converted to Based Currency</td>
				</tr>
				<tr>
					<th width="250">Commitment:</th>
					<td>Commitment Amount:  Approved Amount Minus Disbursement Amount (0 if Loan Age is more than 6 months comparing to system date)</td>
				</tr>
				<tr>
					<th width="250">Commitment-Eqv:</th>
					<td>Commitment Amount Equivalent: Commitment Amount converted to Based Currency</td>
				</tr>
			</tbody>
		</table>
	</div>
	<!-- End note -->
</div>
{% endblock %}

{% block js %}
	{% from "print.html" import exportIncludeJS %}
	{{exportIncludeJS()}}

    <script src="{{ url_for('static',filename='javascripts/jquery.datatables.min.js') }}"></script>
    <script type="text/javascript">
        //Search dataTable
        $(document).ready(function() {
	        $('#mktlist').dataTable({
	            "lengthMenu"    : [[25,50,100,200, -1], [25,50,100,200, "All"]],
	            "bSort"         : true,
	            "pageLength"    : 25,
	        });
	        $("#Refresh").click(function() {
	            fn_fadeIn();
	            window.location.reload(true);
	        });
	        {% from "print.html" import exportDataTable %}
            {{exportDataTable('#mktlist','Loan Commitment Report')}}
	    });
    </script>
{% endblock %}