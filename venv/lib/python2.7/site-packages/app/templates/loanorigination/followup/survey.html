{% extends "layout.html" %}

{% block css %}
<style type="text/css">
	/*tr{
		height:35px;
	}*/
	.panel-group{
		margin-bottom: 5px !important;
	}
	.accordion-toggle::after {
		right: auto;
	}
	.colunm-padding {
		padding: 9px 5px 9px 10px;
	}
	.colunm-padding-first {
		padding: 9px 5px 9px 50px;
	}
	.uninstall-padding{

		display: inline-block;
		padding-left: 25px;
		padding-top: 4px;
		vertical-align: top;
	}
}
.table-borderless td,
.table-borderless th
{
	border: 0 !important;
	padding-top: 3px !important;
}

.modal-lg {
	width: 95%;
}
iframe{
	border: 0px;
	overflow-x:hidden;
}
#Iframe_1 {
	overflow-x: hidden;
}

radio:disabled {
	color:blue;
}

</style>
{% endblock %}

{% block content %}
<!-- defining macros -->

<!-- Macro to get radio checked -->
<!-- Get radio button checked according to answer query from database -->
{% macro AnswerChecked(qid, answerVal) -%}
	{%if SurveyDeObj%}
		{%for row in SurveyDeObj%}
			{%if row.Answer==answerVal and row.Question==qid%}
				checked="checked"
			{%endif%}
		{%endfor%}
	{%endif%}
{%- endmacro%}

<!-- Macro to get radio checked -->
{% macro getAnswerFreeText() -%}
	{%if SurveyDeObj-%}
		{%for row in SurveyDeObj-%}
			{%if row.Question=='13'-%}
				{{row.Answer}}
			{%-endif%}
		{%-endfor%}
	{%-endif%}
{%- endmacro%}


<!-- Get Type of answer accordding to Question -->
{% macro getAnswers(qid,aid) -%}
{# {{AnswerChecked('2')}} #}
	{%if aid != '3'%}
		{%set AnswerObj = AnswerDeObj.query.filter(AnswerDeObj.Answer==aid).all()%}
		{%for row in AnswerObj%}
			<div class="form-check form-check-inline">
			  <label class="form-check-label" style="font-weight: normal;cursor: pointer;">
			  	{# Key:Value ==> QuestionID:AnswerID #} 
				
				<!-- AnswerChecked(Question,Answer) -->
				{#<input class="form-check-input" type="radio" name="{{qid}}" id="{{qid}}_{{aid}}" value="{{row.ID}}" {{AnswerChecked(qid,row.ID)}}> {{row.Description}}#}

				<input class="form-check-input" type="radio" name="Answer[{{qid}}]" id="{{qid}}_{{aid}}" value="{{row.ID}}" {{AnswerChecked(qid,row.ID)}}> {{row.Description}}
			  </label>
			</div>
		{%endfor%}
	{%else%}
	<textarea class="form-control" name="Answer[{{qid}}]" data-q="{{qid}}" data-answer="{{aid}}">{{getAnswerFreeText()}}</textarea>
	{%endif%}
{%- endmacro %}

<div class="form-horizontal">
<form action="/Morakot/UpdateSurvey" method='POST' name="frm_survey">
	<!-- check if input name follwup is exist or not, if it is exist also append value followup id to it -->
	<div class="form-group" style="display: none;">
	   <label for="Followup" class="col-sm-2 control-label"><label for="Followup">Followup ID</label></label>
		<div class="col-sm-10">
			<input class="form-control" id="CFU" name="CFU" type="text" value="{{FollowupID}}" data-original-title="" title="">
		</div>
	</div>
	<div class="form-group" style="display: none;">
	   <label for="Survey" class="col-sm-2 control-label"><label for="Survey">Survey</label></label>
		<div class="col-sm-10">
			<input class="form-control" id="Survey" name="Survey" type="text" value="" data-original-title="" title="">
		</div>
	</div>
	<div class="form-group" style="display: none;">
	   <label for="CustID" class="col-sm-2 control-label"><label for="CustID">Customer ID</label></label>
		<div class="col-sm-10">
			<input class="form-control" id="CustID" name="CustID" type="text" value="{{CustomerID}}" data-original-title="" title="">
		</div>
	</div>

	{%if SurveyCurr%}
		<div class="form-group" style="display: none;">
		   <label for="Curr" class="col-sm-2 control-label"><label for="Curr">Curr</label></label>
			<div class="col-sm-10">
				<input class="form-control" id="Curr" name="Curr" type="text" value="{{SurveyCurr if SurveyCurr else ''}}" data-original-title="" title="">
			</div>
		</div>
	{%endif%}

	{%if SurveyID%}
	<div class="form-group" style="display: none;">
	   <label for="SurveyID" class="col-sm-2 control-label"><label for="SurveyID">Survey ID</label></label>
		<div class="col-sm-10">
			<input class="form-control" id="SurveyID" name="SurveyID" type="text" value="{{SurveyID if SurveyID else ''}}" data-original-title="" title="">
		</div>
	</div>
	{%endif%}
	
	{%for row in QuestionObj%}
		<div class="form-group">
			<label for="Question" class="col-sm-2 control-label"><label for="Question">Question {{loop.index}}:</label></label>
			<div class="col-sm-6 control-label" style="text-align: left">
				{{row.Description}}
			</div>
		</div>
		<div class="form-group" style="margin-top:-15px;">
			<label for="Question" class="col-sm-2 control-label"><label for="Question">Answer:</label></label>
			<div class="col-sm-6 control-label" style="text-align: left;">
				{{getAnswers(row.ID,row.AnswerType)}}
			</div>
		</div>
		<hr style="text-align: center; width:80%;">
	{%endfor%}
	
	<input type="submit" value="Save" class="btn btn-default" style="display: none;">
</form>

</div>


</div>

<div class="clearfix">&nbsp;</div>


{% endblock %}



{% block js %}
	<script>
		$(document).ready(function(){

			// Custom to disable alert message when there is no data change to main form
			window.parent.window.alert = function(message) {
			    if(message == 'Data has no change. Will not submit to server.') {
			        console.log(message);
			    } else {
			        confirm(message);
			    }
			}
			// Custom Message Get result message pop up for successfull added record or any error occured
			var msg = '';
			{%if result==True%}
				msg =  '<div class="alert alert-info">';
				msg += '<button type="button" class="close" data-dismiss="alert">Ã—</button>';
				msg += 'Record was added successfully';
				msg += '</div>';
				window.parent.$('div.navbar').after(msg);
				alert = function() {};
			{%endif%}
			// Get Survey ID into form name Survey
			var ID = window.parent.$('#ID').val();
			$('#Survey').val(ID);

			// Check if it is a list live record or not
			// If yes, disable all radio button and textarea until click on edit, 
			// Then enable for edit.
			if(window.parent.$('#Edit').length > 0){
				$('input:radio,textarea').attr('disabled','disabled');
			}
			window.parent.$('#Edit').click(function(event) { 
				$('input:radio,textarea').removeAttr("disabled");
			})

			$('form[name="frm_survey"]').submit(function() {

			})

			// if($('#Curr').length > 0 )
			// {
			// 	// Disabled defualt Save Button on Main
			// 	window.parent.$('#Save').off('click');

			// }

			// Trigger Save button on Survey form on click
			window.parent.$('#Save').click(function(event) {
				// event.preventDefault();
				$('form[name="frm_survey"]').trigger('submit');
			})


		})

	</script>
{% endblock %}