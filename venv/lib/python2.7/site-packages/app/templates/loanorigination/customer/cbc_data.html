{% extends "layout.html" %}

{% block css %}

<style>
	.verticalLine {
    border-left: 1px solid #000;
}
</style>

{% endblock %}

{% block content %}

	<!--  message  -->
	<div class="clearfix">&nbsp;</div>
	{% include 'msg_error.html' %}

	<div style="padding: 3% 0;">

		<div class="col-sm-12">
			<h1 class="header-3 text-center">Data for CBC</h1>
		</div>

		<div class="col-sm-12" style="padding:20px 10px">
			<h4 class="header-3 text-center">Please click download below to get data for CBC available as CSV format or Excel format.</h4>
		</div>

		<div class="col-sm-6" style="padding:20px 10px">
			<h3 class="header-3 text-center">Loan Active</h3>
			<form id="CustomDate" class="form-inline text-center" method="POST">
				<div class="form-group" style="margin-top:30px">
					<label for="FromDate" class="control-label">Date From:</label>
					<input class="input-sm form-control" type="text" placeholder="YYYY-MM-DD" name="FromDateActive" id="FromDateActive" value="{{ FromDateActive | d('') }}">
					<label for="ToDate" class="control-label">To:</label>
					<input class="input-sm form-control" type="text" placeholder="YYYY-MM-DD" name="ToDateActive" id="ToDateActive" value="{{ ToDateActive | d('') }}">
				</div>
			</form>
			<div class="text-center" style="margin:30px 0px;">
				<b>{{ getLanguage('Also available in') }} :</b>
				<a href="javascript:void(0);" id="btnSubmitCSV" style="cursor:pointer; color:#1d89cf;"> <i class='fa fa-files-o'></i> CSV &nbsp;</a>|
				<a href="javascript:void(0);" id="btnSubmitExcel" style="cursor:pointer; color:#1d89cf;"> <i class='fa fa-file-excel-o'></i> Excel &nbsp;</a>
			</div>
		</div>

		<div class="col-sm-6" style="padding:20px 10px">
			<h3 class="header-3 text-center">Loan Inactive</h3>
			<form id="CustomDate" class="form-inline text-center" method="POST">
				<div class="form-group" style="margin-top:30px">
					<label for="FromDate" class="control-label">Date From:</label>
					<input class="input-sm form-control" type="text" placeholder="YYYY-MM-DD" name="FromDate" id="FromDate" value="{{ FromDate | d('') }}">
					<label for="ToDate" class="control-label">To:</label>
					<input class="input-sm form-control" type="text" placeholder="YYYY-MM-DD" name="ToDate" id="ToDate" value="{{ ToDate | d('') }}">
				</div>
			</form>
			<div class="text-center" style="margin:30px 0px;">
				<b>{{ getLanguage('Also available in') }} :</b>
				<a href="javascript:void(0);" id="csv" style="cursor:pointer; color:#1d89cf;" > <i class='fa fa-files-o'></i> CSV &nbsp;</a>|
				<a href="javascript:void(0);" id="excel" style="cursor:pointer; color:#1d89cf;"> <i class='fa fa-file-excel-o'></i> Excel &nbsp;</a>
			</div>
		</div>

	</div>
	<!-- Warning -->
	<div id="uidemo-modals-alerts-warning" class="modal modal-alert modal-warning fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<i class="fa fa-warning"></i>
				</div>
				<div class="modal-title">Something is not quite right.</div>
				<div class="modal-body">Please contact your system administrator for more details.</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
				</div>
			</div> <!-- / .modal-content -->
		</div> <!-- / .modal-dialog -->
	</div> <!-- / .modal -->
	<!-- / Warning -->

	<script type="text/javascript">

		$(document).ready(function() {
			function fn_fadeIn(){
				var $getParentEle = window.parent.$("#animated")
				$getParentEle.fadeIn("slow");
			}
			function fn_fadeOut(){
				var $getParentEle = window.parent.$("#animated")
				$getParentEle.fadeOut();
			}
			function getDownloadData(url, Extention,Header){
				FileName = {{MemberID}}+{{AsOfDate}};
				var request = new XMLHttpRequest();
				request.open('GET', url, true);
				request.setRequestHeader('Content-Type', Header);
				request.responseType = 'blob';
				fn_fadeIn();
				request.onload = function(e) {
				    if (this.status === 200) {
				        var blob = this.response;
			            var downloadLink = window.document.createElement('a');
			            var contentTypeHeader = request.getResponseHeader("Content-Type");
			            downloadLink.href = window.URL.createObjectURL(new Blob([blob], { type: contentTypeHeader }));
			            downloadLink.download = FileName+'.'+Extention;
			            document.body.appendChild(downloadLink);
			            downloadLink.click();
			            document.body.removeChild(downloadLink);
			            fn_fadeOut();
				       }
				   };
				   request.send();
				}
			function generateDataCSV(url, Extention){
				var Header = "text/csv; charset=utf-8";
				getDownloadData(url, Extention,Header)
			}
			function getnerateDataEcel(url, Extention){
				var Header = 'application/x-www-form-urlencoded; charset=UTF-8';
				getDownloadData(url, Extention,Header)
			}
			$('#btnSubmitExcel').on("click",function(event){
				FromDate = 'FromDate=' + $('input[name="FromDateActive"]').val();
				ToDate   = 'ToDate=' + $('input[name="ToDateActive"]').val();
				var url ="/Morakot/CBCData?Type=Excel" + '&' + FromDate + '&' + ToDate;
				getnerateDataEcel(url,'xlsx')
			});
			$('#btnSubmitCSV').on("click",function(event){
				FromDate = 'FromDate=' + $('input[name="FromDateActive"]').val();
				ToDate   = 'ToDate=' + $('input[name="ToDateActive"]').val();
				url = "/Morakot/CBCData?Type=CSV" + '&' + FromDate + '&' + ToDate;
				generateDataCSV(url, 'csv')
			});
			$('#excel').on('click', function(event){
				FromDate = 'FromDate=' + $('input[name="FromDate"]').val();
				ToDate   = 'ToDate=' + $('input[name="ToDate"]').val();
				url = '/Morakot/CBCLoanInactive?Type=Excel' + '&' + FromDate + '&' + ToDate;
				getnerateDataEcel(url,'xlsx')
			});
			$('#csv').on('click', function(event){
				FromDate = 'FromDate=' + $('input[name="FromDate"]').val();
				ToDate	= 'ToDate=' + $('input[name="ToDate"]').val();
				url 	= '/Morakot/CBCLoanInactive?Type=CSV' + '&' + FromDate + '&' + ToDate;
				generateDataCSV(url, 'csv')
			});
		});
	</script>

{% endblock %}

{% block js %}

	<script type="text/javascript">
		$(function(){
			init.push(function () {
				var options = {
					orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
					format:"yyyy-mm-dd",
					autoclose:true
				}
				$('#FromDate').datepicker(options);
				$('#FromDateActive').datepicker(options);
			});
			
			init.push(function () {
				var options = {
					orientation: $('body').hasClass('right-to-left') ? "auto right" : 'auto auto',
					format:"yyyy-mm-dd",
					autoclose:true
				}
				$('#ToDate').datepicker(options);
				$('#ToDateActive').datepicker(options);
			});
		});
	</script>

{% endblock %}