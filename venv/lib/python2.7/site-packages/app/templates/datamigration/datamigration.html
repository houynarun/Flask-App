{% extends "layout.html" %}

{% block css %}
    <style>
        .header-1,
        .header-1:hover,
        .header-2,
        .header-2:hover {
            text-align: none;
            cursor: pointer;
            text-decoration: none !important;
            display: block;
            z-index: 100000000;
            border-top: 1px solid #eee;
            margin: 0 -9px 0 -9px;
        }

        .header-1,
        .header-1:hover {
            color: #333 !important;
            font-size: 18px;
            font-weight: 300;
            padding: 30px 18px 15px 18px;
            background: #fafafa;
            background: rgba(0,0,0,.02);
            margin-bottom: -15px;
        }

        .header-2,
        .header-2:hover {
            text-transform: uppercase;
            font-size: 11px;
            font-weight: 600;
            color: #888 !important;
            padding: 10px 18px 0 18px;
            margin-bottom: 15px;
            margin-top: 0;
        }

        .header-1 + .header-2 {
            margin-top: 10px;
            margin-bottom: 0;
        }

        .header-1 + .col-sm-12 {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            margin-left: -9px;
            margin-right: -9px;
            padding-left: 18px;
            padding-right: 18px;
            width: auto !important;
            float: none;
        }

        .row {
            margin-bottom: 15px;
            margin-right: 0px !important;
            margin-left: 0px !important;
        }

        .uidemo-note {
            margin: 0;
            border-top: 1px solid #eee !important;
        }

        /*style for input file*/
        .inputfile {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }
    </style>
{% endblock %}


{% block content %}
<div class="row">
    <div class="col-sm-12">
        <h2>Data Migration (Excel file only)</h2>
    </div>
</div>

<div class="clearfix"></div>
{% include 'msg_error.html' %}

<div class="row">

    <div class="col-xs-12">
        <div id="dropzonejs-example" class="dropzone-box">
            <div class="dz-default dz-message">
                <i class="fa fa-cloud-upload"></i>
                Drop files in here<br><span class="dz-text-small">or click to pick manually</span>
            </div>
            <form id="frmUpload">
                <div class="fallback">
                  <input name="uploadfile" type="file" multiple=""/>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xs-12 text-right" style="margin-top: 8px;">
        <button id="btnUpload" type="submit" class="btn btn-flat btn-labeled btn-primary">
          <span class="btn-label icon fa fa-check-square-o"></span> Validate
        </button>
        <a href="{{url_for('CleanData')}}" type="button" id="btnClean" class="btn btn-flat btn-labeled btn-success">
            <span class="btn-label icon fa fa-trash-o"></span> Clear Data
        </a>
    </div>
</div>

<div class="row">
    <div class="col-xs-12" style="margin-top: 8px;">
        <h4><b><u>Please follow instructions below:</u></b></h4>
        <ol>
            <li>Only MORAKOT DATA MIGRATION TEMPLATES (Excel Format) are allowed. <br>
                Please contact Morakot Support Team, if you haven't received these files.
            </li>
            <li>User must follow instructions inside each template to input correct data.</li>
            <li>User are not allowed to rename template file name, sheet name, or add more sheet.</li>
            <li>User need to upload files (multi-select files) follow this order :
                <ol>
                    <li>CUSTOMER.xlsx</li>
                    <li>COLLATEAL.xlsx</li>
                    <li>ACCOUNT.xlsx</li>
                    <li>LOAN CONTRACT.xlsx</li>
                    <li>SCHEDULE DEFINE.xlsx</li>
                    <li>REPAYMENT SCHEDULE.xlsx</li>
                    <li>PAST DUE.xlsx</li>
                </ol>
                <b><u>Note:</u></b> User can validate one or two files, but it must follow this order.
            </li>
            <li>Click on button <b>Validate</b> to validate and wait for the validation process to complete.</li>
            <li>After validation process completed, a zip file will be sent from server. <br>
                If files contain error(s), it will send zip file of excel files back. Error will be written as comment on error cell.<br>
                if files have no error, it will send zip file of csv files back for uploading to the Morakot VB System . 
            </li>
            <li>Click on button <b>Clear Data</b> to clear all temporary data used for validation process.</li>
            <li>VALIDATION PROCESS COMPLETED!!!</li>
        </ol>
    </div>
</div>
{% endblock %}



{% block js %}
    <script type="text/javascript">
    init.push(function () {
      var dropzone = new Dropzone("#dropzonejs-example",{
        url: "/Morakot/DataMigration",
        paramName: "file", // The name that will be used to transfer the file
        maxFilesize: 5, // MB

        addRemoveLinks : true,
        dictResponseError: "Can't upload file!",
        autoProcessQueue: false,
        thumbnailWidth: 138,
        thumbnailHeight: 120,
        parallelUploads: 1,

        previewTemplate: '<div class="dz-preview dz-file-preview"><div class="dz-details"><div class="dz-filename"><span data-dz-name></span></div><div class="dz-size">File size: <span data-dz-size></span></div><div class="dz-thumbnail-wrapper"><div class="dz-thumbnail"><img data-dz-thumbnail><span class="dz-nopreview">No preview</span><div class="dz-success-mark"><i class="fa fa-check-circle-o"></i></div><div class="dz-error-mark"><i class="fa fa-times-circle-o"></i></div><div class="dz-error-message"><span data-dz-errormessage></span></div></div></div></div><div class="progress progress-striped active"><div class="progress-bar progress-bar-success" data-dz-uploadprogress></div></div></div>',
        resize: function(file) {
          var info = { srcX: 0, srcY: 0, srcWidth: file.width, srcHeight: file.height },
            srcRatio = file.width / file.height;
          if (file.height > this.options.thumbnailHeight || file.width > this.options.thumbnailWidth) {
            info.trgHeight = this.options.thumbnailHeight;
            info.trgWidth = info.trgHeight * srcRatio;
            if (info.trgWidth > this.options.thumbnailWidth) {
              info.trgWidth = this.options.thumbnailWidth;
              info.trgHeight = info.trgWidth / srcRatio;
            }
          } else {
            info.trgHeight = file.height;
            info.trgWidth = file.width;
          }
          return info;
        }
      });

      dropzone.on("complete", function(file){
        dropzone.processQueue();
        window.location = '{{url_for("SendFailedResult")}}';
        $("#btnClean").removeAttr('disabled');
      });

      dropzone.on("success", function(file){
        window.location = '{{url_for("SendPassedResult")}}';
        $("#btnClean").removeAttr('disabled');
      });

      dropzone.on("processing", function(file){
        console.log("processing");
        $("#btnClean").attr('disabled','disabled');
      });

      $("#btnUpload").on("click", function(){
         dropzone.processQueue();
      })

    });
    </script>
{% endblock %}
