{% extends "layout.html" %}

{% block css %}

{% endblock %}

{% block content %}

<div class="clearfix">&nbsp;</div>
{% include 'msg_error.html' %}

<div style="padding: 0% 0;">
	<div>
		<h1 class="text-center text-danger" style="font-size: 100px;"><i class="fa fa-ban"></i></h1>
	</div>
	<br>

	<div class="col-sm-12">
		<h1 class="header-3 text-center text-danger" ><b>System is not healthy</b></h1>
	</div>

	<div class="col-sm-12" style="padding:20px 10px">
		<h4 class="header-3 text-center">Your system is not healthy. EOD will not be proceeded. Please fix all critical issus before run EOD.</h4>
	</div>

</div>

<script type="text/javascript">
	init.push(function () {
		$('#RefreshSystemHealthCheck').on("click",function(e){

			$.ajax({
				url: "/Morakot/SystemHealthCheckRefresh",
				type: "GET",
				beforeSend: function() {
				$('#RefreshSystemHealthCheck').addClass('fa-spin');
				},
				success: function(data){
					$('#SysHealthCheck .panel-body > div').html(data);
					$('#RefreshSystemHealthCheck').removeClass('fa-spin');
					$('#SysHealthCheck .panel-body > div').slimScroll({ height: 350, alwaysVisible: true, color: '#888',allowPageScroll: true });
				}
			});
		});		
	$('#SysHealthCheck .panel-body > div').slimScroll({ height: 350, alwaysVisible: true, color: '#888',allowPageScroll: true });
	})
</script>

<div style="width: 70%; margin: auto; padding: 13% 0;">

	<div class="panel panel-info" id="SysHealthCheck">
			<div class="panel-heading">
				<span class="panel-title"> 
					<i class="panel-title-icon fa fa-heartbeat"></i>System Health Check &nbsp;
					<!-- <span class="badge bg-info">{{Obj|length -1}}</span> -->
				</span>
				<div class="panel-heading-controls" >
					<div class="panel-heading-icon" style="padding-top:0px;" >
						<a title='Refresh' class="link" ><i id='RefreshSystemHealthCheck' class='fa fa-refresh'></i></a>
					</div>
				</div>
			</div>
			<div class="panel-body" style="min-height: 290px; ">
				<div>
					<table class="table">
					{% if Obj %}
						<thead>
							<tr>
								<!-- <th></th> -->
								<th> 
									<span class="text-xs">CODE</span><br> 
								</th>
								<th>
									<span class="text-xs">DESCRIPTION</span><br> 
								</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							{% for row in Obj%}
								<tr>
									<td>{{row.Code}}</td>
									<td><a id="{{row.Code}}" href="#">{{row.Title}}</a></td>
									<td>
										<span class="badge {{'badge-danger' if 'Critical' in row.Level else 'badge-warning'}}">{{row.Length - 1}}</span>
									</td>
								</tr>
								<script type="text/javascript">
									init.push(function () {
										$("#{{row.Code}}").click(function(){

											window.parent.addTab("System Health Check - {{row.Code}}", "/Morakot/SysHealthCheck/{{row.Code}}");

										});
									});
								</script>
							{% endfor %}
						</tbody>

					{% else %}
					<table cellspacing="0" cellpadding="0">
						<tr height="50px"></tr>
						<tr>
							<td width="10%"></td>
							<td><i class="fa fa-smile-o text-success" style="font-size: 100px;"></i></td>
							<td width="10%"></td>
							<td style="font-size: 20px;"><b>YOUR SYSTEM IS HEALTHY</b></td>
						</tr>
					</table>

					{% endif %}
					</table>
				</div>
			</div>
	</div>

</div>

{% endblock %}

{% block js %}

{% endblock %}