{% extends "layout.html" %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='stylesheets/jquery.datatables.css') }}">
<style type ="text/css">
	/*body{ font-family: "Times New Roman", Times, serif; }*/
	.container{
		width: 65%;
	}
	.table tbody>tr>td, .table tbody>tr>th, .table tfoot>tr>td, .table tfoot>tr>th, .table thead>tr>td, .table thead>tr>th{
		border-top: 1px solid #FFF;
		border-top-color: #FFF;
	}
	@media print{
		.container{
			width: 100%;
		}
	}
</style>
{% endblock %}

{% block content %}
<div class="navbar navbar-default navbar-static-top">
	<div class="col-sm-6" style="margin-top: 15px;">
		<!-- Button Export -->            
		{% set FullUrl = request.url %}
		{% set Url = FullUrl.split("?")[0] %}
		{% set UrlParam = FullUrl.split("?")[1] if "?" in FullUrl else "" %}
		{{exportButtonLink(Url=Url,UrlParam=UrlParam)}}
	</div>

	<div class="col-sm-6" style="margin-top: 8px;">
		<a href="javascript:void(0)" title="Refresh" id="Refresh" class="btn btn-flat btn-labeled btn-warning pull-right" style="margin-left: 5px;">
			<span class="btn-label icon fa fa-refresh"></span> Refresh
		</a>
		<button type="button" class="btn btn-flat btn-labeled btn-success pull-right" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">
			<span class="btn-label icon fa fa-gear"></span>   {{ getLanguage('Custom') }} 
		</button>
	</div>
</div>
	<div class="col-xs-12">
		<div class="container">
			<div class="header">
				<div class="col-xs-12 text-center" style="margin: 0 0 25px 0;">
					<h3 style="font-weight: bold;">Profit And Loss</h3>
					<p>(amounts in millions of Kyats)</p>
				</div>
				<div class="col-xs-5"></div>
				<div class="col-xs-7" style="padding-right: 0px;">
					<table style="width: 100%; padding-right: 0px;" class="table borderless">
						<tr>
							<td>Date (:dd-mmm-yyyy:)</td>
							<td class="text-right" style="padding-right: 0px;">{{AsOf|safe}}</td>
						</tr>
						<tr>
							<td>Reporting Period:</td>
							<td class="text-right" style="padding-right: 0px;">{{ReportingPeriod}}</td>
						</tr>
					</table>
				</div>
			</div>
			<table class="table table-bordered">
				<thead>
					<tr>
						<th class="text-center">No.</th>
						<th class="text-center">Description</th>
						<th class="text-center">Cumulative Year to Date</th>
					</tr>
				</thead>
				<tbody>
					{% for row in Result %}

					<tr>
						{% if row|length == 1 %}
							<td colspan='3' class="text-center">{{row.1['Value']}}</td>
						{% else %}
							<td class="text-right">{{row.1['Value']}}</td>
							<td>{{row.2['Value']}}</td>
							<td class="text-right">{{row.3['Value']}}</td>
						{% endif %}
					</tr>
					{% endfor %}
				</tbody>
			</table>
			
			<div class="col-xs-4"></div>
			<div class="col-xs-8" style="padding-right: 0px;">

				<table style="width: 100%; padding-right: 0px;" class="table borderless">
					<tr>
						<td>Prepared by (Name/Signature)</td>
						<td class="text-right" style="padding-right: 0px;">____________________________________</td>
					</tr>
					<tr>
						<td>Checked by (Name/Signature)</td>
						<td class="text-right" style="padding-right: 0px;">____________________________________</td>
					</tr>
					<tr>
						<td>Approved by (Name/Signature)</td>
						<td class="text-right" style="padding-right: 0px;">____________________________________</td>
					</tr>
				</table>
			</div>
		</div>
	</div>

{% endblock %}

{% block js %}
{% from "print.html" import exportIncludeJS %}
	{{exportIncludeJS()}}

	<script type="text/javascript">

		$(document).ready(function() {
			
			{% from "print.html" import exportTable %}
			{{exportTable("#mktlist","")}}
			$("#Refresh").click(function() {
				fn_fadeIn();
				window.location.reload(true);
			});
		});
	</script>
	<script type="text/javascript">

		$(function(){
			$('[data-toggle="modal"]').on("click", function(e) {
				e.preventDefault();
				var url = $(this).attr('href');
				if (url.indexOf('#') == 0) {
					// $(url).modal('open');
					return false;
				} else {
					$.get(url, function(data) {
						 $('<div class="modal">' + data + '</div>').modal();
					}).success(function() {
						$('input:text:visible:first').focus();
					});
				}
			});

		});

	</script>
	<!-- Call in Block Js -->

	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form class="form-horizontal" action="{{Url}}" method="GET">

					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="exampleModalLabel">{{ getLanguage('Custom') }}</h4>
					</div>

					<div class="modal-body">
						<div class="form-group row">
							<label for="Branch" class="col-xs-3 col-form-label">Branch</label>
							<div class="col-xs-9">
								<input type="text" class="form-control" id="Branch" name="Branch" placeholder="Branch" value="{{Branch}}">
							</div>
						</div>
						<div class="form-group row">
							<label for="Branch" class="col-xs-3 col-form-label">Reporting Period</label>
							<div class="col-xs-9">
								<select id="Period" class="form-control" name="Period" {{disabled}} >
									<option value="0" {{'selected' if Period == '0'}}>Current Month</option>
									<option value="1" {{'selected' if Period == '1'}}>Current Previous Month</option>
									<option value="2" {{'selected' if Period == '2'}}>Previous Month</option>
									<option value="3" {{'selected' if Period == '3'}}>Year to Date</option>
									<option value="4" {{'selected' if Period == '4'}}>Current Previous Year</option>
									<option value="5" {{'selected' if Period == '5'}}>Previous Year</option>
									<option value="6" {{'selected' if Period == '6'}}>As of Today</option>
								</select>
								<script type="text/javascript">
									init.push(function () {
										// Single select
										$("#Period").select2({
											allowClear: true,
											placeholder: "Reporting Period"
										});
									});
								</script>
							</div>
						</div>
	
						<div class="form-group row">
							 <label for="Year" class="col-xs-3 col-form-label">Year:</label>
						        <div class="col-xs-9">
						             <select name="Year" id="Year" class="form-control">
						                <option value=""></option>
						                {% if GroupYear and GroupYear.all() %}
						                    {% for row in GroupYear|sort %}
						                        {% if Year == row.GLYear %}
						                            <option value="{{row.GLYear}}" selected="">{{row.GLYear}}</option>
						                        {% else %}
						                            <option value="{{row.GLYear}}">{{row.GLYear}}</option>
						                        {% endif %}
						                    {%endfor%}
						                {% endif %}
						            </select>
						            <script type="text/javascript">
										init.push(function () {
											// Single select
											$("#Year").select2({
												allowClear: true,
												placeholder: "Year"
											});
										});
									</script>
						        </div>
						</div>
						<div class="form-group row">
							<label for="Month" class="col-xs-3 col-form-label">Month:</label>
					        <div class="col-xs-9">
					            {% set MonthList = {'00':'--None--',
					                                '01':'01 January',
					                                '02':'02 February',
					                                '03':'03 March',
					                                '04':'04 April',
					                                '05':'05 May',
					                                '06':'06 June',
					                                '07':'07 July',
					                                '08':'08 August',
					                                '09':'09 September',
					                                '10':'10 October',
					                                '11':'11 November',
					                                '12':'12 December'
					                                } 
					            %}
					            <select name="Month" id="Month" class="form-control">
					                <option value=""></option>
					                {% if GroupMonth and GroupMonth.all() %}
					                    {% for row in GroupMonth|sort %}
					                        {% if row.GLMonth|int == Month|int %}
					                            <option value="{{row.GLMonth}}" selected="">{{MonthList[row.GLMonth]}}</option>
					                        {% else %}
					                            <option value="{{row.GLMonth}}">{{MonthList[row.GLMonth]}}</option>
					                        {% endif %}
					                    {% endfor %}
					                {% endif %}
					            </select>
					            <script type="text/javascript">
										init.push(function () {
											// Single select
											$("#Month").select2({
												allowClear: true,
												placeholder: "Month"
											});
										});
									</script>
					        </div>
						</div>
						<div {% if AuditedStatus == 'No' %} style="display:none;" {% endif %} class="form-group row" id="AuditBox">
					        <label for="Audit" class="col-xs-3 col-form-label">Audited:</label>
					        <div class="col-xs-9">
					             <select name="Audit" id="Audit" class="form-control">
					                {% if Audit == '1' %}
					                    <option value="1" selected>Yes</option>
					                    <option value="0" >No</option>
					                {% else %}
					                    <option value="1" >Yes</option>
					                    <option value="0" selected>No</option>
					                {% endif %}
					            </select>
					        </div>
					    </div>
					</div>

					<div class="modal-footer">
						<button type="submit" class="btn btn-primary">{{ getLanguage('Apply') }}</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">{{ getLanguage('Cancel') }}</button>
					</div>

				</form>
			</div>
		</div>
	</div>
</script>
<script type="text/javascript">
	 $('#Year').change(function(e) {
        var Year = $(this).val();
        $.ajax({
            type: 'get',
            dataType: 'json',
            url: '/Morakot/FinancialReport/GroupMonth/'+Year,
            success: function(data) {
                var MonthList = {'00':'--None--',
                                '01':'01 January',
                                '02':'02 February',
                                '03':'03 March',
                                '04':'04 April',
                                '05':'05 May',
                                '06':'06 June',
                                '07':'07 July',
                                '08':'08 August',
                                '09':'09 September',
                                '10':'10 October',
                                '11':'11 November',
                                '12':'12 December'
                                }; 
                $('#Month').html('<option value=""></option>');
                $.each(data,function(i,val) {
                    $('#Month').append('<option value="'+val+'">'+MonthList[val]+'</option>');
                });
            }
        })
    });

	$('#Month').change(function(e){
        var Month = $(this).val();
        var Year = $('#Year').val();

        $.ajax({
            type: 'get',
            dataType: 'json',
            url: '/Morakot/FinancialReport/GetAuditedStatus/?Year='+Year+'&Month='+Month,
            success: function(data) {
                if (data.Audit == 'Yes') {
                    $('#AuditBox').show()

                } else {
                    $('#Audit').val('1')
                    $('#AuditBox').hide()
                }
            }
        })
    });

	$('select').select2();
</script>
{% endblock %}

{% macro exportButtonLink(Url="",UrlParam="") %}
	<div id="exportButton">
		<b>Also available in :</b>
		<a href="javascript:void(0)" id="print"><i class='fa fa-print'></i>&nbsp;Print</a>
	</div>
{% endmacro %}