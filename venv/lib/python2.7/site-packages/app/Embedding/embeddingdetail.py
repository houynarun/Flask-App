from app.mktcore.wtfimports import *
from .models import *
import json
from flask 				import Markup
from app.tools.mktroute 	import *

def loadEmbedding():
	return MKT_EMBEDDING.query

class FRM_EMBEDDING_DETAIL(exform):
	EmbeddedApp 		= 		QuerySelectField(requiredlabel('Embedded App', "*"),
									query_factory=loadEmbedding,
									get_label=lambda a: a.ID + " - " + a.EmbeddedApp,
									allow_blank=True,
									blank_text='--None--',
									default='--None--',
									validators=[validators.Required()],
									)
	EmbeddedType		= 		SelectField(requiredlabel("Embedded Type","*"),
								choices=[('', '--None--'),('L', 'Public Link'),('F', 'Frame'),('C','Custom')],
						 		coerce=str,
						 		validators=[validators.Required()])
	Configuration 		= 		TextAreaField(requiredlabel("Configuration","*"),[validators.Required()])

	def validate_Configuration(form,field):
		Configuration 		= request.form['Configuration']
		EmbeddedType 		= request.form['EmbeddedType']
		ConfigurationList 	= Configuration.split()
		if EmbeddedType == 'C' and len(ConfigurationList) %2 != 0:
			raise ValidationError("Invalid Syntax.")



