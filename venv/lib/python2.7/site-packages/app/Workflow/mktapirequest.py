from app.mktcore.wtfimports 		import *
from app.mktcore.imports 			import *
from flask 							import request
import json
import requests
from app.mktcore.authentication 		import getToken

class API_REQUEST(object):
	"""docstring for API_REQUEST
		* Post form data or insert record
		* Post Authorize record
	"""
	def postForm(self,url="",data="",Branch="",Inputter=""):
		"""
		def:
			posting data to specifict form by url posting 
		param:
			- url:
				- type (str):fully url for form posting.ex http://127.0.0.1:5000/Morakot/API/Customer/
			-data :
				- type (Dict): dict data that dict key is match with model
			-headers :
				- type (Dict):it require when post data to endpoint.
		return:
			-type (turple):(response,status_code)
			**note:status_code=200 successfull posting from,
				   status_code=400 bad request,not success posting form
				   status_code=3xx redirect url 
		"""
		"""header"""
		ID = session.get("getLogInID")
		print "getToken",getToken()
		headers = {	
					'authorizationkey': getToken(),
					'accept': "application/json",
					'content-type': "application/json"
					}

		"""In default,Branch and Inputer will get from user login to insert to record, 
			but we can override it by pass by param Branch and Inputter """
		if Branch:
			# print "Branch",Branch
			headers.update({'OverrideBranch':Branch})
		if Inputter:
			# print "Inputter",Inputter
			headers.update({'OverrideInputter':Inputter})
		# print "session",session
		"""here post add new record to table"""
		r = 	requests.request("POST",url,data= json.dumps(data),headers=headers)

		"""Update SessionSecurity in table User to provent logout system """
		self.UpdateSessionSecurity()
		return r.text,r.status_code

	def postAuthorize(self,url="",Branch=""):
		"""		
		def:
			posting authorize record by http request 
		param:
			- url:
				- type (str):fully url for form posting.ex http://127.0.0.1:5000/Morakot/API/Customer/CU0001
			-headers :
				- type (Dict):it require when post data to endpoint.
		return:
			-type (turple):(response,status_code)
			**note:status_code=2xx successfully http request or  authorize record,
				   status_code=4xx bad request or fial request,authorize record not success
				   status_code=3xx redirect to new url
				   status_code=5xx internal server error
		"""
		print "getToken",getToken()
		headers = {	
					'authorizationkey':getToken(),
					'accept': "application/json",
					'content-type': "application/json"
					
					}
		"""here post authorize record"""
		r = requests.api.request("GET",url,headers=headers)
		
		"""Update SessionSecurity in table User to provent logout system """
		self.UpdateSessionSecurity()
		return r.text,r.status_code
	def UpdateSessionSecurity(self):
		User  	=	MKT_LOGIN_USER.query.filter_by(UserID=session['getLogInID']).first()
		if User:
			User.SessionSecurity=session.get("MKTSecurity")
			db.session.add(User)
			db.session.commit()

api_request =	API_REQUEST()



		