from flask 						import g, flash
from app.mktcore.wtfimports 	import *
from .models 					import *
import time

from app.Currency.models 		import MKT_CURRENCY

class FRM_PER_INTEREST(exform):

	Description 	=	TextField(requiredlabel("Description", "*"), [validators.Required()])
	Term 			= 	TextField(requiredlabel("Term", "*"), [validators.Required()], description="1-Term and Rate")
	DeDesc 			=	TextField(requiredlabel("Description", "*"), [validators.Required()], description="1-Term and Rate")
	Rate 			=	TextField(requiredlabel("Interest Per Year", "*"), [validators.Required()], description="1-Term and Rate")

	def validate_Term(form, field):

		Term = request.form['Term']

		NewStr = Term.split()

		if len(NewStr) == 1:

			try:

				int(NewStr[0])

			except:
				raise ValidationError("This field must be in numeric format.")

		elif len(NewStr) == 2:

			try:

				int(NewStr[0])

			except:
				raise ValidationError("This field must be in numeric format.")

			try:

				int(NewStr[1])

			except:
				raise ValidationError("This field must be in numeric format.")

		else:
			raise ValidationError("Input wrong format.")

	def validate_Rate(form, field):

		Rate = request.form['Rate']

		try:

			float(Rate)

		except:
			raise ValidationError("This field must be in numeric format.")

	@staticmethod
	def isMultiValue():
		controls_list=["1-Term and Rate"]
		return controls_list

	@staticmethod
	def beforeInsert():

		ID 			= 	request.form['ID']
		Currency 	= 	ID[3:]

		CurrencyObj =	MKT_CURRENCY.query.get(Currency)

		if not CurrencyObj:
			flash(msg_error + "Currency %s not found." %Currency)
			return False

		return True