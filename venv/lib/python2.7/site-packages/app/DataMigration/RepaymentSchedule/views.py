import app.tools.mkttool 		as mkttool
import app.tools.mktdatamigration as mktmigrate

def validateRepaymentSchedule(DictRecord):
	DictMessage 		= {}
	##################################
	### Validate Group field
	#################################	

	Required 			= 	[
								"Branch","ID","LoanID","No","CollectionDate",
								"Principal","Interest","Charge","Balance","NumDay",
								"RepStatus", "PartPaidAmt"
							]

	FormatDate 			=	["CollectionDate"]
	Choices		 		=	[
								("RepStatus", ("0","1","2","3")),						
							]	
	RecordFound 		=	[
								("Branch","MKT_BRANCH","ID"),
								("LoanID","MKT_LOAN_CONTRACT","ID"),
							]
	
	Number				=	["No","Principal","Interest","Charge","Balance","NumDay","PartPaidAmt"]	

	RecordFoundMulti	=	[
								("MKT_LOAN_CONTRACT", "Branch", "ID", "Branch", "LoanID"),
							]
	IDFormat			= 	"%s%s" % (DictRecord.get("LoanID"), DictRecord.get("No"))					
	Prefix				=	[(IDFormat, "ID")]
	Length				=	[("ID", len(IDFormat), len(IDFormat))]

	DictMessage.update(mktmigrate.exeFunctionValidate(DictRecord=DictRecord,
						Required=Required, 
						FormatDate=FormatDate, 
						InvalidChoies=Choices, 
						RecordFound=RecordFound, 
						Number=Number,
						RecordFoundMulti=RecordFoundMulti,
						Prefix=Prefix,
						Length=Length,		
						DebugMode=False))

	##################################
	### Validate Custom field
	##################################	
	#check PartPaidAmt

	if "RepStatus" not in DictMessage and "PartPaidAmt" not in DictMessage and  "Principal" not in DictMessage and "Interest" not in DictMessage:

		RepStatus = DictRecord.get("RepStatus")
		PartPaidAmt = DictRecord.get("PartPaidAmt")
		Principal = DictRecord.get("Principal")
		Interest = DictRecord.get("Interest")		
		TotalPayment = float(Principal) + float(Interest)

		if RepStatus == "0" or RepStatus == "1":
			if float(PartPaidAmt) != float(0):
				DictMessage.update({"PartPaidAmt": "Must be equal 0"})	
		elif RepStatus == "2":	
			if not (float(PartPaidAmt) > float(0) and float(PartPaidAmt) < TotalPayment):
				DictMessage.update({"PartPaidAmt": "Must be bigger than 0 and smaller than %s" % TotalPayment})	
		elif RepStatus == "3":
			if float(PartPaidAmt) != TotalPayment:
				DictMessage.update({"PartPaidAmt": "Must be equal %s" % TotalPayment})		

	return DictMessage