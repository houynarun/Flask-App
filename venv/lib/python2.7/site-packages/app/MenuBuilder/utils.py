# somewhere else in your codebase, let's say utils.py

import copy


def structure_listitem(listitem):
    items = copy.deepcopy(listitem)

    if not items:
        return items

    if len(items) == 1:
        items[0].append([])
        return items

    first, rest = items[0], items[1:]

    header = first[0]
    sub_items = []
    while rest and rest[0][0].startswith(header):
        sub_items.append(rest.pop(0))

    first.append(structure_listitem(sub_items))
    return [first] + structure_listitem(rest)


def render_structured_listitem(listitem):
    if not listitem:
        return ''

    # print "LIST ITEMS: ", listitem
    out = ['<ol>']
    for item in listitem:
        the_id, header, form,menu_id,parents,icon,active, sublist = item

        if sublist:

            out.append('<li data-ItemID="%s" data-formid="%s" data-formdesc="%s" data-act="%s" data-icon="%s">\
                <i class="%s"></i>%s<a href="JavaScript:void(0)" style="visibility: visible;"><i class="fa fa-pencil modal-trigger" aria-hidden="true" data-toggle="modal" data-target="#update-item"></i></a>\n%s\n</li>'
                       % (the_id, form, header.strip(),active, icon, icon, header, render_structured_listitem(sublist)))

        else:
            out.append('<li data-ItemID="%s" data-formid="%s" data-formdesc="%s" data-act="%s" data-icon="%s"><i class="%s"></i>%s\
                <a href="JavaScript:void(0)" style="visibility: visible;"><i class="fa fa-pencil modal-trigger" aria-hidden="true" data-toggle="modal" data-target="#update-item"></i></a></li>'
                       % (the_id, form, header.strip(), active, icon, icon, header.strip()))

    out.append('</ol>')
    return '\n'.join(out)


def render_listitem(listitem):
    return render_structured_listitem(structure_listitem(listitem))   

    """ 
    ==== Convert MenuItemObj to this format ====
    listitem = [    
                ['101','Dashboard'],
                ['102','Potential Customer'],
                ['102-01','Potential Customer Activity'],
                ['102-02','Potential Customer Report'],
                ['102-99','Potentail Customer Detail'],
                ['102-99-01','Potential Customer Detail Listing'],
                ['102-99-02','Potential Customer Follow Up'],
                ['102-99-02-01','Follow Up PAR']
    ]
    """
def toListFromObj(MenuItemObj,startIndex=None,endIndex=None):
    MenuItemObj     = [list(element) for element in MenuItemObj] # convert to list
    # startIndex      = startIndex if startIndex != '' else ''
    # endIndex        = endIndex if endIndex != '' else ''
    NewList         = [element[startIndex:endIndex] for element in MenuItemObj]
    return NewList 

def FieldAttrVal(Table,ID,Field):
    TableObj        = TableObj.query.filter(Table.ID==ID).first()
    if TableObj:
        return TableObj.Field
    else:
        return ''