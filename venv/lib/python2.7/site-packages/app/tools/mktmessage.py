from flask 							import flash
from app.mktcore.imports 			import *
from .. 							import app, db
from app.Language.register 			import Language
import logging
import mkttool  					as mkttool
import mktbjstat 					as mktbjstat
from datetime 						import datetime, date, timedelta

def makeLoggedFile(Msg):
	try:

		dat 		= datetime.now()
		CurrentTime = '%s:%s:%s'% (dat.hour, dat.minute, dat.second)
		currentDate = '%s-%s-%s'% (dat.year, dat.month, dat.day)
		# currentDate = str(currentDate) + "_" + CurrentTime
		filename 	= app.config.get("EOD_LOG_PATH") + "EOD_%s.log" %currentDate
		logging.basicConfig(filename=filename,level=logging.DEBUG)
		logging.info(str(Msg))

	except:
		raise
def msgError(EOD=1, Msg="", Index=""):
	try:

		db.session.rollback()

		if Index:
			Msg = getTextMsg(Index)

		if int(EOD) == 1:
			print Msg
			return "1"
		else:
			flash(msg_error + Msg)
			return "0"

	except:
		raise

def msgOutputMsg(Msg="", Index=""):
	try:

		if Index:
			Msg = getTextMsg(Index)

		print Msg

		# makeLoggedFile(Msg)

	except:
		raise

def getTextMsg(Index=""):
	try:

		Msg = Language[Index]
		return Msg

	except:
		raise

def getLang(Index=""):
	try:

		Msg = Language[Index]
		return Msg

	except:
		raise

def getNBCLang(Language, Index=""):
	try:
		
		return Language[Index]

	except Exception, e:
		raise

def setLogError(Message,Raise=True):
	FileName = app.config.get("EOD_LOG_ERROR") #"log/error.log"
	FileText = mkttool.setWriteFile(FileName,str(time.strftime("%Y-%m-%d %H:%M:%S"))+' : '+str(Message),False)
	mktbjstat.makeLogFileOnError('Y')
	db.session.rollback()
	print Message
	if Raise:
		raise ValueError(Message)
	else:
		setTracebackLog()

def setTracebackLog():
	mktbjstat.makeLogFileOnError('Y')
	LogTime = time.strftime("%Y-%m-%d %H:%M:%S")
	FileName = app.config.get("EOD_LOG_ERROR")
	logging.basicConfig(filename=FileName,
						format='\n %(asctime)s %(message)s',
                    	datefmt='%a, %d %b %Y %H:%M:%S',
						level=logging.DEBUG)
	logging.exception('\n************************ Log Start ************************\n\n')
