from app.tools.mktdate import getDateDiff,getDateTimeNow
from app.Dates.models import MKT_DATES
import time
from datetime import date, datetime, timedelta

from app import ThreadS

def getBankDateObj(ThreadS=ThreadS):
	try:
		from app.Dates.models import MKT_DATES

		BankDate = ThreadS.query(MKT_DATES).get("SYSTEM")
		return BankDate

	except:
		ThreadS.rollback()
		raise
def getDateISO(Date=None):
	try:
		if Date:
			now = Date
		else:
			d = datetime.now()
			now = '%s-%s-%s'% (d.year, d.month, d.day)
		CurrentDate = datetime.strptime(str(now), "%Y-%m-%d").date()
		return CurrentDate

	except:
		raise


class Struct(object):

	def __init__(self, **entries):
		self.__dict__.update(entries)

def getBankDate(ThreadS=ThreadS):
	try:
		from app.Dates.models import MKT_DATES

		BankDate = ThreadS.query(MKT_DATES).get("SYSTEM")
		if BankDate:
			CurrentDate = BankDate.SystemDate
		else:
			BankDate = {'SystemDate':str(getDateISO())}
			CurrentDate = Struct(**BankDate)

		CurrentDate = datetime.strptime(str(CurrentDate), "%Y-%m-%d").date()
		
		return CurrentDate

	except:
		ThreadS.rollback()
		raise