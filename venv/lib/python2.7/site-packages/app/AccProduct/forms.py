from wtforms 					import DecimalField, IntegerField
from app.mktcore.wtfimports 	import *
from .models 					import *
import time
from app.tools.catetool 		import *
from app.Interest.models 		import MKT_INTEREST
from app.Charge.models 			import MKT_CHARGE
from app.AccRule.models 		import MKT_ACC_RULE
from app.Category.models 		import MKT_CATEGORY
from app.Tax.models 			import MKT_TAX

def loadInterest():
	return MKT_INTEREST.query

def loadCharge():
	return MKT_CHARGE.query

def loadAccRule():
	return MKT_ACC_RULE.query

def loadCategory():
	return MKT_CATEGORY.query

def loadTax():
	return MKT_TAX.query

class FRM_ACC_PRODUCT(exform):
	
	Description 	= 	TextField(requiredlabel("Description", "*"), [validators.Required()])
	CategoryList 	= 	QuerySelectField(requiredlabel('Category', '*'),
	                        query_factory=loadCategory,
	                        get_label=lambda a: a.ID + " - " + a.Description,
	                        allow_blank=True,
	                        blank_text=u'--None--',
	                        validators=[validators.Required()]
                        )

	InterestKey 	= 	QuerySelectField('Interest Key',
	                        query_factory=loadInterest,
	                        get_label=u'Description',
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )

	Charge 			= 	QuerySelectField('Charge',
	                        query_factory=loadCharge,
	                        get_label=u'Description',
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )

	Tax 			= 	QuerySelectField('Tax',
	                        query_factory=loadTax,
	                        get_label=u'Description',
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )

	Rule 			= 	QuerySelectField('Account Rule',
	                        query_factory=loadAccRule,
	                        get_label=u'Description',
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )

	IntDayBasis 	= 	SelectField('Interest Day Basis',
							choices=[('', '--None--'),
									 ('1', '360/360'),
									 ('2', '365/360'),
									 ('3', '365/365')],
							coerce=str
						)

	IntAccrBasis 	= 	SelectField('Interest Accrual Basis',
							choices=[('', '--None--'),
									 ('1', 'Daily'),
									 ('2', 'Weekly'),
									 ('3', 'Monthly'),
									 ('4', 'Yearly')],
							coerce=str
						)

	IntCapitalization 	= 	SelectField('Interest Capitalization',
								choices=[('', '--None--'),
										 ('1', 'Daily'),
										 ('2', 'Weekly'),
										 ('3', 'Monthly'),
										 ('4', 'Yearly')],
								coerce=str
							)

	ClosingWithAccr 	= 	SelectField('Closing with Accrual',
								choices=[('Y', 'Full accrual'),
										 ('N', 'Without accrual'),
										 ('M', 'Without accrual current')],
								coerce=str
							)

	DormantDays 		= 	IntegerField("Dormant Days", [validators.Optional()], default=0)

	ProductType 		= 	SelectField(requiredlabel("Product Type", "*"),
								choices=[('E', 'External'), ('I', 'Internal')],
								default='E',
								validators=[validators.Required()]
							)

	IntPayableCat 	= 	QuerySelectField('Accr Int Payable Cat',
	                        query_factory=loadCategory,
	                        get_label=lambda a: a.ID + " - " + a.Description,
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )

	IntExpenseCat 		= 	QuerySelectField('Interest Expense Cat',
	                        query_factory=loadCategory,
	                        get_label=lambda a: a.ID + " - " + a.Description,
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )
	AccrReceivableCat 	= 	QuerySelectField('Accr Interest Receivable Cat',
	                        query_factory=loadCategory,
	                        get_label=lambda a: a.ID + " - " + a.Description,
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )
	IntIncomeCat 		= 	QuerySelectField('Interest Income Cat',
	                        query_factory=loadCategory,
	                        get_label=lambda a: a.ID + " - " + a.Description,
	                        allow_blank=True,
	                        blank_text=u'--None--'
                        )
	AccrMode 	= 	TextField("Accrue Mode")


	@staticmethod
	def setWidth():
		control_list= [('IntDayBasis', len2),
					   ('IntAccrBasis', len2),
					   ('IntCapitalization', len2),
					   ('DormentDays', len2),
					   ('ProductType', len2)]
					   
		return control_list

	@staticmethod
	def listField():
		Fields = [
					"ID",
					"Description",
					"CategoryList",
					"InterestKey",
					"Rule",
					"Dormant",
					"ProductType"
				]
		return Fields