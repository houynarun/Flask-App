from flask import flash, session,request
import time
from app.tools.user import *
#audit trail management

def setAuditrail(fieldname, isAuthorize,fieldvalue,status =""):
    if not session.get("ChangeBranch") :
        session["ChangeBranch"] = ""
        

    if isAuthorize:
        if fieldname in ('Createdon','Authorizeon'):
            field_value=time.strftime('%Y-%m-%d %H:%M:%S')
        elif fieldname in ('Inputter','Authorizer'):
            field_value= getUser().ID 
        elif fieldname in ('Status'):
            field_value='AUTH'
        elif fieldname == 'Branch' :
            if request.headers.get("OverrideBranch"):
                field_value=request.headers.get("OverrideBranch")
            else:
                field_value = getBranch(session["ChangeBranch"]).ID
            
        else:
            field_value=fieldvalue
    else:

        if fieldname in ('Createdon'):
            field_value=time.strftime('%Y-%m-%d %H:%M:%S')
        elif fieldname in ('Inputter'):
            if request.headers.get("OverrideInputter"):
                field_value=request.headers.get("OverrideInputter")
            else:
                field_value=getUser().ID 
        elif fieldname in ('Status'):
            field_value='INAU'
        elif fieldname == 'Branch' :
            if request.headers.get("OverrideBranch"):
                field_value=request.headers.get("OverrideBranch")
            else:
                field_value = getBranch(session["ChangeBranch"]).ID
        else:
            field_value=fieldvalue

    return field_value