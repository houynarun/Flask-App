# encoding=utf8
from flask 						import Flask,request,flash, session,jsonify
from .. import app
from app.mktcore.imports 		import *
from app.mktcore.globalfunction import *
from app.Branch.models import *


@app.route("/Morakot/ChangeBranch", methods=['POST'])
@app.route("/Morakot/API/ChangeBranch", methods=['POST'])
@login_required
@checkLogOutSession
@checkLogOutTime	
def changebranch():
	querystring = ''	
	query = ''
	BranchName = request.form["Branch"]
	if request.method == 'POST':
		BranchID = request.form["Branch"]
		if BranchID:
			session["ChangeBranch"] = BranchID
			try:
				session["FilterBranch"] = BranchID
			except e as Exception:
				pass
		if checkContentType() == 'json' or "API" in request.url:
			return FormatJsonMessage(message='Branch has been changed to %s'%BranchName)
		# flash ("Branch has been changed.")
		return "OK"

	# #get branch access from user
	# BranchAccess = getUser().AccessBranch
	# if 'ALL' in BranchAccess :
	# 	query = MKT_BRANCH.query.all()
	# else :
	# 	itemsplit = BranchAccess.split (" ")
	# 	for item in itemsplit :
	# 		if querystring == "" :
	# 			querystring = "'" + item + "'"
	# 		else :
	# 			querystring = querystring + ",'" + item + "'"  

	# 	querystring = eval ("[" + querystring + "]")

	# 	query = MKT_BRANCH.query.filter(MKT_BRANCH.ID.in_(querystring)).all()


	# return render_template("changebranch.html",query=query)