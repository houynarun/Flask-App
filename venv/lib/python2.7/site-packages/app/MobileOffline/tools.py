from app.mktcore.imports 			import *
from .models import *
from app.Role.models import MKT_ROLE

import app.tools.user 			as mktUser
import app.tools.mktsetting as mktSetting

MobileOfflineEnabled = "MOBILE_OFFLINE_ENABLED"

def getOfflineMenuItems(Items):
	OfflineItems 			= []
	SizeOfData				= "0"
	if mktSetting.getAppSetting(MobileOfflineEnabled)=="Y":
		try:
			RoleObj 	= getRoleObj(getUserRole())
			MOfflineObj	= getMobileOffileObj(RoleObj.MobileOffline)
			SizeOfData	= MOfflineObj.SizeOfData
			FormUrls 	= getUserFormUrls(MOfflineObj.Forms)
			for Item in Items:
				if Item["url"] in FormUrls and Item["url"] != "":
					OfflineItems.append(Item)
		except:
			pass
	return OfflineItems, SizeOfData

def getMobileOffileObj(OfflineID):
	Forms = MKT_MOBILE_OFFLINE.query.get(OfflineID) if OfflineID else []
	return Forms

def getRoleObj(RoleID):
	RoleObj = MKT_ROLE.query.get(RoleID) if RoleID else {}
	return RoleObj

def getUserRole():
	UserObj = mktUser.getUser()
	UserRole = UserObj.Role if UserObj else "0"
	return UserRole

def getUserFormUrls(Urls):
	FormUrls = [url.URL for url in mktUser.getFormURL().all() if url.URL in Urls]
	return FormUrls