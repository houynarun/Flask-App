from app.mktcore.wtfimports import *
from .models import *

import app.tools.user as mktUser

def getForms():
  FormUrls = mktUser.getFormURL().all()
  Forms = []
  for u in FormUrls:
    if u.EnableAPI == "Y":
      Forms.append((u.URL,u.FormDesc))
  return Forms

class FRM_MOBILE_OFFLINE(exform):
  Description   = TextField(requiredlabel("Description","*"), [validators.Required()])
  Forms         = MKTSelect2MultipleField(requiredlabel("Forms","*"), [validators.Required()], 
                  default='',
                  coerce=str)
  SizeOfData    = TextField(requiredlabel("SizeOfData (MB)","*"), [validators.Required()], 
                  default='5')

  def __init__(self, *args, **kwargs):
		super(FRM_MOBILE_OFFLINE, self).__init__(*args, **kwargs)
		self.Forms.choices=getForms()

  def validate_SizeOfData(form,field):
		FieldData = request.form['SizeOfData']
		try:
			if FieldData:
				int(FieldData)
		except:
			raise ValidationError("This field allows only numeric only.")
