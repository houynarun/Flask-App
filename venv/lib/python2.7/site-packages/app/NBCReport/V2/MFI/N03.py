# -*- coding: utf-8 -*-

'''
Report Name : Income Statement

'''

from app.mktcore.imports 		import *
import app.tools.mktmessage 	as mktmessage
import app.tools.mktdate		as mktdate
import app.tools.mktnbc			as mktnbc
import app.tools.mktmoney		as mktmoney
from decimal 					import Decimal

from app.GLBalance.models 		import MKT_GL_BALANCE, MKT_GL_BALANCE_BACKUP


def getMFI03(Branch = "ALL", ReportedDate = "", Period = 1, Month = "", Year = ""):
	try:
		
		ID = 'N002'
		Result 			=	mktnbc.getNBCLineReport(ID, int(Period), Branch, ReportedDate, Year=Year, Month=Month)
		Data 			= 	Result[0].get("Data",[])

		ReportHeader 	=	mktnbc.getHeaderReport(	ReportName 		=	u'របាយការណ៏ប្រចាំខែសី្តពី ចំណូល និងចំណាយ',
													Title 			=	'',
													Form 			=	'3')
		RecordRow 	= []
		ExcelRecord = {}
		TableHeader = {}

		ExcelRecord.update({
						"E3" : ReportHeader.get('ReportedDate',""),
						"D5" : ReportHeader.get('CompanyName',""),
						"F7" : Decimal(ReportHeader.get('ReportingRate',0))
					})

		TableHeader = mktnbc.setTableHeader(Text=u'', 
                                            Rowspan=3,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'ត្រីមាស', 
                                            Rowspan=0,Colspan=3,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'ជារៀល', 
                                            Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'1', 
                                            Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រូបិយបណ្ណផ្សេងៗ\nគិតជារៀល', 
                                            Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'2', 
                                            Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'សរុបជារៀល', 
                                            Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'3 = 2 + 1', 
                                            Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'បង្គរពីដើមឆ្នាំ', 
                                            Rowspan=3,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		LineNumber = 11
		for item in Data:
			row = dict(item)
			Description = row.get("Description","")
			AmountInRiel= row.get("AmountInRiels",0)
			OtherAmount = row.get("OtherAmount",0)
			TotalAmount = row.get("TotalInRiels",0)
			LineType 	= row.get("LineType",'LD')
			Indent		= row.get("Indent",0)
			RowBGColor 	= row.get("RowBGColor","")
			LineFormat  = row.get("LineFormat","")
			YTDBalance 	= row.get("YTDBalance","")


			RecordRow.append({
					1:Description,
					2:mktmoney.formatNumber(AmountInRiel, 1, 2),
					3:mktmoney.formatNumber(OtherAmount, 1, 2),
					4:mktmoney.formatNumber(TotalAmount, 1, 2),
					5:mktmoney.formatNumber(YTDBalance, 1, 2),
					'LineType':LineType,
					'Indent':Indent,
					'RowBGColor':RowBGColor,
					'LineFormat':'LineFormat'
				})

			ExcelRecord.update({
							"E%s"%(LineNumber) : AmountInRiel,
							"F%s"%(LineNumber) : OtherAmount,
							"H%s"%(LineNumber) : YTDBalance
						})
			LineNumber += 1
		Result = {'ReportHeader': ReportHeader, 'TableHeader': TableHeader, 'Data':RecordRow, 'Excel':ExcelRecord}
		'''
		BORDER_NONE = None
		BORDER_DASHDOT = 'dashDot'
		BORDER_DASHDOTDOT = 'dashDotDot'
		BORDER_DASHED = 'dashed'
		BORDER_DOTTED = 'dotted'
		BORDER_DOUBLE = 'double'
		BORDER_HAIR = 'hair'
		BORDER_MEDIUM = 'medium'
		BORDER_MEDIUMDASHDOT = 'mediumDashDot'
		BORDER_MEDIUMDASHDOTDOT = 'mediumDashDotDot'
		BORDER_MEDIUMDASHED = 'mediumDashed'
		BORDER_SLANTDASHDOT = 'slantDashDot'
		BORDER_THICK = 'thick'
		BORDER_THIN = 'thin'
		'''
		CellSyle 	= {}
		ExcelHeader = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]
		row = 11
		while row <= 58:			
			for col in range(0,4):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "bottom*thin,FF000000:top*thin,FF000000"
				CellSyle.update({column:style})
			row+=1		

		row = 12
		while row <= 53:
			if row not in [17,23,24,35,36,47,48]:			
				for col in range(0,1):
					column 	= "%s%s" % (ExcelHeader[col],row)
					style 	= "right*thin,FF000000:bottom*thin,FF000000"
					CellSyle.update({column:style})
			row+=1

		row = 26
		while row <= 34:
			if row not in [31]:			
				for col in range(1,2):
					column 	= "%s%s" % (ExcelHeader[col],row)
					style 	= "right*thin,FF000000:bottom*thin,FF000000"
					CellSyle.update({column:style})
			row+=1

		row = 9
		while row <= 10:
			column 	= "%s%s" % ("H",row)
			style 	= "right*medium,FF000000"
			CellSyle.update({column:style})
			row+=1
		

		row_list = [7,58]
		for row in row_list:
			for col in range(0,7):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "bottom*medium,FF000000"
				CellSyle.update({column:style})

		row = 58
		while row <= 58:
			column 	= "%s%s" % ("E",row)
			style 	= "right*thin,FF000000:left*thin,FF000000:bottom*medium,FF000000"
			CellSyle.update({column:style})
			column 	= "%s%s" % ("F",row)
			CellSyle.update({column:style})
			row+=1
			
		return Result,CellSyle
	except:
		raise