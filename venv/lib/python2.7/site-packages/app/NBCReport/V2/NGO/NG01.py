# -*- coding: utf-8 -*-
'''
Report Name: Balance Sheet
'''

from app.mktcore.imports 		import *
import app.tools.mktmessage 	as mktmessage
import app.tools.mktdate		as mktdate
import app.tools.mktnbc			as mktnbc
import app.tools.mktmoney		as mktmoney
from decimal import Decimal
from app.GLBalance.models 		import MKT_GL_BALANCE, MKT_GL_BALANCE_BACKUP

def getNGO01(Branch = "ALL", ReportedDate = "", Period = 2, Month = "", Year = ""):
	try:
		
		ID = 'N001'
		Result 			=	mktnbc.getNBCLineReport(ID, int(Period), Branch, ReportedDate, Year=Year, Month=Month)
		Data 			= 	Result[0].get("Data",[])
		# InDollar 		=	request.args.get('InDollar') if 'InDollar' in request.args else 'N'
		ReportingRate 	=	0#mktnbc.getDisplayReportingRate(Year, Month, Period)         

		ReportHeader 	=	mktnbc.getHeaderReport(	ReportName 		=	u'របាយការណ៏ប្រចាំខែសី្តពី ទ្រព្យសកម្ម និងទ្រព្យអកម្ម',
													Title 			=	'',
													Form 			=	'1-BS')
		RecordRow 	= []
		ExcelRecord = {}
		TableHeader = {}

		ExcelRecord.update({
				"E3" : ReportHeader.get('ReportedDate',""),
				"D5" : ReportHeader.get('CompanyName',""),
				"F8" : Decimal(ReportHeader.get('ReportingRate',0))
			})

		TableHeader = mktnbc.setTableHeader(Text=u'ទ្រព្យសកម្ម', 
                                            Rowspan=2,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'ជារៀល', 
                                            Rowspan=0,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'1', 
                                            Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រូបិយបណ្ណផ្សេងៗ\nគិតជារៀល', 
                                            Rowspan=0,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'2', 
                                            Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'សរុបជារៀល', 
                                            Rowspan=0,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'3 = 2 + 1', 
                                            Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")

		LineNumber = 11 
		for item in Data:
			row = dict(item)
			Description = row.get("Description","")
			AmountInRiel= row.get("AmountInRiels",0)
			OtherAmount = row.get("OtherAmount",0)
			TotalAmount = row.get("TotalInRiels",0)
			LineType 	= row.get("LineType",'LD')
			Indent		= row.get("Indent",0)
			RowBGColor 	= row.get("RowBGColor","")
			LineFormat  = row.get("LineFormat","")
			# LineNumber 	= int(row.get("LineNumber",""))

			RecordRow.append({
					1:Description,
					2:mktmoney.formatNumber(AmountInRiel, 1, 2),
					3:mktmoney.formatNumber(OtherAmount, 1, 2),
					4:mktmoney.formatNumber(TotalAmount, 1, 2),
					'LineType':LineType,
					'Indent':Indent,
					'RowBGColor':RowBGColor,
					'LineFormat':'LineFormat'
				})

			if LineNumber == 39:
				LineNumber += 2
			ExcelRecord.update({
							"F%s"%(LineNumber) : AmountInRiel,
							"G%s"%(LineNumber) : OtherAmount,
							"H%s"%(LineNumber)	: AmountInRiel + OtherAmount
						})
			
			LineNumber += 1


		Result = {'ReportHeader': ReportHeader, 'TableHeader': TableHeader, 'Data':RecordRow, 'Excel':ExcelRecord}
		return Result
	except:
		raise