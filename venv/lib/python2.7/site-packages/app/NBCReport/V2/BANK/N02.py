# -*- coding: utf-8 -*-
'''
Report Name: Balance Sheet
'''

from app.mktcore.imports 		import *
import app.tools.mktmessage 	as mktmessage
import app.tools.mktdate		as mktdate
import app.tools.mktnbc			as mktnbc
import app.tools.mktmoney		as mktmoney
from decimal import Decimal
from app.GLBalance.models 		import MKT_GL_BALANCE, MKT_GL_BALANCE_BACKUP

def getBANK02(Branch = "ALL", ReportedDate = "", Period = 3, Month = "", Year = ""):
	try:
		
		ID = 'N002'
		Result 			=	mktnbc.getNBCLineReport(ID, 3, Branch, ReportedDate, Year=Year, Month=Month)
		Data 			= 	Result[0].get("Data",[])
		Result2 			=	mktnbc.getNBCLineReport(ID, 2, Branch, ReportedDate, Year=Year, Month=Month)
		Data2 			= 	Result2[0].get("Data",[])
		# InDollar 		=	request.args.get('InDollar') if 'InDollar' in request.args else 'N'
		ReportingRate 	=	0#mktnbc.getDisplayReportingRate(Year, Month, Period)         

		ReportHeader 	=	mktnbc.getHeaderReport(	ReportName 		=	u'MONTHLY REPORT ON INCOME STATEMENT',
													Title 			=	u'របាយការណ៍ប្រចាំខែស្តីពី ចំណូលនិងចំណាយ',
													Form 			=	'Income Statement')
		RecordRow 	= []
		ExcelRecord = {}
		TableHeader = {}

		ExcelRecord.update({
				"A4" : u'As of:  %s'% mktdate.formatDate(ReportedDate,'%d %B %Y'),
				"K5" : ((ReportHeader.get('CompanyName',"")).splitlines())[0],
				"K6" : ((ReportHeader.get('CompanyName',"")).splitlines())[1],
				"K8" : Decimal(ReportHeader.get('ReportingRate',0))
			})

		TableHeader = mktnbc.setTableHeader(Text=u'', 
                                            Rowspan=0,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រៀល\n Riels', 
                                            Rowspan=0,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រូបិយប័ណ្ណផ្សេងៗគិត​ ជារៀល​ \n Other currencies translated in riels', 
                                            Rowspan=0,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'សរុបជារៀល \n Total in riels', 
                                            Rowspan=0,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")

		RowNumber = 14
		NumberExtra = [50,99,150]
		for item in Data:
			row = dict(item)
			if RowNumber==181:
				row = dict(Data2[82])
			Description = row.get("Description","")
			AmountInRiel= row.get("AmountInRiels",0)
			OtherAmount = row.get("OtherAmount",0)
			TotalAmount = row.get("TotalInRiels",0)
			LineType 	= row.get("LineType",'LD')
			Indent		= row.get("Indent",0)
			RowBGColor 	= row.get("RowBGColor","")
			LineFormat  = row.get("LineFormat","")
			LineNumber 	= int(row.get("LineNumber",""))

			RecordRow.append({
					1:Description,
					2:mktmoney.formatNumber(AmountInRiel, 1, 2),
					3:mktmoney.formatNumber(OtherAmount, 1, 2),
					4:mktmoney.formatNumber(TotalAmount, 1, 2),
					'LineType':LineType,
					'Indent':Indent,
					'RowBGColor':RowBGColor,
					'LineFormat':'LineFormat'
				})

			if RowNumber in NumberExtra:
				RowNumber += 1
			if LineType =='LD':
				ExcelRecord.update({
								"K%s"%(RowNumber) : AmountInRiel,
								"L%s"%(RowNumber) : OtherAmount,
							})
			RowNumber += 2


		Result = {'ReportHeader': ReportHeader, 'TableHeader': TableHeader, 'Data':RecordRow, 'Excel':ExcelRecord}
		CellSyle = {
					  'C10':'top*thin,FF000000',
					  'E10':'top*thin,FF000000',
					  'I10':'top*thin,FF000000',
					  'B13':'bottom*thin,FF000000',
					  'B14':'left*medium,FF000000',
					  'C13':'bottom*thin,FF000000',
					  'E13':'bottom*thin,FF000000',
					  'I13':'bottom*thin,FF000000',
					 'K11':'left*thin,FF000000:right*thin,FF000000',
					 'K13':'left*thin,FF000000:right*thin,FF000000:bottom*thin,FF000000',
					 'L13':'bottom*thin,FF000000',
					 'L15':'bottom*thin,FF000000',
					 'K15':'left*thin,FF000000:right*thin,FF000000:bottom*thin,FF000000',
					 'M11':'left*thin,FF000000:right*thin,FF000000',
					 'M13':'left*thin,FF000000:right*thin,FF000000:bottom*thin,FF000000',
					 'M15':'left*thin,FF000000:right*thin,FF000000:bottom*thin,FF000000',
					}

		ExcelHeader = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]

		row = 16
		while row <= 50:			
			for col in range(1,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000"
				CellSyle.update({column:style})
			row+=2

		row = 16
		while row <= 50:			
			for col in range(10,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "right*thin,FF000000:bottom*hair,FF000000"
				CellSyle.update({column:style})
			row+=1

		row = 51
		while row <= 99:			
			for col in range(1,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000"
				CellSyle.update({column:style})
			row+=2

		row = 51
		while row <= 99:			
			for col in range(10,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "right*thin,FF000000:bottom*hair,FF000000"
				CellSyle.update({column:style})
			row+=1

		row = 100
		while row <= 150:			
			for col in range(1,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000"
				CellSyle.update({column:style})
			row+=2

		row = 100
		while row <= 150:			
			for col in range(10,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "right*thin,FF000000:bottom*hair,FF000000"
				CellSyle.update({column:style})
			row+=1

		row = 151
		while row <= 192:			
			for col in range(1,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000"
				CellSyle.update({column:style})
			row+=2

		row = 151
		while row <= 190:			
			for col in range(10,13):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "right*thin,FF000000:bottom*hair,FF000000"
				CellSyle.update({column:style})
			row+=1


		return Result,CellSyle
	except:
		raise