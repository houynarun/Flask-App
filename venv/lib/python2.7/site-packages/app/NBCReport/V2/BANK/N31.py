# -*- coding: utf-8 -*-

from app.mktcore.imports 		import *
import app.tools.mktmessage 	as mktmessage
import app.tools.mktdate		as mktdate
import app.tools.mktnbc			as mktnbc
import app.tools.mktmoney		as mktmoney
from decimal import Decimal
from app.GLBalance.models 		import MKT_GL_BALANCE, MKT_GL_BALANCE_BACKUP
from app.LoanContract.models 	import *
from app.Customer.models 		import *
from app.IdType.models	 		import *
from app.LoanProduct.models 	import *
from app.Industry.models 		import *
from app.Collateral.models 		import *
from app.CollateralType.models 	import *
from app.LoanApplication.models import *
from app.Currency.models 		import *
from app.AssetClass.models 		import *
from app.Sector.models 			import *
from app.LoanAmendment.models 	import *
from .BankSetting 				import *
try:
	from app.OverdraftContract.models import *
except ImportError as e:
    print e


def getBANK31(Branch = "ALL", ReportedDate = "", Period = 2, Month = "", Year = ""):
	''' This function must return result like below:
			Result = {
				'Data': 		Data,
				'Excel': 		Excel,
				'ReportHeader': ReportHeader,
				'TableHeader': 	TableHeader
				}
	'''
	try:
		getAccSetting 	=	mktsetting.getAccSetting()
		Currency 		=	'USD'
		BaseCurrency 	=	getAccSetting.BaseCurrency
		ID 				= 	'N001'
		Branch = "ALL"

		Condition = []
		if Year and Month:
			GLTable   = MKT_GL_BALANCE_BACKUP
			Condition = [GLTable.GLYear == Year,GLTable.GLMonth == Month]
			CYear 	  = Year
			CMonth 	  = Month
		else:
			GLTable   = MKT_GL_BALANCE
			BankDate  = mktdate.getBankDate()
			CYear 	  = BankDate.year
			CMonth 	  = BankDate.month

		GLObj   =   GLTable.query.filter(*Condition)

		Result			=   {}
		Data 			= 	[]
		Excel 			= 	{}
		TableHeader 	= 	{}

		ReportName 		= 	u'MONTHLY REPORT ON WEIGHTED AVERAGEINTEREST INTEREST RATE ON DEPOSITS AND LOANS'
		Title 			= 	u'របាយការណ៍ប្រចាំខែស្តីពីអត្រាការប្រាក់មធ្យមថ្លឹងចំពោះប្រាក់បញ្ញើនឹងឥណទាន'
		Form 			= 	'Interest Rate'
		ReportHeader 	=	 mktnbc.getHeaderReport(ReportName 		=	ReportName,
													Title 			=	Title,
													Form 			=	Form)

		TableHeader = mktnbc.setTableHeader(Text=u'ប្រភេទគណនី \nTypes of Accounts​', 
									 	Rowspan='',Colspan='',RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រៀល​\nKHR', 
									 	Rowspan='',Colspan='4',RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'ដុល្លារអាមេរិក\nUSD', 
									 	Rowspan='',Colspan='4',RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រួបិយប័ណ្ណផ្សេង\nOther FCs', 
									 	Rowspan='',Colspan='4',RowIndex=1, TableHeader=TableHeader, Class="text-center")

		Data,Excel = getData(ID, Branch, Period, ReportedDate, GLObj=GLObj, GLTable=GLTable, Year=CYear, Month=CMonth, ReportHeader=ReportHeader)

		Result.update({'TableHeader':TableHeader,'ReportHeader':ReportHeader,'Data':Data,'Excel':Excel})
		
		CellSyle = {
					'B7':'bottom*medium,FF000000',
					'C7':'bottom*medium,FF000000',
					'D7':'bottom*medium,FF000000',
					'E7':'bottom*medium,FF000000',
					'G7':'bottom*medium,FF000000',
					'H7':'bottom*medium,FF000000',
					'I8':'top*medium,FF000000:right*thin,FF000000',
					'K7':'bottom*medium,FF000000',
					'L7':'bottom*medium,FF000000',
					'M8':'top*medium,FF000000:right*thin,FF000000',
					'O7':'bottom*medium,FF000000',
					'P7':'bottom*medium,FF000000',
					'Q8':'top*medium,FF000000:right*medium,FF000000',
					'Q9':'right*medium,FF000000',
					'B10':'top*medium,FF000000',
					'D10':'top*medium,FF000000',
					'E10':'top*medium,FF000000',

					'C11':'bottom*thin,FF000000',
					'D11':'bottom*thin,FF000000',
					'E11':'bottom*thin,FF000000',
					}

		return Result, CellSyle

	except:
		raise

def getData(ID, Branch='HO', Period=6, ReportedDate="", GLTable='', GLObj='', Year='', Month='',ReportHeader=""):
	try:
		RecordRow 	= []
		ExcelRecord = {}
		ReportingRate = float(ReportHeader.get('ReportingRate',0))
		ExcelRecord.update({
				"A4" : u'As of:  %s'% mktdate.formatDate(ReportedDate,'%d %B %Y'),
				"C5" : ((ReportHeader.get('CompanyName',"")).splitlines())[0],
				"C6" : ((ReportHeader.get('CompanyName',"")).splitlines())[1],
				"Q6" : u'%s'%ReportingRate,
			})

		SubTotal 		=	0
		ReportingRate 	=	mktsetting.getAppSetting('NBCExchangeRate')
		TotalWeightedAmt=	0
		TotalC1 		=	0
		TotalC2 		=	0
		NetOpenPosition =	0

		TotalNetWorth 	=	0 #N016.getNBCN016(ID, Branch, Period, ReportedDate, GLObj=GLObj, GLTable=GLTable, Year=Year, Month=Month)['TotalNetWorth']
		
		CMonth  =	int(Month)
		CYear 	=	int(Year)
		if CMonth == 1:
			CYear 	=	Year - 1
			CMonth  =	13
			
		CMonth  	=	CMonth - 1
		CMonth 		=	'0%s'%Month if CMonth < 10 else CMonth
		Day 		=	calendar.monthrange(Year, Month)[1]
		FromDate 	=	'%s-%s-01'%(CYear, CMonth)
		ToDate 		=	'%s-%s-%s'%(CYear, CMonth, Day)

		NBCBusinessLoan 		= (mktsetting.getAppSetting('NBCBankBusinessLoanN31')).split()
		NBCConsumerLoan 		= (mktsetting.getAppSetting('NBCBankConsumerLoanN31')).split()
		NBCOtherLoan 			= (mktsetting.getAppSetting('NBCBankOtherLoanN31')).split()
		NBCOFConsumerLoan31 	= (mktsetting.getAppSetting('NBCOFConsumerLoan31')).split()
		NBCOFBusinessLoan31 	= (mktsetting.getAppSetting('NBCOFBusinessLoan31')).split()
		# Get loan info by product
		CellRow		= 	12
		RecordRow.append({ 1:u'ប្រាក់បញ្ញើ \n Deposits:',  
						2:u'ចំនួនទឹកប្រាក់ថ្មី\n New Amount', 
						3:u'អត្រាការប្រាក់ថ្លឹង\n Weighted Interest Rate on New Amount', 
						4:u'ចំនួនប្រាក់ចុងគ្រា\n Outstanding Amount',
						5:u'អត្រាការប្រាក់ថ្លឹង\n Weighted Interest Rate on Outstanding Amount',
						6:u'ចំនួនទឹកប្រាក់ថ្មី\n New Amount', 
						7:u'អត្រាការប្រាក់ថ្លឹង\n Weighted Interest Rate on New Amount', 
						8:u'ចំនួនប្រាក់ចុងគ្រា\n Outstanding Amount',
						9:u'អត្រាការប្រាក់ថ្លឹង\n Weighted Interest Rate on Outstanding Amount',
						10:u'ចំនួនទឹកប្រាក់ថ្មី\n New Amount', 
						11:u'អត្រាការប្រាក់ថ្លឹង\n Weighted Interest Rate on New Amount', 
						12:u'ចំនួនប្រាក់ចុងគ្រា\n Outstanding Amount',
						13:u'អត្រាការប្រាក់ថ្លឹង\n Weighted Interest Rate on Outstanding Amount',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':mktnbc.BG_HEADER_COLOR,
						'LineFormat':'bold',
					})

		RecordRow.append({ 1:u'1- ប្រាក់បញ្ញើចរន្ត\nDemand Deposits',  
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold',
						})
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 	1:u'2- ប្រាក់បញ្ញើសំចៃ\nSaving Deposits',  
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold', })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 	1:u'3- ប្រាក់បញ្ញើមានកាលកំណត់\nTerm Deposits:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold',})
		CellRow+=1

		RecordRow.append({ 1:u'3.1- រហូតដល់​ ១​ ខែ\nOne month or less', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':''
						 })
		ExcelRecord.update({					
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'3.2- លើសពី ១ ខែ រហូតដល់ ៣ ខែ\nGreater than one month to three months', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':''})
		ExcelRecord.update({					
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'3.3- លើសពី ៣ ខែ រហូតដល់ ៦ ខែ​\nGreater than three months to six months ', 
					2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
					'LineType':'LD',
					'Indent':1,
					'RowBGColor':'',
					'LineFormat':''})
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'3.4- លើសពី ៦ ខែ រហូតដល់ ៩ ខែ\nGreater than six months to nine months', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'3.4- លើសពី ៩ ខែ រហូតដល់ ១​ ឆ្នាំ\nGreater than nine months to one year', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'3.4- លើសពី ១​ ឆ្នាំ រហូតដល់ ៣ ឆ្នាំ\nGreater than one year to three year', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'3.4- លើសពី ៥ ឆ្នាំ\nGreater than five year',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'4- ប្រាក់បញ្ញើផ្សេងៗ\nOther ​​Deposits', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold'})
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 1:u'ឥណទាន\nLoans:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':mktnbc.BG_HEADER_COLOR,
						'LineFormat':'bold', })
		CellRow+=3
		# =============Variable for overdraft consumer loan contract===========
		TotalSecNewDisAmountKHRN1 			= 0
		AvgSecNewIntKHRN1 					= 0

		TotalSecOutKHRN1 					= 0
		AvgSecIntKHRN1 						= 0

		TotalSecNewDisAmountUSDN1 			= 0
		AvgSecNewIntUSDN1 					= 0

		TotalSecOutUSDN1 					= 0
		AvgSecIntUSDN1 						= 0

		TotalSecNewDisAmountOtherFCN1 		= 0
		AvgSecNewIntOtherFCN1 				= 0

		TotalSecOutOtherFCN1 				= 0
		AvgSecIntOtherFCN1 					= 0

		AVGIntRateOfLCOF = getAVGIntRateOfLCOverdraft("ALL",NBCOFConsumerLoan31)

		if AVGIntRateOfLCOF:
			for AvgIntRate in AVGIntRateOfLCOF:
				TotalSecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1 if AvgIntRate.TotalNewDisAmountKHRN1 else 0
				AvgSecNewIntKHRN1 				+= AvgIntRate.AvgNewIntKHRN1 if AvgIntRate.AvgNewIntKHRN1 else 0
				TotalSecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1 if AvgIntRate.TotalOutKHRN1 else 0
				AvgSecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1 if AvgIntRate.AvgIntKHRN1 else 0
				TotalSecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1 if AvgIntRate.TotalNewDisAmountUSDN1 else 0
				AvgSecNewIntUSDN1 				+= AvgIntRate.AvgNewIntUSDN1 if AvgIntRate.AvgNewIntUSDN1 else 0
				TotalSecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1 if AvgIntRate.TotalOutUSDN1 else 0
				AvgSecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1 if AvgIntRate.AvgIntUSDN1 else 0
				TotalSecNewDisAmountOtherFCN1 += AvgIntRate.TotalNewDisAmountOtherFCN1 if AvgIntRate.TotalNewDisAmountOtherFCN1 else 0
				AvgSecNewIntOtherFCN1 			+= AvgIntRate.AvgNewIntOtherFCN1 if AvgIntRate.AvgNewIntOtherFCN1 else 0
				TotalSecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1 if AvgIntRate.TotalOutOtherFCN1 else 0
				AvgSecIntOtherFCN1 			+= AvgIntRate.AvgIntOtherFCN1 if AvgIntRate.AvgIntOtherFCN1 else 0

		RecordRow.append({ 1:u'1- ឥណទានវិបារូបន៍ -​ ទៅអ្នកប្រើប្រាស់\nOverdraft - Consumer',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRN1)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRN1), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRN1)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgSecIntKHRN1), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDN1)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDN1), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDN1)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDN1), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCN1)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCN1), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCN1)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCN1), "%"),
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold' })
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRN1,
					"G%s"%(CellRow) : AvgSecNewIntKHRN1/100,
					"H%s"%(CellRow) : TotalSecOutKHRN1,
					"I%s"%(CellRow) : AvgSecIntKHRN1/100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDN1,
					"K%s"%(CellRow) : AvgSecNewIntUSDN1/100,
					"L%s"%(CellRow) : TotalSecOutUSDN1,
					"M%s"%(CellRow) : AvgSecIntUSDN1/100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCN1,
					"O%s"%(CellRow) : AvgSecNewIntOtherFCN1/100,
					"P%s"%(CellRow) : TotalSecOutOtherFCN1,
					"Q%s"%(CellRow) : AvgSecIntOtherFCN1/100
				})
		CellRow+=1

		# =============Variable for overdraft consumer loan contract===========
		TotalSecNewDisAmountKHRN1 			= 0
		AvgSecNewIntKHRN1 					= 0

		TotalSecOutKHRN1 					= 0
		AvgSecIntKHRN1 						= 0

		TotalSecNewDisAmountUSDN1 			= 0
		AvgSecNewIntUSDN1 					= 0

		TotalSecOutUSDN1 					= 0
		AvgSecIntUSDN1 						= 0

		TotalSecNewDisAmountOtherFCN1 		= 0
		AvgSecNewIntOtherFCN1 				= 0

		TotalSecOutOtherFCN1 				= 0
		AvgSecIntOtherFCN1 					= 0

		AVGIntRateOfLCOF = getAVGIntRateOfLCOverdraft("ALL",NBCOFBusinessLoan31)

		if AVGIntRateOfLCOF:
			for AvgIntRate in AVGIntRateOfLCOF:
				TotalSecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1 if AvgIntRate.TotalNewDisAmountKHRN1 else 0
				AvgSecNewIntKHRN1 				+= AvgIntRate.AvgNewIntKHRN1 if AvgIntRate.AvgNewIntKHRN1 else 0
				TotalSecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1 if AvgIntRate.TotalOutKHRN1 else 0
				AvgSecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1 if AvgIntRate.AvgIntKHRN1 else 0
				TotalSecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1 if AvgIntRate.TotalNewDisAmountUSDN1 else 0
				AvgSecNewIntUSDN1 				+= AvgIntRate.AvgNewIntUSDN1 if AvgIntRate.AvgNewIntUSDN1 else 0
				TotalSecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1 if AvgIntRate.TotalOutUSDN1 else 0
				AvgSecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1 if AvgIntRate.AvgIntUSDN1 else 0
				TotalSecNewDisAmountOtherFCN1 += AvgIntRate.TotalNewDisAmountOtherFCN1 if AvgIntRate.TotalNewDisAmountOtherFCN1 else 0
				AvgSecNewIntOtherFCN1 			+= AvgIntRate.AvgNewIntOtherFCN1 if AvgIntRate.AvgNewIntOtherFCN1 else 0
				TotalSecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1 if AvgIntRate.TotalOutOtherFCN1 else 0
				AvgSecIntOtherFCN1 			+= AvgIntRate.AvgIntOtherFCN1 if AvgIntRate.AvgIntOtherFCN1 else 0

		RecordRow.append({ 	1:u'2- ឥណទានវិបារូបន៍ -​ ទៅធុរកិច្ច\nOverdraft - Business',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRN1)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRN1), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRN1)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgSecIntKHRN1), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDN1)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDN1), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDN1)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDN1), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCN1)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCN1), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCN1)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCN1), "%"),
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold' })
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRN1,
					"G%s"%(CellRow) : AvgSecNewIntKHRN1/100,
					"H%s"%(CellRow) : TotalSecOutKHRN1,
					"I%s"%(CellRow) : AvgSecIntKHRN1/100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDN1,
					"K%s"%(CellRow) : AvgSecNewIntUSDN1/100,
					"L%s"%(CellRow) : TotalSecOutUSDN1,
					"M%s"%(CellRow) : AvgSecIntUSDN1/100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCN1,
					"O%s"%(CellRow) : AvgSecNewIntOtherFCN1/100,
					"P%s"%(CellRow) : TotalSecOutOtherFCN1,
					"Q%s"%(CellRow) : AvgSecIntOtherFCN1/100
				})
		CellRow+=1

		RecordRow.append({ 	1:u'3- ប័ណ្ណឥណទាន\nCredit Card',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold'
						 })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 	1:u'4- ឥណទានចំពោះធនាគារ\nBank Placements:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 	1:u'4.1- រហូតដល់​ ១​ ខែ\nOne month or less', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':''})
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({ 	1:u'4.2- លើសពី ១ ខែ \nGreater than one month', 
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1
		
		RecordRow.append({ 	1:u'5- ឥណទានមានកាលកំណត់ - ទៅអ្នកប្រើប្រាស់\nTerm Loans - Consumer:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold'})
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		AVGIntRateOfUnsecuredLoanContract = getAVGIntRateOfLoanContract("ALL",NBCConsumerLoan)

		# =============Variable for secure loan contract===========
		TotalSecNewDisAmountKHRN1 			= 0
		AvgSecNewIntKHRN1 					= 0
		TotalSecNewDisAmountKHRN5 			= 0
		AvgSecNewIntKHRN5 					= 0
		TotalSecNewDisAmountKHRY5 		= 0
		AvgSecNewIntKHRY5 				= 0

		TotalSecOutKHRN1 					= 0
		AvgSecIntKHRN1 						= 0
		TotalSecOutKHRN5 				= 0
		TotalSecIntKHRN5 						= 0
		TotalSecOutKHRY5 				= 0
		AvgSecIntKHRY5 					= 0

		TotalSecNewDisAmountUSDN1 			= 0
		AvgSecNewIntUSDN1 					= 0
		TotalSecNewDisAmountUSDN5 			= 0
		AvgSecNewIntUSDN5 					= 0
		TotalSecNewDisAmountUSDY5 		= 0
		AvgSecNewIntUSDY5 				= 0

		TotalSecOutUSDN1 					= 0
		AvgSecIntUSDN1 						= 0
		TotalSecOutUSDN5				= 0
		AvgSecIntUSDN5 						= 0
		TotalSecOutUSDY5 				= 0
		AvgSecIntUSDY5 					= 0

		TotalSecNewDisAmountOtherFCN1 		= 0
		AvgSecNewIntOtherFCN1 				= 0
		TotalSecNewDisAmountOtherFCN5 		= 0
		AvgSecNewIntOtherFCN5 				= 0
		TotalSecNewDisAmountOtherFCY5 	= 0
		AvgSecNewIntOtherFCY5 			= 0

		TotalSecOutOtherFCN1 				= 0
		AvgSecIntOtherFCN1 					= 0
		TotalSecOutOtherFCN5 			= 0
		AvgSecIntOtherFCN5 					= 0
		TotalSecOutOtherFCY5 			= 0
		AvgSecIntOtherFCY5 				= 0

		# =============Variable for unsecure loan contract===========
		TotalUnsecNewDisAmountKHRN1 			= 0
		AvgUnsecNewDisAmountKHRN1 					= 0
		TotalUnsecNewDisAmountKHRN5 			= 0
		AvgUnsecNewIntAmountKHRN5 					= 0
		TotalUnsecNewDisAmountKHRY5 		= 0
		AvgUnsecNewIntKHRY5 				= 0

		TotalUnsecOutKHRN1 					= 0
		AvgUnsecIntKHRN1 						= 0
		TotalUnsecOutKHRN5 				= 0
		AvgUnsecIntKHRN5 						= 0
		TotalUnsecOutKHRY5 				= 0
		AvgUnsecIntKHRY5 					= 0

		TotalUnsecNewDisAmountUSDN1 			= 0
		AvgUnsecNewIntUSDN1 					= 0
		TotalUnsNewDisAmountUSDN5 			= 0
		AvgUnsecNewIntUSDN5 					= 0
		TotalUnsecNewDisAmountUSDY5 		= 0
		AvgUnsecNewIntUSDY5 				= 0

		TotalUnsecOutUSDN1 					= 0
		AvgUnsecIntUSDN1 						= 0
		TotalUnsOutUSDN5 				= 0
		AvgUnsecIntUSDN5 						= 0
		TotalUnsecOutUSDY5 				= 0
		AvgUnsecIntUSDY5 					= 0

		TotalUnsecNewDisAmountOtherFCN1 		= 0
		AvgUnsecNewIntOtherFCN1 				= 0
		TotalUnsecNewDisAmountOtherFCN5 		= 0
		AvgUnsecNewIntOtherFCN5 				= 0
		TotalUnsecNewDisAmountOtherFCY5 	= 0
		AvgUnsecNewIntOtherFCY5 			= 0

		TotalUnsecOutOtherFCN1 				= 0
		AvgIntOtherFCN1 							= 0
		TotalUnsecOutOtherFCN5 			= 0
		AvgUnsecIntOtherFCN5 					= 0
		TotalUnsecOutOtherFCY5 			= 0
		AvgUnsecIntOtherFCY5 				= 0

		if AVGIntRateOfUnsecuredLoanContract:
			for AvgIntRate in AVGIntRateOfUnsecuredLoanContract:
				if AvgIntRate.SecuredLoan == 'Y':
					if AvgIntRate.Term == 1:
						TotalSecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1
						AvgSecNewIntKHRN1 				+= AvgIntRate.AvgNewIntKHRN1
						TotalSecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1
						AvgSecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1
						TotalSecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1
						AvgSecNewIntUSDN1 				+= AvgIntRate.AvgNewIntUSDN1
						TotalSecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1
						AvgSecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1
						TotalSecNewDisAmountOtherFCN1 += AvgIntRate.TotalNewDisAmountOtherFCN1
						AvgSecNewIntOtherFCN1 			+= AvgIntRate.AvgNewIntOtherFCN1
						TotalSecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1
						AvgSecIntOtherFCN1 			+= AvgIntRate.AvgIntOtherFCN1
					elif AvgIntRate.Term == 5:
						TotalSecNewDisAmountKHRN5 	+= AvgIntRate.TotalNewDisbAmountKHRN5
						AvgSecNewIntKHRN5 				+= AvgIntRate.AvgNewIntKHRN5
						TotalSecOutKHRN5 				+= AvgIntRate.TotalOutKHRN5
						TotalSecIntKHRN5 					+= AvgIntRate.AvgIntKHRN5
						TotalSecNewDisAmountUSDN5 		+= AvgIntRate.TotalNewDisAmountUSDN5
						AvgSecNewIntUSDN5 				+= AvgIntRate.AvgNewIntUSDN5
						TotalSecOutUSDN5 				+= AvgIntRate.TotalOutUSDN5
						AvgSecIntUSDN5 					+= AvgIntRate.AvgIntUSDN5
						TotalSecNewDisAmountOtherFCN5 	+= AvgIntRate.TotalNewDisAmountOtherFCN5
						AvgSecNewIntOtherFCN5 			+= AvgIntRate.AvgNewIntOtherFCN5
						TotalSecOutOtherFCN5 			+= AvgIntRate.TotalOutOtherFCN5
						AvgSecIntOtherFCN5 				+= AvgIntRate.AvgIntOtherFCN5
					else:
						TotalSecNewDisAmountKHRY5 	+= AvgIntRate.TotalNewDisAmountKHRY5
						AvgSecNewIntKHRY5 				+= AvgIntRate.AvgNewIntKHRY5
						TotalSecOutKHRY5 			+= AvgIntRate.TotalOutKHRY5
						AvgSecIntKHRY5 				+= AvgIntRate.AvgIntKHRY5
						TotalSecNewDisAmountUSDY5 	+= AvgIntRate.TotalNewDisAmountUSDY5
						AvgSecNewIntUSDY5 				+= AvgIntRate.AvgNewIntUSDY5
						TotalSecOutUSDY5 			+= AvgIntRate.TotalOutUSDY5
						AvgSecIntUSDY5 				+= AvgIntRate.AvgIntUSDY5
						TotalSecNewDisAmountOtherFCY5 += AvgIntRate.TotalNewDisAmountOtherFCY5
						AvgSecNewIntOtherFCY5 			+= AvgIntRate.AvgNewIntOtherFCY5
						TotalSecOutOtherFCY5 		+= AvgIntRate.TotalOutOtherFCY5
						AvgSecIntOtherFCY5 			+= AvgIntRate.AvgIntOtherFCY5

				else:
					# Loan not Secure are here
					if AvgIntRate.Term == 1:
						TotalUnsecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1
						AvgUnsecNewDisAmountKHRN1 			+= AvgIntRate.AvgNewIntKHRN1
						TotalUnsecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1
						AvgUnsecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1
						TotalUnsecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1
						AvgUnsecNewIntUSDN1 			+= AvgIntRate.AvgNewIntUSDN1
						TotalUnsecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1
						AvgUnsecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1
						TotalUnsecNewDisAmountOtherFCN1+= AvgIntRate.TotalNewDisAmountOtherFCN1
						AvgUnsecNewIntOtherFCN1 		+= AvgIntRate.AvgNewIntOtherFCN1
						TotalUnsecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1
						AvgIntOtherFCN1 					+= AvgIntRate.AvgIntOtherFCN1
						
					elif AvgIntRate.Term == 5:
						TotalUnsecNewDisAmountKHRN5 		+= AvgIntRate.TotalNewDisbAmountKHRN5
						AvgUnsecNewIntAmountKHRN5 				+= AvgIntRate.AvgNewIntKHRN5
						TotalUnsecOutKHRN5 			+= AvgIntRate.TotalOutKHRN5
						AvgUnsecIntKHRN5 					+= AvgIntRate.AvgIntKHRN5
						TotalUnsNewDisAmountUSDN5 		+= AvgIntRate.TotalNewDisAmountUSDN5
						AvgUnsecNewIntUSDN5 				+= AvgIntRate.AvgNewIntUSDN5
						TotalUnsOutUSDN5 			+= AvgIntRate.TotalOutUSDN5
						AvgUnsecIntUSDN5 					+= AvgIntRate.AvgIntUSDN5
						TotalUnsecNewDisAmountOtherFCN5 	+= AvgIntRate.TotalNewDisAmountOtherFCN5
						AvgUnsecNewIntOtherFCN5 			+= AvgIntRate.AvgNewIntOtherFCN5
						TotalUnsecOutOtherFCN5 		+= AvgIntRate.TotalOutOtherFCN5
						AvgUnsecIntOtherFCN5 				+= AvgIntRate.AvgIntOtherFCN5
					else:
						TotalUnsecNewDisAmountKHRY5 	+= AvgIntRate.TotalNewDisAmountKHRY5
						AvgUnsecNewIntKHRY5 			+= AvgIntRate.AvgNewIntKHRY5
						TotalUnsecOutKHRY5 			+= AvgIntRate.TotalOutKHRY5
						AvgUnsecIntKHRY5 				+= AvgIntRate.AvgIntKHRY5
						TotalUnsecNewDisAmountUSDY5 	+= AvgIntRate.TotalNewDisAmountUSDY5
						AvgUnsecNewIntUSDY5 			+= AvgIntRate.AvgNewIntUSDY5
						TotalUnsecOutUSDY5 			+= AvgIntRate.TotalOutUSDY5
						AvgUnsecIntUSDY5 				+= AvgIntRate.AvgIntUSDY5
						TotalUnsecNewDisAmountOtherFCY5+= AvgIntRate.TotalNewDisAmountOtherFCY5
						AvgUnsecNewIntOtherFCY5 		+= AvgIntRate.AvgNewIntOtherFCY5
						TotalUnsecOutOtherFCY5 				+= AvgIntRate.TotalOutOtherFCY5
						AvgUnsecIntOtherFCY5 			+= AvgIntRate.AvgIntOtherFCY5

		RecordRow.append({ 1:u'5.1- មិនមានការធានា\nUnsecured:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1
		CellRow =34

		RecordRow.append({
						1:u'1- រហូតដល់​ ១​ ឆ្នាំ\nOne year or less ',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRN1)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewDisAmountKHRN1), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRN1)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRN1), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountUSDN1)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDN1), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsecOutUSDN1)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDN1), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCN1)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCN1), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCN1)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgIntOtherFCN1), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
					})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRN1,
					"G%s"%(CellRow) : float(AvgUnsecNewDisAmountKHRN1) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRN1,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRN1) / 100,
					"J%s"%(CellRow) : TotalUnsecNewDisAmountUSDN1,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDN1) / 100,
					"L%s"%(CellRow) : TotalUnsecOutUSDN1,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDN1) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCN1,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCN1) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCN1,
					"Q%s"%(CellRow) : float(AvgIntOtherFCN1) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'2- លើសពី ១ ឆ្នាំ​ ដល់៥ឆ្នាំ\nGreater than 1 year to 5 years',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRN5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntAmountKHRN5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRN5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRN5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsNewDisAmountUSDN5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDN5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsOutUSDN5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDN5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCN5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCN5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCN5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntOtherFCN5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
					})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRN5,
					"G%s"%(CellRow) : float(AvgUnsecNewIntAmountKHRN5) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRN5,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRN5) / 100,
					"J%s"%(CellRow) : TotalUnsNewDisAmountUSDN5,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDN5) / 100,
					"L%s"%(CellRow) : TotalUnsOutUSDN5,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDN5) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCN5,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCN5) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCN5,
					"Q%s"%(CellRow) : float(AvgUnsecIntOtherFCN5) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'3- លើសពី ៥ ឆ្នាំ\nGreater than 5 year',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRY5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntKHRY5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRY5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRY5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountUSDY5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDY5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsecOutUSDY5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDY5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCY5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCY5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCY5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntOtherFCY5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
					})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRY5,
					"G%s"%(CellRow) : float(AvgUnsecNewIntKHRY5) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRY5,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRY5) / 100,
					"J%s"%(CellRow) : TotalUnsecNewDisAmountUSDY5,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDY5) / 100,
					"L%s"%(CellRow) : TotalUnsecOutUSDY5,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDY5) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCY5,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCY5) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCY5,
					"Q%s"%(CellRow) : float(AvgUnsecIntOtherFCY5) / 100
				})
		CellRow+=1

		RecordRow.append({ 	1:u'5.2- មានការធានា\nSecured:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({
						1:u'1- រហូតដល់​ ១​ ឆ្នាំ\nOne year or less ',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRN1)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRN1), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRN1)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgSecIntKHRN1), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDN1)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDN1), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDN1)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDN1), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCN1)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCN1), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCN1)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCN1), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
					})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRN1,
					"G%s"%(CellRow) : float(AvgSecNewIntKHRN1) / 100,
					"H%s"%(CellRow) : TotalSecOutKHRN1,
					"I%s"%(CellRow) : float(AvgSecIntKHRN1) / 100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDN1,
					"K%s"%(CellRow) : float(AvgSecNewIntUSDN1) / 100,
					"L%s"%(CellRow) : TotalSecOutUSDN1,
					"M%s"%(CellRow) : float(AvgSecIntUSDN1) / 100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCN1,
					"O%s"%(CellRow) : float(AvgSecNewIntOtherFCN1) / 100,
					"P%s"%(CellRow) : TotalSecOutOtherFCN1,
					"Q%s"%(CellRow) : float(AvgSecIntOtherFCN1) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'2- លើសពី ១ ឆ្នាំ​ ដល់៥ឆ្នាំ\nGreater than 1 year to 5 years',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRN5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRN5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRN5)),
						5:u'%s %s' %(mktmoney.formatNumber(TotalSecIntKHRN5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDN5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDN5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDN5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDN5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCN5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCN5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCN5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCN5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
					})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRN5,
					"G%s"%(CellRow) : float(AvgSecNewIntKHRN5) / 100,
					"H%s"%(CellRow) : TotalSecOutKHRN5,
					"I%s"%(CellRow) : float(TotalSecIntKHRN5) / 100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDN5,
					"K%s"%(CellRow) : float(AvgSecNewIntUSDN5) / 100,
					"L%s"%(CellRow) : TotalSecOutUSDN5,
					"M%s"%(CellRow) : float(AvgSecIntUSDN5) / 100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCN5,
					"O%s"%(CellRow) : float(AvgSecNewIntOtherFCN5) / 100,
					"P%s"%(CellRow) : TotalSecOutOtherFCN5,
					"Q%s"%(CellRow) : float(AvgSecIntOtherFCN5) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'3- លើសពី ៥ ឆ្នាំ\nGreater than 5 year',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRY5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRY5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRY5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgSecIntKHRY5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDY5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDY5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDY5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDY5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCY5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCY5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCY5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCY5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
					})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRY5,
					"G%s"%(CellRow) : float(AvgSecNewIntKHRY5) / 100,
					"H%s"%(CellRow) : TotalSecOutKHRY5,
					"I%s"%(CellRow) : float(AvgSecIntKHRY5) / 100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDY5,
					"K%s"%(CellRow) : float(AvgSecNewIntUSDY5) / 100,
					"L%s"%(CellRow) : TotalSecOutUSDY5,
					"M%s"%(CellRow) : float(AvgSecIntUSDY5) / 100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCY5,
					"O%s"%(CellRow) : float(AvgSecNewIntOtherFCY5) / 100,
					"P%s"%(CellRow) : TotalSecOutOtherFCY5,
					"Q%s"%(CellRow) : float(AvgSecIntOtherFCY5) / 100
				})
		CellRow+=1
		
		RecordRow.append({ 	1:u'6- ឥណទានមានកាលកំណត់ - ទៅធុរកិច្ច\nTerm Loans - Business:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold'
						 })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		AVGIntRateOfUnsecuredLoanContract = getAVGIntRateOfLoanContract("ALL",NBCBusinessLoan)

		# =============Variable for secure loan contract===========
		TotalSecNewDisAmountKHRN1 			= 0
		AvgSecNewIntKHRN1 					= 0
		TotalSecNewDisAmountKHRN5 			= 0
		AvgSecNewIntKHRN5 					= 0
		TotalSecNewDisAmountKHRY5 			= 0
		AvgSecNewIntKHRY5 					= 0

		TotalSecOutKHRN1 					= 0
		AvgSecIntKHRN1 						= 0
		TotalSecOutKHRN5 					= 0
		TotalSecIntKHRN5 					= 0
		TotalSecOutKHRY5 					= 0
		AvgSecIntKHRY5 						= 0

		TotalSecNewDisAmountUSDN1 			= 0
		AvgSecNewIntUSDN1 					= 0
		TotalSecNewDisAmountUSDN5 			= 0
		AvgSecNewIntUSDN5 					= 0
		TotalSecNewDisAmountUSDY5 			= 0
		AvgSecNewIntUSDY5 					= 0

		TotalSecOutUSDN1 					= 0
		AvgSecIntUSDN1 						= 0
		TotalSecOutUSDN5 					= 0
		AvgSecIntUSDN5 						= 0
		TotalSecOutUSDY5 					= 0
		AvgSecIntUSDY5 						= 0

		TotalSecNewDisAmountOtherFCN1 		= 0
		AvgSecNewIntOtherFCN1 				= 0
		TotalSecNewDisAmountOtherFCN5 		= 0
		AvgSecNewIntOtherFCN5 				= 0
		TotalSecNewDisAmountOtherFCY5 		= 0
		AvgSecNewIntOtherFCY5 				= 0

		TotalSecOutOtherFCN1 				= 0
		AvgSecIntOtherFCN1 					= 0
		TotalSecOutOtherFCN5 				= 0
		AvgSecIntOtherFCN5 					= 0
		TotalSecOutOtherFCY5 				= 0
		AvgSecIntOtherFCY5 					= 0

		# =============Variable for unsecure loan contract===========
		TotalUnsecNewDisAmountKHRN1 		= 0
		AvgUnsecNewDisAmountKHRN1 			= 0
		TotalUnsecNewDisAmountKHRN5 		= 0
		AvgUnsecNewIntAmountKHRN5 			= 0
		TotalUnsecNewDisAmountKHRY5 		= 0
		AvgUnsecNewIntKHRY5 				= 0

		TotalUnsecOutKHRN1 					= 0
		AvgUnsecIntKHRN1 					= 0
		TotalUnsecOutKHRN5 					= 0
		AvgUnsecIntKHRN5 					= 0
		TotalUnsecOutKHRY5 					= 0
		AvgUnsecIntKHRY5 					= 0

		TotalUnsecNewDisAmountUSDN1 		= 0
		AvgUnsecNewIntUSDN1 				= 0
		TotalUnsNewDisAmountUSDN5 			= 0
		AvgUnsecNewIntUSDN5 				= 0
		TotalUnsecNewDisAmountUSDY5 		= 0
		AvgUnsecNewIntUSDY5 				= 0

		TotalUnsecOutUSDN1 					= 0
		AvgUnsecIntUSDN1 					= 0
		TotalUnsOutUSDN5 					= 0
		AvgUnsecIntUSDN5 					= 0
		TotalUnsecOutUSDY5 					= 0
		AvgUnsecIntUSDY5 					= 0

		TotalUnsecNewDisAmountOtherFCN1 	= 0
		AvgUnsecNewIntOtherFCN1 			= 0
		TotalUnsecNewDisAmountOtherFCN5 	= 0
		AvgUnsecNewIntOtherFCN5 			= 0
		TotalUnsecNewDisAmountOtherFCY5 	= 0
		AvgUnsecNewIntOtherFCY5 			= 0

		TotalUnsecOutOtherFCN1 				= 0
		AvgIntOtherFCN1 					= 0
		TotalUnsecOutOtherFCN5 				= 0
		AvgUnsecIntOtherFCN5 				= 0
		TotalUnsecOutOtherFCY5 				= 0
		AvgUnsecIntOtherFCY5 				= 0

		if AVGIntRateOfUnsecuredLoanContract:
			for AvgIntRate in AVGIntRateOfUnsecuredLoanContract:
				if AvgIntRate.SecuredLoan == 'Y':
					if AvgIntRate.Term == 1:
						TotalSecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1
						AvgSecNewIntKHRN1 				+= AvgIntRate.AvgNewIntKHRN1
						TotalSecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1
						AvgSecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1
						TotalSecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1
						AvgSecNewIntUSDN1 				+= AvgIntRate.AvgNewIntUSDN1
						TotalSecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1
						AvgSecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1
						TotalSecNewDisAmountOtherFCN1 += AvgIntRate.TotalNewDisAmountOtherFCN1
						AvgSecNewIntOtherFCN1 			+= AvgIntRate.AvgNewIntOtherFCN1
						TotalSecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1
						AvgSecIntOtherFCN1 			+= AvgIntRate.AvgIntOtherFCN1
					elif AvgIntRate.Term == 5:
						TotalSecNewDisAmountKHRN5 	+= AvgIntRate.TotalNewDisbAmountKHRN5
						AvgSecNewIntKHRN5 				+= AvgIntRate.AvgNewIntKHRN5
						TotalSecOutKHRN5 				+= AvgIntRate.TotalOutKHRN5
						TotalSecIntKHRN5 					+= AvgIntRate.AvgIntKHRN5
						TotalSecNewDisAmountUSDN5 		+= AvgIntRate.TotalNewDisAmountUSDN5
						AvgSecNewIntUSDN5 				+= AvgIntRate.AvgNewIntUSDN5
						TotalSecOutUSDN5 				+= AvgIntRate.TotalOutUSDN5
						AvgSecIntUSDN5 					+= AvgIntRate.AvgIntUSDN5
						TotalSecNewDisAmountOtherFCN5 	+= AvgIntRate.TotalNewDisAmountOtherFCN5
						AvgSecNewIntOtherFCN5 			+= AvgIntRate.AvgNewIntOtherFCN5
						TotalSecOutOtherFCN5 			+= AvgIntRate.TotalOutOtherFCN5
						AvgSecIntOtherFCN5 				+= AvgIntRate.AvgIntOtherFCN5
					else:
						TotalSecNewDisAmountKHRY5 	+= AvgIntRate.TotalNewDisAmountKHRY5
						AvgSecNewIntKHRY5 				+= AvgIntRate.AvgNewIntKHRY5
						TotalSecOutKHRY5 			+= AvgIntRate.TotalOutKHRY5
						AvgSecIntKHRY5 				+= AvgIntRate.AvgIntKHRY5
						TotalSecNewDisAmountUSDY5 	+= AvgIntRate.TotalNewDisAmountUSDY5
						AvgSecNewIntUSDY5 				+= AvgIntRate.AvgNewIntUSDY5
						TotalSecOutUSDY5 			+= AvgIntRate.TotalOutUSDY5
						AvgSecIntUSDY5 				+= AvgIntRate.AvgIntUSDY5
						TotalSecNewDisAmountOtherFCY5 += AvgIntRate.TotalNewDisAmountOtherFCY5
						AvgSecNewIntOtherFCY5 			+= AvgIntRate.AvgNewIntOtherFCY5
						TotalSecOutOtherFCY5 		+= AvgIntRate.TotalOutOtherFCY5
						AvgSecIntOtherFCY5 			+= AvgIntRate.AvgIntOtherFCY5

				else:
					# Loan not Secure are here
					if AvgIntRate.Term == 1:
						TotalUnsecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1
						AvgUnsecNewDisAmountKHRN1 			+= AvgIntRate.AvgNewIntKHRN1
						TotalUnsecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1
						AvgUnsecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1
						TotalUnsecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1
						AvgUnsecNewIntUSDN1 			+= AvgIntRate.AvgNewIntUSDN1
						TotalUnsecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1
						AvgUnsecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1
						TotalUnsecNewDisAmountOtherFCN1+= AvgIntRate.TotalNewDisAmountOtherFCN1
						AvgUnsecNewIntOtherFCN1 		+= AvgIntRate.AvgNewIntOtherFCN1
						TotalUnsecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1
						AvgIntOtherFCN1 					+= AvgIntRate.AvgIntOtherFCN1
						
					elif AvgIntRate.Term == 5:
						TotalUnsecNewDisAmountKHRN5 		+= AvgIntRate.TotalNewDisbAmountKHRN5
						AvgUnsecNewIntAmountKHRN5 				+= AvgIntRate.AvgNewIntKHRN5
						TotalUnsecOutKHRN5 			+= AvgIntRate.TotalOutKHRN5
						AvgUnsecIntKHRN5 					+= AvgIntRate.AvgIntKHRN5
						TotalUnsNewDisAmountUSDN5 		+= AvgIntRate.TotalNewDisAmountUSDN5
						AvgUnsecNewIntUSDN5 				+= AvgIntRate.AvgNewIntUSDN5
						TotalUnsOutUSDN5 			+= AvgIntRate.TotalOutUSDN5
						AvgUnsecIntUSDN5 					+= AvgIntRate.AvgIntUSDN5
						TotalUnsecNewDisAmountOtherFCN5 	+= AvgIntRate.TotalNewDisAmountOtherFCN5
						AvgUnsecNewIntOtherFCN5 			+= AvgIntRate.AvgNewIntOtherFCN5
						TotalUnsecOutOtherFCN5 		+= AvgIntRate.TotalOutOtherFCN5
						AvgUnsecIntOtherFCN5 				+= AvgIntRate.AvgIntOtherFCN5
					else:
						TotalUnsecNewDisAmountKHRY5 	+= AvgIntRate.TotalNewDisAmountKHRY5
						AvgUnsecNewIntKHRY5 			+= AvgIntRate.AvgNewIntKHRY5
						TotalUnsecOutKHRY5 			+= AvgIntRate.TotalOutKHRY5
						AvgUnsecIntKHRY5 				+= AvgIntRate.AvgIntKHRY5
						TotalUnsecNewDisAmountUSDY5 	+= AvgIntRate.TotalNewDisAmountUSDY5
						AvgUnsecNewIntUSDY5 			+= AvgIntRate.AvgNewIntUSDY5
						TotalUnsecOutUSDY5 			+= AvgIntRate.TotalOutUSDY5
						AvgUnsecIntUSDY5 				+= AvgIntRate.AvgIntUSDY5
						TotalUnsecNewDisAmountOtherFCY5+= AvgIntRate.TotalNewDisAmountOtherFCY5
						AvgUnsecNewIntOtherFCY5 		+= AvgIntRate.AvgNewIntOtherFCY5
						TotalUnsecOutOtherFCY5 				+= AvgIntRate.TotalOutOtherFCY5
						AvgUnsecIntOtherFCY5 			+= AvgIntRate.AvgIntOtherFCY5

		RecordRow.append({ 	1:u'6.1- មិនមានការធានា Unsecured:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':'' })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({
						1:u'1- រហូតដល់​ ១​ ឆ្នាំ\nOne year or less ',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRN1)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewDisAmountKHRN1), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRN1)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRN1), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountUSDN1)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDN1), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsecOutUSDN1)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDN1), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCN1)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCN1), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCN1)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgIntOtherFCN1), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRN1,
					"G%s"%(CellRow) : float(AvgUnsecNewDisAmountKHRN1) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRN1,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRN1) / 100,
					"J%s"%(CellRow) : TotalUnsecNewDisAmountUSDN1,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDN1) / 100,
					"L%s"%(CellRow) : TotalUnsecOutUSDN1,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDN1) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCN1,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCN1) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCN1,
					"Q%s"%(CellRow) : float(AvgIntOtherFCN1) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'2- លើសពី ១ ឆ្នាំ​ ដល់៥ឆ្នាំ\nGreater than 1 year to 5 years',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRN5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntAmountKHRN5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRN5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRN5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsNewDisAmountUSDN5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDN5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsOutUSDN5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDN5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCN5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCN5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCN5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntOtherFCN5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
					})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRN5,
					"G%s"%(CellRow) : float(AvgUnsecNewIntAmountKHRN5) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRN5,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRN5) / 100,
					"J%s"%(CellRow) : TotalUnsNewDisAmountUSDN5,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDN5) / 100,
					"L%s"%(CellRow) : TotalUnsOutUSDN5,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDN5) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCN5,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCN5) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCN5,
					"Q%s"%(CellRow) : float(AvgUnsecIntOtherFCN5) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'3- លើសពី ៥ ឆ្នាំ\nGreater than 5 year',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRY5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntKHRY5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRY5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRY5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountUSDY5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDY5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsecOutUSDY5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDY5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCY5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCY5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCY5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntOtherFCY5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRY5,
					"G%s"%(CellRow) : float(AvgUnsecNewIntKHRY5) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRY5,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRY5) / 100,
					"J%s"%(CellRow) : TotalUnsecNewDisAmountUSDY5,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDY5) / 100,
					"L%s"%(CellRow) : TotalUnsecOutUSDY5,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDY5) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCY5,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCY5) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCY5,
					"Q%s"%(CellRow) : float(AvgUnsecIntOtherFCY5) / 100
				})
		CellRow+=1

		RecordRow.append({ 	1:u'6.2- មានការធានា Secured:',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'LD',
						'Indent':1,
						'RowBGColor':'',
						'LineFormat':''
						 })
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		RecordRow.append({
						1:u'1- រហូតដល់​ ១​ ឆ្នាំ\nOne year or less ',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRN1)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRN1), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRN1)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgSecIntKHRN1), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDN1)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDN1), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDN1)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDN1), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCN1)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCN1), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCN1)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCN1), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRN1,
					"G%s"%(CellRow) : float(AvgSecNewIntKHRN1) / 100,
					"H%s"%(CellRow) : TotalSecOutKHRN1,
					"I%s"%(CellRow) : float(AvgSecIntKHRN1) / 100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDN1,
					"K%s"%(CellRow) : float(AvgSecNewIntUSDN1) / 100,
					"L%s"%(CellRow) : TotalSecOutUSDN1,
					"M%s"%(CellRow) : float(AvgSecIntUSDN1) / 100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCN1,
					"O%s"%(CellRow) : float(AvgSecNewIntOtherFCN1) / 100,
					"P%s"%(CellRow) : TotalSecOutOtherFCN1,
					"Q%s"%(CellRow) : float(AvgSecIntOtherFCN1) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'2- លើសពី ១ ឆ្នាំ​ ដល់៥ឆ្នាំ\nGreater than 1 year to 5 years',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRN5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRN5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRN5)),
						5:u'%s %s' %(mktmoney.formatNumber(TotalSecIntKHRN5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDN5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDN5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDN5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDN5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCN5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCN5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCN5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCN5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRN5,
					"G%s"%(CellRow) : float(AvgSecNewIntKHRN5) / 100,
					"H%s"%(CellRow) : TotalSecOutKHRN5,
					"I%s"%(CellRow) : float(TotalSecIntKHRN5) / 100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDN5,
					"K%s"%(CellRow) : float(AvgSecNewIntUSDN5) / 100,
					"L%s"%(CellRow) : TotalSecOutUSDN5,
					"M%s"%(CellRow) : float(AvgSecIntUSDN5) / 100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCN5,
					"O%s"%(CellRow) : float(AvgSecNewIntOtherFCN5) / 100,
					"P%s"%(CellRow) : TotalSecOutOtherFCN5,
					"Q%s"%(CellRow) : float(AvgSecIntOtherFCN5) / 100
				})
		CellRow+=1

		RecordRow.append({
						1:u'3- លើសពី ៥ ឆ្នាំ\nGreater than 5 year',
						2:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountKHRY5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntKHRY5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalSecOutKHRY5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgSecIntKHRY5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountUSDY5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntUSDY5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalSecOutUSDY5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgSecIntUSDY5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalSecNewDisAmountOtherFCY5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgSecNewIntOtherFCY5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalSecOutOtherFCY5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgSecIntOtherFCY5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalSecNewDisAmountKHRY5,
					"G%s"%(CellRow) : float(AvgSecNewIntKHRY5) / 100,
					"H%s"%(CellRow) : TotalSecOutKHRY5,
					"I%s"%(CellRow) : float(AvgSecIntKHRY5) / 100,
					"J%s"%(CellRow) : TotalSecNewDisAmountUSDY5,
					"K%s"%(CellRow) : float(AvgSecNewIntUSDY5) / 100,
					"L%s"%(CellRow) : TotalSecOutUSDY5,
					"M%s"%(CellRow) : float(AvgSecIntUSDY5) / 100,
					"N%s"%(CellRow) : TotalSecNewDisAmountOtherFCY5,
					"O%s"%(CellRow) : float(AvgSecNewIntOtherFCY5) / 100,
					"P%s"%(CellRow) : TotalSecOutOtherFCY5,
					"Q%s"%(CellRow) : float(AvgSecIntOtherFCY5) / 100
				})
		CellRow+=1
		
		RecordRow.append({1:u'7- ឥណទានផ្សេងៗ\nOther​ Loans',
						2:u'',
						3:u'',
						4:u'',
						5:u'',
						6:u'',
						7:u'',
						8:u'',
						9:u'',
						10:u'',
						11:u'',
						12:u'',
						13:u'',
						'LineType':'GH',
						'Indent':0,
						'RowBGColor':'',
						'LineFormat':'bold'
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : "",
					"G%s"%(CellRow) : "",
					"H%s"%(CellRow) : "",
					"I%s"%(CellRow) : "",
					"J%s"%(CellRow) : "",
					"K%s"%(CellRow) : "",
					"L%s"%(CellRow) : "",
					"M%s"%(CellRow) : "",
					"N%s"%(CellRow) : "",
					"O%s"%(CellRow) : "",
					"P%s"%(CellRow) : "",
					"Q%s"%(CellRow) : ""
				})
		CellRow+=1

		AVGIntRateOfUnsecuredLoanContract = getAVGIntRateOfLoanContract("ALL",NBCOtherLoan)

		# =============Variable for secure loan contract===========
		TotalSecNewDisAmountKHRN1 		= 0
		AvgSecNewIntKHRN1 				= 0
		TotalSecNewDisAmountKHRN5 		= 0
		AvgSecNewIntKHRN5 				= 0
		TotalSecNewDisAmountKHRY5 		= 0
		AvgSecNewIntKHRY5 				= 0

		TotalSecOutKHRN1 				= 0
		AvgSecIntKHRN1 					= 0
		TotalSecOutKHRN5 				= 0
		TotalSecIntKHRN5 				= 0
		TotalSecOutKHRY5 				= 0
		AvgSecIntKHRY5 					= 0

		TotalSecNewDisAmountUSDN1 		= 0
		AvgSecNewIntUSDN1 				= 0
		TotalSecNewDisAmountUSDN5 		= 0
		AvgSecNewIntUSDN5 				= 0
		TotalSecNewDisAmountUSDY5 		= 0
		AvgSecNewIntUSDY5 				= 0

		TotalSecOutUSDN1 				= 0
		AvgSecIntUSDN1 					= 0
		TotalSecOutUSDN5 				= 0
		AvgSecIntUSDN5 					= 0
		TotalSecOutUSDY5 				= 0
		AvgSecIntUSDY5 					= 0

		TotalSecNewDisAmountOtherFCN1 	= 0
		AvgSecNewIntOtherFCN1 			= 0
		TotalSecNewDisAmountOtherFCN5 	= 0
		AvgSecNewIntOtherFCN5 			= 0
		TotalSecNewDisAmountOtherFCY5 	= 0
		AvgSecNewIntOtherFCY5 			= 0

		TotalSecOutOtherFCN1 			= 0
		AvgSecIntOtherFCN1 				= 0
		TotalSecOutOtherFCN5 			= 0
		AvgSecIntOtherFCN5 				= 0
		TotalSecOutOtherFCY5 			= 0
		AvgSecIntOtherFCY5 				= 0

		# =============Variable for unsecure loan contract===========
		TotalUnsecNewDisAmountKHRN1 	= 0
		AvgUnsecNewDisAmountKHRN1 		= 0
		TotalUnsecNewDisAmountKHRN5 	= 0
		AvgUnsecNewIntAmountKHRN5 		= 0
		TotalUnsecNewDisAmountKHRY5 	= 0
		AvgUnsecNewIntKHRY5 			= 0

		TotalUnsecOutKHRN1 				= 0
		AvgUnsecIntKHRN1 				= 0
		TotalUnsecOutKHRN5 				= 0
		AvgUnsecIntKHRN5 				= 0
		TotalUnsecOutKHRY5 				= 0
		AvgUnsecIntKHRY5 				= 0

		TotalUnsecNewDisAmountUSDN1 	= 0
		AvgUnsecNewIntUSDN1 			= 0
		TotalUnsNewDisAmountUSDN5 		= 0
		AvgUnsecNewIntUSDN5 			= 0
		TotalUnsecNewDisAmountUSDY5 	= 0
		AvgUnsecNewIntUSDY5 			= 0

		TotalUnsecOutUSDN1 				= 0
		AvgUnsecIntUSDN1 				= 0
		TotalUnsOutUSDN5 				= 0
		AvgUnsecIntUSDN5 				= 0
		TotalUnsecOutUSDY5 				= 0
		AvgUnsecIntUSDY5 				= 0

		TotalUnsecNewDisAmountOtherFCN1 	= 0
		AvgUnsecNewIntOtherFCN1 			= 0
		TotalUnsecNewDisAmountOtherFCN5 	= 0
		AvgUnsecNewIntOtherFCN5 			= 0
		TotalUnsecNewDisAmountOtherFCY5 	= 0
		AvgUnsecNewIntOtherFCY5 			= 0

		TotalUnsecOutOtherFCN1 				= 0
		AvgIntOtherFCN1 					= 0
		TotalUnsecOutOtherFCN5 				= 0
		AvgUnsecIntOtherFCN5 				= 0
		TotalUnsecOutOtherFCY5 				= 0
		AvgUnsecIntOtherFCY5 				= 0

		if AVGIntRateOfUnsecuredLoanContract:
			for AvgIntRate in AVGIntRateOfUnsecuredLoanContract:
				if AvgIntRate.SecuredLoan == 'Y':
					if AvgIntRate.Term == 1:
						TotalSecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1
						AvgSecNewIntKHRN1 				+= AvgIntRate.AvgNewIntKHRN1
						TotalSecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1
						AvgSecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1
						TotalSecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1
						AvgSecNewIntUSDN1 				+= AvgIntRate.AvgNewIntUSDN1
						TotalSecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1
						AvgSecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1
						TotalSecNewDisAmountOtherFCN1 += AvgIntRate.TotalNewDisAmountOtherFCN1
						AvgSecNewIntOtherFCN1 			+= AvgIntRate.AvgNewIntOtherFCN1
						TotalSecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1
						AvgSecIntOtherFCN1 			+= AvgIntRate.AvgIntOtherFCN1
					elif AvgIntRate.Term == 5:
						TotalSecNewDisAmountKHRN5 	+= AvgIntRate.TotalNewDisbAmountKHRN5
						AvgSecNewIntKHRN5 				+= AvgIntRate.AvgNewIntKHRN5
						TotalSecOutKHRN5 				+= AvgIntRate.TotalOutKHRN5
						TotalSecIntKHRN5 					+= AvgIntRate.AvgIntKHRN5
						TotalSecNewDisAmountUSDN5 		+= AvgIntRate.TotalNewDisAmountUSDN5
						AvgSecNewIntUSDN5 				+= AvgIntRate.AvgNewIntUSDN5
						TotalSecOutUSDN5 				+= AvgIntRate.TotalOutUSDN5
						AvgSecIntUSDN5 					+= AvgIntRate.AvgIntUSDN5
						TotalSecNewDisAmountOtherFCN5 	+= AvgIntRate.TotalNewDisAmountOtherFCN5
						AvgSecNewIntOtherFCN5 			+= AvgIntRate.AvgNewIntOtherFCN5
						TotalSecOutOtherFCN5 			+= AvgIntRate.TotalOutOtherFCN5
						AvgSecIntOtherFCN5 				+= AvgIntRate.AvgIntOtherFCN5
					else:
						TotalSecNewDisAmountKHRY5 	+= AvgIntRate.TotalNewDisAmountKHRY5
						AvgSecNewIntKHRY5 				+= AvgIntRate.AvgNewIntKHRY5
						TotalSecOutKHRY5 			+= AvgIntRate.TotalOutKHRY5
						AvgSecIntKHRY5 				+= AvgIntRate.AvgIntKHRY5
						TotalSecNewDisAmountUSDY5 	+= AvgIntRate.TotalNewDisAmountUSDY5
						AvgSecNewIntUSDY5 				+= AvgIntRate.AvgNewIntUSDY5
						TotalSecOutUSDY5 			+= AvgIntRate.TotalOutUSDY5
						AvgSecIntUSDY5 				+= AvgIntRate.AvgIntUSDY5
						TotalSecNewDisAmountOtherFCY5 += AvgIntRate.TotalNewDisAmountOtherFCY5
						AvgSecNewIntOtherFCY5 			+= AvgIntRate.AvgNewIntOtherFCY5
						TotalSecOutOtherFCY5 		+= AvgIntRate.TotalOutOtherFCY5
						AvgSecIntOtherFCY5 			+= AvgIntRate.AvgIntOtherFCY5

				else:
					# Loan not Secure are here
					if AvgIntRate.Term == 1:
						TotalUnsecNewDisAmountKHRN1 	+= AvgIntRate.TotalNewDisAmountKHRN1
						AvgUnsecNewDisAmountKHRN1 			+= AvgIntRate.AvgNewIntKHRN1
						TotalUnsecOutKHRN1 			+= AvgIntRate.TotalOutKHRN1
						AvgUnsecIntKHRN1 				+= AvgIntRate.AvgIntKHRN1
						TotalUnsecNewDisAmountUSDN1 	+= AvgIntRate.TotalNewDisAmountUSDN1
						AvgUnsecNewIntUSDN1 			+= AvgIntRate.AvgNewIntUSDN1
						TotalUnsecOutUSDN1 			+= AvgIntRate.TotalOutUSDN1
						AvgUnsecIntUSDN1 				+= AvgIntRate.AvgIntUSDN1
						TotalUnsecNewDisAmountOtherFCN1+= AvgIntRate.TotalNewDisAmountOtherFCN1
						AvgUnsecNewIntOtherFCN1 		+= AvgIntRate.AvgNewIntOtherFCN1
						TotalUnsecOutOtherFCN1 		+= AvgIntRate.TotalOutOtherFCN1
						AvgIntOtherFCN1 					+= AvgIntRate.AvgIntOtherFCN1
						
					elif AvgIntRate.Term == 5:
						TotalUnsecNewDisAmountKHRN5 		+= AvgIntRate.TotalNewDisbAmountKHRN5
						AvgUnsecNewIntAmountKHRN5 				+= AvgIntRate.AvgNewIntKHRN5
						TotalUnsecOutKHRN5 			+= AvgIntRate.TotalOutKHRN5
						AvgUnsecIntKHRN5 					+= AvgIntRate.AvgIntKHRN5
						TotalUnsNewDisAmountUSDN5 		+= AvgIntRate.TotalNewDisAmountUSDN5
						AvgUnsecNewIntUSDN5 				+= AvgIntRate.AvgNewIntUSDN5
						TotalUnsOutUSDN5 			+= AvgIntRate.TotalOutUSDN5
						AvgUnsecIntUSDN5 					+= AvgIntRate.AvgIntUSDN5
						TotalUnsecNewDisAmountOtherFCN5 	+= AvgIntRate.TotalNewDisAmountOtherFCN5
						AvgUnsecNewIntOtherFCN5 			+= AvgIntRate.AvgNewIntOtherFCN5
						TotalUnsecOutOtherFCN5 		+= AvgIntRate.TotalOutOtherFCN5
						AvgUnsecIntOtherFCN5 				+= AvgIntRate.AvgIntOtherFCN5
					else:
						TotalUnsecNewDisAmountKHRY5 	+= AvgIntRate.TotalNewDisAmountKHRY5
						AvgUnsecNewIntKHRY5 			+= AvgIntRate.AvgNewIntKHRY5
						TotalUnsecOutKHRY5 			+= AvgIntRate.TotalOutKHRY5
						AvgUnsecIntKHRY5 				+= AvgIntRate.AvgIntKHRY5
						TotalUnsecNewDisAmountUSDY5 	+= AvgIntRate.TotalNewDisAmountUSDY5
						AvgUnsecNewIntUSDY5 			+= AvgIntRate.AvgNewIntUSDY5
						TotalUnsecOutUSDY5 			+= AvgIntRate.TotalOutUSDY5
						AvgUnsecIntUSDY5 				+= AvgIntRate.AvgIntUSDY5
						TotalUnsecNewDisAmountOtherFCY5+= AvgIntRate.TotalNewDisAmountOtherFCY5
						AvgUnsecNewIntOtherFCY5 		+= AvgIntRate.AvgNewIntOtherFCY5
						TotalUnsecOutOtherFCY5 				+= AvgIntRate.TotalOutOtherFCY5
						AvgUnsecIntOtherFCY5 			+= AvgIntRate.AvgIntOtherFCY5

		TotalUnsecNewDisAmountKHRN1 			+= TotalSecNewDisAmountKHRN1
		AvgUnsecNewDisAmountKHRN1					+= AvgSecNewIntKHRN1
		TotalUnsecOutKHRN1 					+= TotalSecOutKHRN1
		AvgUnsecIntKHRN1 						+= AvgSecIntKHRN1
		TotalUnsecNewDisAmountUSDN1 			+= TotalSecNewDisAmountUSDN1
		AvgUnsecNewIntUSDN1 					+= AvgSecNewIntUSDN1
		TotalUnsecOutUSDN1 					+= TotalSecOutUSDN1
		AvgUnsecIntUSDN1 						+= AvgSecIntUSDN1
		TotalUnsecNewDisAmountOtherFCN1 		+= TotalSecNewDisAmountOtherFCN1
		AvgUnsecNewIntOtherFCN1 				+= AvgSecNewIntOtherFCN1
		TotalUnsecOutOtherFCN1 				+= TotalSecOutOtherFCN1
		AvgIntOtherFCN1 							+= AvgSecIntOtherFCN1
		
		TotalUnsecNewDisAmountKHRN5 			+= TotalSecNewDisAmountKHRN5
		AvgUnsecNewIntAmountKHRN5 					+= AvgSecNewIntKHRN5
		TotalUnsecOutKHRN5 				+= TotalSecOutKHRN5
		AvgUnsecIntKHRN5 						+= TotalSecIntKHRN5
		TotalUnsNewDisAmountUSDN5 			+= TotalSecNewDisAmountUSDN5
		AvgUnsecNewIntUSDN5 					+= AvgSecNewIntUSDN5
		TotalUnsOutUSDN5 				+= TotalSecOutUSDN1
		AvgUnsecIntUSDN5 						+= AvgSecIntUSDN5
		TotalUnsecNewDisAmountOtherFCN5 		+= TotalSecNewDisAmountOtherFCN5
		AvgUnsecNewIntOtherFCN5 				+= AvgSecNewIntOtherFCN5
		TotalUnsecOutOtherFCN5 			+= TotalSecOutOtherFCN5
		AvgUnsecIntOtherFCN5 					+= AvgSecIntOtherFCN5

		TotalUnsecNewDisAmountKHRY5 		+= TotalSecNewDisAmountKHRY5
		AvgUnsecNewIntKHRY5 				+= AvgSecNewIntKHRY5
		TotalUnsecOutKHRY5 				+= TotalSecOutKHRY5
		AvgUnsecIntKHRY5 					+= AvgSecIntKHRY5
		TotalUnsecNewDisAmountUSDY5 		+= TotalSecNewDisAmountUSDY5
		AvgUnsecNewIntUSDY5 				+= AvgSecNewIntUSDY5
		TotalUnsecOutUSDY5 				+= TotalSecOutUSDY5
		AvgUnsecIntUSDY5 					+= AvgSecIntUSDY5
		TotalUnsecNewDisAmountOtherFCY5 	+= TotalSecNewDisAmountOtherFCY5
		AvgUnsecNewIntOtherFCY5 			+= AvgSecNewIntOtherFCY5
		TotalUnsecOutOtherFCY5 			+= TotalSecOutOtherFCY5
		AvgUnsecIntOtherFCY5 				+= AvgSecIntOtherFCY5

		RecordRow.append({1:u'1- រហូតដល់​ ១​ ឆ្នាំ\nOne year or less ',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRN1)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewDisAmountKHRN1), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRN1)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRN1), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountUSDN1)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDN1), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsecOutUSDN1)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDN1), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCN1)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCN1), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCN1)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgIntOtherFCN1), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRN1,
					"G%s"%(CellRow) : float(AvgUnsecNewDisAmountKHRN1) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRN1,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRN1) / 100,
					"J%s"%(CellRow) : TotalUnsecNewDisAmountUSDN1,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDN1) / 100,
					"L%s"%(CellRow) : TotalUnsecOutUSDN1,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDN1) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCN1,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCN1) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCN1,
					"Q%s"%(CellRow) : float(AvgIntOtherFCN1) / 100
				})
		CellRow+=1

		RecordRow.append({1:u'2- លើសពី ១ ឆ្នាំ​ ដល់៥ឆ្នាំ\nGreater than 1 year to 5 years',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRN5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntAmountKHRN5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRN5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRN5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsNewDisAmountUSDN5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDN5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsOutUSDN5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDN5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCN5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCN5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCN5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntOtherFCN5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRN5,
					"G%s"%(CellRow) : float(AvgUnsecNewIntAmountKHRN5) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRN5,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRN5) / 100,
					"J%s"%(CellRow) : TotalUnsNewDisAmountUSDN5,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDN5) / 100,
					"L%s"%(CellRow) : TotalUnsOutUSDN5,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDN5) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCN5,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCN5) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCN5,
					"Q%s"%(CellRow) : float(AvgUnsecIntOtherFCN5) / 100
				})
		CellRow+=1

		RecordRow.append({1:u'3- លើសពី ៥ ឆ្នាំ\nGreater than 5 year',
						2:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountKHRY5)),
						3:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntKHRY5), "%"),
						4:u'%s' %(mktmoney.formatNumber(TotalUnsecOutKHRY5)),
						5:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntKHRY5), "%"),
						6:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountUSDY5)),
						7:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntUSDY5), "%"),
						8:u'%s' %(mktmoney.formatNumber(TotalUnsecOutUSDY5)),
						9:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntUSDY5), "%"),
						10:u'%s' %(mktmoney.formatNumber(TotalUnsecNewDisAmountOtherFCY5)),
						11:u'%s %s' %(mktmoney.formatNumber(AvgUnsecNewIntOtherFCY5), "%"),
						12:u'%s' %(mktmoney.formatNumber(TotalUnsecOutOtherFCY5)),
						13:u'%s %s' %(mktmoney.formatNumber(AvgUnsecIntOtherFCY5), "%"),
						'LineType':'LD',
						'Indent':2,
						'RowBGColor':'',
						'LineFormat':''
				})
		ExcelRecord.update({
					"F%s"%(CellRow) : TotalUnsecNewDisAmountKHRY5,
					"G%s"%(CellRow) : float(AvgUnsecNewIntKHRY5) / 100,
					"H%s"%(CellRow) : TotalUnsecOutKHRY5,
					"I%s"%(CellRow) : float(AvgUnsecIntKHRY5) / 100,
					"J%s"%(CellRow) : TotalUnsecNewDisAmountUSDY5,
					"K%s"%(CellRow) : float(AvgUnsecNewIntUSDY5) / 100,
					"L%s"%(CellRow) : TotalUnsecOutUSDY5,
					"M%s"%(CellRow) : float(AvgUnsecIntUSDY5) / 100,
					"N%s"%(CellRow) : TotalUnsecNewDisAmountOtherFCY5,
					"O%s"%(CellRow) : float(AvgUnsecNewIntOtherFCY5) / 100,
					"P%s"%(CellRow) : TotalUnsecOutOtherFCY5,
					"Q%s"%(CellRow) : float(AvgUnsecIntOtherFCY5) / 100
				})
		CellRow+=1

		return RecordRow,ExcelRecord

	except Exception, e:
		raise

def getAVGIntRateOfLoanContract(Branch = "ALL",LoanProduct=None):
	BankDate 		= mktdate.getBankDate()
	BankDatePreMonth = BankDate - timedelta(days=1)
	BankDatePreMonth = str(BankDatePreMonth)[:7]
	ReadAs 			= 1000000

	LoanObj = db.session.query(
								MKT_LOAN_CONTRACT.Branch.label('Branch'),
								MKT_LOAN_CONTRACT.ID.label('ID'),
								MKT_LOAN_CONTRACT.LoanProduct.label('LoanProduct'),
								MKT_LOAN_COLLATERAL.Collateral.label('CollateralID'),
								(MKT_LOAN_CONTRACT.Disbursed * cast(MKT_CURRENCY.OtherRate1, Float)).label('DisbursedAmount'),
								(case(
									[(
										cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1,
										1
									)],
								else_= 
										case(
											[(
												and_(cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1, cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
												5
											)],
										else_= 10
										)
										)).label('Term'),
								case(
									[(
										MKT_LOAN_COLLATERAL.Collateral != None,
										'Y'
									)],
								else_='N'
								).label('SecuredLoan'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisbursedAmountKHR'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisbAmountKHRN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntKHRN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountKHRN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntKHRN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountKHRY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntKHRY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR',cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutKHRN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR', cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntKHRN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutKHRN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntKHRN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutKHRY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'KHR',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntKHRY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountUSD'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountUSDN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntUSDN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountUSDN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntUSDN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountUSDY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntUSDY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutUSDN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD', cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntUSDN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutUSDN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntUSDN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutUSDY5'),

								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency == 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntUSDY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountOtherFC'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountOtherFCN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntOtherFCN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountOtherFCN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntOtherFCN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										(MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountOtherFCY5'),

								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', MKT_LOAN_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%'),cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										((MKT_LOAN_CONTRACT.Disbursed + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntOtherFCY5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutOtherFCN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD', cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 1),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntOtherFCN1'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutOtherFCN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 1 ,cast(MKT_LOAN_CONTRACT.Term,Float)/12 <= 5),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntOtherFCN5'),
								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										(MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutOtherFCY5'),

								case(
									[(
										and_(MKT_LOAN_CONTRACT.Currency != 'KHR', MKT_LOAN_CONTRACT.Currency != 'USD',cast(MKT_LOAN_CONTRACT.Term,Float)/12 > 5),
										((MKT_LOAN_CONTRACT.OutstandingAmount + MKT_LOAN_CONTRACT.AccrInterest) * cast(MKT_LOAN_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntOtherFCY5')

								).\
								join(MKT_CURRENCY, MKT_CURRENCY.ID == MKT_LOAN_CONTRACT.Currency).\
								outerjoin(MKT_LOAN_COLLATERAL, MKT_LOAN_COLLATERAL.ID == MKT_LOAN_CONTRACT.ID).\
								outerjoin(MKT_COLLATERAL_DE, MKT_COLLATERAL_DE.CollateralID==MKT_LOAN_COLLATERAL.Collateral).\
								distinct(MKT_LOAN_CONTRACT.ID).\
								subquery()

	if Branch != 'ALL':
		LoanObj = db.session.query(LoanObj).\
									filter(LoanObj.c.Branch.in_(Branch)).\
									subquery()
	
	LoanObj = db.session.query(LoanObj).\
								filter(LoanObj.c.LoanProduct.in_(LoanProduct)).\
								subquery()
	
	LoanObj = db.session.query(
								LoanObj.c.SecuredLoan.label('SecuredLoan'),
								LoanObj.c.Term.label('Term'),
								func.sum(LoanObj.c.DisbursedAmount).label('DisbursedAmount'),
								func.sum(LoanObj.c.NewDisbursedAmountKHR).label('NewDisbursedAmountKHR'),
								func.sum(LoanObj.c.NewDisbAmountKHRN1).label('NewDisbAmountKHRN1'),
								func.sum(LoanObj.c.NewIntKHRN1).label('NewIntKHRN1'),
								func.sum(LoanObj.c.NewDisAmountKHRN5).label('NewDisAmountKHRN5'),
								func.sum(LoanObj.c.NewIntKHRN5).label('NewIntKHRN5'),
								func.sum(LoanObj.c.NewDisAmountKHRY5).label('NewDisAmountKHRY5'),
								func.sum(LoanObj.c.NewIntKHRY5).label('NewIntKHRY5'),
								func.sum(LoanObj.c.OutKHRN1).label('OutKHRN1'),
								func.sum(LoanObj.c.IntKHRN1).label('IntKHRN1'),
								func.sum(LoanObj.c.OutKHRN5).label('OutKHRN5'),
								func.sum(LoanObj.c.IntKHRN5).label('IntKHRN5'),
								func.sum(LoanObj.c.OutKHRY5).label('OutKHRY5'),
								func.sum(LoanObj.c.IntKHRY5).label('IntKHRY5'),
								func.sum(LoanObj.c.NewDisAmountUSD).label('NewDisAmountUSD'),
								func.sum(LoanObj.c.NewDisAmountUSDN1).label('NewDisAmountUSDN1'),
								func.sum(LoanObj.c.NewIntUSDN1).label('NewIntUSDN1'),
								func.sum(LoanObj.c.NewDisAmountUSDN5).label('NewDisAmountUSDN5'),
								func.sum(LoanObj.c.NewIntUSDN5).label('NewIntUSDN5'),
								func.sum(LoanObj.c.NewDisAmountUSDY5).label('NewDisAmountUSDY5'),
								func.sum(LoanObj.c.NewIntUSDY5).label('NewIntUSDY5'),
								func.sum(LoanObj.c.OutUSDN1).label('OutUSDN1'),
								func.sum(LoanObj.c.IntUSDN1).label('IntUSDN1'),
								func.sum(LoanObj.c.OutUSDN5).label('OutUSDN5'),
								func.sum(LoanObj.c.IntUSDN5).label('IntUSDN5'),
								func.sum(LoanObj.c.OutUSDY5).label('OutUSDY5'),
								func.sum(LoanObj.c.IntUSDY5).label('IntUSDY5'),
								func.sum(LoanObj.c.NewDisAmountOtherFC).label('NewDisAmountOtherFC'),
								func.sum(LoanObj.c.NewDisAmountOtherFCN1).label('NewDisAmountOtherFCN1'),
								func.sum(LoanObj.c.NewIntOtherFCN1).label('NewIntOtherFCN1'),
								func.sum(LoanObj.c.NewDisAmountOtherFCN5).label('NewDisAmountOtherFCN5'),
								func.sum(LoanObj.c.NewIntOtherFCN5).label('NewIntOtherFCN5'),
								func.sum(LoanObj.c.NewDisAmountOtherFCY5).label('NewDisAmountOtherFCY5'),
								func.sum(LoanObj.c.NewIntOtherFCY5).label('NewIntOtherFCY5'),
								func.sum(LoanObj.c.OutOtherFCN1).label('OutOtherFCN1'),
								func.sum(LoanObj.c.IntOtherFCN1).label('IntOtherFCN1'),
								func.sum(LoanObj.c.OutOtherFCN5).label('OutOtherFCN5'),
								func.sum(LoanObj.c.IntOtherFCN5).label('IntOtherFCN5'),
								func.sum(LoanObj.c.OutOtherFCY5).label('OutOtherFCY5'),
								func.sum(LoanObj.c.IntOtherFCY5).label('IntOtherFCY5'),
								).\
								group_by(LoanObj.c.SecuredLoan, LoanObj.c.Term).\
								subquery()

	LoanObj = db.session.query(
								LoanObj.c.SecuredLoan.label('SecuredLoan'),
								LoanObj.c.Term.label('Term'),
								(LoanObj.c.NewDisbAmountKHRN1 / ReadAs).label('TotalNewDisAmountKHRN1'),
								case(
									[(
										LoanObj.c.NewDisbAmountKHRN1 != 0,
										LoanObj.c.NewIntKHRN1 / LoanObj.c.NewDisbAmountKHRN1
									)],
									else_=0
								).label('AvgNewIntKHRN1'),
								(LoanObj.c.NewDisAmountKHRN5 / ReadAs).label('TotalNewDisbAmountKHRN5'),
								case(
									[(
										LoanObj.c.NewDisAmountKHRN5 != 0,
										LoanObj.c.NewIntKHRN5 / LoanObj.c.NewDisAmountKHRN5
									)],
									else_=0
								).label('AvgNewIntKHRN5'),
								(LoanObj.c.NewDisAmountKHRY5 / ReadAs).label('TotalNewDisAmountKHRY5'),
								case(
									[(
										LoanObj.c.NewDisAmountKHRY5 != 0,
										LoanObj.c.NewIntKHRY5 / LoanObj.c.NewDisAmountKHRY5
									)],
									else_=0
								).label('AvgNewIntKHRY5'),
								(LoanObj.c.OutKHRN1 / ReadAs).label('TotalOutKHRN1'),
								case(
									[(
										LoanObj.c.OutKHRN1 != 0,
										LoanObj.c.IntKHRN1 / LoanObj.c.OutKHRN1
									)],
									else_=0
								).label('AvgIntKHRN1'),
								(LoanObj.c.OutKHRN5 / ReadAs).label('TotalOutKHRN5'),
								case(
									[(
										LoanObj.c.OutKHRN5 != 0,
										LoanObj.c.IntKHRN5 / LoanObj.c.OutKHRN5
									)],
									else_=0
								).label('AvgIntKHRN5'),
								(LoanObj.c.OutKHRY5 / ReadAs).label('TotalOutKHRY5'),
								case(
									[(
										LoanObj.c.OutKHRY5 != 0,
										LoanObj.c.IntKHRY5 / LoanObj.c.OutKHRY5
									)],
									else_=0
								).label('AvgIntKHRY5'),
								(LoanObj.c.NewDisAmountUSDN1 / ReadAs).label('TotalNewDisAmountUSDN1'),
								case(
									[(
										LoanObj.c.NewDisAmountUSDN1 != 0,
										LoanObj.c.NewIntUSDN1 / LoanObj.c.NewDisAmountUSDN1
									)],
									else_=0
								).label('AvgNewIntUSDN1'),
								(LoanObj.c.NewDisAmountUSDN5 / ReadAs).label('TotalNewDisAmountUSDN5'),
								case(
									[(
										LoanObj.c.NewDisAmountUSDN5 != 0,
										LoanObj.c.NewIntUSDN5 / LoanObj.c.NewDisAmountUSDN5
									)],
									else_=0
								).label('AvgNewIntUSDN5'),
								(LoanObj.c.NewDisAmountUSDY5 / ReadAs).label('TotalNewDisAmountUSDY5'),
								case(
									[(
										LoanObj.c.NewDisAmountUSDY5 != 0,
										LoanObj.c.NewIntUSDY5 / LoanObj.c.NewDisAmountUSDY5
									)],
									else_=0
								).label('AvgNewIntUSDY5'),
								(LoanObj.c.OutUSDN1 / ReadAs).label('TotalOutUSDN1'),
								case(
									[(
										LoanObj.c.OutUSDN1 != 0,
										LoanObj.c.IntUSDN1 / LoanObj.c.OutUSDN1
									)],
									else_=0
								).label('AvgIntUSDN1'),
								(LoanObj.c.OutUSDN5 / ReadAs).label('TotalOutUSDN5'),
								case(
									[(
										LoanObj.c.OutUSDN5 != 0,
										LoanObj.c.IntUSDN5 / LoanObj.c.OutUSDN5
									)],
									else_=0
								).label('AvgIntUSDN5'),
								(LoanObj.c.OutUSDY5 / ReadAs).label('TotalOutUSDY5'),
								case(
									[(
										LoanObj.c.OutUSDY5 != 0,
										LoanObj.c.IntUSDY5 / LoanObj.c.OutUSDY5
									)],
									else_=0
								).label('AvgIntUSDY5'),
								(LoanObj.c.NewDisAmountOtherFCN1 / ReadAs).label('TotalNewDisAmountOtherFCN1'),
								case(
									[(
										LoanObj.c.NewDisAmountOtherFCN1 != 0,
										LoanObj.c.NewIntOtherFCN1 / LoanObj.c.NewDisAmountOtherFCN1
									)],
									else_=0
								).label('AvgNewIntOtherFCN1'),
								(LoanObj.c.NewDisAmountOtherFCN5 / ReadAs).label('TotalNewDisAmountOtherFCN5'),
								case(
									[(
										LoanObj.c.NewDisAmountOtherFCN5 != 0,
										LoanObj.c.NewIntOtherFCN5 / LoanObj.c.NewDisAmountOtherFCN5
									)],
									else_=0
								).label('AvgNewIntOtherFCN5'),
								(LoanObj.c.NewDisAmountOtherFCY5 / ReadAs).label('TotalNewDisAmountOtherFCY5'),
								case(
									[(
										LoanObj.c.NewDisAmountOtherFCY5 != 0,
										LoanObj.c.NewIntOtherFCY5 / LoanObj.c.NewDisAmountOtherFCY5
									)],
									else_=0
								).label('AvgNewIntOtherFCY5'),
								(LoanObj.c.OutOtherFCN1 / ReadAs).label('TotalOutOtherFCN1'),
								case(
									[(
										LoanObj.c.OutOtherFCN1 != 0,
										LoanObj.c.IntOtherFCN1 / LoanObj.c.OutOtherFCN1
									)],
									else_=0
								).label('AvgIntOtherFCN1'),
								(LoanObj.c.OutOtherFCN5 / ReadAs).label('TotalOutOtherFCN5'),
								case(
									[(
										LoanObj.c.OutOtherFCN5 != 0,
										LoanObj.c.IntOtherFCN5 / LoanObj.c.OutOtherFCN5
									)],
									else_=0
								).label('AvgIntOtherFCN5'),
								(LoanObj.c.OutOtherFCY5 / ReadAs).label('TotalOutOtherFCY5'),
								case(
									[(
										LoanObj.c.OutOtherFCY5 != 0,
										LoanObj.c.IntOtherFCY5 / LoanObj.c.OutOtherFCY5
									)],
									else_=0
								).label('AvgIntOtherFCY5'),
								).\
								subquery()

	LoanObj = db.session.query(LoanObj).order_by(LoanObj.c.SecuredLoan).all()

	return LoanObj


def getAVGIntRateOfLCOverdraft(Branch = "ALL",LoanProduct=None):
	BankDate 		= mktdate.getBankDate()
	BankDatePreMonth = BankDate - timedelta(days=1)
	BankDatePreMonth = str(BankDatePreMonth)[:7]
	ReadAs 			= 1000000

	LoanObj = db.session.query(
								MKT_OVERDRAFT_CONTRACT.Branch.label('Branch'),
								MKT_OVERDRAFT_CONTRACT.ID.label('ID'),
								MKT_OVERDRAFT_CONTRACT.AccProduct.label('AccProduct'),
								(MKT_OVERDRAFT_CONTRACT.OutstandingAmount * cast(MKT_CURRENCY.OtherRate1, Float)).label('DisbursedAmount'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency == 'KHR', MKT_OVERDRAFT_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										(MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisbAmountKHRN1'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency == 'KHR', MKT_OVERDRAFT_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										((MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_OVERDRAFT_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntKHRN1'),
								case(
									[(
										MKT_OVERDRAFT_CONTRACT.Currency == 'KHR',
										(MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutKHRN1'),
								case(
									[(
										MKT_OVERDRAFT_CONTRACT.Currency == 'KHR',
										((MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_OVERDRAFT_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntKHRN1'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency == 'USD', MKT_OVERDRAFT_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										(MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountUSDN1'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency == 'USD', MKT_OVERDRAFT_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										((MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_OVERDRAFT_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntUSDN1'),
								case(
									[(
										MKT_OVERDRAFT_CONTRACT.Currency == 'USD',
										(MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutUSDN1'),
								case(
									[(
										MKT_OVERDRAFT_CONTRACT.Currency == 'USD',
										((MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_OVERDRAFT_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntUSDN1'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency != 'KHR', MKT_OVERDRAFT_CONTRACT.Currency != 'USD', MKT_OVERDRAFT_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										(MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewDisAmountOtherFCN1'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency != 'KHR', MKT_OVERDRAFT_CONTRACT.Currency != 'USD', MKT_OVERDRAFT_CONTRACT.ValueDate.ilike(BankDatePreMonth + '%')),
										((MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_OVERDRAFT_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('NewIntOtherFCN1'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency != 'KHR', MKT_OVERDRAFT_CONTRACT.Currency != 'USD'),
										(MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('OutOtherFCN1'),
								case(
									[(
										and_(MKT_OVERDRAFT_CONTRACT.Currency != 'KHR', MKT_OVERDRAFT_CONTRACT.Currency != 'USD'),
										((MKT_OVERDRAFT_CONTRACT.OutstandingAmount + MKT_OVERDRAFT_CONTRACT.AccrInterest) * cast(MKT_OVERDRAFT_CONTRACT.InterestRate, Float)) * cast(MKT_CURRENCY.OtherRate1, Float)
									)],
								else_=0
								).label('IntOtherFCN1')

								).\
								join(MKT_CURRENCY, MKT_CURRENCY.ID == MKT_OVERDRAFT_CONTRACT.Currency).\
								distinct(MKT_OVERDRAFT_CONTRACT.ID).\
								subquery()

	LoanObj = db.session.query(LoanObj).\
								filter(LoanObj.c.AccProduct.in_(LoanProduct)).\
								subquery()

	LoanObj = db.session.query(
								func.sum(LoanObj.c.DisbursedAmount).label('DisbursedAmount'),
								func.sum(LoanObj.c.NewDisbAmountKHRN1).label('NewDisbAmountKHRN1'),
								func.sum(LoanObj.c.NewIntKHRN1).label('NewIntKHRN1'),
								func.sum(LoanObj.c.OutKHRN1).label('OutKHRN1'),
								func.sum(LoanObj.c.IntKHRN1).label('IntKHRN1'),
								func.sum(LoanObj.c.NewDisAmountUSDN1).label('NewDisAmountUSDN1'),
								func.sum(LoanObj.c.NewIntUSDN1).label('NewIntUSDN1'),
								func.sum(LoanObj.c.OutUSDN1).label('OutUSDN1'),
								func.sum(LoanObj.c.IntUSDN1).label('IntUSDN1'),
								func.sum(LoanObj.c.NewDisAmountOtherFCN1).label('NewDisAmountOtherFCN1'),
								func.sum(LoanObj.c.NewIntOtherFCN1).label('NewIntOtherFCN1'),
								func.sum(LoanObj.c.OutOtherFCN1).label('OutOtherFCN1'),
								func.sum(LoanObj.c.IntOtherFCN1).label('IntOtherFCN1'),
								).\
								subquery()

	LoanObj = db.session.query(
								(LoanObj.c.NewDisbAmountKHRN1 / ReadAs).label('TotalNewDisAmountKHRN1'),
								case(
									[(
										LoanObj.c.NewDisbAmountKHRN1 != 0,
										LoanObj.c.NewIntKHRN1 / LoanObj.c.NewDisbAmountKHRN1
									)],
									else_=0
								).label('AvgNewIntKHRN1'),
								(LoanObj.c.OutKHRN1 / ReadAs).label('TotalOutKHRN1'),
								case(
									[(
										LoanObj.c.OutKHRN1 != 0,
										LoanObj.c.IntKHRN1 / LoanObj.c.OutKHRN1
									)],
									else_=0
								).label('AvgIntKHRN1'),
								(LoanObj.c.NewDisAmountUSDN1 / ReadAs).label('TotalNewDisAmountUSDN1'),
								case(
									[(
										LoanObj.c.NewDisAmountUSDN1 != 0,
										LoanObj.c.NewIntUSDN1 / LoanObj.c.NewDisAmountUSDN1
									)],
									else_=0
								).label('AvgNewIntUSDN1'),
								(LoanObj.c.OutUSDN1 / ReadAs).label('TotalOutUSDN1'),
								case(
									[(
										LoanObj.c.OutUSDN1 != 0,
										LoanObj.c.IntUSDN1 / LoanObj.c.OutUSDN1
									)],
									else_=0
								).label('AvgIntUSDN1'),
								(LoanObj.c.NewDisAmountOtherFCN1 / ReadAs).label('TotalNewDisAmountOtherFCN1'),
								case(
									[(
										LoanObj.c.NewDisAmountOtherFCN1 != 0,
										LoanObj.c.NewIntOtherFCN1 / LoanObj.c.NewDisAmountOtherFCN1
									)],
									else_=0
								).label('AvgNewIntOtherFCN1'),
								(LoanObj.c.OutOtherFCN1 / ReadAs).label('TotalOutOtherFCN1'),
								case(
									[(
										LoanObj.c.OutOtherFCN1 != 0,
										LoanObj.c.IntOtherFCN1 / LoanObj.c.OutOtherFCN1
									)],
									else_=0
								).label('AvgIntOtherFCN1')
								).\
								all()


	return LoanObj
