# -*- coding: utf-8 -*-
'''
Report Name: Balance Sheet
'''

from app.mktcore.imports 		import *
import app.tools.mktmessage 	as mktmessage
import app.tools.mktdate		as mktdate
import app.tools.mktnbc			as mktnbc
import app.tools.mktmoney		as mktmoney
from decimal import Decimal
from app.GLBalance.models 		import MKT_GL_BALANCE, MKT_GL_BALANCE_BACKUP

def getBANK01(Branch = "ALL", ReportedDate = "", Period = 2, Month = "", Year = "", NBC05=False):
	try:
		
		ID = 'N001'
		Result 			=	mktnbc.getNBCLineReport(ID, int(Period), Branch, ReportedDate, Year=Year, Month=Month)
		Data 			= 	Result[0].get("Data",[])
		# InDollar 		=	request.args.get('InDollar') if 'InDollar' in request.args else 'N'
		ReportingRate 	=	0#mktnbc.getDisplayReportingRate(Year, Month, Period)         

		ReportHeader 	=	mktnbc.getHeaderReport(	ReportName 		=	u'MONTHLY REPORT ON BALANCE SHEET',
													Title 			=	u'របាយការណ៏ប្រចាំខែសី្តពី ទ្រព្យសកម្ម និងទ្រព្យអកម្ម',
													Form 			=	'Balance Sheet')
		RecordRow 	= []
		ExcelRecord = {}
		TableHeader = {}

		ExcelRecord.update({
				"C4" : u'As of:  %s'% mktdate.formatDate(ReportedDate,'%d %B %Y'),
				"C5" : u'ឈ្មោះធនាគារ  : %s'%((ReportHeader.get('CompanyName',"")).splitlines())[0],
				"C6" : u' BANK NAME  : %s'%((ReportHeader.get('CompanyName',"")).splitlines())[1],
				"I8" : Decimal(ReportHeader.get('ReportingRate',0))
			})

		TableHeader = mktnbc.setTableHeader(Text=u'ទ្រព្យសកម្ម\nASSETS', 
											Rowspan=3,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'សមតុល្យដុលជារៀល ឬ គិតជារៀល​ \n Gross Amount in Riel or Translation in Riels', 
											Rowspan=2,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'1', 
											Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u' សំវិធានធន និង រំលស់ត្រូវដកចេញ \n Provision and Depreciation to be Deducted', 
											Rowspan=2,Colspan=0,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'2', 
											Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'សមតុល្យសុទ្ធបន្ទាប់ពីដកចេញសំវិធានធន និង​រំលស់​ \n Net Amount After Deduction of Provision and Depreciation', 
											Rowspan=0,Colspan=3,RowIndex=1, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រៀល \n Riels (KHR)', 
											Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'រូបិយប័ណ្្ណផ្សេងៗ \n Other Currencies Translated in KHR', 
											Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'សរុបជារៀល \n Total in KHR', 
											Rowspan=0,Colspan=0,RowIndex=2, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'3', 
											Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'4', 
											Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")
		TableHeader = mktnbc.setTableHeader(Text=u'5 = 1 - 2 = 3 + 4', 
											Rowspan=0,Colspan=0,RowIndex=3, TableHeader=TableHeader, Class="text-center")

		RowNumber = 14 
		for item in Data:
			row = dict(item)
			Description = row.get("Description","")
			GrossAmount = row.get("GrossAmount",0)
			AmountInRiel= row.get("AmountInRiels",0)
			OtherAmount = row.get("OtherAmount",0)
			ProvAmount 	= row.get("ProvisionAmount",0)
			TotalAmount = row.get("TotalInRiels",0)
			LineType 	= row.get("LineType",'LD')
			Indent		= row.get("Indent",0)
			RowBGColor 	= row.get("RowBGColor","")
			LineFormat  = row.get("LineFormat","")
			LineNumber 	= int(row.get("LineNumber",""))
			if (LineNumber >=1 and LineNumber <=70):
				RecordRow.append({
						1:Description,
						2:mktmoney.formatNumber(GrossAmount, 1, 2),
						3:mktmoney.formatNumber(ProvAmount, 1, 2),
						4:mktmoney.formatNumber(AmountInRiel, 1, 2),
						5:mktmoney.formatNumber(OtherAmount, 1, 2),
						6:mktmoney.formatNumber(TotalAmount, 1, 2),
						'LineType':LineType,
						'Indent':Indent,
						'RowBGColor':RowBGColor,
						'LineFormat':'LineFormat'
					})
				if LineNumber ==70:
					if NBC05==True:
						return TotalAmount
					RecordRow.append({
							1:u"ទ្រព្យអកម្ម និងមូលនិធិរបស់ភាគទុនិក\n LIABILITIES AND SHAREHOLDER'S EQUITY",
							2:u'',
							3:u'',
							4:u'រៀល\nRiels (KHR)',
							5:u'រូបិយប័ណ្ណផ្សេងៗ គិតជារៀល\nOther Currencies Translated in KHR',
							6:u'សរុបជារៀល\nTotal in KHR',
							'LineType':'GH',
							'Indent':Indent,
							'RowBGColor':RowBGColor,
							'LineFormat':'bold'
						})
			else:
				RecordRow.append({
						1:Description,
						2:u'',
						3:u'',
						4:mktmoney.formatNumber(AmountInRiel, 1, 1),
						5:mktmoney.formatNumber(OtherAmount, 1, 1),
						6:mktmoney.formatNumber(TotalAmount, 1, 1),
						'LineType':LineType,
						'Indent':Indent,
						'RowBGColor':RowBGColor,
						'LineFormat':'LineFormat'
					})
			if (LineNumber >=1 and LineNumber <=70):
				if LineType =='LD':
					ExcelRecord.update({
									"H%s"%(RowNumber) : ProvAmount,
									"I%s"%(RowNumber) : AmountInRiel,
									"J%s"%(RowNumber) : OtherAmount,
								})
			else:
				if RowNumber == 154:
					RowNumber += 4
				if LineType =='LD':
					ExcelRecord.update({
									"I%s"%(RowNumber) : AmountInRiel,
									"J%s"%(RowNumber) : OtherAmount,
								})
			RowNumber += 2
		Result = {'ReportHeader': ReportHeader, 'TableHeader': TableHeader, 'Data':RecordRow, 'Excel':ExcelRecord}
		CellSyle = {
					 'D9':'top*thin,FF000000',
					 'E9':'top*thin,FF000000',
					 'F9':'top*thin,FF000000',
					 'J9':'top*thin,FF000000',
					 'K9':'top*thin,FF000000:right*thin,FF000000',
					 'k10':'right*thin,FF000000',
					 'G10':'left*thin,FF000000:right*thin,FF000000',
					 'G12':'left*thin,FF000000:right*thin,FF000000:bottom*thin,FF000000',
					 'A10':'left*thin,FF000000',
					 'B10':'right*double,FF000000',
					 'A12':'left*thin,FF000000',
					 'B12':'right*double,FF000000',
					 'D13':'bottom*thin,FF000000',
					 'E13':'bottom*thin,FF000000',
					 'F13':'bottom*thin,FF000000',
					 'C15':'left*double,FF000000:bottom*thin,FF000000',
					 'H15':'left*thin,FF000000:right*thin,FF000000',
					 'J15':'left*thin,FF000000:right*thin,FF000000',
					 'I10':'bottom*thin,FF000000:left*thin,FF000000',
					 'J10':'bottom*thin,FF000000',
					 'K10':'bottom*thin,FF000000',
					 'K11':'top*thin,FF000000:right*thin,FF000000',
					 'H12':'bottom*thin,FF000000',
					 'I12':'bottom*thin,FF000000:left*thin,FF000000:right*thin,FF000000',
					 'J12':'bottom*thin,FF000000',
					 'K12':'bottom*thin,FF000000:left*thin,FF000000:right*thin,FF000000',
					 'K15':'right*thin,FF000000',
					 'B156':'right*thin,FF000000',
					}
		ExcelHeader = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]

		row = 16
		while row <= 154:			
			for col in range(2,11):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000"
				CellSyle.update({column:style})
			row+=2
		row = 16
		while row <= 153:			
			for col in range(6,11):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "left*thin,FF000000:right*thin,FF000000"
				CellSyle.update({column:style})
			row+=1
		row = 16
		while row <= 153:			
			for col in range(6,11):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000:left*thin,FF000000:right*thin,FF000000"
				CellSyle.update({column:style})
			row+=2
		row = 16
		while row <= 153:			
			for col in range(1,2):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000:left*thin,FF000000:right*thin,FF000000"
				CellSyle.update({column:style})
			row+=1

		row = 156
		while row <= 284:			
			for col in range(2,11):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000"
				CellSyle.update({column:style})
			row+=2
		row = 156
		while row <= 283:			
			for col in range(8,11):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "left*thin,FF000000:right*thin,FF000000"
				CellSyle.update({column:style})
			row+=1
		row = 156
		while row <= 283:			
			for col in range(8,11):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000:left*thin,FF000000:right*thin,FF000000"
				CellSyle.update({column:style})
			row+=2
		row = 156
		while row <= 283:			
			for col in range(1,2):
				column 	= "%s%s" % (ExcelHeader[col],row)
				style 	= "top*hair,FF000000:left*thin,FF000000:right*thin,FF000000"
				CellSyle.update({column:style})
			row+=1

		return Result,CellSyle
	except:
		raise