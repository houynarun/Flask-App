from app.mktcore.wtfimports 	import *
from .models 					import *
from app.Category.models 		import MKT_CATEGORY
import time

import app.tools.mktsetting 	as mktsetting
import app.tools.mkttool 		as mkttool
from app.Transaction.models		import MKT_TRANSACTION

def loadCategory():
	return MKT_CATEGORY.query

def loadTransaction():
	return MKT_TRANSACTION.query

class FRM_TAX(exform):

	Rate 			= TextField(requiredlabel("Rate", "*"), [validators.Required()])
	Description 	= TextField(requiredlabel("Description", "*"), [validators.Required()])
	
	if not mktsetting.getAppSetting("LEASING_TYPE_SETTING") == "Y":
		Category 		= QuerySelectField(requiredlabel('Tax Category', '*'),
										query_factory=loadCategory,
										get_label=lambda a: a.ID + " - " + a.Description,
										allow_blank=True,
										blank_text=u'--None--',
										validators=[validators.Required()]
									)
	if mktsetting.getAppSetting("LEASING_TYPE_SETTING") == "Y":
		Category 			= QuerySelectField(requiredlabel('VAT Output Category', '*'),
										query_factory=loadCategory,
										get_label=lambda a: a.ID + " - " + a.Description,
										allow_blank=True,
										blank_text=u'--None--',
										validators=[validators.Required()]
									)
		VATInputCategory 			= QuerySelectField(requiredlabel('VAT Input Category', '*'),
										query_factory=loadCategory,
										get_label=lambda a: a.ID + " - " + a.Description,
										allow_blank=True,
										blank_text=u'--None--',
										validators=[validators.Required()]
									)
		AccrVATOutputCategory 			= QuerySelectField(requiredlabel('Accr VAT Output Cate', '*'),
										query_factory=loadCategory,
										get_label=lambda a: a.ID + " - " + a.Description,
										allow_blank=True,
										blank_text=u'--None--',
										validators=[validators.Required()]
									)
		TaxExpenseCategory	=	QuerySelectField(requiredlabel('Tax Expense Category', '*'),
										query_factory=loadCategory,
										get_label=lambda a: a.ID + " - " + a.Description,
										allow_blank=True,
										blank_text=u'--None--',
										validators=[validators.Required()]
									)
		VATInputTransaction	=	QuerySelectField(requiredlabel('VAT Input Transaction', '*'),
										query_factory=loadTransaction,
										get_label=lambda a: a.ID + " - " + a.Description,
										allow_blank=True,
										blank_text=u'--None--',
										validators=[validators.Required()]
									)
		VATOutputTransaction	=	QuerySelectField(requiredlabel('VAT Output Transaction', '*'),
										query_factory=loadTransaction,
										get_label=lambda a: a.ID + " - " + a.Description,
										allow_blank=True,
										blank_text=u'--None--',
										validators=[validators.Required()]
									)

	def validate_Rate(form, field):
		Rate = form.Rate.data
		if Rate:
			if mkttool.isString(Rate):
				raise ValidationError('This field is required a number.')
			else:
				if Rate.find(',') != -1:
					raise ValidationError('This field is required a number.')


